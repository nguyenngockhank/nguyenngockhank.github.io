<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Whatsapp System | Nguyễn Khánk&#39;s Wiki</title>
    <meta name="generator" content="VuePress 1.7.1">
    <link rel="apple-touch-icon" sizes="180x180" href="../public/favicons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="../public/favicons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="../public/favicons/favicon-16x16.png">
    <link rel="manifest" href="../public/favicons/manifest.json">
    <link rel="mask-icon" href="../public/favicons/safari-pinned-tab.svg" color="#3a0839">
    <link rel="shortcut icon" href="../public/favicons/favicon.ico">
    <meta name="description" content="Wikipedia của tui">
    <meta name="msapplication-TileColor" content="#3a0839">
    <meta name="msapplication-config" content="../public/favicons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    
    <link rel="preload" href="/docs/assets/css/0.styles.6906ca04.css" as="style"><link rel="preload" href="/docs/assets/js/app.27d3c261.js" as="script"><link rel="preload" href="/docs/assets/js/2.1bcd0ab7.js" as="script"><link rel="preload" href="/docs/assets/js/39.764ba9f3.js" as="script"><link rel="preload" href="/docs/assets/js/76.b399e428.js" as="script"><link rel="prefetch" href="/docs/assets/js/10.7d3be4cf.js"><link rel="prefetch" href="/docs/assets/js/100.2ddc5290.js"><link rel="prefetch" href="/docs/assets/js/101.cf4111b7.js"><link rel="prefetch" href="/docs/assets/js/102.1f8d85d6.js"><link rel="prefetch" href="/docs/assets/js/103.ba4208e4.js"><link rel="prefetch" href="/docs/assets/js/104.6b5b2de2.js"><link rel="prefetch" href="/docs/assets/js/105.f02c7525.js"><link rel="prefetch" href="/docs/assets/js/106.d7891e0e.js"><link rel="prefetch" href="/docs/assets/js/107.1f7d95a3.js"><link rel="prefetch" href="/docs/assets/js/108.1f4627fe.js"><link rel="prefetch" href="/docs/assets/js/109.39278f35.js"><link rel="prefetch" href="/docs/assets/js/11.f3c2a9c1.js"><link rel="prefetch" href="/docs/assets/js/110.6f47e821.js"><link rel="prefetch" href="/docs/assets/js/111.0086327a.js"><link rel="prefetch" href="/docs/assets/js/112.c1d956ef.js"><link rel="prefetch" href="/docs/assets/js/113.f2d7c125.js"><link rel="prefetch" href="/docs/assets/js/114.ae487b90.js"><link rel="prefetch" href="/docs/assets/js/115.f5511eec.js"><link rel="prefetch" href="/docs/assets/js/116.52220f53.js"><link rel="prefetch" href="/docs/assets/js/117.7a3a232f.js"><link rel="prefetch" href="/docs/assets/js/118.ed6f3576.js"><link rel="prefetch" href="/docs/assets/js/119.d5cf7e77.js"><link rel="prefetch" href="/docs/assets/js/12.845592bf.js"><link rel="prefetch" href="/docs/assets/js/120.a1e5b00d.js"><link rel="prefetch" href="/docs/assets/js/121.658f27fe.js"><link rel="prefetch" href="/docs/assets/js/122.3550e41f.js"><link rel="prefetch" href="/docs/assets/js/123.3e6d64c4.js"><link rel="prefetch" href="/docs/assets/js/124.31b9bafa.js"><link rel="prefetch" href="/docs/assets/js/125.e855cb93.js"><link rel="prefetch" href="/docs/assets/js/126.2463786f.js"><link rel="prefetch" href="/docs/assets/js/127.752de146.js"><link rel="prefetch" href="/docs/assets/js/128.f70e8475.js"><link rel="prefetch" href="/docs/assets/js/129.5a1fb146.js"><link rel="prefetch" href="/docs/assets/js/13.cc7f5455.js"><link rel="prefetch" href="/docs/assets/js/130.4f15d6c2.js"><link rel="prefetch" href="/docs/assets/js/131.531b59bc.js"><link rel="prefetch" href="/docs/assets/js/132.ec40e8f3.js"><link rel="prefetch" href="/docs/assets/js/133.68d3fcab.js"><link rel="prefetch" href="/docs/assets/js/134.7a3b67cf.js"><link rel="prefetch" href="/docs/assets/js/135.b679b1b2.js"><link rel="prefetch" href="/docs/assets/js/136.4e8a7825.js"><link rel="prefetch" href="/docs/assets/js/137.3455596d.js"><link rel="prefetch" href="/docs/assets/js/138.019cc42a.js"><link rel="prefetch" href="/docs/assets/js/139.40c5098b.js"><link rel="prefetch" href="/docs/assets/js/14.c4a9d536.js"><link rel="prefetch" href="/docs/assets/js/140.4a080a85.js"><link rel="prefetch" href="/docs/assets/js/141.8828441b.js"><link rel="prefetch" href="/docs/assets/js/142.31913dc4.js"><link rel="prefetch" href="/docs/assets/js/143.6c46bafd.js"><link rel="prefetch" href="/docs/assets/js/144.5a751cac.js"><link rel="prefetch" href="/docs/assets/js/145.9b0eb3a3.js"><link rel="prefetch" href="/docs/assets/js/146.402510f9.js"><link rel="prefetch" href="/docs/assets/js/147.80e7777c.js"><link rel="prefetch" href="/docs/assets/js/148.e2702e57.js"><link rel="prefetch" href="/docs/assets/js/149.a9c54954.js"><link rel="prefetch" href="/docs/assets/js/15.5f510e3a.js"><link rel="prefetch" href="/docs/assets/js/150.56462aeb.js"><link rel="prefetch" href="/docs/assets/js/151.6ed9fd6c.js"><link rel="prefetch" href="/docs/assets/js/152.fb00113a.js"><link rel="prefetch" href="/docs/assets/js/153.f5365ede.js"><link rel="prefetch" href="/docs/assets/js/154.7afcf13c.js"><link rel="prefetch" href="/docs/assets/js/155.96dcb17c.js"><link rel="prefetch" href="/docs/assets/js/156.efbb973b.js"><link rel="prefetch" href="/docs/assets/js/157.88139be9.js"><link rel="prefetch" href="/docs/assets/js/158.43570c7f.js"><link rel="prefetch" href="/docs/assets/js/159.1c6a5350.js"><link rel="prefetch" href="/docs/assets/js/16.c7524b39.js"><link rel="prefetch" href="/docs/assets/js/160.dcb1882e.js"><link rel="prefetch" href="/docs/assets/js/161.d592400d.js"><link rel="prefetch" href="/docs/assets/js/162.de363d34.js"><link rel="prefetch" href="/docs/assets/js/163.45acec99.js"><link rel="prefetch" href="/docs/assets/js/164.793b3085.js"><link rel="prefetch" href="/docs/assets/js/165.721ff4a8.js"><link rel="prefetch" href="/docs/assets/js/166.f86e935a.js"><link rel="prefetch" href="/docs/assets/js/167.fa63a9a8.js"><link rel="prefetch" href="/docs/assets/js/168.45ac9908.js"><link rel="prefetch" href="/docs/assets/js/169.964850cb.js"><link rel="prefetch" href="/docs/assets/js/17.401ba843.js"><link rel="prefetch" href="/docs/assets/js/170.9388d824.js"><link rel="prefetch" href="/docs/assets/js/171.e7a6d54a.js"><link rel="prefetch" href="/docs/assets/js/172.37a37170.js"><link rel="prefetch" href="/docs/assets/js/173.5d69f97e.js"><link rel="prefetch" href="/docs/assets/js/174.1d5b4efe.js"><link rel="prefetch" href="/docs/assets/js/175.0b9bc1b8.js"><link rel="prefetch" href="/docs/assets/js/176.dfe41978.js"><link rel="prefetch" href="/docs/assets/js/177.54853c4e.js"><link rel="prefetch" href="/docs/assets/js/178.07f4278d.js"><link rel="prefetch" href="/docs/assets/js/179.29563271.js"><link rel="prefetch" href="/docs/assets/js/18.8471641f.js"><link rel="prefetch" href="/docs/assets/js/180.01c28872.js"><link rel="prefetch" href="/docs/assets/js/181.d8249bd6.js"><link rel="prefetch" href="/docs/assets/js/182.c484f0ed.js"><link rel="prefetch" href="/docs/assets/js/183.89632de3.js"><link rel="prefetch" href="/docs/assets/js/184.92bbfd3b.js"><link rel="prefetch" href="/docs/assets/js/185.01ca80d5.js"><link rel="prefetch" href="/docs/assets/js/186.178b43cf.js"><link rel="prefetch" href="/docs/assets/js/187.956ef69b.js"><link rel="prefetch" href="/docs/assets/js/188.242f7ce1.js"><link rel="prefetch" href="/docs/assets/js/189.5f41b63a.js"><link rel="prefetch" href="/docs/assets/js/19.ca12d090.js"><link rel="prefetch" href="/docs/assets/js/190.6b087bfb.js"><link rel="prefetch" href="/docs/assets/js/191.d119f4ff.js"><link rel="prefetch" href="/docs/assets/js/192.6e4a663f.js"><link rel="prefetch" href="/docs/assets/js/193.0cb1ed0a.js"><link rel="prefetch" href="/docs/assets/js/194.ef249711.js"><link rel="prefetch" href="/docs/assets/js/195.9b9db024.js"><link rel="prefetch" href="/docs/assets/js/196.1e7f33e0.js"><link rel="prefetch" href="/docs/assets/js/197.5ef68316.js"><link rel="prefetch" href="/docs/assets/js/198.c6b94c6c.js"><link rel="prefetch" href="/docs/assets/js/199.50431014.js"><link rel="prefetch" href="/docs/assets/js/20.f0a466d9.js"><link rel="prefetch" href="/docs/assets/js/200.9bdf3454.js"><link rel="prefetch" href="/docs/assets/js/201.724fa19a.js"><link rel="prefetch" href="/docs/assets/js/202.cb5f0f75.js"><link rel="prefetch" href="/docs/assets/js/203.8a764e22.js"><link rel="prefetch" href="/docs/assets/js/204.fe9d33f5.js"><link rel="prefetch" href="/docs/assets/js/205.4dfd60a9.js"><link rel="prefetch" href="/docs/assets/js/206.6c87e3c7.js"><link rel="prefetch" href="/docs/assets/js/207.d30019a8.js"><link rel="prefetch" href="/docs/assets/js/208.cbd42dae.js"><link rel="prefetch" href="/docs/assets/js/209.90dc6c14.js"><link rel="prefetch" href="/docs/assets/js/21.4865599a.js"><link rel="prefetch" href="/docs/assets/js/210.052839f5.js"><link rel="prefetch" href="/docs/assets/js/211.1985741d.js"><link rel="prefetch" href="/docs/assets/js/212.d1793a25.js"><link rel="prefetch" href="/docs/assets/js/213.5305fef2.js"><link rel="prefetch" href="/docs/assets/js/214.dfc351bb.js"><link rel="prefetch" href="/docs/assets/js/215.ef7d5942.js"><link rel="prefetch" href="/docs/assets/js/216.07f63a51.js"><link rel="prefetch" href="/docs/assets/js/217.c87ee229.js"><link rel="prefetch" href="/docs/assets/js/218.0e62d5b3.js"><link rel="prefetch" href="/docs/assets/js/219.0cc1c53f.js"><link rel="prefetch" href="/docs/assets/js/22.5de3042c.js"><link rel="prefetch" href="/docs/assets/js/220.f9c23ad4.js"><link rel="prefetch" href="/docs/assets/js/221.3b3b3867.js"><link rel="prefetch" href="/docs/assets/js/222.fea7308e.js"><link rel="prefetch" href="/docs/assets/js/223.3f74b197.js"><link rel="prefetch" href="/docs/assets/js/224.f23b0992.js"><link rel="prefetch" href="/docs/assets/js/225.e0db39ea.js"><link rel="prefetch" href="/docs/assets/js/226.b0ac1d55.js"><link rel="prefetch" href="/docs/assets/js/227.1fb5a751.js"><link rel="prefetch" href="/docs/assets/js/228.f0cfe474.js"><link rel="prefetch" href="/docs/assets/js/229.c430a419.js"><link rel="prefetch" href="/docs/assets/js/23.b236a3f0.js"><link rel="prefetch" href="/docs/assets/js/230.7b11d083.js"><link rel="prefetch" href="/docs/assets/js/231.9bd18ba0.js"><link rel="prefetch" href="/docs/assets/js/232.8786f695.js"><link rel="prefetch" href="/docs/assets/js/233.177685ff.js"><link rel="prefetch" href="/docs/assets/js/234.2c265c6e.js"><link rel="prefetch" href="/docs/assets/js/235.0e89649c.js"><link rel="prefetch" href="/docs/assets/js/236.5756271e.js"><link rel="prefetch" href="/docs/assets/js/237.76fe98e0.js"><link rel="prefetch" href="/docs/assets/js/238.3b77d394.js"><link rel="prefetch" href="/docs/assets/js/239.b656e84d.js"><link rel="prefetch" href="/docs/assets/js/24.8791cc1d.js"><link rel="prefetch" href="/docs/assets/js/240.bcbe1c7a.js"><link rel="prefetch" href="/docs/assets/js/241.5a1a30b8.js"><link rel="prefetch" href="/docs/assets/js/242.5215120f.js"><link rel="prefetch" href="/docs/assets/js/243.ea85e2a7.js"><link rel="prefetch" href="/docs/assets/js/244.7b6da559.js"><link rel="prefetch" href="/docs/assets/js/245.016a11ac.js"><link rel="prefetch" href="/docs/assets/js/246.31e3e7cd.js"><link rel="prefetch" href="/docs/assets/js/247.d93b9031.js"><link rel="prefetch" href="/docs/assets/js/248.77e44e91.js"><link rel="prefetch" href="/docs/assets/js/249.12a34566.js"><link rel="prefetch" href="/docs/assets/js/25.3c142bbc.js"><link rel="prefetch" href="/docs/assets/js/250.bf9fade8.js"><link rel="prefetch" href="/docs/assets/js/251.45421dde.js"><link rel="prefetch" href="/docs/assets/js/252.4466bb8c.js"><link rel="prefetch" href="/docs/assets/js/253.d6ee5a67.js"><link rel="prefetch" href="/docs/assets/js/254.e0936801.js"><link rel="prefetch" href="/docs/assets/js/255.f0570e97.js"><link rel="prefetch" href="/docs/assets/js/256.fecc35ae.js"><link rel="prefetch" href="/docs/assets/js/257.9ea68e25.js"><link rel="prefetch" href="/docs/assets/js/258.b8ffb3a3.js"><link rel="prefetch" href="/docs/assets/js/259.25998716.js"><link rel="prefetch" href="/docs/assets/js/26.db53637c.js"><link rel="prefetch" href="/docs/assets/js/260.023b39be.js"><link rel="prefetch" href="/docs/assets/js/261.79e140f0.js"><link rel="prefetch" href="/docs/assets/js/262.6ce9fc61.js"><link rel="prefetch" href="/docs/assets/js/263.551c8c47.js"><link rel="prefetch" href="/docs/assets/js/264.bb89f9cd.js"><link rel="prefetch" href="/docs/assets/js/265.e59f0127.js"><link rel="prefetch" href="/docs/assets/js/266.c442bcc9.js"><link rel="prefetch" href="/docs/assets/js/267.f68bcc94.js"><link rel="prefetch" href="/docs/assets/js/268.ef6a957a.js"><link rel="prefetch" href="/docs/assets/js/269.392b53ec.js"><link rel="prefetch" href="/docs/assets/js/27.8ec8d94b.js"><link rel="prefetch" href="/docs/assets/js/270.44817cce.js"><link rel="prefetch" href="/docs/assets/js/271.fa763f2c.js"><link rel="prefetch" href="/docs/assets/js/272.8ffda064.js"><link rel="prefetch" href="/docs/assets/js/273.aef4ee8e.js"><link rel="prefetch" href="/docs/assets/js/274.b3caa203.js"><link rel="prefetch" href="/docs/assets/js/275.af2c8f7a.js"><link rel="prefetch" href="/docs/assets/js/276.f0f84c4e.js"><link rel="prefetch" href="/docs/assets/js/277.4fc631c7.js"><link rel="prefetch" href="/docs/assets/js/278.aeec55e5.js"><link rel="prefetch" href="/docs/assets/js/279.4feee6ae.js"><link rel="prefetch" href="/docs/assets/js/28.aa7dca10.js"><link rel="prefetch" href="/docs/assets/js/280.0a61b0c2.js"><link rel="prefetch" href="/docs/assets/js/281.5c096efd.js"><link rel="prefetch" href="/docs/assets/js/282.2b174188.js"><link rel="prefetch" href="/docs/assets/js/283.ece66307.js"><link rel="prefetch" href="/docs/assets/js/284.46af2bcf.js"><link rel="prefetch" href="/docs/assets/js/285.eba87a92.js"><link rel="prefetch" href="/docs/assets/js/286.9ea332d8.js"><link rel="prefetch" href="/docs/assets/js/287.0d06d1bf.js"><link rel="prefetch" href="/docs/assets/js/288.6523b138.js"><link rel="prefetch" href="/docs/assets/js/289.09d51bab.js"><link rel="prefetch" href="/docs/assets/js/29.d1952a3c.js"><link rel="prefetch" href="/docs/assets/js/290.ab0fde48.js"><link rel="prefetch" href="/docs/assets/js/291.2eae1174.js"><link rel="prefetch" href="/docs/assets/js/292.2331fffe.js"><link rel="prefetch" href="/docs/assets/js/293.39540046.js"><link rel="prefetch" href="/docs/assets/js/294.9dedad59.js"><link rel="prefetch" href="/docs/assets/js/295.7dca099f.js"><link rel="prefetch" href="/docs/assets/js/296.871dfaf6.js"><link rel="prefetch" href="/docs/assets/js/297.3f5bf59c.js"><link rel="prefetch" href="/docs/assets/js/298.63fefc36.js"><link rel="prefetch" href="/docs/assets/js/299.8e4b1c98.js"><link rel="prefetch" href="/docs/assets/js/3.a06a8ace.js"><link rel="prefetch" href="/docs/assets/js/30.4aac3d75.js"><link rel="prefetch" href="/docs/assets/js/300.76031aab.js"><link rel="prefetch" href="/docs/assets/js/301.8ff1c7e8.js"><link rel="prefetch" href="/docs/assets/js/302.6a02c992.js"><link rel="prefetch" href="/docs/assets/js/303.e410479b.js"><link rel="prefetch" href="/docs/assets/js/304.df2f90e6.js"><link rel="prefetch" href="/docs/assets/js/305.96812133.js"><link rel="prefetch" href="/docs/assets/js/306.581d404c.js"><link rel="prefetch" href="/docs/assets/js/307.45ff2a21.js"><link rel="prefetch" href="/docs/assets/js/308.b1ecc601.js"><link rel="prefetch" href="/docs/assets/js/309.866371b2.js"><link rel="prefetch" href="/docs/assets/js/31.a6b5b562.js"><link rel="prefetch" href="/docs/assets/js/310.1f3ab98c.js"><link rel="prefetch" href="/docs/assets/js/311.d8040f52.js"><link rel="prefetch" href="/docs/assets/js/312.26e2f8e3.js"><link rel="prefetch" href="/docs/assets/js/313.2cb1ab35.js"><link rel="prefetch" href="/docs/assets/js/314.69e3f1e3.js"><link rel="prefetch" href="/docs/assets/js/315.1b013781.js"><link rel="prefetch" href="/docs/assets/js/316.699db380.js"><link rel="prefetch" href="/docs/assets/js/317.3d5cc81f.js"><link rel="prefetch" href="/docs/assets/js/318.a4415143.js"><link rel="prefetch" href="/docs/assets/js/319.83787fcc.js"><link rel="prefetch" href="/docs/assets/js/32.5194944e.js"><link rel="prefetch" href="/docs/assets/js/320.5eca1ec1.js"><link rel="prefetch" href="/docs/assets/js/321.569fa271.js"><link rel="prefetch" href="/docs/assets/js/322.a494d1e4.js"><link rel="prefetch" href="/docs/assets/js/323.e20fe2a8.js"><link rel="prefetch" href="/docs/assets/js/324.5eca8247.js"><link rel="prefetch" href="/docs/assets/js/325.2a62bb04.js"><link rel="prefetch" href="/docs/assets/js/326.e2fd4abe.js"><link rel="prefetch" href="/docs/assets/js/327.3b27dd03.js"><link rel="prefetch" href="/docs/assets/js/328.77a5e1d8.js"><link rel="prefetch" href="/docs/assets/js/329.a5d36b60.js"><link rel="prefetch" href="/docs/assets/js/33.21741262.js"><link rel="prefetch" href="/docs/assets/js/330.dc825092.js"><link rel="prefetch" href="/docs/assets/js/331.bd98830a.js"><link rel="prefetch" href="/docs/assets/js/332.d34855d5.js"><link rel="prefetch" href="/docs/assets/js/333.a08b36a9.js"><link rel="prefetch" href="/docs/assets/js/334.d3673bb0.js"><link rel="prefetch" href="/docs/assets/js/335.ed3434ae.js"><link rel="prefetch" href="/docs/assets/js/336.bb734b28.js"><link rel="prefetch" href="/docs/assets/js/337.05e1276b.js"><link rel="prefetch" href="/docs/assets/js/338.facd228f.js"><link rel="prefetch" href="/docs/assets/js/339.17b93350.js"><link rel="prefetch" href="/docs/assets/js/34.9f866e87.js"><link rel="prefetch" href="/docs/assets/js/340.e509926e.js"><link rel="prefetch" href="/docs/assets/js/341.dbd4887c.js"><link rel="prefetch" href="/docs/assets/js/342.97e6c801.js"><link rel="prefetch" href="/docs/assets/js/343.71bf2ab8.js"><link rel="prefetch" href="/docs/assets/js/344.2547a86a.js"><link rel="prefetch" href="/docs/assets/js/345.e3e5af3c.js"><link rel="prefetch" href="/docs/assets/js/346.46d183cc.js"><link rel="prefetch" href="/docs/assets/js/347.ae0f1c23.js"><link rel="prefetch" href="/docs/assets/js/348.c5631877.js"><link rel="prefetch" href="/docs/assets/js/349.734a7cb4.js"><link rel="prefetch" href="/docs/assets/js/35.72d29139.js"><link rel="prefetch" href="/docs/assets/js/350.db0487ef.js"><link rel="prefetch" href="/docs/assets/js/351.9bd10f73.js"><link rel="prefetch" href="/docs/assets/js/352.6c24462c.js"><link rel="prefetch" href="/docs/assets/js/353.75e2d0ed.js"><link rel="prefetch" href="/docs/assets/js/354.45b703dd.js"><link rel="prefetch" href="/docs/assets/js/355.5a992658.js"><link rel="prefetch" href="/docs/assets/js/356.08d26dc2.js"><link rel="prefetch" href="/docs/assets/js/357.66d9628d.js"><link rel="prefetch" href="/docs/assets/js/358.a0d62fae.js"><link rel="prefetch" href="/docs/assets/js/359.f7fa5c1b.js"><link rel="prefetch" href="/docs/assets/js/36.a918418a.js"><link rel="prefetch" href="/docs/assets/js/360.9efc11e5.js"><link rel="prefetch" href="/docs/assets/js/361.a11d4c98.js"><link rel="prefetch" href="/docs/assets/js/362.fb9f1eee.js"><link rel="prefetch" href="/docs/assets/js/363.af27a8dd.js"><link rel="prefetch" href="/docs/assets/js/364.aaea03de.js"><link rel="prefetch" href="/docs/assets/js/365.00ef7f6b.js"><link rel="prefetch" href="/docs/assets/js/366.dcae068b.js"><link rel="prefetch" href="/docs/assets/js/367.f222d1fc.js"><link rel="prefetch" href="/docs/assets/js/368.f6ad2988.js"><link rel="prefetch" href="/docs/assets/js/369.d905d75d.js"><link rel="prefetch" href="/docs/assets/js/37.ab12d302.js"><link rel="prefetch" href="/docs/assets/js/370.7aa593f9.js"><link rel="prefetch" href="/docs/assets/js/371.b93fda14.js"><link rel="prefetch" href="/docs/assets/js/372.5d7a7de3.js"><link rel="prefetch" href="/docs/assets/js/373.99ba5d69.js"><link rel="prefetch" href="/docs/assets/js/374.6995fd47.js"><link rel="prefetch" href="/docs/assets/js/375.232022e5.js"><link rel="prefetch" href="/docs/assets/js/376.79696cde.js"><link rel="prefetch" href="/docs/assets/js/377.0e54b707.js"><link rel="prefetch" href="/docs/assets/js/378.a7d75089.js"><link rel="prefetch" href="/docs/assets/js/379.6126cfd4.js"><link rel="prefetch" href="/docs/assets/js/38.affec0f1.js"><link rel="prefetch" href="/docs/assets/js/380.a25f5734.js"><link rel="prefetch" href="/docs/assets/js/381.0039be98.js"><link rel="prefetch" href="/docs/assets/js/382.ee3203b2.js"><link rel="prefetch" href="/docs/assets/js/383.eb2da14a.js"><link rel="prefetch" href="/docs/assets/js/384.db7a1e9c.js"><link rel="prefetch" href="/docs/assets/js/385.3e317db4.js"><link rel="prefetch" href="/docs/assets/js/386.18b62699.js"><link rel="prefetch" href="/docs/assets/js/387.80f0198b.js"><link rel="prefetch" href="/docs/assets/js/388.0c113d80.js"><link rel="prefetch" href="/docs/assets/js/389.1fb1309f.js"><link rel="prefetch" href="/docs/assets/js/390.6426b620.js"><link rel="prefetch" href="/docs/assets/js/391.9939bd79.js"><link rel="prefetch" href="/docs/assets/js/392.246daee5.js"><link rel="prefetch" href="/docs/assets/js/393.5c2e277f.js"><link rel="prefetch" href="/docs/assets/js/394.8d1658bb.js"><link rel="prefetch" href="/docs/assets/js/395.9d26f7d5.js"><link rel="prefetch" href="/docs/assets/js/396.7251f06a.js"><link rel="prefetch" href="/docs/assets/js/397.f9bcc3a1.js"><link rel="prefetch" href="/docs/assets/js/398.03f37825.js"><link rel="prefetch" href="/docs/assets/js/399.03fac731.js"><link rel="prefetch" href="/docs/assets/js/4.d01d3543.js"><link rel="prefetch" href="/docs/assets/js/40.45463c3d.js"><link rel="prefetch" href="/docs/assets/js/400.cfe1e2ec.js"><link rel="prefetch" href="/docs/assets/js/401.501c08fb.js"><link rel="prefetch" href="/docs/assets/js/402.fe0bcf0f.js"><link rel="prefetch" href="/docs/assets/js/403.243b4761.js"><link rel="prefetch" href="/docs/assets/js/404.8c62f39c.js"><link rel="prefetch" href="/docs/assets/js/405.592e0c7d.js"><link rel="prefetch" href="/docs/assets/js/406.05642799.js"><link rel="prefetch" href="/docs/assets/js/407.262af7bf.js"><link rel="prefetch" href="/docs/assets/js/408.430c571d.js"><link rel="prefetch" href="/docs/assets/js/409.2c69f452.js"><link rel="prefetch" href="/docs/assets/js/41.45d44aec.js"><link rel="prefetch" href="/docs/assets/js/410.74543cb6.js"><link rel="prefetch" href="/docs/assets/js/411.21ca8c9b.js"><link rel="prefetch" href="/docs/assets/js/412.57dccb21.js"><link rel="prefetch" href="/docs/assets/js/413.cf00aa33.js"><link rel="prefetch" href="/docs/assets/js/414.cb5cd19e.js"><link rel="prefetch" href="/docs/assets/js/415.7282bfa0.js"><link rel="prefetch" href="/docs/assets/js/416.2b17ac80.js"><link rel="prefetch" href="/docs/assets/js/417.7dc5cbc1.js"><link rel="prefetch" href="/docs/assets/js/418.8a0a9361.js"><link rel="prefetch" href="/docs/assets/js/419.637d5672.js"><link rel="prefetch" href="/docs/assets/js/42.f81cdf79.js"><link rel="prefetch" href="/docs/assets/js/420.a145e1b9.js"><link rel="prefetch" href="/docs/assets/js/421.625ee75a.js"><link rel="prefetch" href="/docs/assets/js/422.4de765ec.js"><link rel="prefetch" href="/docs/assets/js/423.fd362d1e.js"><link rel="prefetch" href="/docs/assets/js/424.51688310.js"><link rel="prefetch" href="/docs/assets/js/425.0a1d3a73.js"><link rel="prefetch" href="/docs/assets/js/426.99a356c2.js"><link rel="prefetch" href="/docs/assets/js/427.885d74c2.js"><link rel="prefetch" href="/docs/assets/js/428.311ec3ee.js"><link rel="prefetch" href="/docs/assets/js/429.14bba901.js"><link rel="prefetch" href="/docs/assets/js/43.b5f746f3.js"><link rel="prefetch" href="/docs/assets/js/430.9c804c64.js"><link rel="prefetch" href="/docs/assets/js/431.bf38b4a9.js"><link rel="prefetch" href="/docs/assets/js/432.f3eb35a7.js"><link rel="prefetch" href="/docs/assets/js/433.d36eece4.js"><link rel="prefetch" href="/docs/assets/js/434.4cae5ecf.js"><link rel="prefetch" href="/docs/assets/js/435.9452c399.js"><link rel="prefetch" href="/docs/assets/js/436.aa5eca9a.js"><link rel="prefetch" href="/docs/assets/js/437.8a85efa9.js"><link rel="prefetch" href="/docs/assets/js/438.2cd0342a.js"><link rel="prefetch" href="/docs/assets/js/439.983c2d69.js"><link rel="prefetch" href="/docs/assets/js/44.b6a1cfd5.js"><link rel="prefetch" href="/docs/assets/js/440.c7bba290.js"><link rel="prefetch" href="/docs/assets/js/441.b152c5db.js"><link rel="prefetch" href="/docs/assets/js/442.7f0d6fd3.js"><link rel="prefetch" href="/docs/assets/js/443.e306b52a.js"><link rel="prefetch" href="/docs/assets/js/444.3a0f3151.js"><link rel="prefetch" href="/docs/assets/js/445.10950c03.js"><link rel="prefetch" href="/docs/assets/js/446.527e460c.js"><link rel="prefetch" href="/docs/assets/js/447.68c98ce7.js"><link rel="prefetch" href="/docs/assets/js/448.16f8a0e7.js"><link rel="prefetch" href="/docs/assets/js/449.be95aa9c.js"><link rel="prefetch" href="/docs/assets/js/45.1dc1f37b.js"><link rel="prefetch" href="/docs/assets/js/450.dee844be.js"><link rel="prefetch" href="/docs/assets/js/451.58c1ffae.js"><link rel="prefetch" href="/docs/assets/js/452.5a6cd3f3.js"><link rel="prefetch" href="/docs/assets/js/453.c72dca21.js"><link rel="prefetch" href="/docs/assets/js/454.3702d1a7.js"><link rel="prefetch" href="/docs/assets/js/455.1a8ac8c9.js"><link rel="prefetch" href="/docs/assets/js/456.c499e227.js"><link rel="prefetch" href="/docs/assets/js/457.53e389ee.js"><link rel="prefetch" href="/docs/assets/js/458.7c3b4754.js"><link rel="prefetch" href="/docs/assets/js/459.5138bf12.js"><link rel="prefetch" href="/docs/assets/js/46.97494c0e.js"><link rel="prefetch" href="/docs/assets/js/460.158493a6.js"><link rel="prefetch" href="/docs/assets/js/461.d46d587b.js"><link rel="prefetch" href="/docs/assets/js/462.11bd9fc1.js"><link rel="prefetch" href="/docs/assets/js/463.3514b8c2.js"><link rel="prefetch" href="/docs/assets/js/464.d74456e7.js"><link rel="prefetch" href="/docs/assets/js/465.c5a90afa.js"><link rel="prefetch" href="/docs/assets/js/466.133d4874.js"><link rel="prefetch" href="/docs/assets/js/467.4d8c72a1.js"><link rel="prefetch" href="/docs/assets/js/468.c61817f3.js"><link rel="prefetch" href="/docs/assets/js/469.8cde492d.js"><link rel="prefetch" href="/docs/assets/js/47.48a26d13.js"><link rel="prefetch" href="/docs/assets/js/470.cda1171e.js"><link rel="prefetch" href="/docs/assets/js/471.843b56ff.js"><link rel="prefetch" href="/docs/assets/js/472.760aaa33.js"><link rel="prefetch" href="/docs/assets/js/473.d2126001.js"><link rel="prefetch" href="/docs/assets/js/474.7ac230e5.js"><link rel="prefetch" href="/docs/assets/js/475.94305226.js"><link rel="prefetch" href="/docs/assets/js/476.7fe7f1d0.js"><link rel="prefetch" href="/docs/assets/js/477.ec3d8f63.js"><link rel="prefetch" href="/docs/assets/js/478.0ca6899c.js"><link rel="prefetch" href="/docs/assets/js/479.095831d6.js"><link rel="prefetch" href="/docs/assets/js/48.4a8d7f54.js"><link rel="prefetch" href="/docs/assets/js/480.27310ec0.js"><link rel="prefetch" href="/docs/assets/js/481.801e016b.js"><link rel="prefetch" href="/docs/assets/js/482.662fbf55.js"><link rel="prefetch" href="/docs/assets/js/483.ece925d6.js"><link rel="prefetch" href="/docs/assets/js/484.6a75b7df.js"><link rel="prefetch" href="/docs/assets/js/485.fd7d9af2.js"><link rel="prefetch" href="/docs/assets/js/486.258cad5c.js"><link rel="prefetch" href="/docs/assets/js/487.10ed1c39.js"><link rel="prefetch" href="/docs/assets/js/488.141f82fb.js"><link rel="prefetch" href="/docs/assets/js/489.fdce0612.js"><link rel="prefetch" href="/docs/assets/js/49.7c893923.js"><link rel="prefetch" href="/docs/assets/js/490.cc335a35.js"><link rel="prefetch" href="/docs/assets/js/491.4676e3bd.js"><link rel="prefetch" href="/docs/assets/js/492.0a97b86c.js"><link rel="prefetch" href="/docs/assets/js/493.9171a002.js"><link rel="prefetch" href="/docs/assets/js/494.aa172dbd.js"><link rel="prefetch" href="/docs/assets/js/495.cec3dac2.js"><link rel="prefetch" href="/docs/assets/js/496.6e17d924.js"><link rel="prefetch" href="/docs/assets/js/497.d8cfc3ca.js"><link rel="prefetch" href="/docs/assets/js/498.0f5eb4ef.js"><link rel="prefetch" href="/docs/assets/js/499.ad5628fb.js"><link rel="prefetch" href="/docs/assets/js/5.ac85f284.js"><link rel="prefetch" href="/docs/assets/js/50.676a1211.js"><link rel="prefetch" href="/docs/assets/js/500.2a6c2b95.js"><link rel="prefetch" href="/docs/assets/js/501.5cd66745.js"><link rel="prefetch" href="/docs/assets/js/502.b06cc960.js"><link rel="prefetch" href="/docs/assets/js/503.070a6700.js"><link rel="prefetch" href="/docs/assets/js/504.3f394165.js"><link rel="prefetch" href="/docs/assets/js/505.fb53d458.js"><link rel="prefetch" href="/docs/assets/js/506.d48b02c2.js"><link rel="prefetch" href="/docs/assets/js/507.362c2c50.js"><link rel="prefetch" href="/docs/assets/js/508.a5d13947.js"><link rel="prefetch" href="/docs/assets/js/509.f9570646.js"><link rel="prefetch" href="/docs/assets/js/51.07fd4604.js"><link rel="prefetch" href="/docs/assets/js/510.6ce37426.js"><link rel="prefetch" href="/docs/assets/js/511.aa0b9e5d.js"><link rel="prefetch" href="/docs/assets/js/512.055e0b70.js"><link rel="prefetch" href="/docs/assets/js/513.0f707642.js"><link rel="prefetch" href="/docs/assets/js/514.22bd3829.js"><link rel="prefetch" href="/docs/assets/js/515.4980abb7.js"><link rel="prefetch" href="/docs/assets/js/516.65bd537e.js"><link rel="prefetch" href="/docs/assets/js/517.6651b77b.js"><link rel="prefetch" href="/docs/assets/js/518.5fa6e4cd.js"><link rel="prefetch" href="/docs/assets/js/519.a110d135.js"><link rel="prefetch" href="/docs/assets/js/52.cc28f62d.js"><link rel="prefetch" href="/docs/assets/js/520.dbb717e2.js"><link rel="prefetch" href="/docs/assets/js/521.fc4af9d5.js"><link rel="prefetch" href="/docs/assets/js/522.76a94caf.js"><link rel="prefetch" href="/docs/assets/js/523.82d46188.js"><link rel="prefetch" href="/docs/assets/js/524.21ed943b.js"><link rel="prefetch" href="/docs/assets/js/525.0791dcbf.js"><link rel="prefetch" href="/docs/assets/js/526.b70f48f7.js"><link rel="prefetch" href="/docs/assets/js/527.d152e869.js"><link rel="prefetch" href="/docs/assets/js/528.4a19707a.js"><link rel="prefetch" href="/docs/assets/js/529.dd2eb9d5.js"><link rel="prefetch" href="/docs/assets/js/53.4157dba3.js"><link rel="prefetch" href="/docs/assets/js/530.a9d764f0.js"><link rel="prefetch" href="/docs/assets/js/531.3ade3535.js"><link rel="prefetch" href="/docs/assets/js/532.837c0252.js"><link rel="prefetch" href="/docs/assets/js/533.31cd692b.js"><link rel="prefetch" href="/docs/assets/js/534.9a4a3dce.js"><link rel="prefetch" href="/docs/assets/js/535.ba6a0f29.js"><link rel="prefetch" href="/docs/assets/js/536.aec6c32b.js"><link rel="prefetch" href="/docs/assets/js/537.c2ac7ea3.js"><link rel="prefetch" href="/docs/assets/js/538.4d170343.js"><link rel="prefetch" href="/docs/assets/js/539.3fea416f.js"><link rel="prefetch" href="/docs/assets/js/54.823775fd.js"><link rel="prefetch" href="/docs/assets/js/540.22130835.js"><link rel="prefetch" href="/docs/assets/js/541.58b7b2c5.js"><link rel="prefetch" href="/docs/assets/js/542.b98662af.js"><link rel="prefetch" href="/docs/assets/js/543.e37779a7.js"><link rel="prefetch" href="/docs/assets/js/544.5d69fa6d.js"><link rel="prefetch" href="/docs/assets/js/545.e75b0fa7.js"><link rel="prefetch" href="/docs/assets/js/546.44bb6782.js"><link rel="prefetch" href="/docs/assets/js/547.e4a659cf.js"><link rel="prefetch" href="/docs/assets/js/548.7e5e0b79.js"><link rel="prefetch" href="/docs/assets/js/549.144e24d1.js"><link rel="prefetch" href="/docs/assets/js/55.1d5d22f9.js"><link rel="prefetch" href="/docs/assets/js/550.822ed888.js"><link rel="prefetch" href="/docs/assets/js/551.fc6d5a7f.js"><link rel="prefetch" href="/docs/assets/js/552.671dcca4.js"><link rel="prefetch" href="/docs/assets/js/553.bd76165f.js"><link rel="prefetch" href="/docs/assets/js/554.847e4db1.js"><link rel="prefetch" href="/docs/assets/js/555.c609ae8e.js"><link rel="prefetch" href="/docs/assets/js/556.c8f01649.js"><link rel="prefetch" href="/docs/assets/js/56.6f73d3b0.js"><link rel="prefetch" href="/docs/assets/js/57.e84aef51.js"><link rel="prefetch" href="/docs/assets/js/58.57f70104.js"><link rel="prefetch" href="/docs/assets/js/59.69b3db96.js"><link rel="prefetch" href="/docs/assets/js/6.95a69e13.js"><link rel="prefetch" href="/docs/assets/js/60.e185e145.js"><link rel="prefetch" href="/docs/assets/js/61.cfc2c7a4.js"><link rel="prefetch" href="/docs/assets/js/62.e53e35d2.js"><link rel="prefetch" href="/docs/assets/js/63.6af16172.js"><link rel="prefetch" href="/docs/assets/js/64.3074e51a.js"><link rel="prefetch" href="/docs/assets/js/65.b693ac76.js"><link rel="prefetch" href="/docs/assets/js/66.f78a08d6.js"><link rel="prefetch" href="/docs/assets/js/67.6bcd915d.js"><link rel="prefetch" href="/docs/assets/js/68.5e5daa80.js"><link rel="prefetch" href="/docs/assets/js/69.3c991ee2.js"><link rel="prefetch" href="/docs/assets/js/7.e9c16184.js"><link rel="prefetch" href="/docs/assets/js/70.9f69acdf.js"><link rel="prefetch" href="/docs/assets/js/71.a97c780e.js"><link rel="prefetch" href="/docs/assets/js/72.7912b5ba.js"><link rel="prefetch" href="/docs/assets/js/73.7d9b48e3.js"><link rel="prefetch" href="/docs/assets/js/74.18bce9c2.js"><link rel="prefetch" href="/docs/assets/js/75.64671930.js"><link rel="prefetch" href="/docs/assets/js/77.3ee9c19f.js"><link rel="prefetch" href="/docs/assets/js/78.12bb1122.js"><link rel="prefetch" href="/docs/assets/js/79.f9a6e128.js"><link rel="prefetch" href="/docs/assets/js/8.0dad7ba1.js"><link rel="prefetch" href="/docs/assets/js/80.d100a53b.js"><link rel="prefetch" href="/docs/assets/js/81.7fb63cc9.js"><link rel="prefetch" href="/docs/assets/js/82.d47e11f3.js"><link rel="prefetch" href="/docs/assets/js/83.267de5b3.js"><link rel="prefetch" href="/docs/assets/js/84.81f2b869.js"><link rel="prefetch" href="/docs/assets/js/85.7713f4c1.js"><link rel="prefetch" href="/docs/assets/js/86.d9032beb.js"><link rel="prefetch" href="/docs/assets/js/87.b1202938.js"><link rel="prefetch" href="/docs/assets/js/88.ef0cf8da.js"><link rel="prefetch" href="/docs/assets/js/89.26cd78d5.js"><link rel="prefetch" href="/docs/assets/js/9.e62a5d3e.js"><link rel="prefetch" href="/docs/assets/js/90.7be01e5b.js"><link rel="prefetch" href="/docs/assets/js/91.880e8378.js"><link rel="prefetch" href="/docs/assets/js/92.3371f165.js"><link rel="prefetch" href="/docs/assets/js/93.8111d2a0.js"><link rel="prefetch" href="/docs/assets/js/94.ee3e9fd5.js"><link rel="prefetch" href="/docs/assets/js/95.b61a6419.js"><link rel="prefetch" href="/docs/assets/js/96.61f75b90.js"><link rel="prefetch" href="/docs/assets/js/97.fe464076.js"><link rel="prefetch" href="/docs/assets/js/98.f844bead.js"><link rel="prefetch" href="/docs/assets/js/99.f3dd768c.js">
    <link rel="stylesheet" href="/docs/assets/css/0.styles.6906ca04.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/docs/" class="home-link router-link-active"><!----> <span class="site-name">Nguyễn Khánk's Wiki</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/docs/architect/" class="nav-link">
  Architecture
</a></div><div class="nav-item"><a href="https://nguyenngockhank.github.io" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Home
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/docs/architect/" class="nav-link">
  Architecture
</a></div><div class="nav-item"><a href="https://nguyenngockhank.github.io" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Home
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>System Design Case Studies</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/docs/kungfu/case-study/notification/" class="sidebar-link">Design a notification system</a></li><li><a href="/docs/kungfu/case-study/metrics/" class="sidebar-link">Metrics Monitoring &amp; Alerting System</a></li><li><a href="/docs/kungfu/case-study/ad-click/" class="sidebar-link">Ad Click Event Aggregation</a></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>Data storage</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>Online tools</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>Booking System</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>Social Network</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>Location-based</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>Video</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading open"><span>Chat system</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/docs/kungfu/case-study/chat-system/" aria-current="page" class="sidebar-link">Design a Chat App</a></li><li><a href="/docs/kungfu/case-study/chat-system/part2/" class="sidebar-link">Design a Chat App (2)</a></li><li><a href="/docs/kungfu/case-study/chat-system/whatsapp/" aria-current="page" class="active sidebar-link">Whatsapp System</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docs/kungfu/case-study/chat-system/whatsapp/#introduction" class="sidebar-link">Introduction</a></li><li class="sidebar-sub-header"><a href="/docs/kungfu/case-study/chat-system/whatsapp/#detailed-design" class="sidebar-link">Detailed Design</a></li><li class="sidebar-sub-header"><a href="/docs/kungfu/case-study/chat-system/whatsapp/#data-model" class="sidebar-link">Data Model</a></li><li class="sidebar-sub-header"><a href="/docs/kungfu/case-study/chat-system/whatsapp/#component-design" class="sidebar-link">Component Design</a></li><li class="sidebar-sub-header"><a href="/docs/kungfu/case-study/chat-system/whatsapp/#optimization" class="sidebar-link">Optimization</a></li></ul></li><li><a href="/docs/kungfu/case-study/chat-system/telegram/" class="sidebar-link">Telegram System</a></li><li><a href="/docs/kungfu/case-study/chat-system/fb-messenger/" class="sidebar-link">Design Facebook Messenger</a></li></ul></section></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>The Art of Readable Code</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>97 Things Every Programmer Should Know</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Go</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="whatsapp-system"><a href="#whatsapp-system" class="header-anchor">#</a> Whatsapp System</h1> <h2 id="introduction"><a href="#introduction" class="header-anchor">#</a> Introduction</h2> <p>Note:This is one way of designing an instant messenger system such as WhatsApp. However, we don’t guarantee that WhatsApp is designed in this way. This is our prototype on
designing a similar system</p> <h3 id="problem-statement"><a href="#problem-statement" class="header-anchor">#</a> Problem Statement</h3> <p>In this chapter. we will design an instant messenger platform such as WhatsApp or Signal which users can utilize to send messages to each other. An essential aspect of the
application is that the chat messages won’t be permanently stored in the application.</p> <div class="custom-block tip"><p class="custom-block-title">FUN FACT:</p> <p>Some of the chat messengers such as FB Messenger stores the chat messages unless the users explicitly delete it. However, instant messengers such as WhatsApp don’t save the messages permanently on their server.</p></div> <h3 id="gathering-requirements"><a href="#gathering-requirements" class="header-anchor">#</a> Gathering requirements</h3> <p>The instant messenger application should meet the following requirements.</p> <ul><li>It should be able to support one-on-one conversations between users.</li> <li>It should be able to show Sent/Delivered/Read confirmation to other users.</li> <li>It should be able to provide information about the last time a user was active.</li> <li>It should allow users to share images.</li> <li>It should be able to send push notifications to other users</li></ul> <h3 id="_8-1-3-capacity-planning"><a href="#_8-1-3-capacity-planning" class="header-anchor">#</a> 8.1.3 Capacity Planning</h3> <p>We need to build a highly scalable platform which can support traffic at the scale of
WhatsApp. Additionally, while doing capacity planning, we need to ensure that we think
through the worst-case scenarios of peak traffic. Some of the numbers which we can use
for capacity estimations of an application (like WhatsApp) are listed below.</p> <ul><li>Number of users on the application every month: 1 Billion</li> <li>Number of active users per second at peak traffic: 650, 000</li> <li>Number of messages per second at peak traffic: 40 Million</li></ul> <p>The entire application will comprise of several microservices each performing a specific task. The number of servers required in the data plane (Webmaster include the link
to the distributed systems chapter) (let’s call it to chat microservice) handling the traffic of
chat messages can be estimated using the following equation.</p> <p>= <em>(chat messages per second Latency)/ concurrent connections per server</em></p> <p>Let’s assume that the number of concurrent connections per server is 100K, and the
latency of sending a message is 20 milliseconds. In such a scenario, the estimated number
of servers required in the chat servers’ fleet (using the equation mentioned above) will be 8
(i.e., 40 Million*20 ms/100K). In standard practice, it I s recommended to add a few more
servers to account for handling failures of these servers. In a subsequent section, we will
see the impact which these chat servers will have on the overall infrastructure cost.</p> <div class="custom-block tip"><p class="custom-block-title">FUN FACT</p> <p>In this talk, Rick Reed(software engineer @ WhatsApp) talks about optimizing their Erlang-based server applications and tuning the FreeBSD kernel to support
millions of concurrent connections per server. This helped them to a great extent in keeping
their server footprint as small as possible.</p></div> <h2 id="detailed-design"><a href="#detailed-design" class="header-anchor">#</a> Detailed Design</h2> <p>The required features of this instant messenger application can be modeled using two
micro-services: Chat service and Transient service. The Chat Service will be the one
serving the traffic of online chat messages sent by active users. The service will check if
the user to whom the message is sent is online or not. If the user is online, then the message will be forwarded to that user instantly. Otherwise, the message will be handled by the Transient Service. This service will be responsible for maintaining all the messages (text
or image) sent to offline users. The data will be stored in the Transient Storage temporarily
until the offline user comes back online. We will provide more details about the individual
components in one of the later sections.</p> <p><img src="/docs/assets/img/40.1e375610.png" alt="alt"><br> <em>Figure 8.1: High level Design - WhatsApp</em></p> <div class="custom-block tip"><p class="custom-block-title">FUN FACT</p> <p>WhatsApp actually uses a much similar approach as discussed by the same WhatsApp engineer (Rick Reed) in a different talk.</p></div> <h3 id="api-design"><a href="#api-design" class="header-anchor">#</a> API Design</h3> <p>We can expose a REST endpoint to interact with the Chat Service. The definition of the
API endpoint to send messages is mentioned below.</p> <div class="language- extra-class"><pre class="language-text"><code>sendMessage(String fromUser, String toUser, ClientMetaData clientMetaData, String message)
</code></pre></div><p><strong>Request</strong>:</p> <ul><li><em>fromUser</em>:The userId who is sending the request</li> <li><em>toUser</em>: The userId to whom the request is being sent</li> <li><em>clientMetaData</em>: The metadata to store client’s information such as device details, locations etc.</li> <li><em>message</em>: The message being sent as part of the communication.</li></ul> <h2 id="data-model"><a href="#data-model" class="header-anchor">#</a> Data Model</h2> <p>We will store details such as the server to which the user is connected and the last time
user was active. We can use a document-based database such as MongoDB to store user
information such as the last activity time of the user (aka heartbeat time). The data-model
will look similar to the table below.</p> <table><thead><tr><th>userID (HK)</th> <th>HeartBeatTime</th> <th>connected server</th></tr></thead> <tbody><tr><td>User A</td> <td>T1</td> <td>Server A</td></tr> <tr><td>User B</td> <td>T2</td> <td>Server B</td></tr></tbody></table> <h2 id="component-design"><a href="#component-design" class="header-anchor">#</a> Component Design</h2> <p>In this section, we will talk about two different scenarios for sending messages in a oneto-one communication. After that, we will discuss the other features which we need to
support, such as push notifications and user activity status. In the end, we will look into
the different mechanisms for doing optimizations and handling failure scenarios.</p> <h3 id="one-to-one-communication"><a href="#one-to-one-communication" class="header-anchor">#</a> One-to-One communication</h3> <p>Here, we will talk about the two different scenarios associated with sending messages to
another user. The first scenario involves sending a text message to an online user. In
the second scenario, we have described the sequence of operations involved in sending an
image to an offline user.</p> <h4 id="scenario-1-sending-text-to-an-online-user"><a href="#scenario-1-sending-text-to-an-online-user" class="header-anchor">#</a> Scenario-1: Sending text to an online user</h4> <p>The details about each of the steps in the sequence diagram for sending a text message to an online user is mentioned below.</p> <p><img src="/docs/assets/img/41.5828e3ac.png" alt="alt"><br> <em>Figure 8.2: One-to-One communication between online users</em></p> <ol><li>Alice sends a message to Bob which gets directed to the chat server with which Alice is connected.</li> <li>Alice gets an acknowledgement from the chat server it’s connected (i.e. ChatServerA) and the message is mstorage to fetching information about the chat server to which Bob is connected.</li> <li>ChatStorage returns the information that Bob is connected to ChatServerB. ChatServerA forwards the message to ChatServerB.</li> <li>The message gets delivered to Bob using a push mechanism (Webmaster include link).</li> <li>Bob sends ACK back to ChatServerB. The ACK is forwarded to ChatServerA to which Alice is connected.</li> <li>The ACK gets delivered to Alice and is marked as DELIVERED</li></ol> <h4 id="scenario-2-sending-image-to-an-offline-user"><a href="#scenario-2-sending-image-to-an-offline-user" class="header-anchor">#</a> Scenario 2: Sending image to an offline user</h4> <p>The details about each of the steps in the sequence diagram for sending an image to an offline user is mentioned below.</p> <p><img src="/docs/assets/img/42.158e0242.png" alt="alt"><br> <em>Figure 8.3: Sequence diagram: Sending image to an offline user</em></p> <ol><li>Alice sends an image to Bob which gets forwarded to ChatServerA,theserverwithwhichAliceisconnec</li> <li>File Server returns the image url of the uploaded file to ChatServerA.T heimageurlisreturnedtoAlicewhichis</li> <li>ChatServerA makes request for the server to which Bob is connected. ChatStorage returns information that Bob is</li> <li>ChatServerA forwards the message containing the image−url to the transient server The transient sever stores turlin transient storage.</li> <li>Bob comes online and performs heart-beat (Webmaster Include Link) with ChatServerB.ChatServerB f etche</li> <li>ChatServerB f orwardsthetransientmessagestoBob.Bob f etchestheimage f romthe fileserver.Atthispoint,th</li> <li>Bob’s device sends ACK for Alice’s image to ChatServerB Fetches information about the server to which Alice</li> <li>Forwards the ACK to ChatServerA The ACK gets delivered to Alice marking the message as DELIVERED.</li></ol> <p><strong>Transient Data storage</strong></p> <p>We can implement a queue-based mechanism to store and retrieve the transient messages using a FIFO based policy. We can use existing cloud-based technologies for this purpose, such as Amazon SQS or Windows Azure Queue Service. We
can use these queues to store transient messages sent to offline users. All the references to
these transient messages are removed from the system once the messages are delivered to
the offline user.</p> <h3 id="push-notifications"><a href="#push-notifications" class="header-anchor">#</a> Push Notifications</h3> <p>There are two approaches to deliver messages to users by using push technology : client
pull or server push. If we go down the route of client pull, we can either decide between
long vs. short polling. On the other hand, there are two ways to implement the server
push approach: WebSocket and Server-Sent Events(SSE). Websockets has been the defacto communication protocol for chat applications. We have provided more details about
it in the section below.</p> <p>Using the polling technique, the client asks the server for new data regularly. The tradeoff decision to choose the polling technique can be taken using the data-points mentioned
below.</p> <p><strong>Short Polling e.g., AJAX-based timer</strong></p> <ul><li>✅ Pros: more straightforward and not very server consuming if the time between requests is long</li> <li>❌ Cons: not ideal for scenarios when we need to be notified of server events with minimal delay</li></ul> <p><strong>Long Polling e.g., Comet Based on XHR</strong></p> <ul><li>✅ Pros: notifications of server events happen with no delay</li> <li>❌ Cons: more complex and consume more server resources</li></ul> <p>The approach to push server messages to clients is mainly of two types. The first one is
WebSocket which is a communication protocol. It provides duplex communication channels over a single TCP connection. It’s ideal for scenarios such as chat applications due to
its two-directional communication. The other one is called Server-sent events (SSE) which
allows a server to send “new data” to the client asynchronously once the initial client-server
connection has been established. SSEs are more suitable in a publisher-subscriber model
such as real-time streaming stock prices; twitter feeds updates and browser notifications.</p> <h3 id="user-activity-status"><a href="#user-activity-status" class="header-anchor">#</a> User Activity Status</h3> <p>The last time when a user was active is a standard functionality which can be found on
instant messengers. We have shown the data-model to store the related information in
Table 1 above.</p> <p><img src="data:image/png;base64,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" alt="alt"><br> <em>Figure 8.4: Heartbeat between client and server</em></p> <p>In Fig 8.4, we have shown the mechanism using which a connection is maintained
between client and server using WebSockets. Once an initial connection is established
between client and server, the communication switches to a bi-directional binary protocol.
The connection is kept alive between client and server using heartbeats. We store the last time a heartbeat was received from a user in a database. The data-storage can then be
queried to fetch the last time a user was active.</p> <h2 id="optimization"><a href="#optimization" class="header-anchor">#</a> Optimization</h2> <p>We can use the parameters listed below to suggest optimizations in the system. We have
provided details about the approach which should be followed for suggesting optimizations
in a system in this article.</p> <ul><li><strong>Latency</strong>: We can use distributed cache (Include Link to distributed caching) such
as Redis to cache the information of user activity status and their recent chats inmemory. This may help in reducing the overall latency of the application and provides a better customer experience. Even some of the database solutions do provide in-memory caching solutions such as Amazon DynamoDB Accelerator.</li> <li><strong>Infrastructure cost</strong>: It’s apparent from the system that significant contribution to the
infrastructure cost will be from chat servers. The cost incurred from the chat servers
can mount quickly if its server foot-print isn’t kept in check. One way of doing that
is to increase the number of connections per host. It will significantly reduce the
number of servers required for maintaining the service. We can accomplish this task
by tuning the server configurations and choosing suitable technologies. For instance,
engineers at WhatsApp were able to achieve millions of connections per host by
optimizing their Erlang-based server applications and tuning the FreeBSD kernel</li> <li><strong>Availability</strong> : We can maintain multiple copies of the transient messages so that
even if the messages in one of the copies is lost then it can still be retrieved from
the other copy. This would imply maintaining replicas of those transient messages.
The client would be responsible for fetching the messages from two queues and will
merge them. We will discuss more in the next section.</li></ul> <h3 id="addressing-bottlenecks"><a href="#addressing-bottlenecks" class="header-anchor">#</a> Addressing Bottlenecks</h3> <p>The major bottlenecks in the system which are more vulnerable to failures are the chat
servers and the transient storage solutions. We have recommended some approaches to
handle such failures in the section below.</p> <ul><li><strong>Chat server failure</strong>: The chat servers in the system will be holding connections with
the users. There are two ways of handling the failure of chat servers. One approach
can be to transfer those TCP connections to another server; however, implementation
of such fail-overs isn’t trivial. The second, which is comparatively more straightforward is to have the user clients initiate the connection automatically in case of
connection loss. The information of the server to which the user is connected needs
to be updated in the database is agnostic of the approach we take. For instance, in
Fig 5.6, we have shown an illustration of the handling this failure scenario. We can
see that User1 is connected to Server1, and when this server goes down, then the
connection is re-established with another server (i.e. Server2), and this information
is updated in the database.</li></ul> <p><img src="/docs/assets/img/44.4d2a35bc.png" alt="alt"><br> <em>Figure 8.5: Handling chat server failure</em></p> <ul><li><strong>Transient storage failure</strong>: The transient storage is another component which is
prone to failures and can cause loss of messages in-transit to offline users. We can
make replicas of the transient storage of each user to prevent the loss of messages
which were sent to them when they were offline. When a user comes back online then both the original and the replica instances of the user’s transient storage are
queried and merged. In Fig 8.6, we have illustrated a mechanism to handle transient
storage failure which gets initiated when user comes back online</li></ul> <p><img src="/docs/assets/img/45.af161500.png" alt="alt"><br> <em>Figure 8.6: Handling transient storage failures</em></p> <h3 id="monitoring"><a href="#monitoring" class="header-anchor">#</a> Monitoring</h3> <p>We want to ensure that our service can meet the user demands with high availability and
low latency. We can define service level agreements (SLAs) for these metrics and create
moderate and severe monitors which can trigger an alarm when these SLAs are violated.
For this application, we can define the following SLAs for the sendMessage API.</p> <ol><li>Availability SLA: p99.999</li> <li>Latency SLA: p99.999 of 5 milliseconds</li></ol> <p>The availability SLA implies that that the monitor will trigger an alarm if more than 1
out of 1000 requests fail. Likewise, the latency SLA means that an alert will be triggered
if the server takes &gt; 5ms to respond for more than 1 out of 100 requests it receives.</p> <p>Additionally, we can put failure alarms in different error scenarios. One such scenario can occur when the chat server isn’t able to fetch transient messages for a user from
all the replicas of transient storage. This maps to Step10 illustrated in Fig 3 above where</p> <p><em>ChatServerB requests the transient server to fetch the messages sent to Bob when Bob was off line.</em>
Let′s assume th8.</p> <h3 id="extended-requirements"><a href="#extended-requirements" class="header-anchor">#</a> Extended Requirements</h3> <p>We can extend the system to support group chats using which we can get messages delivered to multiple users. We can create a data-model to store the group data-entity, which will
be identified by GroupChatID and will be used to maintain a list of people who are part of
that group. The system described above is extensible to support the scenarios for sending
message to online and offline users. We can build a component which will be responsible
for ensuring that the messages get delivered to all the users in the group depending upon
their activity status.</p> <p>Another aspect that can be covered as an extension to this problem is that of security,
specifically end-to-end encryption, where only the communicating users can read the messages. Each user has a public key that is shared with all the other users with whom the user
is communicating. For instance, two users Alice and Bob, are communicating with each
other. Alice has Bob’s public key and vice versa; however, their private key isn’t shared.
When Alice sends a message to Bob, the message is encrypted using Bob’s public key
and sent over the network. The server directs the encrypted message to Bob, who uses the
private key to decrypt the message. In this way, the server only has access to the encrypted
message, and only Alice and Bob can read the actual messages they exchanged.</p> <p><img src="/docs/assets/img/46.93e71c03.png" alt="alt"><br> <em>Figure 8.7: End-to-End encryption while sending messages</em></p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/docs/kungfu/case-study/chat-system/part2/" class="prev">
        Design a Chat App (2)
      </a></span> <span class="next"><a href="/docs/kungfu/case-study/chat-system/telegram/">
        Telegram System
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----><!----><!----></div></div>
    <script src="/docs/assets/js/app.27d3c261.js" defer></script><script src="/docs/assets/js/2.1bcd0ab7.js" defer></script><script src="/docs/assets/js/39.764ba9f3.js" defer></script><script src="/docs/assets/js/76.b399e428.js" defer></script>
  </body>
</html>
