<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>4. Modules Should Be Deep | Nguyễn Khánk&#39;s Wiki</title>
    <meta name="generator" content="VuePress 1.7.1">
    <link rel="apple-touch-icon" sizes="180x180" href="../public/favicons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="../public/favicons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="../public/favicons/favicon-16x16.png">
    <link rel="manifest" href="../public/favicons/manifest.json">
    <link rel="mask-icon" href="../public/favicons/safari-pinned-tab.svg" color="#3a0839">
    <link rel="shortcut icon" href="../public/favicons/favicon.ico">
    <meta name="description" content="Wikipedia của tui">
    <meta name="msapplication-TileColor" content="#3a0839">
    <meta name="msapplication-config" content="../public/favicons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    
    <link rel="preload" href="/docs/assets/css/0.styles.5d974432.css" as="style"><link rel="preload" href="/docs/assets/js/app.18f0d89d.js" as="script"><link rel="preload" href="/docs/assets/js/2.4b1aafd9.js" as="script"><link rel="preload" href="/docs/assets/js/65.9e3dd553.js" as="script"><link rel="preload" href="/docs/assets/js/30.a8926ddd.js" as="script"><link rel="prefetch" href="/docs/assets/js/10.2b6c4aa0.js"><link rel="prefetch" href="/docs/assets/js/100.46fe3398.js"><link rel="prefetch" href="/docs/assets/js/101.8262c4f2.js"><link rel="prefetch" href="/docs/assets/js/102.b978188d.js"><link rel="prefetch" href="/docs/assets/js/103.9c1ffadd.js"><link rel="prefetch" href="/docs/assets/js/104.7e8ea6c9.js"><link rel="prefetch" href="/docs/assets/js/105.ccb07dc3.js"><link rel="prefetch" href="/docs/assets/js/106.7c4a07c9.js"><link rel="prefetch" href="/docs/assets/js/107.5d7d7b8b.js"><link rel="prefetch" href="/docs/assets/js/108.0af3c9ca.js"><link rel="prefetch" href="/docs/assets/js/109.34fa8adf.js"><link rel="prefetch" href="/docs/assets/js/11.9bbfd330.js"><link rel="prefetch" href="/docs/assets/js/110.2044e340.js"><link rel="prefetch" href="/docs/assets/js/111.3f38e793.js"><link rel="prefetch" href="/docs/assets/js/112.094ad80e.js"><link rel="prefetch" href="/docs/assets/js/113.0ad33b7f.js"><link rel="prefetch" href="/docs/assets/js/114.04619454.js"><link rel="prefetch" href="/docs/assets/js/115.cf7f6b28.js"><link rel="prefetch" href="/docs/assets/js/116.87b9e260.js"><link rel="prefetch" href="/docs/assets/js/117.030704a4.js"><link rel="prefetch" href="/docs/assets/js/118.98f87c3d.js"><link rel="prefetch" href="/docs/assets/js/119.a8c59f4f.js"><link rel="prefetch" href="/docs/assets/js/12.78cd3e44.js"><link rel="prefetch" href="/docs/assets/js/120.bb08ffce.js"><link rel="prefetch" href="/docs/assets/js/121.e543349a.js"><link rel="prefetch" href="/docs/assets/js/122.7ece22a6.js"><link rel="prefetch" href="/docs/assets/js/123.e3889590.js"><link rel="prefetch" href="/docs/assets/js/124.ef6dbdfa.js"><link rel="prefetch" href="/docs/assets/js/125.134742a7.js"><link rel="prefetch" href="/docs/assets/js/126.c9b67d42.js"><link rel="prefetch" href="/docs/assets/js/127.4a1c1121.js"><link rel="prefetch" href="/docs/assets/js/128.9a5ca275.js"><link rel="prefetch" href="/docs/assets/js/129.5c3e7982.js"><link rel="prefetch" href="/docs/assets/js/13.12ca3620.js"><link rel="prefetch" href="/docs/assets/js/130.8e6bf10c.js"><link rel="prefetch" href="/docs/assets/js/131.deb13050.js"><link rel="prefetch" href="/docs/assets/js/132.788569e7.js"><link rel="prefetch" href="/docs/assets/js/133.00bb08e6.js"><link rel="prefetch" href="/docs/assets/js/134.0710dc01.js"><link rel="prefetch" href="/docs/assets/js/135.ec29c511.js"><link rel="prefetch" href="/docs/assets/js/136.d7595912.js"><link rel="prefetch" href="/docs/assets/js/137.4db17c84.js"><link rel="prefetch" href="/docs/assets/js/138.6c2a14f9.js"><link rel="prefetch" href="/docs/assets/js/139.b9c71546.js"><link rel="prefetch" href="/docs/assets/js/14.160caff2.js"><link rel="prefetch" href="/docs/assets/js/140.f512094b.js"><link rel="prefetch" href="/docs/assets/js/141.b87ce4d3.js"><link rel="prefetch" href="/docs/assets/js/142.2b723930.js"><link rel="prefetch" href="/docs/assets/js/143.796feda5.js"><link rel="prefetch" href="/docs/assets/js/144.edd5f0a5.js"><link rel="prefetch" href="/docs/assets/js/145.e8297f22.js"><link rel="prefetch" href="/docs/assets/js/146.938015f6.js"><link rel="prefetch" href="/docs/assets/js/147.273a7d40.js"><link rel="prefetch" href="/docs/assets/js/148.1452d64c.js"><link rel="prefetch" href="/docs/assets/js/149.eeb26147.js"><link rel="prefetch" href="/docs/assets/js/15.ab8d9546.js"><link rel="prefetch" href="/docs/assets/js/150.d2698622.js"><link rel="prefetch" href="/docs/assets/js/151.e9785b9f.js"><link rel="prefetch" href="/docs/assets/js/152.9ffdd251.js"><link rel="prefetch" href="/docs/assets/js/153.f3e62f82.js"><link rel="prefetch" href="/docs/assets/js/154.91b684cb.js"><link rel="prefetch" href="/docs/assets/js/155.a618903b.js"><link rel="prefetch" href="/docs/assets/js/156.1ba7ab1d.js"><link rel="prefetch" href="/docs/assets/js/157.3e8f3b22.js"><link rel="prefetch" href="/docs/assets/js/158.c5843358.js"><link rel="prefetch" href="/docs/assets/js/159.82b5a42e.js"><link rel="prefetch" href="/docs/assets/js/16.4cae1a64.js"><link rel="prefetch" href="/docs/assets/js/160.53def4de.js"><link rel="prefetch" href="/docs/assets/js/161.d4b6e1a6.js"><link rel="prefetch" href="/docs/assets/js/162.7238622b.js"><link rel="prefetch" href="/docs/assets/js/163.135443f1.js"><link rel="prefetch" href="/docs/assets/js/164.61b1a819.js"><link rel="prefetch" href="/docs/assets/js/165.fad5cf82.js"><link rel="prefetch" href="/docs/assets/js/166.cead220d.js"><link rel="prefetch" href="/docs/assets/js/167.751a6dd1.js"><link rel="prefetch" href="/docs/assets/js/168.83211b9f.js"><link rel="prefetch" href="/docs/assets/js/169.791bb142.js"><link rel="prefetch" href="/docs/assets/js/17.51631769.js"><link rel="prefetch" href="/docs/assets/js/170.d93ea18e.js"><link rel="prefetch" href="/docs/assets/js/171.520a0e24.js"><link rel="prefetch" href="/docs/assets/js/172.6fb0d734.js"><link rel="prefetch" href="/docs/assets/js/173.60eefb6a.js"><link rel="prefetch" href="/docs/assets/js/174.2e128920.js"><link rel="prefetch" href="/docs/assets/js/175.162dd96c.js"><link rel="prefetch" href="/docs/assets/js/176.81012a39.js"><link rel="prefetch" href="/docs/assets/js/177.7c1847f3.js"><link rel="prefetch" href="/docs/assets/js/178.f3783149.js"><link rel="prefetch" href="/docs/assets/js/179.a33b9aee.js"><link rel="prefetch" href="/docs/assets/js/18.43e78dca.js"><link rel="prefetch" href="/docs/assets/js/180.a4c0879b.js"><link rel="prefetch" href="/docs/assets/js/181.129ae076.js"><link rel="prefetch" href="/docs/assets/js/182.d862270a.js"><link rel="prefetch" href="/docs/assets/js/183.69a1444a.js"><link rel="prefetch" href="/docs/assets/js/184.f486732d.js"><link rel="prefetch" href="/docs/assets/js/185.62381e36.js"><link rel="prefetch" href="/docs/assets/js/186.c7c95526.js"><link rel="prefetch" href="/docs/assets/js/187.58969818.js"><link rel="prefetch" href="/docs/assets/js/188.cfd3cd3e.js"><link rel="prefetch" href="/docs/assets/js/189.138e0adf.js"><link rel="prefetch" href="/docs/assets/js/19.fbe81b12.js"><link rel="prefetch" href="/docs/assets/js/190.f176f3e1.js"><link rel="prefetch" href="/docs/assets/js/191.6895b2d9.js"><link rel="prefetch" href="/docs/assets/js/192.38519e6d.js"><link rel="prefetch" href="/docs/assets/js/193.ddbf1d3d.js"><link rel="prefetch" href="/docs/assets/js/194.b7256806.js"><link rel="prefetch" href="/docs/assets/js/195.5e49f481.js"><link rel="prefetch" href="/docs/assets/js/196.d08d7fdf.js"><link rel="prefetch" href="/docs/assets/js/197.654b16f9.js"><link rel="prefetch" href="/docs/assets/js/198.b54cc0c6.js"><link rel="prefetch" href="/docs/assets/js/199.3cbdb9ad.js"><link rel="prefetch" href="/docs/assets/js/20.2af03f9f.js"><link rel="prefetch" href="/docs/assets/js/200.c944c858.js"><link rel="prefetch" href="/docs/assets/js/201.955c51a0.js"><link rel="prefetch" href="/docs/assets/js/202.6c0cc5cb.js"><link rel="prefetch" href="/docs/assets/js/203.8fde1d0a.js"><link rel="prefetch" href="/docs/assets/js/204.332b1f1b.js"><link rel="prefetch" href="/docs/assets/js/205.6d9e0690.js"><link rel="prefetch" href="/docs/assets/js/206.c666e479.js"><link rel="prefetch" href="/docs/assets/js/207.f2a48609.js"><link rel="prefetch" href="/docs/assets/js/208.5a777f6b.js"><link rel="prefetch" href="/docs/assets/js/209.c2fbc43f.js"><link rel="prefetch" href="/docs/assets/js/21.8c789441.js"><link rel="prefetch" href="/docs/assets/js/210.a6e3b1e0.js"><link rel="prefetch" href="/docs/assets/js/211.f7924e14.js"><link rel="prefetch" href="/docs/assets/js/212.991a1488.js"><link rel="prefetch" href="/docs/assets/js/213.bd39f027.js"><link rel="prefetch" href="/docs/assets/js/214.fa97d6c3.js"><link rel="prefetch" href="/docs/assets/js/215.2136507e.js"><link rel="prefetch" href="/docs/assets/js/216.d8855f63.js"><link rel="prefetch" href="/docs/assets/js/217.1667fba7.js"><link rel="prefetch" href="/docs/assets/js/218.0542320b.js"><link rel="prefetch" href="/docs/assets/js/219.9d9e6638.js"><link rel="prefetch" href="/docs/assets/js/22.31811c12.js"><link rel="prefetch" href="/docs/assets/js/220.3afef9dc.js"><link rel="prefetch" href="/docs/assets/js/221.4b9331f8.js"><link rel="prefetch" href="/docs/assets/js/222.46b6d39a.js"><link rel="prefetch" href="/docs/assets/js/223.c84fb958.js"><link rel="prefetch" href="/docs/assets/js/224.aabc54fb.js"><link rel="prefetch" href="/docs/assets/js/225.40afd300.js"><link rel="prefetch" href="/docs/assets/js/226.3e8876b4.js"><link rel="prefetch" href="/docs/assets/js/227.b9fb86dc.js"><link rel="prefetch" href="/docs/assets/js/228.ef712936.js"><link rel="prefetch" href="/docs/assets/js/229.a878a61d.js"><link rel="prefetch" href="/docs/assets/js/23.e91c2e91.js"><link rel="prefetch" href="/docs/assets/js/230.284c542f.js"><link rel="prefetch" href="/docs/assets/js/231.56f7c81f.js"><link rel="prefetch" href="/docs/assets/js/232.b9f5d740.js"><link rel="prefetch" href="/docs/assets/js/233.81180526.js"><link rel="prefetch" href="/docs/assets/js/234.54526fc1.js"><link rel="prefetch" href="/docs/assets/js/235.53a4269e.js"><link rel="prefetch" href="/docs/assets/js/236.6ade9ca8.js"><link rel="prefetch" href="/docs/assets/js/237.7460d2e6.js"><link rel="prefetch" href="/docs/assets/js/238.51038843.js"><link rel="prefetch" href="/docs/assets/js/239.f1682cf0.js"><link rel="prefetch" href="/docs/assets/js/24.94367e91.js"><link rel="prefetch" href="/docs/assets/js/240.8032a6a6.js"><link rel="prefetch" href="/docs/assets/js/241.102126b0.js"><link rel="prefetch" href="/docs/assets/js/242.87ddd4be.js"><link rel="prefetch" href="/docs/assets/js/243.88fd2b3a.js"><link rel="prefetch" href="/docs/assets/js/244.9f7ff3b4.js"><link rel="prefetch" href="/docs/assets/js/245.5aeffb1d.js"><link rel="prefetch" href="/docs/assets/js/246.8b6386f5.js"><link rel="prefetch" href="/docs/assets/js/247.9b0524db.js"><link rel="prefetch" href="/docs/assets/js/248.9c7a45a1.js"><link rel="prefetch" href="/docs/assets/js/249.49840c26.js"><link rel="prefetch" href="/docs/assets/js/25.b0c4be3c.js"><link rel="prefetch" href="/docs/assets/js/250.34f69070.js"><link rel="prefetch" href="/docs/assets/js/251.f0da1923.js"><link rel="prefetch" href="/docs/assets/js/252.52d568d7.js"><link rel="prefetch" href="/docs/assets/js/253.ab18d5ab.js"><link rel="prefetch" href="/docs/assets/js/254.d298ce89.js"><link rel="prefetch" href="/docs/assets/js/255.b90f51f7.js"><link rel="prefetch" href="/docs/assets/js/256.3debf270.js"><link rel="prefetch" href="/docs/assets/js/257.e8a0e811.js"><link rel="prefetch" href="/docs/assets/js/258.2ff84997.js"><link rel="prefetch" href="/docs/assets/js/259.99eb587b.js"><link rel="prefetch" href="/docs/assets/js/26.7f9f74c8.js"><link rel="prefetch" href="/docs/assets/js/260.9c2ff57c.js"><link rel="prefetch" href="/docs/assets/js/261.f2cfebb4.js"><link rel="prefetch" href="/docs/assets/js/262.575bc3c9.js"><link rel="prefetch" href="/docs/assets/js/263.67da67c0.js"><link rel="prefetch" href="/docs/assets/js/264.376c9923.js"><link rel="prefetch" href="/docs/assets/js/265.44e6aac4.js"><link rel="prefetch" href="/docs/assets/js/266.7ae44840.js"><link rel="prefetch" href="/docs/assets/js/267.339324fa.js"><link rel="prefetch" href="/docs/assets/js/268.6f609a5a.js"><link rel="prefetch" href="/docs/assets/js/269.7eafa18c.js"><link rel="prefetch" href="/docs/assets/js/27.84e2de5b.js"><link rel="prefetch" href="/docs/assets/js/270.01dba6b3.js"><link rel="prefetch" href="/docs/assets/js/271.0afcd79d.js"><link rel="prefetch" href="/docs/assets/js/272.82447239.js"><link rel="prefetch" href="/docs/assets/js/273.fb39ebb8.js"><link rel="prefetch" href="/docs/assets/js/274.a1109073.js"><link rel="prefetch" href="/docs/assets/js/275.c7297ee1.js"><link rel="prefetch" href="/docs/assets/js/276.b10558e9.js"><link rel="prefetch" href="/docs/assets/js/277.dacb7706.js"><link rel="prefetch" href="/docs/assets/js/278.12242942.js"><link rel="prefetch" href="/docs/assets/js/279.04bde50d.js"><link rel="prefetch" href="/docs/assets/js/28.7a97d6ed.js"><link rel="prefetch" href="/docs/assets/js/280.9f130b39.js"><link rel="prefetch" href="/docs/assets/js/281.29fc7edb.js"><link rel="prefetch" href="/docs/assets/js/282.0ba64d45.js"><link rel="prefetch" href="/docs/assets/js/283.f6a51c86.js"><link rel="prefetch" href="/docs/assets/js/284.2ccc1264.js"><link rel="prefetch" href="/docs/assets/js/285.49df6ab7.js"><link rel="prefetch" href="/docs/assets/js/286.3513c929.js"><link rel="prefetch" href="/docs/assets/js/287.2fff4aa2.js"><link rel="prefetch" href="/docs/assets/js/288.e009560d.js"><link rel="prefetch" href="/docs/assets/js/289.ecc24adc.js"><link rel="prefetch" href="/docs/assets/js/29.64904cd0.js"><link rel="prefetch" href="/docs/assets/js/290.87068421.js"><link rel="prefetch" href="/docs/assets/js/291.b173d597.js"><link rel="prefetch" href="/docs/assets/js/292.94600d35.js"><link rel="prefetch" href="/docs/assets/js/293.b69a0598.js"><link rel="prefetch" href="/docs/assets/js/294.f33d3e0f.js"><link rel="prefetch" href="/docs/assets/js/295.501ec819.js"><link rel="prefetch" href="/docs/assets/js/296.876e074f.js"><link rel="prefetch" href="/docs/assets/js/297.767df1de.js"><link rel="prefetch" href="/docs/assets/js/298.fc54bc56.js"><link rel="prefetch" href="/docs/assets/js/299.65473642.js"><link rel="prefetch" href="/docs/assets/js/3.6a16f83a.js"><link rel="prefetch" href="/docs/assets/js/300.28a658bd.js"><link rel="prefetch" href="/docs/assets/js/301.0d215e08.js"><link rel="prefetch" href="/docs/assets/js/302.b503c9c9.js"><link rel="prefetch" href="/docs/assets/js/303.1a86d63c.js"><link rel="prefetch" href="/docs/assets/js/304.18f6ac17.js"><link rel="prefetch" href="/docs/assets/js/305.cf121b5a.js"><link rel="prefetch" href="/docs/assets/js/306.e65bb20b.js"><link rel="prefetch" href="/docs/assets/js/307.95574c52.js"><link rel="prefetch" href="/docs/assets/js/308.dba78bb6.js"><link rel="prefetch" href="/docs/assets/js/309.e142562b.js"><link rel="prefetch" href="/docs/assets/js/31.b7d9674f.js"><link rel="prefetch" href="/docs/assets/js/310.ead4add0.js"><link rel="prefetch" href="/docs/assets/js/311.d456f975.js"><link rel="prefetch" href="/docs/assets/js/312.70290415.js"><link rel="prefetch" href="/docs/assets/js/313.3907418c.js"><link rel="prefetch" href="/docs/assets/js/314.d75ec15e.js"><link rel="prefetch" href="/docs/assets/js/315.f9071502.js"><link rel="prefetch" href="/docs/assets/js/316.e2b008ce.js"><link rel="prefetch" href="/docs/assets/js/317.4c4b5d77.js"><link rel="prefetch" href="/docs/assets/js/318.2770f562.js"><link rel="prefetch" href="/docs/assets/js/319.58d111ad.js"><link rel="prefetch" href="/docs/assets/js/32.42d95475.js"><link rel="prefetch" href="/docs/assets/js/320.25c5b5ed.js"><link rel="prefetch" href="/docs/assets/js/321.17ec70a0.js"><link rel="prefetch" href="/docs/assets/js/322.b7390b8e.js"><link rel="prefetch" href="/docs/assets/js/323.6ccb8b77.js"><link rel="prefetch" href="/docs/assets/js/324.ebce847c.js"><link rel="prefetch" href="/docs/assets/js/325.6bf6a13b.js"><link rel="prefetch" href="/docs/assets/js/326.12ec3ea1.js"><link rel="prefetch" href="/docs/assets/js/327.27a782a9.js"><link rel="prefetch" href="/docs/assets/js/328.eb11917a.js"><link rel="prefetch" href="/docs/assets/js/329.7867e315.js"><link rel="prefetch" href="/docs/assets/js/33.9e56992d.js"><link rel="prefetch" href="/docs/assets/js/330.c1e14448.js"><link rel="prefetch" href="/docs/assets/js/331.98a583b5.js"><link rel="prefetch" href="/docs/assets/js/332.c2128d10.js"><link rel="prefetch" href="/docs/assets/js/333.230c1fc1.js"><link rel="prefetch" href="/docs/assets/js/334.9ffda49b.js"><link rel="prefetch" href="/docs/assets/js/335.f1fef49c.js"><link rel="prefetch" href="/docs/assets/js/336.b2a8b98a.js"><link rel="prefetch" href="/docs/assets/js/337.6b6b3167.js"><link rel="prefetch" href="/docs/assets/js/338.d3581cd3.js"><link rel="prefetch" href="/docs/assets/js/339.ad39fb1c.js"><link rel="prefetch" href="/docs/assets/js/34.cd3b1e00.js"><link rel="prefetch" href="/docs/assets/js/340.4709e2ad.js"><link rel="prefetch" href="/docs/assets/js/341.e4ad0e41.js"><link rel="prefetch" href="/docs/assets/js/342.2f2fc684.js"><link rel="prefetch" href="/docs/assets/js/343.287aceca.js"><link rel="prefetch" href="/docs/assets/js/344.e9f8e7ec.js"><link rel="prefetch" href="/docs/assets/js/345.d077fa5a.js"><link rel="prefetch" href="/docs/assets/js/346.82a4f692.js"><link rel="prefetch" href="/docs/assets/js/347.602d827c.js"><link rel="prefetch" href="/docs/assets/js/348.96e8e72f.js"><link rel="prefetch" href="/docs/assets/js/349.095d07b0.js"><link rel="prefetch" href="/docs/assets/js/35.9a720bfc.js"><link rel="prefetch" href="/docs/assets/js/350.034b1440.js"><link rel="prefetch" href="/docs/assets/js/351.778d6826.js"><link rel="prefetch" href="/docs/assets/js/352.a1e3790a.js"><link rel="prefetch" href="/docs/assets/js/353.5fa45113.js"><link rel="prefetch" href="/docs/assets/js/354.467ede1c.js"><link rel="prefetch" href="/docs/assets/js/355.4a6bf0e4.js"><link rel="prefetch" href="/docs/assets/js/356.e4a67714.js"><link rel="prefetch" href="/docs/assets/js/357.b1a1397e.js"><link rel="prefetch" href="/docs/assets/js/358.94c879c0.js"><link rel="prefetch" href="/docs/assets/js/359.babd755e.js"><link rel="prefetch" href="/docs/assets/js/36.391aa43a.js"><link rel="prefetch" href="/docs/assets/js/360.19d18cbb.js"><link rel="prefetch" href="/docs/assets/js/361.8a6be73b.js"><link rel="prefetch" href="/docs/assets/js/362.6c23e449.js"><link rel="prefetch" href="/docs/assets/js/363.5257774e.js"><link rel="prefetch" href="/docs/assets/js/364.40e5c473.js"><link rel="prefetch" href="/docs/assets/js/365.59ec3037.js"><link rel="prefetch" href="/docs/assets/js/366.baac6f7a.js"><link rel="prefetch" href="/docs/assets/js/367.f3fcc3d6.js"><link rel="prefetch" href="/docs/assets/js/368.1ea7bada.js"><link rel="prefetch" href="/docs/assets/js/369.c52654af.js"><link rel="prefetch" href="/docs/assets/js/37.6ea12731.js"><link rel="prefetch" href="/docs/assets/js/370.d7bb155b.js"><link rel="prefetch" href="/docs/assets/js/371.bb8e324c.js"><link rel="prefetch" href="/docs/assets/js/372.93da25e5.js"><link rel="prefetch" href="/docs/assets/js/373.d71c58e3.js"><link rel="prefetch" href="/docs/assets/js/374.eadfeb14.js"><link rel="prefetch" href="/docs/assets/js/375.2d95ad22.js"><link rel="prefetch" href="/docs/assets/js/376.718812b6.js"><link rel="prefetch" href="/docs/assets/js/377.3d7e6db8.js"><link rel="prefetch" href="/docs/assets/js/38.8fa08674.js"><link rel="prefetch" href="/docs/assets/js/39.6b24eadb.js"><link rel="prefetch" href="/docs/assets/js/4.18bd1d61.js"><link rel="prefetch" href="/docs/assets/js/40.695f504f.js"><link rel="prefetch" href="/docs/assets/js/41.f3181cfc.js"><link rel="prefetch" href="/docs/assets/js/42.9ba3d77e.js"><link rel="prefetch" href="/docs/assets/js/43.b2761398.js"><link rel="prefetch" href="/docs/assets/js/44.d6df959c.js"><link rel="prefetch" href="/docs/assets/js/45.fc5844bf.js"><link rel="prefetch" href="/docs/assets/js/46.8c725b4c.js"><link rel="prefetch" href="/docs/assets/js/47.4dc24e81.js"><link rel="prefetch" href="/docs/assets/js/48.0fcda1fa.js"><link rel="prefetch" href="/docs/assets/js/49.323c7084.js"><link rel="prefetch" href="/docs/assets/js/5.b16f7fd5.js"><link rel="prefetch" href="/docs/assets/js/50.580728ba.js"><link rel="prefetch" href="/docs/assets/js/51.eb4935bb.js"><link rel="prefetch" href="/docs/assets/js/52.b221e14c.js"><link rel="prefetch" href="/docs/assets/js/53.0277b886.js"><link rel="prefetch" href="/docs/assets/js/54.dbaf9d4c.js"><link rel="prefetch" href="/docs/assets/js/55.cf8952e3.js"><link rel="prefetch" href="/docs/assets/js/56.172f2c81.js"><link rel="prefetch" href="/docs/assets/js/57.7bf8fcc1.js"><link rel="prefetch" href="/docs/assets/js/58.d2169493.js"><link rel="prefetch" href="/docs/assets/js/59.53102ba3.js"><link rel="prefetch" href="/docs/assets/js/6.9ccaf204.js"><link rel="prefetch" href="/docs/assets/js/60.e47abf41.js"><link rel="prefetch" href="/docs/assets/js/61.e9f267da.js"><link rel="prefetch" href="/docs/assets/js/62.b941bda1.js"><link rel="prefetch" href="/docs/assets/js/63.4dc2523b.js"><link rel="prefetch" href="/docs/assets/js/64.c7b3b0fe.js"><link rel="prefetch" href="/docs/assets/js/66.18672da6.js"><link rel="prefetch" href="/docs/assets/js/67.493e909e.js"><link rel="prefetch" href="/docs/assets/js/68.642d9cbb.js"><link rel="prefetch" href="/docs/assets/js/69.6c9542ae.js"><link rel="prefetch" href="/docs/assets/js/7.1f1b12da.js"><link rel="prefetch" href="/docs/assets/js/70.f9d8478d.js"><link rel="prefetch" href="/docs/assets/js/71.dc3a93c2.js"><link rel="prefetch" href="/docs/assets/js/72.899013ec.js"><link rel="prefetch" href="/docs/assets/js/73.3570eca9.js"><link rel="prefetch" href="/docs/assets/js/74.c621629b.js"><link rel="prefetch" href="/docs/assets/js/75.ec8a6978.js"><link rel="prefetch" href="/docs/assets/js/76.7a585597.js"><link rel="prefetch" href="/docs/assets/js/77.d70bcfbf.js"><link rel="prefetch" href="/docs/assets/js/78.78cad07a.js"><link rel="prefetch" href="/docs/assets/js/79.b5b76b7f.js"><link rel="prefetch" href="/docs/assets/js/8.8abaf296.js"><link rel="prefetch" href="/docs/assets/js/80.094f0f71.js"><link rel="prefetch" href="/docs/assets/js/81.0055f5ca.js"><link rel="prefetch" href="/docs/assets/js/82.60eacc7d.js"><link rel="prefetch" href="/docs/assets/js/83.59169f72.js"><link rel="prefetch" href="/docs/assets/js/84.2632d1dd.js"><link rel="prefetch" href="/docs/assets/js/85.05377401.js"><link rel="prefetch" href="/docs/assets/js/86.5fa033c3.js"><link rel="prefetch" href="/docs/assets/js/87.f39edea4.js"><link rel="prefetch" href="/docs/assets/js/88.e9e63bdb.js"><link rel="prefetch" href="/docs/assets/js/89.86ac9367.js"><link rel="prefetch" href="/docs/assets/js/9.6deed371.js"><link rel="prefetch" href="/docs/assets/js/90.b25bc088.js"><link rel="prefetch" href="/docs/assets/js/91.1ccfe02d.js"><link rel="prefetch" href="/docs/assets/js/92.11729bcb.js"><link rel="prefetch" href="/docs/assets/js/93.af6f6105.js"><link rel="prefetch" href="/docs/assets/js/94.a334662a.js"><link rel="prefetch" href="/docs/assets/js/95.8f5867bb.js"><link rel="prefetch" href="/docs/assets/js/96.67dc1acc.js"><link rel="prefetch" href="/docs/assets/js/97.24c03314.js"><link rel="prefetch" href="/docs/assets/js/98.ec98b0c6.js"><link rel="prefetch" href="/docs/assets/js/99.4ba2f787.js">
    <link rel="stylesheet" href="/docs/assets/css/0.styles.5d974432.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/docs/" class="home-link router-link-active"><!----> <span class="site-name">Nguyễn Khánk's Wiki</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/docs/architect/" class="nav-link">
  Architecture
</a></div><div class="nav-item"><a href="/docs/kungfu/letsgo.html" class="nav-link">
  Kungfu
</a></div><div class="nav-item"><a href="https://nguyenngockhank.github.io" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Home
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/docs/architect/" class="nav-link">
  Architecture
</a></div><div class="nav-item"><a href="/docs/kungfu/letsgo.html" class="nav-link">
  Kungfu
</a></div><div class="nav-item"><a href="https://nguyenngockhank.github.io" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Home
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>The Art of Readable Code</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>A Philosophy of Software Design</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/docs/kungfu/philosophy/c1.html" class="sidebar-link">1. Introduction</a></li><li><a href="/docs/kungfu/philosophy/c2.html" class="sidebar-link">2. The Nature of Complexity</a></li><li><a href="/docs/kungfu/philosophy/c3.html" class="sidebar-link">3. Working Code Isn’t Enough</a></li><li><a href="/docs/kungfu/philosophy/c4.html" aria-current="page" class="active sidebar-link">4. Modules Should Be Deep</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docs/kungfu/philosophy/c4.html#_4-1-modular-design" class="sidebar-link">4.1    Modular design</a></li><li class="sidebar-sub-header"><a href="/docs/kungfu/philosophy/c4.html#_4-2-what-s-in-an-interface" class="sidebar-link">4.2    What’s in an interface?</a></li><li class="sidebar-sub-header"><a href="/docs/kungfu/philosophy/c4.html#_4-3-abstractions" class="sidebar-link">4.3    Abstractions</a></li><li class="sidebar-sub-header"><a href="/docs/kungfu/philosophy/c4.html#_4-4-deep-modules" class="sidebar-link">4.4    Deep modules</a></li><li class="sidebar-sub-header"><a href="/docs/kungfu/philosophy/c4.html#_4-5-shallow-modules" class="sidebar-link">4.5    Shallow modules</a></li><li class="sidebar-sub-header"><a href="/docs/kungfu/philosophy/c4.html#_4-6-classitis" class="sidebar-link">4.6    Classitis</a></li><li class="sidebar-sub-header"><a href="/docs/kungfu/philosophy/c4.html#_4-7-examples-java-and-unix-i-o" class="sidebar-link">4.7    Examples: Java and Unix I/O</a></li><li class="sidebar-sub-header"><a href="/docs/kungfu/philosophy/c4.html#_4-8-conclusion" class="sidebar-link">4.8    Conclusion</a></li></ul></li><li><a href="/docs/kungfu/philosophy/c5.html" class="sidebar-link">5.  Information Hiding (and Leakage)</a></li><li><a href="/docs/kungfu/philosophy/c6.html" class="sidebar-link">6.  General-Purpose Modules are Deeper</a></li><li><a href="/docs/kungfu/philosophy/c7.html" class="sidebar-link">7.  Dierent Layer, Dierent Abstraction</a></li><li><a href="/docs/kungfu/philosophy/c8.html" class="sidebar-link">8.  Pull Complexity Downwards</a></li><li><a href="/docs/kungfu/philosophy/c9.html" class="sidebar-link">9.  Better Together Or Better Apart?</a></li><li><a href="/docs/kungfu/philosophy/c10.html" class="sidebar-link">10.  Dene Errors Out Of Existence</a></li><li><a href="/docs/kungfu/philosophy/c11.html" class="sidebar-link">11.  Design it Twice</a></li><li><a href="/docs/kungfu/philosophy/c12.html" class="sidebar-link">12. Why Write Comments? The Four Excuses</a></li><li><a href="/docs/kungfu/philosophy/c13.html" class="sidebar-link">13. Comments Should Describe Things that aren’t Obvious from the Code</a></li><li><a href="/docs/kungfu/philosophy/c14.html" class="sidebar-link">14. Choosing Names</a></li><li><a href="/docs/kungfu/philosophy/c15.html" class="sidebar-link">15.  Write The Comments First</a></li><li><a href="/docs/kungfu/philosophy/c16.html" class="sidebar-link">16. Modifying Existing Code</a></li><li><a href="/docs/kungfu/philosophy/c17.html" class="sidebar-link">17. Consistency</a></li><li><a href="/docs/kungfu/philosophy/c18.html" class="sidebar-link">18. Code Should be Obvious</a></li><li><a href="/docs/kungfu/philosophy/c19.html" class="sidebar-link">19. Software Trends</a></li><li><a href="/docs/kungfu/philosophy/c20.html" class="sidebar-link">20. Designing for Performance</a></li><li><a href="/docs/kungfu/philosophy/c21.html" class="sidebar-link">21. Conclusion</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Building Microservices</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>97 Things Every Programmer Should Know</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>NoSql Distilled</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Others</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="_4-modules-should-be-deep"><a href="#_4-modules-should-be-deep" class="header-anchor">#</a> 4. Modules Should Be Deep</h1> <p>One of the most important techniques for managing software complexity
is to design systems so that developers only need to face a small fraction
of the overall complexity at any given time. This approach is called
modular design, and this chapter presents its basic principles.</p> <h2 id="_4-1-modular-design"><a href="#_4-1-modular-design" class="header-anchor">#</a> 4.1    Modular design</h2> <p>In modular design, a software system is decomposed into a collection of
modules that are relatively independent. Modules can take many forms,
such as classes, subsystems, or services. In an ideal world, each module
would be completely independent of the others: a developer could work in
any of the modules without knowing anything about any of the other
modules. In this world, the complexity of a system would be the
complexity of its worst module.</p> <p>Unfortunately, this ideal is not achievable. Modules must work
together by calling each others’s functions or methods. As a result,
modules must know something about each other. There will be
dependencies between the modules: if one module changes, other modules
may need to change to match. For example, the arguments for a method
create a dependency between the method and any code that invokes the
method. If the required arguments change, all invocations of the method
must be modified to conform to the new signature. Dependencies can take
many other forms, and they can be quite subtle. The goal of modular
design is to minimize the dependencies between modules.</p> <p>In order to manage dependencies, we think of each module in two
parts: an interface and an implementation. The interface consists of
everything that a developer working in a different module must know in</p> <p>order to use the given module. Typically, the interface describes what the
module does but not how it does it. The implementation consists of the
code that carries out the promises made by the interface. A developer
working in a particular module must understand the interface and
implementation of that module, plus the interfaces of any other modules
invoked by the given module. A developer should not need to understand
the implementations of modules other than the one he or she is working in.</p> <p>Consider a module that implements balanced trees. The module
probably contains sophisticated code for ensuring that the tree remains
balanced. However, this complexity is not visible to users of the module.
Users see a relatively simple interface for invoking operations to insert,
remove, and fetch nodes in the tree. To invoke an insert operation, the
caller need only provide the key and value for the new node; the
mechanisms for traversing the tree and splitting nodes are not visible in
the interface.</p> <p>For the purposes of this book, a module is any unit of code that has an
interface and an implementation. Each class in an object-oriented
programming language is a module. Methods within a class, or functions
in a language that isn’t object-oriented, can also be thought of as modules:
each of these has an interface and an implementation, and modular design
techniques can be applied to them. Higher-level subsystems and services
are also modules; their interfaces may take different forms, such as kernel
calls or HTTP requests. Much of the discussion about modular design in
this book focuses on designing classes, but the techniques and concepts
apply to other kinds of modules as well.</p> <p>The best modules are those whose interfaces are much simpler than
their implementations. Such modules have two advantages. First, a simple
interface minimizes the complexity that a module imposes on the rest of
the system. Second, if a module is modified in a way that does not change
its interface, then no other module will be affected by the modification. If
a module’s interface is much simpler than its implementation, there will
be many aspects of the module that can be changed without affecting other
modules.</p> <h2 id="_4-2-what-s-in-an-interface"><a href="#_4-2-what-s-in-an-interface" class="header-anchor">#</a> 4.2    What’s in an interface?</h2> <p>The interface to a module contains two kinds of information: formal and
informal. The formal parts of an interface are specified explicitly in the
code, and some of these can be checked for correctness by the
programming language. For example, the formal interface for a method is
its signature, which includes the names and types of its parameters, the
type of its return value, and information about exceptions thrown by the
method. Most programming languages ensure that each invocation of a
method provides the right number and types of arguments to match its
signature. The formal interface for a class consists of the signatures for all
of its public methods, plus the names and types of any public variables.</p> <p>Each interface also includes informal elements. These are not specified
in a way that can be understood or enforced by the programming language.
The informal parts of an interface include its high-level behavior, such as
the fact that a function deletes the file named by one of its arguments. If
there are constraints on the usage of a class (perhaps one method must be
called before another), these are also part of the class’s interface. In
general, if a developer needs to know a particular piece of information in
order to use a module, then that information is part of the module’s
interface. The informal aspects of an interface can only be described using
comments, and the programming language cannot ensure that the</p> <p>description is complete or accurate^1. For most interfaces the informal
aspects are larger and more complex than the formal aspects.</p> <p>One of the benefits of a clearly specified interface is that it indicates
exactly what developers need to know in order to use the associated
module. This helps to eliminate the “unknown unknowns” problem
described in Section 2.2.</p> <h2 id="_4-3-abstractions"><a href="#_4-3-abstractions" class="header-anchor">#</a> 4.3    Abstractions</h2> <p>The term abstraction is closely related to the idea of modular design. An
abstraction is a simplified view of an entity, which omits unimportant
details. Abstractions are useful because they make it easier for us to think
about and manipulate complex things.</p> <p>In modular programming, each module provides an abstraction in form
of its interface. The interface presents a simplified view of the module’s</p> <p>functionality; the details of the implementation are unimportant from the
standpoint of the module’s abstraction, so they are omitted from the
interface.</p> <p>In the definition of abstraction, the word “unimportant” is crucial. The
more unimportant details that are omitted from an abstraction, the better.
However, a detail can only be omitted from an abstraction if it is
unimportant. An abstraction can go wrong in two ways. First, it can
include details that are not really important; when this happens, it makes
the abstraction more complicated than necessary, which increases the
cognitive load on developers using the abstraction. The second error is
when an abstraction omits details that really are important. This results in
obscurity: developers looking only at the abstraction will not have all the
information they need to use the abstraction correctly. An abstraction that
omits important details is a false abstraction: it might appear simple, but
in reality it isn’t. The key to designing abstractions is to understand what
is important, and to look for designs that minimize the amount of
information that is important.</p> <p>As an example, consider a file system. The abstraction provided by a
file system omits many details, such as the mechanism for choosing which
blocks on a storage device to use for the data in a given file. These details
are unimportant to users of the file system (as long as the system provides
adequate performance). However, some of the details of a file system’s
implementation are important to users. Most file systems cache data in
main memory, and they may delay writing new data to the storage device
in order to improve performance. Some applications, such as databases,
need to know exactly when data is written through to storage, so they can
ensure that data will be preserved after system crashes. Thus, the rules for
flushing data to secondary storage must be visible in the file system’s
interface.</p> <p>We depend on abstractions to manage complexity not just in
programming, but pervasively in our everyday lives. A microwave oven
contains complex electronics to convert alternating current into microwave
radiation and distribute that radiation throughout the cooking cavity.
Fortunately, users see a much simpler abstraction, consisting of a few
buttons to control the timing and intensity of the microwaves. Cars provide</p> <p>a simple abstraction that allows us to drive them without understanding
the mechanisms for electrical motors, battery power management, anti-
lock brakes, cruise control, and so on.</p> <h2 id="_4-4-deep-modules"><a href="#_4-4-deep-modules" class="header-anchor">#</a> 4.4    Deep modules</h2> <p>The best modules are those that provide powerful functionality yet have
simple interfaces. I use the term deep to describe such modules. To
visualize the notion of depth, imagine that each module is represented by a
rectangle, as shown in Figure 4.1. The area of each rectangle is
proportional to the functionality implemented by the module. The top edge
of a rectangle represents the module’s interface; the length of that edge
indicates the complexity of the interface. The best modules are deep: they
have a lot of functionality hidden behind a simple interface. A deep
module is a good abstraction because only a small fraction of its internal
complexity is visible to its users.</p> <p><img src="/docs/assets/img/image--004.ed9eb89a.jpg" alt="Image"></p> <p><strong>Figure 4.1</strong>: <em>Deep and shallow modules. The best modules are deep: they allow a lot of functionality to be accessed through a simple interface. A shallow module is one with a relatively complex interface, but not much functionality: it doesn’t hide much complexity.</em></p> <p>Module depth is a way of thinking about cost versus benefit. The
benefit provided by a module is its functionality. The cost of a module (in
terms of system complexity) is its interface. A module’s interface
represents the complexity that the module imposes on the rest of the
system: the smaller and simpler the interface, the less complexity that it
introduces. The best modules are those with the greatest benefit and the
least cost. Interfaces are good, but more, or larger, interfaces are not
necessarily better!</p> <p>The mechanism for file I/O provided by the Unix operating system and
its descendants, such as Linux, is a beautiful example of a deep interface.
There are only five basic system calls for I/O, with simple signatures:</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">int</span> <span class="token function">open</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> path<span class="token punctuation">,</span> <span class="token keyword">int</span> flags<span class="token punctuation">,</span> mode_t permissions<span class="token punctuation">)</span><span class="token punctuation">;</span>
ssize_t <span class="token function">read</span><span class="token punctuation">(</span><span class="token keyword">int</span> fd<span class="token punctuation">,</span> <span class="token keyword">void</span><span class="token operator">*</span> buffer<span class="token punctuation">,</span> size_t count<span class="token punctuation">)</span><span class="token punctuation">;</span>
ssize_t <span class="token function">write</span><span class="token punctuation">(</span><span class="token keyword">int</span> fd<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">void</span><span class="token operator">*</span> buffer<span class="token punctuation">,</span> size_t count<span class="token punctuation">)</span><span class="token punctuation">;</span>
off_t <span class="token function">lseek</span><span class="token punctuation">(</span><span class="token keyword">int</span> fd<span class="token punctuation">,</span> off_t offset<span class="token punctuation">,</span> <span class="token keyword">int</span> referencePosition<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> <span class="token function">close</span><span class="token punctuation">(</span><span class="token keyword">int</span> fd<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>The open system call takes a hierarchical file name such as /a/b/c and</p> <p>returns an integer file descriptor, which is used to reference the open file.
The other arguments for open provide optional information such as
whether the file is being opened for reading or writing, whether a new file
should be created if there is no existing file, and access permissions for
the file, if a new file is created. The read and write system calls transfer</p> <p>information between buffer areas in the application’s memory and the file;
close ends the access to the file. Most files are accessed sequentially, so
that is the default; however, random access can be achieved by invoking
the lseek system call to change the current access position.</p> <p>A modern implementation of the Unix I/O interface requires hundreds
of thousands of lines of code, which address complex issues such as:
How are files represented on disk in order to allow efficient access?
How are directories stored, and how are hierarchical path names
processed to find the files they refer to?
How are permissions enforced, so that one user cannot modify or
delete another user’s files?
How are file accesses implemented? For example, how is
functionality divided between interrupt handlers and background
code, and how do these two elements communicate safely?
What scheduling policies are used when there are concurrent accesses
to multiple files?
How can recently accessed file data be cached in memory in order to
reduce the number of disk accesses?
How can a variety of different secondary storage devices, such as
disks and flash drives, be incorporated into a single file system?</p> <p>All of these issues, and many more, are handled by the Unix file system
implementation; they are invisible to programmers who invoke the system
calls. Implementations of the Unix I/O interface have evolved radically
over the years, but the five basic kernel calls have not changed.</p> <p>Another example of a deep module is the garbage collector in a
language such as Go or Java. This module has no interface at all; it works
invisibly behind the scenes to reclaim unused memory. Adding garbage
collection to a system actually shrinks its overall interface, since it
eliminates the interface for freeing objects. The implementation of a
garbage collector is quite complex, but that complexity is hidden from
programmers using the language.</p> <p>Deep modules such as Unix I/O and garbage collectors provide
powerful abstractions because they are easy to use, yet they hide
significant implementation complexity.</p> <h2 id="_4-5-shallow-modules"><a href="#_4-5-shallow-modules" class="header-anchor">#</a> 4.5    Shallow modules</h2> <p>On the other hand, a shallow module is one whose interface is relatively
complex in comparison to the functionality that it provides. For example, a
class that implements linked lists is shallow. It doesn’t take much code to
manipulate a linked list (inserting or deleting an element takes only a few
lines), so the linked list abstraction doesn’t hide very many details. The
complexity of a linked list interface is nearly as great as the complexity of
its implementation. Shallow classes are sometimes unavoidable, but they
don’t provide help much in managing complexity.</p> <p>Here is an extreme example of a shallow method, taken from a project
in a software design class:</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">addNullValueForAttribute</span><span class="token punctuation">(</span><span class="token class-name">String</span> attribute<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    data<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>attribute<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>From the standpoint of managing complexity, this method makes things
worse, not better. The method offers no abstraction, since all of its
functionality is visible through its interface. For example, callers probably
need to know that the attribute will be stored in the data variable. It is no
simpler to think about the interface than to think about the full</p> <p>implementation. If the method is documented properly, the documentation
will be longer than the method’s code. It even takes more keystrokes to
invoke the method than it would take for a caller to manipulate the data</p> <p>variable directly. The method adds complexity (in the form of a new
interface for developers to learn) but provides no compensating benefit.</p> <div class="custom-block danger"><p class="custom-block-title">Red Flag: Shallow Module</p> <p>A shallow module is one whose interface is complicated relative to the
functionality it provides. Shallow modules don’t help much in the battle
against complexity, because the benefit they provide (not having to learn
about how they work internally) is negated by the cost of learning and
using their interfaces. Small modules tend to be shallow.</p></div> <h2 id="_4-6-classitis"><a href="#_4-6-classitis" class="header-anchor">#</a> 4.6    Classitis</h2> <p>Unfortunately, the value of deep classes is not widely appreciated today.
The conventional wisdom in programming is that classes should be small,
not deep. Students are often taught that the most important thing in class
design is to break up larger classes into smaller ones. The same advice is
often given about methods: “Any method longer than N lines should be
divided into multiple methods” (N can be as low as 10). This approach
results in large numbers of shallow classes and methods, which add to
overall system complexity.</p> <p>The extreme of the “classes should be small” approach is a syndrome I
call classitis, which stems from the mistaken view that “classes are good,
so more classes are better.” In systems suffering from classitis, developers
are encouraged to minimize the amount of functionality in each new class:
if you want more functionality, introduce more classes. Classitis may
result in classes that are individually simple, but it increases the
complexity of the overall system. Small classes don’t contribute much
functionality, so there have to be a lot of them, each with its own interface.
These interfaces accumulate to create tremendous complexity at the</p> <p>system level. Small classes also result in a verbose programming style,
due to the boilerplate required for each class.</p> <h2 id="_4-7-examples-java-and-unix-i-o"><a href="#_4-7-examples-java-and-unix-i-o" class="header-anchor">#</a> 4.7    Examples: Java and Unix I/O</h2> <p>One of the most visible examples of classitis today is the Java class library. The Java language doesn’t require lots of small classes, but a culture of classitis seems to have taken root in the Java programming community. For example, to open a file in order to read serialized objects
from it, you must create three different objects:</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">FileInputStream</span> fileStream <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileInputStream</span><span class="token punctuation">(</span>fileName<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">BufferedInputStream</span> bufferedStream <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BufferedInputStream</span><span class="token punctuation">(</span>fileStream<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">ObjectInputStream</span> objectStream <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ObjectInputStream</span><span class="token punctuation">(</span>bufferedStream<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>A <code>FileInputStream</code> object provides only rudimentary I/O: it is not capable of performing buffered I/O, nor can it read or write serialized objects. The <code>BufferedInputStream</code> object adds buffering to a <code>FileInputStream</code>, and the</p> <p><code>ObjectInputStream</code> adds the ability to read and write serialized objects. The first two objects in the code above, fileStream and bufferedStream, are never used once the file has been opened; all future operations use <code>objectStream</code>.</p> <p>It is particularly annoying (and error-prone) that buffering must be requested explicitly by creating a separate <code>BufferedInputStream</code> object; if a developer forgets to create this object, there will be no buffering and I/O will be slow. Perhaps the Java developers would argue that not everyone wants to use buffering for file I/O, so it shouldn’t be built into the base mechanism. They might argue that it’s better to keep buffering separate, so people can choose whether or not to use it. Providing choice is good, but interfaces should be designed to make the common case as simple as possible (see the formula on page 6). Almost every user of file I/O will want buffering, so it should be provided by default. For those few situations where buffering is not desirable, the library can provide a mechanism to disable it. Any mechanism for disabling buffering should be cleanly separated in the interface (for example, by providing a different constructor for FileInputStream, or through a method that disables or replaces the buffering mechanism), so that most developers do not even need to be aware of its existence.</p> <p>In contrast, the designers of the Unix system calls made the common case simple. For example, they recognized that sequential I/O is most common, so they made that the default behavior. Random access is still relatively easy to do, using the lseek system call, but a developer doing only sequential access need not be aware of that mechanism. If an interface has many features, but most developers only need to be aware of a few of them, the effective complexity of that interface is just the
complexity of the commonly used features.</p> <h2 id="_4-8-conclusion"><a href="#_4-8-conclusion" class="header-anchor">#</a> 4.8    Conclusion</h2> <p>By separating the interface of a module from its implementation, we can hide the complexity of the implementation from the rest of the system.</p> <p>Users of a module need only understand the abstraction provided by its interface. The most important issue in designing classes and other modules is to make them deep, so that they have simple interfaces for the common use cases, yet still provide significant functionality. This maximizes the amount of complexity that is concealed.</p> <p>(^1) There exist languages, mostly in the research community, where the overall behavior of a method or function can be described formally using a specification language. The specification can be checked automatically to ensure that it matches the implementation. An interesting question is whether such a formal specification could replace the informal parts of an interface.</p> <p>My current opinion is that an interface described in English is likely to be more intuitive and understandable for developers than one written in a formal specification language.</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/docs/kungfu/philosophy/c3.html" class="prev">
        3. Working Code Isn’t Enough
      </a></span> <span class="next"><a href="/docs/kungfu/philosophy/c5.html">
        5.  Information Hiding (and Leakage)
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----><!----><!----></div></div>
    <script src="/docs/assets/js/app.18f0d89d.js" defer></script><script src="/docs/assets/js/2.4b1aafd9.js" defer></script><script src="/docs/assets/js/65.9e3dd553.js" defer></script><script src="/docs/assets/js/30.a8926ddd.js" defer></script>
  </body>
</html>
