<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>9.  Better Together Or Better Apart? | Nguyễn Khánk&#39;s Wiki</title>
    <meta name="generator" content="VuePress 1.7.1">
    <link rel="apple-touch-icon" sizes="180x180" href="../public/favicons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="../public/favicons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="../public/favicons/favicon-16x16.png">
    <link rel="manifest" href="../public/favicons/manifest.json">
    <link rel="mask-icon" href="../public/favicons/safari-pinned-tab.svg" color="#3a0839">
    <link rel="shortcut icon" href="../public/favicons/favicon.ico">
    <meta name="description" content="Wikipedia của tui">
    <meta name="msapplication-TileColor" content="#3a0839">
    <meta name="msapplication-config" content="../public/favicons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    
    <link rel="preload" href="/docs/assets/css/0.styles.5d974432.css" as="style"><link rel="preload" href="/docs/assets/js/app.feff3dbb.js" as="script"><link rel="preload" href="/docs/assets/js/2.aca46d71.js" as="script"><link rel="preload" href="/docs/assets/js/23.dc13f196.js" as="script"><link rel="preload" href="/docs/assets/js/27.5ed2ce18.js" as="script"><link rel="prefetch" href="/docs/assets/js/10.e2dac1de.js"><link rel="prefetch" href="/docs/assets/js/100.072f86f4.js"><link rel="prefetch" href="/docs/assets/js/101.fc0bc918.js"><link rel="prefetch" href="/docs/assets/js/102.ddeddef2.js"><link rel="prefetch" href="/docs/assets/js/103.a299e414.js"><link rel="prefetch" href="/docs/assets/js/104.29aa9c20.js"><link rel="prefetch" href="/docs/assets/js/105.5211965b.js"><link rel="prefetch" href="/docs/assets/js/106.f091e57b.js"><link rel="prefetch" href="/docs/assets/js/107.80acce0d.js"><link rel="prefetch" href="/docs/assets/js/108.b0108b40.js"><link rel="prefetch" href="/docs/assets/js/109.7953f94a.js"><link rel="prefetch" href="/docs/assets/js/11.34f9e1bc.js"><link rel="prefetch" href="/docs/assets/js/110.59b888f8.js"><link rel="prefetch" href="/docs/assets/js/111.5b11b553.js"><link rel="prefetch" href="/docs/assets/js/112.8a857b53.js"><link rel="prefetch" href="/docs/assets/js/113.5aab77e8.js"><link rel="prefetch" href="/docs/assets/js/114.aef8a2f2.js"><link rel="prefetch" href="/docs/assets/js/115.777be1e9.js"><link rel="prefetch" href="/docs/assets/js/116.3092451f.js"><link rel="prefetch" href="/docs/assets/js/117.3345c37e.js"><link rel="prefetch" href="/docs/assets/js/118.be055f62.js"><link rel="prefetch" href="/docs/assets/js/119.77b121e6.js"><link rel="prefetch" href="/docs/assets/js/12.a704c651.js"><link rel="prefetch" href="/docs/assets/js/120.2d64d4ae.js"><link rel="prefetch" href="/docs/assets/js/121.954a3ba9.js"><link rel="prefetch" href="/docs/assets/js/122.f8032cd6.js"><link rel="prefetch" href="/docs/assets/js/123.96d7858b.js"><link rel="prefetch" href="/docs/assets/js/124.f12d4c00.js"><link rel="prefetch" href="/docs/assets/js/125.47b679a8.js"><link rel="prefetch" href="/docs/assets/js/126.725c596d.js"><link rel="prefetch" href="/docs/assets/js/127.75f3139f.js"><link rel="prefetch" href="/docs/assets/js/128.9862473f.js"><link rel="prefetch" href="/docs/assets/js/129.0f09cf34.js"><link rel="prefetch" href="/docs/assets/js/13.66fe2f7e.js"><link rel="prefetch" href="/docs/assets/js/130.d20c4272.js"><link rel="prefetch" href="/docs/assets/js/131.771cb92a.js"><link rel="prefetch" href="/docs/assets/js/132.308ce22e.js"><link rel="prefetch" href="/docs/assets/js/133.99780c7f.js"><link rel="prefetch" href="/docs/assets/js/134.c8bb3739.js"><link rel="prefetch" href="/docs/assets/js/135.d22b8cd4.js"><link rel="prefetch" href="/docs/assets/js/136.0f7f2732.js"><link rel="prefetch" href="/docs/assets/js/137.66315d8b.js"><link rel="prefetch" href="/docs/assets/js/138.bc1e4151.js"><link rel="prefetch" href="/docs/assets/js/139.4bf7c284.js"><link rel="prefetch" href="/docs/assets/js/14.57825f78.js"><link rel="prefetch" href="/docs/assets/js/140.023cb781.js"><link rel="prefetch" href="/docs/assets/js/141.3ed2d77a.js"><link rel="prefetch" href="/docs/assets/js/142.97feece5.js"><link rel="prefetch" href="/docs/assets/js/143.22b3a1b2.js"><link rel="prefetch" href="/docs/assets/js/144.3b8c0d53.js"><link rel="prefetch" href="/docs/assets/js/145.c187e405.js"><link rel="prefetch" href="/docs/assets/js/146.02e7dc46.js"><link rel="prefetch" href="/docs/assets/js/147.1ea04230.js"><link rel="prefetch" href="/docs/assets/js/148.eceb141f.js"><link rel="prefetch" href="/docs/assets/js/149.7bc98406.js"><link rel="prefetch" href="/docs/assets/js/15.cbcf56bd.js"><link rel="prefetch" href="/docs/assets/js/150.345f53e1.js"><link rel="prefetch" href="/docs/assets/js/151.97fd5643.js"><link rel="prefetch" href="/docs/assets/js/152.0f0ace62.js"><link rel="prefetch" href="/docs/assets/js/153.5ae906c9.js"><link rel="prefetch" href="/docs/assets/js/154.4524d48f.js"><link rel="prefetch" href="/docs/assets/js/155.d7cbb04b.js"><link rel="prefetch" href="/docs/assets/js/156.51743cf0.js"><link rel="prefetch" href="/docs/assets/js/157.12aa1a8a.js"><link rel="prefetch" href="/docs/assets/js/158.04757c69.js"><link rel="prefetch" href="/docs/assets/js/159.7a8588a6.js"><link rel="prefetch" href="/docs/assets/js/16.b9864c9c.js"><link rel="prefetch" href="/docs/assets/js/160.79ec6015.js"><link rel="prefetch" href="/docs/assets/js/161.4f0b5cd9.js"><link rel="prefetch" href="/docs/assets/js/162.6cc1f3af.js"><link rel="prefetch" href="/docs/assets/js/163.187c5335.js"><link rel="prefetch" href="/docs/assets/js/164.556dc6d8.js"><link rel="prefetch" href="/docs/assets/js/165.6c6e1f75.js"><link rel="prefetch" href="/docs/assets/js/166.afe12552.js"><link rel="prefetch" href="/docs/assets/js/167.bd3dd81a.js"><link rel="prefetch" href="/docs/assets/js/168.b5e90a8d.js"><link rel="prefetch" href="/docs/assets/js/169.80b477b3.js"><link rel="prefetch" href="/docs/assets/js/17.8983ce9d.js"><link rel="prefetch" href="/docs/assets/js/170.4fcbc9a3.js"><link rel="prefetch" href="/docs/assets/js/171.6c7ccd83.js"><link rel="prefetch" href="/docs/assets/js/172.e02d80ea.js"><link rel="prefetch" href="/docs/assets/js/173.66fb904a.js"><link rel="prefetch" href="/docs/assets/js/174.4f18cc78.js"><link rel="prefetch" href="/docs/assets/js/175.b1c5644a.js"><link rel="prefetch" href="/docs/assets/js/176.bd684253.js"><link rel="prefetch" href="/docs/assets/js/177.c62f362d.js"><link rel="prefetch" href="/docs/assets/js/178.f953855f.js"><link rel="prefetch" href="/docs/assets/js/179.10404ee2.js"><link rel="prefetch" href="/docs/assets/js/18.5efe21b3.js"><link rel="prefetch" href="/docs/assets/js/180.c4330ec2.js"><link rel="prefetch" href="/docs/assets/js/181.02c26c33.js"><link rel="prefetch" href="/docs/assets/js/182.773ba280.js"><link rel="prefetch" href="/docs/assets/js/183.064d5ae1.js"><link rel="prefetch" href="/docs/assets/js/184.2c64e798.js"><link rel="prefetch" href="/docs/assets/js/185.38c7b6e9.js"><link rel="prefetch" href="/docs/assets/js/186.d95e2e7a.js"><link rel="prefetch" href="/docs/assets/js/187.8aad3033.js"><link rel="prefetch" href="/docs/assets/js/188.7f201e8d.js"><link rel="prefetch" href="/docs/assets/js/189.6cefdb59.js"><link rel="prefetch" href="/docs/assets/js/19.58823304.js"><link rel="prefetch" href="/docs/assets/js/190.90e5aa35.js"><link rel="prefetch" href="/docs/assets/js/191.3e1cf065.js"><link rel="prefetch" href="/docs/assets/js/192.a2c49267.js"><link rel="prefetch" href="/docs/assets/js/193.cd7650f2.js"><link rel="prefetch" href="/docs/assets/js/194.1d2ca753.js"><link rel="prefetch" href="/docs/assets/js/195.e29ca5e1.js"><link rel="prefetch" href="/docs/assets/js/196.ff519f9d.js"><link rel="prefetch" href="/docs/assets/js/197.d7c7a2c2.js"><link rel="prefetch" href="/docs/assets/js/198.77259c6a.js"><link rel="prefetch" href="/docs/assets/js/199.7983bd3b.js"><link rel="prefetch" href="/docs/assets/js/20.3b486daa.js"><link rel="prefetch" href="/docs/assets/js/200.e9a796d0.js"><link rel="prefetch" href="/docs/assets/js/201.b4449da8.js"><link rel="prefetch" href="/docs/assets/js/202.ab520617.js"><link rel="prefetch" href="/docs/assets/js/203.1944c871.js"><link rel="prefetch" href="/docs/assets/js/204.2ddfe4db.js"><link rel="prefetch" href="/docs/assets/js/205.3a4a5484.js"><link rel="prefetch" href="/docs/assets/js/206.9eaec970.js"><link rel="prefetch" href="/docs/assets/js/207.ca2acd17.js"><link rel="prefetch" href="/docs/assets/js/208.bc4e3070.js"><link rel="prefetch" href="/docs/assets/js/209.8194c212.js"><link rel="prefetch" href="/docs/assets/js/21.1e77a313.js"><link rel="prefetch" href="/docs/assets/js/210.473ccc45.js"><link rel="prefetch" href="/docs/assets/js/211.623b4033.js"><link rel="prefetch" href="/docs/assets/js/212.0f85a611.js"><link rel="prefetch" href="/docs/assets/js/213.191977aa.js"><link rel="prefetch" href="/docs/assets/js/214.a23c6dcc.js"><link rel="prefetch" href="/docs/assets/js/215.25321a42.js"><link rel="prefetch" href="/docs/assets/js/216.e450a05c.js"><link rel="prefetch" href="/docs/assets/js/217.abab04ca.js"><link rel="prefetch" href="/docs/assets/js/218.66e0082a.js"><link rel="prefetch" href="/docs/assets/js/219.5f4ee9fd.js"><link rel="prefetch" href="/docs/assets/js/22.1c51f113.js"><link rel="prefetch" href="/docs/assets/js/220.bbb5df8d.js"><link rel="prefetch" href="/docs/assets/js/221.0d3dfd46.js"><link rel="prefetch" href="/docs/assets/js/222.8e68bdb2.js"><link rel="prefetch" href="/docs/assets/js/223.6c582cd9.js"><link rel="prefetch" href="/docs/assets/js/224.f570e175.js"><link rel="prefetch" href="/docs/assets/js/225.b249063b.js"><link rel="prefetch" href="/docs/assets/js/226.48576d77.js"><link rel="prefetch" href="/docs/assets/js/227.8346e855.js"><link rel="prefetch" href="/docs/assets/js/228.8e3e6ca7.js"><link rel="prefetch" href="/docs/assets/js/229.faed0af8.js"><link rel="prefetch" href="/docs/assets/js/230.dcc8e04d.js"><link rel="prefetch" href="/docs/assets/js/231.611372c2.js"><link rel="prefetch" href="/docs/assets/js/232.aaaeb300.js"><link rel="prefetch" href="/docs/assets/js/233.819d8911.js"><link rel="prefetch" href="/docs/assets/js/234.41eb70ca.js"><link rel="prefetch" href="/docs/assets/js/235.acedc064.js"><link rel="prefetch" href="/docs/assets/js/236.fbc4b8f7.js"><link rel="prefetch" href="/docs/assets/js/237.7b217482.js"><link rel="prefetch" href="/docs/assets/js/238.6b2400f7.js"><link rel="prefetch" href="/docs/assets/js/239.570754bf.js"><link rel="prefetch" href="/docs/assets/js/24.d1deb976.js"><link rel="prefetch" href="/docs/assets/js/240.30c365e9.js"><link rel="prefetch" href="/docs/assets/js/241.aebbd7aa.js"><link rel="prefetch" href="/docs/assets/js/242.5df1a85a.js"><link rel="prefetch" href="/docs/assets/js/243.704fb61f.js"><link rel="prefetch" href="/docs/assets/js/244.9bc98748.js"><link rel="prefetch" href="/docs/assets/js/245.38e733b7.js"><link rel="prefetch" href="/docs/assets/js/246.b81c0b24.js"><link rel="prefetch" href="/docs/assets/js/247.c0a84943.js"><link rel="prefetch" href="/docs/assets/js/248.47e7f09b.js"><link rel="prefetch" href="/docs/assets/js/249.29294a64.js"><link rel="prefetch" href="/docs/assets/js/25.ddba0ef8.js"><link rel="prefetch" href="/docs/assets/js/250.7b97771f.js"><link rel="prefetch" href="/docs/assets/js/251.af134ede.js"><link rel="prefetch" href="/docs/assets/js/252.996a9add.js"><link rel="prefetch" href="/docs/assets/js/253.6b08af88.js"><link rel="prefetch" href="/docs/assets/js/254.a14372bd.js"><link rel="prefetch" href="/docs/assets/js/255.868fb43f.js"><link rel="prefetch" href="/docs/assets/js/256.606c2f81.js"><link rel="prefetch" href="/docs/assets/js/257.9c34c318.js"><link rel="prefetch" href="/docs/assets/js/258.236c65be.js"><link rel="prefetch" href="/docs/assets/js/259.dc9c78fd.js"><link rel="prefetch" href="/docs/assets/js/26.23be3024.js"><link rel="prefetch" href="/docs/assets/js/260.228e0898.js"><link rel="prefetch" href="/docs/assets/js/261.7dd0cc1f.js"><link rel="prefetch" href="/docs/assets/js/262.7c674375.js"><link rel="prefetch" href="/docs/assets/js/263.0d61e50b.js"><link rel="prefetch" href="/docs/assets/js/264.0595e5d9.js"><link rel="prefetch" href="/docs/assets/js/265.4f8cb07b.js"><link rel="prefetch" href="/docs/assets/js/266.fe3edb0f.js"><link rel="prefetch" href="/docs/assets/js/267.8942e793.js"><link rel="prefetch" href="/docs/assets/js/268.86eb0eb9.js"><link rel="prefetch" href="/docs/assets/js/269.03f58dca.js"><link rel="prefetch" href="/docs/assets/js/270.90b7be1d.js"><link rel="prefetch" href="/docs/assets/js/271.b556bf53.js"><link rel="prefetch" href="/docs/assets/js/272.0b7f4823.js"><link rel="prefetch" href="/docs/assets/js/273.d311f5f5.js"><link rel="prefetch" href="/docs/assets/js/274.06fb099b.js"><link rel="prefetch" href="/docs/assets/js/275.e40667a2.js"><link rel="prefetch" href="/docs/assets/js/276.d3ab71c4.js"><link rel="prefetch" href="/docs/assets/js/277.5feda584.js"><link rel="prefetch" href="/docs/assets/js/278.beaf14c2.js"><link rel="prefetch" href="/docs/assets/js/279.f7073aaf.js"><link rel="prefetch" href="/docs/assets/js/28.f7b1175c.js"><link rel="prefetch" href="/docs/assets/js/280.72c464b5.js"><link rel="prefetch" href="/docs/assets/js/281.1fc9c7ce.js"><link rel="prefetch" href="/docs/assets/js/282.4e16e559.js"><link rel="prefetch" href="/docs/assets/js/283.4fb4b1a6.js"><link rel="prefetch" href="/docs/assets/js/284.c3baaf64.js"><link rel="prefetch" href="/docs/assets/js/285.a7a948cc.js"><link rel="prefetch" href="/docs/assets/js/286.73a344a9.js"><link rel="prefetch" href="/docs/assets/js/287.6035b91a.js"><link rel="prefetch" href="/docs/assets/js/288.bb0dbdf9.js"><link rel="prefetch" href="/docs/assets/js/289.10918ad5.js"><link rel="prefetch" href="/docs/assets/js/29.d0e3b179.js"><link rel="prefetch" href="/docs/assets/js/290.20c7bcd8.js"><link rel="prefetch" href="/docs/assets/js/291.ee116400.js"><link rel="prefetch" href="/docs/assets/js/292.dfc2e949.js"><link rel="prefetch" href="/docs/assets/js/293.8a851721.js"><link rel="prefetch" href="/docs/assets/js/294.1f4a08e0.js"><link rel="prefetch" href="/docs/assets/js/295.7ba75a19.js"><link rel="prefetch" href="/docs/assets/js/296.b251d4cf.js"><link rel="prefetch" href="/docs/assets/js/297.d56d6d59.js"><link rel="prefetch" href="/docs/assets/js/298.2e259f4b.js"><link rel="prefetch" href="/docs/assets/js/299.7fed62ba.js"><link rel="prefetch" href="/docs/assets/js/3.054cc2ec.js"><link rel="prefetch" href="/docs/assets/js/30.b554c761.js"><link rel="prefetch" href="/docs/assets/js/300.1f947cef.js"><link rel="prefetch" href="/docs/assets/js/301.f708dd5e.js"><link rel="prefetch" href="/docs/assets/js/302.161104b1.js"><link rel="prefetch" href="/docs/assets/js/303.e23692dd.js"><link rel="prefetch" href="/docs/assets/js/304.05659027.js"><link rel="prefetch" href="/docs/assets/js/305.9bf971c9.js"><link rel="prefetch" href="/docs/assets/js/306.ca8deeea.js"><link rel="prefetch" href="/docs/assets/js/307.97a6667e.js"><link rel="prefetch" href="/docs/assets/js/308.693ca743.js"><link rel="prefetch" href="/docs/assets/js/309.fffb02db.js"><link rel="prefetch" href="/docs/assets/js/31.370bb99a.js"><link rel="prefetch" href="/docs/assets/js/310.2bc665a7.js"><link rel="prefetch" href="/docs/assets/js/311.7953e1c2.js"><link rel="prefetch" href="/docs/assets/js/312.fa9bc367.js"><link rel="prefetch" href="/docs/assets/js/313.ac895eeb.js"><link rel="prefetch" href="/docs/assets/js/314.3631b719.js"><link rel="prefetch" href="/docs/assets/js/315.74ff42ab.js"><link rel="prefetch" href="/docs/assets/js/316.3e76797f.js"><link rel="prefetch" href="/docs/assets/js/317.6fb15d7c.js"><link rel="prefetch" href="/docs/assets/js/318.79e44dca.js"><link rel="prefetch" href="/docs/assets/js/319.bc94de5a.js"><link rel="prefetch" href="/docs/assets/js/32.78d1f1eb.js"><link rel="prefetch" href="/docs/assets/js/320.50cf4d33.js"><link rel="prefetch" href="/docs/assets/js/321.92c73aef.js"><link rel="prefetch" href="/docs/assets/js/322.4b083d48.js"><link rel="prefetch" href="/docs/assets/js/323.26c3a0ab.js"><link rel="prefetch" href="/docs/assets/js/324.fcb79d62.js"><link rel="prefetch" href="/docs/assets/js/325.45cede6b.js"><link rel="prefetch" href="/docs/assets/js/326.199b7195.js"><link rel="prefetch" href="/docs/assets/js/327.c396bfb7.js"><link rel="prefetch" href="/docs/assets/js/328.988a3de9.js"><link rel="prefetch" href="/docs/assets/js/329.fe8358a3.js"><link rel="prefetch" href="/docs/assets/js/33.6b9b4e96.js"><link rel="prefetch" href="/docs/assets/js/34.76d3700c.js"><link rel="prefetch" href="/docs/assets/js/35.b61bf772.js"><link rel="prefetch" href="/docs/assets/js/36.7f32760f.js"><link rel="prefetch" href="/docs/assets/js/37.4079c117.js"><link rel="prefetch" href="/docs/assets/js/38.1ac45a99.js"><link rel="prefetch" href="/docs/assets/js/39.0b98297f.js"><link rel="prefetch" href="/docs/assets/js/4.98818668.js"><link rel="prefetch" href="/docs/assets/js/40.bc044ad5.js"><link rel="prefetch" href="/docs/assets/js/41.de0fe499.js"><link rel="prefetch" href="/docs/assets/js/42.e225df72.js"><link rel="prefetch" href="/docs/assets/js/43.5e38f722.js"><link rel="prefetch" href="/docs/assets/js/44.c7251ae2.js"><link rel="prefetch" href="/docs/assets/js/45.47147150.js"><link rel="prefetch" href="/docs/assets/js/46.b91db25b.js"><link rel="prefetch" href="/docs/assets/js/47.40a11e04.js"><link rel="prefetch" href="/docs/assets/js/48.02effbc8.js"><link rel="prefetch" href="/docs/assets/js/49.0daadd89.js"><link rel="prefetch" href="/docs/assets/js/5.c3703f1d.js"><link rel="prefetch" href="/docs/assets/js/50.821b5322.js"><link rel="prefetch" href="/docs/assets/js/51.907927f0.js"><link rel="prefetch" href="/docs/assets/js/52.fbd6f4cb.js"><link rel="prefetch" href="/docs/assets/js/53.f1a0dc32.js"><link rel="prefetch" href="/docs/assets/js/54.8b66e487.js"><link rel="prefetch" href="/docs/assets/js/55.07cf4188.js"><link rel="prefetch" href="/docs/assets/js/56.ba320d44.js"><link rel="prefetch" href="/docs/assets/js/57.13a27667.js"><link rel="prefetch" href="/docs/assets/js/58.ef5d7e10.js"><link rel="prefetch" href="/docs/assets/js/59.dd726a42.js"><link rel="prefetch" href="/docs/assets/js/6.a764175d.js"><link rel="prefetch" href="/docs/assets/js/60.77ab395a.js"><link rel="prefetch" href="/docs/assets/js/61.3634b93f.js"><link rel="prefetch" href="/docs/assets/js/62.4c2d18ec.js"><link rel="prefetch" href="/docs/assets/js/63.57de2c82.js"><link rel="prefetch" href="/docs/assets/js/64.7b6639a9.js"><link rel="prefetch" href="/docs/assets/js/65.563fdeff.js"><link rel="prefetch" href="/docs/assets/js/66.81bd4cf2.js"><link rel="prefetch" href="/docs/assets/js/67.7fa4933d.js"><link rel="prefetch" href="/docs/assets/js/68.beebaf3f.js"><link rel="prefetch" href="/docs/assets/js/69.64313c8f.js"><link rel="prefetch" href="/docs/assets/js/7.2960bb58.js"><link rel="prefetch" href="/docs/assets/js/70.96160c4a.js"><link rel="prefetch" href="/docs/assets/js/71.ddaef725.js"><link rel="prefetch" href="/docs/assets/js/72.96fd17ad.js"><link rel="prefetch" href="/docs/assets/js/73.7ccc2f65.js"><link rel="prefetch" href="/docs/assets/js/74.3198ebf4.js"><link rel="prefetch" href="/docs/assets/js/75.4886a68c.js"><link rel="prefetch" href="/docs/assets/js/76.8d13e16c.js"><link rel="prefetch" href="/docs/assets/js/77.adc7359e.js"><link rel="prefetch" href="/docs/assets/js/78.2e03c285.js"><link rel="prefetch" href="/docs/assets/js/79.7d0ac9a1.js"><link rel="prefetch" href="/docs/assets/js/8.4c0568fd.js"><link rel="prefetch" href="/docs/assets/js/80.0e2710e5.js"><link rel="prefetch" href="/docs/assets/js/81.cdf404cc.js"><link rel="prefetch" href="/docs/assets/js/82.01e97e1f.js"><link rel="prefetch" href="/docs/assets/js/83.90c08f77.js"><link rel="prefetch" href="/docs/assets/js/84.2225a6dc.js"><link rel="prefetch" href="/docs/assets/js/85.49171e3b.js"><link rel="prefetch" href="/docs/assets/js/86.b18603ac.js"><link rel="prefetch" href="/docs/assets/js/87.772b6e3a.js"><link rel="prefetch" href="/docs/assets/js/88.82fdaa52.js"><link rel="prefetch" href="/docs/assets/js/89.bfcd0e62.js"><link rel="prefetch" href="/docs/assets/js/9.c7f05dcb.js"><link rel="prefetch" href="/docs/assets/js/90.ebe887ad.js"><link rel="prefetch" href="/docs/assets/js/91.7006ce28.js"><link rel="prefetch" href="/docs/assets/js/92.e662a7e6.js"><link rel="prefetch" href="/docs/assets/js/93.b97b9d2a.js"><link rel="prefetch" href="/docs/assets/js/94.36f8f62e.js"><link rel="prefetch" href="/docs/assets/js/95.b7192aed.js"><link rel="prefetch" href="/docs/assets/js/96.f0bc5b58.js"><link rel="prefetch" href="/docs/assets/js/97.59dcee0b.js"><link rel="prefetch" href="/docs/assets/js/98.e16eec31.js"><link rel="prefetch" href="/docs/assets/js/99.26ea8045.js">
    <link rel="stylesheet" href="/docs/assets/css/0.styles.5d974432.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/docs/" class="home-link router-link-active"><!----> <span class="site-name">Nguyễn Khánk's Wiki</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/docs/architect/" class="nav-link">
  Architecture
</a></div><div class="nav-item"><a href="/docs/kungfu/letsgo.html" class="nav-link">
  Kungfu
</a></div><div class="nav-item"><a href="https://nguyenngockhank.github.io" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Home
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/docs/architect/" class="nav-link">
  Architecture
</a></div><div class="nav-item"><a href="/docs/kungfu/letsgo.html" class="nav-link">
  Kungfu
</a></div><div class="nav-item"><a href="https://nguyenngockhank.github.io" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Home
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>NoSql Distilled</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>A Philosophy of Software Design</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/docs/kungfu/philosophy/c1.html" class="sidebar-link">1. Introduction</a></li><li><a href="/docs/kungfu/philosophy/c2.html" class="sidebar-link">2. The Nature of Complexity</a></li><li><a href="/docs/kungfu/philosophy/c3.html" class="sidebar-link">3. Working Code Isn’t Enough</a></li><li><a href="/docs/kungfu/philosophy/c4.html" class="sidebar-link">4. Modules Should Be Deep</a></li><li><a href="/docs/kungfu/philosophy/c5.html" class="sidebar-link">5.  Information Hiding (and Leakage)</a></li><li><a href="/docs/kungfu/philosophy/c6.html" class="sidebar-link">6.  General-Purpose Modules are Deeper</a></li><li><a href="/docs/kungfu/philosophy/c7.html" class="sidebar-link">7.  Dierent Layer, Dierent Abstraction</a></li><li><a href="/docs/kungfu/philosophy/c8.html" class="sidebar-link">8.  Pull Complexity Downwards</a></li><li><a href="/docs/kungfu/philosophy/c9.html" aria-current="page" class="active sidebar-link">9.  Better Together Or Better Apart?</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docs/kungfu/philosophy/c9.html#_9-1-bring-together-if-information-is-shared" class="sidebar-link">9.1    Bring together if information is shared</a></li><li class="sidebar-sub-header"><a href="/docs/kungfu/philosophy/c9.html#_9-2-bring-together-if-it-will-simplify-the-interface" class="sidebar-link">9.2    Bring together if it will simplify the interface</a></li><li class="sidebar-sub-header"><a href="/docs/kungfu/philosophy/c9.html#_9-3-bring-together-to-eliminate-duplication" class="sidebar-link">9.3    Bring together to eliminate duplication</a></li><li class="sidebar-sub-header"><a href="/docs/kungfu/philosophy/c9.html#_9-4-separate-general-purpose-and-special-purpose-code" class="sidebar-link">9.4 Separate general-purpose and special-purpose code</a></li><li class="sidebar-sub-header"><a href="/docs/kungfu/philosophy/c9.html#_9-5-example-insertion-cursor-and-selection" class="sidebar-link">9.5    Example: insertion cursor and selection</a></li><li class="sidebar-sub-header"><a href="/docs/kungfu/philosophy/c9.html#_9-6-example-separate-class-for-logging" class="sidebar-link">9.6    Example: separate class for logging</a></li><li class="sidebar-sub-header"><a href="/docs/kungfu/philosophy/c9.html#_9-7-example-editor-undo-mechanism" class="sidebar-link">9.7    Example: editor undo mechanism</a></li><li class="sidebar-sub-header"><a href="/docs/kungfu/philosophy/c9.html#_9-8-splitting-and-joining-methods" class="sidebar-link">9.8    Splitting and joining methods</a></li><li class="sidebar-sub-header"><a href="/docs/kungfu/philosophy/c9.html#_9-9-conclusion" class="sidebar-link">9.9    Conclusion</a></li></ul></li><li><a href="/docs/kungfu/philosophy/c10.html" class="sidebar-link">10.  Dene Errors Out Of Existence</a></li><li><a href="/docs/kungfu/philosophy/c11.html" class="sidebar-link">11.  Design it Twice</a></li><li><a href="/docs/kungfu/philosophy/c12.html" class="sidebar-link">12. Why Write Comments? The Four Excuses</a></li><li><a href="/docs/kungfu/philosophy/c13.html" class="sidebar-link">13. Comments Should Describe Things that aren’t Obvious from the Code</a></li><li><a href="/docs/kungfu/philosophy/c14.html" class="sidebar-link">14. Choosing Names</a></li><li><a href="/docs/kungfu/philosophy/c15.html" class="sidebar-link">15.  Write The Comments First</a></li><li><a href="/docs/kungfu/philosophy/c16.html" class="sidebar-link">16. Modifying Existing Code</a></li><li><a href="/docs/kungfu/philosophy/c17.html" class="sidebar-link">17. Consistency</a></li><li><a href="/docs/kungfu/philosophy/c18.html" class="sidebar-link">18. Code Should be Obvious</a></li><li><a href="/docs/kungfu/philosophy/c19.html" class="sidebar-link">19. Software Trends</a></li><li><a href="/docs/kungfu/philosophy/c20.html" class="sidebar-link">20. Designing for Performance</a></li><li><a href="/docs/kungfu/philosophy/c21.html" class="sidebar-link">21. Conclusion</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>97 Things Every Programmer Should Know</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>The Art of Readable Code</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="_9-better-together-or-better-apart"><a href="#_9-better-together-or-better-apart" class="header-anchor">#</a> 9.  Better Together Or Better Apart?</h1> <p>One of the most fundamental questions in software design is this: given
two pieces of functionality, should they be implemented together in the
same place, or should their implementations be separated? This question
applies at all levels in a system, such as functions, methods, classes, and
services. For example, should buffering be included in the class that
provides stream-oriented file I/O, or should it be in a separate class?
Should the parsing of an HTTP request be implemented entirely in one
method, or should it be divided among multiple methods (or even multiple
classes)? This chapter discusses the factors to consider when making these
decisions. Some of these factors have already been discussed in previous
chapters, but they will be revisited here for completeness.</p> <p>When deciding whether to combine or separate, the goal is to reduce
the complexity of the system as a whole and improve its modularity. It
might appear that the best way to achieve this goal is to divide the system
into a large number of small components: the smaller the components, the
simpler each individual component is likely to be. However, the act of
subdividing creates additional complexity that was not present before
subdivision:
Some complexity comes just from the number of components: the
more components, the harder to keep track of them all and the harder
to find a desired component within the large collection. Subdivision
usually results in more interfaces, and every new interface adds
complexity.
Subdivision can result in additional code to manage the components.
For example, a piece of code that used a single object before
subdivision might now have to manage multiple objects.</p> <p>Subdivision creates separation: the subdivided components will be
farther apart than they were before subdivision. For example,
methods that were together in a single class before subdivision may
be in different classes after subdivision, and possibly in different
files. Separation makes it harder for developers to see the components
at the same time, or even to be aware of their existence. If the
components are truly independent, then separation is good: it allows
the developer to focus on a single component at a time, without being
distracted by the other components. On the other hand, if there are
dependencies between the components, then separation is bad:
developers will end up flipping back and forth between the
components. Even worse, they may not be aware of the dependencies,
which can lead to bugs.
Subdivision can result in duplication: code that was present in a
single instance before subdivision may need to be present in each of
the subdivided components.
Bringing pieces of code together is most beneficial if they are closely
related. If the pieces are unrelated, they are probably better off apart. Here
are a few indications that two pieces of code are related:
They share information; for example, both pieces of code might
depend on the syntax of a particular type of document.
They are used together: anyone using one of the pieces of code is
likely to use the other as well. This form of relationship is only
compelling if it is bidirectional. As a counter-example, a disk block
cache will almost always involve a hash table, but hash tables can be
used in many situations that don’t involve block caches; thus, these
modules should be separate.
They overlap conceptually, in that there is a simple higher-level
category that includes both of the pieces of code. For example,
searching for a substring and case conversion both fall under the
category of string manipulation; flow control and reliable delivery
both fall under the category of network communication.
It is hard to understand one of the pieces of code without looking at
the other.</p> <p>The rest of this chapter uses more specific rules as well as examples to
show when it makes sense to bring pieces of code together and when it
makes sense to separate them.</p> <h2 id="_9-1-bring-together-if-information-is-shared"><a href="#_9-1-bring-together-if-information-is-shared" class="header-anchor">#</a> 9.1    Bring together if information is shared</h2> <p>Section 5.4 introduced this principle in the context of a project
implementing an HTTP server. In its first implementation, the project
used two different methods in different classes to read in and parse HTTP
requests. The first method read the text of an incoming request from a
network socket and placed it in a string object. The second method parsed
the string to extract the various components of the request. With this
decomposition, both of the methods ended up with considerable
knowledge of the format of HTTP requests: the first method was only
trying to read the request, not parse it, but it couldn’t identify the end of
the request without doing most of the work of parsing it (for example, it
had to parse header lines in order to identify the header containing the
overall request length). Because of this shared information, it is better to
both read and parse the request in the same place; when the two classes
were combined into one, the code got shorter and simpler.</p> <h2 id="_9-2-bring-together-if-it-will-simplify-the-interface"><a href="#_9-2-bring-together-if-it-will-simplify-the-interface" class="header-anchor">#</a> 9.2    Bring together if it will simplify the interface</h2> <p>When two or more modules are combined into a single module, it may be
possible to define an interface for the new module that is simpler or easier
to use than the original interfaces. This often happens when the original
modules each implement part of the solution to a problem. In the HTTP
server example from the preceding section, the original methods required
an interface to return the HTTP request string from the first method and
pass it to the second. When the methods were combined, these interfaces
were eliminated.</p> <p>In addition, when the functionality of two or more classes is combined,
it may be possible to perform some functions automatically, so that most
users need not be aware of them. The Java I/O library illustrates this
opportunity. If the FileInputStream and BufferedInputStream classes were
combined and buffering were provided by default, the vast majority of</p> <p>users would never even need to be aware of the existence of buffering. A
combined FileInputStream class might provide methods to disable or</p> <p>replace the default buffering mechanism, but most users would not need to
learn about them.</p> <h2 id="_9-3-bring-together-to-eliminate-duplication"><a href="#_9-3-bring-together-to-eliminate-duplication" class="header-anchor">#</a> 9.3    Bring together to eliminate duplication</h2> <p>If you find the same pattern of code repeated over and over, see if you can
reorganize the code to eliminate the repetition. One approach is to factor
the repeated code out into a separate method and replace the repeated code
snippets with calls to the method. This approach is most effective if the
repeated code snippet is long and the replacement method has a simple
signature. If the snippet is only one or two lines long, there may not be
much benefit in replacing it with a method call. If the snippet interacts in
complex ways with its environment (such as by accessing numerous local
variables), then the replacement method might require a complex
signature (such as many pass-by-reference arguments), which would
reduce its value.</p> <p>Another way to eliminate duplication is to refactor the code so that the
snippet in question only needs to be executed in one place. Suppose you
are writing a method that needs to return errors at several different points,
and the same cleanup actions need to be performed at each of these points
before returning (see Figure 9.1 for an example). If the programming
language supports goto, you can move the cleanup code to the very end of
the method and then goto that snippet at each of the points where an error</p> <p>return is required, as in Figure 9.2. Goto statements are generally
considered a bad idea, and they can result in indecipherable code if used
indiscriminately, but they are useful in situations like this where they are
used to escape from nested code.</p> <h2 id="_9-4-separate-general-purpose-and-special-purpose-code"><a href="#_9-4-separate-general-purpose-and-special-purpose-code" class="header-anchor">#</a> 9.4 Separate general-purpose and special-purpose code</h2> <p>If a module contains a mechanism that can be used for several different purposes, then it should provide just that one general-purpose mechanism.
It should not include code that specializes the mechanism for a particular use, nor should it contain other general-purpose mechanisms. Special-purpose code associated with a general-purpose mechanism should
normally go in a different module (typically one associated with the particular purpose). The GUI editor discussion in Chapter 6 illustrated this principle: the best design was one where the text class provided general-
purpose text operations, while operations particular to the user interface (such as deleting the selection) were implemented in the user interface module. This approach eliminated information leakage and additional interfaces that were present in an earlier design where the specialized user interface operations were implemented in the text class.</p> <div class="custom-block danger"><p class="custom-block-title">Repetition</p> <p>If the same piece of code (or code that is almost the same) appears over and over again, that’s a red flag that you haven’t found the right abstractions.</p></div> <p><img src="/docs/assets/img/image--020.b0b0a3c5.png" alt="Image"></p> <p><strong>Figure 9.1</strong>: <em>This code processes incoming network packets of different types; for each type, if the packet is too short for that type, a message gets logged. In this version of the code, the LOG statement is duplicated for several different packet types.</em></p> <p><img src="/docs/assets/img/image--021.a0bc49c0.png" alt="Image"></p> <p><strong>Figure 9.2</strong>: <em>A reorganization of the code from Figure 9.1 so that there is only one copy of the LOG statement.</em></p> <p>In general, the lower layers of a system tend to be more general-
purpose and the upper layers more special-purpose. For example, the
topmost layer of an application consists of features totally specific to that
application. The way to separate special-purpose code from general-
purpose code is to pull the special-purpose code upwards, into the higher
layers, leaving the lower layers general-purpose. When you encounter a
class that includes both general-purpose and special-purpose features for
the same abstraction, see if the class can be separated into two classes, one
containing the general-purpose features, and the other layered on top of it
to provide the special-purpose features.</p> <h2 id="_9-5-example-insertion-cursor-and-selection"><a href="#_9-5-example-insertion-cursor-and-selection" class="header-anchor">#</a> 9.5    Example: insertion cursor and selection</h2> <p>The next sections work through three examples that illustrate the
principles discussed above. In two of the examples the best approach is to
separate the relevant pieces of code; in the third example it is better to join
them together.</p> <p>The first example consists of the insertion cursor and the selection in
the GUI editor project from Chapter 6. The editor displayed a blinking
vertical line indicating where text typed by the user would appear in the
document. It also displayed a highlighted range of characters called the
selection, which was used for copying or deleting text. The insertion
cursor was always visible, but there could be times when no text was
selected. If the selection existed, the insertion cursor was always
positioned at one end of it.</p> <p>The selection and insertion cursor are related in some ways. For
example, the cursor is always positioned at one end of the selection, and
the cursor and selection tend to be manipulated together: clicking and
dragging the mouse sets both of them, and text insertion first deletes the
selected text, if there is any, and then inserts new text at the cursor
position. Thus, it might seem logical to use a single object to manage both
the selection and the cursor, and one project team took this approach. The object stored two positions in the file, along with booleans indicating which end was the cursor and whether the selection existed.</p> <p>However, the combined object was awkward. It provided no benefit for higher-level code, since the higher-level code still needed to be aware of the selection and cursor as distinct entities, and it manipulated them
separately (during text insertion, it first invoked a method on the combined object to delete the selected text; then it invoked another method to retrieve the cursor position in order to insert new text). The
combined object was actually more complex to implement than separate objects. It avoided storing the cursor position as a separate entity, but instead had to store a boolean indicating which end of the selection was
the cursor. In order to retrieve the cursor position, the combined object had to first test the boolean and then choose the appropriate end of the selection.</p> <div class="custom-block danger"><p class="custom-block-title">Special-General Mixture</p> <p>This red flag occurs when a general-purpose mechanism also contains code specialized for a particular use of that mechanism. This makes the mechanism more complicated and creates information leakage between the mechanism and the particular use case: future modifications to the use case are likely to require changes to the underlying mechanism as well.</p></div> <p>In this case, the selection and cursor were not closely enough related to
combine them. When the code was revised to separate the selection and
the cursor, both the usage and the implementation became simpler.
Separate objects provided a simpler interface than a combined object from
which selection and cursor information had to be extracted. The cursor
implementation also got simpler because the cursor position was
represented directly, rather than indirectly through a selection and a
boolean. In fact, in the revised version no special classes were used for
either the selection or the cursor. Instead, a new Position class was introduced to represent a location in the file (a line number and character within line). The selection was represented with two Positions and the cursor with one. Positions also found other uses in the project. This example also demonstrates the benefits of a lower-level but more general-purpose interface, which were discussed in Chapter 6.</p> <h2 id="_9-6-example-separate-class-for-logging"><a href="#_9-6-example-separate-class-for-logging" class="header-anchor">#</a> 9.6    Example: separate class for logging</h2> <p>The second example involved error logging in a student project. A class
contained several code sequences like the following:</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">try</span> <span class="token punctuation">{</span>
    rpcConn <span class="token operator">=</span> connectionPool<span class="token punctuation">.</span><span class="token function">getConnection</span><span class="token punctuation">(</span>dest<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">NetworkErrorLogger</span><span class="token punctuation">.</span><span class="token function">logRpcOpenError</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span> dest<span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Rather than logging the error at the point where it was detected, a separate
method in a special error logging class was invoked. The error logging
class was defined at the end of the same source file:</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">NetworkErrorLogger</span> <span class="token punctuation">{</span>
    <span class="token comment">/**
    *  Output information relevant to an error that occurs when trying
    *  to open a connection to send an RPC.
    *
    *  @param req
    *       The RPC request that would have been sent through the connection
    *  @param dest
    *       The destination of the RPC
    *  @param e
    *       The caught error
    */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">logRpcOpenError</span><span class="token punctuation">(</span>RpcRequest req<span class="token punctuation">,</span> AddrPortTuple dest<span class="token punctuation">,</span> Exception e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        logger<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>Level<span class="token punctuation">.</span>WARNING<span class="token punctuation">,</span> <span class="token string">&quot;Cannot send message: &quot;</span> <span class="token operator">+</span> req <span class="token operator">+</span> &quot;<span class="token punctuation">.</span>
        \n<span class="token string">&quot; + &quot;</span>Unable to find <span class="token operator">or</span> open connection to &quot; <span class="token operator">+</span> dest <span class="token operator">+</span>
        <span class="token string">&quot; :&quot;</span> <span class="token operator">+</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre></div><p>The <code>NetworkErrorLogger</code> class contained several methods such as <code>logRpcSendError</code> and <code>logRpcReceiveError</code>, each of which logged a different kind of error.</p> <p>This separation added complexity with no benefit. The logging
methods were shallow: most consisted of a single line of code, but they
required a considerable amount of documentation. Each method was only
invoked in a single place. The logging methods were highly dependent on
their invocations: someone reading the invocation would most likely flip
over to the logging method to make sure that the right information was
being logged; similarly, someone reading the logging method would
probably flip over to the invocation site to understand the purpose of the
method.</p> <p>In this example, it would be better to eliminate the logging methods
and place the logging statements at the locations where the errors were
detected. This would make the code easier to read and eliminate the
interfaces required for the logging methods.</p> <h2 id="_9-7-example-editor-undo-mechanism"><a href="#_9-7-example-editor-undo-mechanism" class="header-anchor">#</a> 9.7    Example: editor undo mechanism</h2> <p>In the GUI editor project from Section 6.2, one of the requirements was to
support multi-level undo/redo, not just for changes to the text itself, but
also for changes in the selection, insertion cursor, and view. For example,
if a user selected some text, deleted it, scrolled to a different place in the
file, and then invoked undo, the editor had to restore its state to what it
was just before the deletion. This included restoring the deleted text,
selecting it again, and also making the selected text visible in the window.</p> <p>Some of the student projects implemented the entire undo mechanism
as part of the text class. The text class maintained a list of all the undoable
changes. It automatically added entries to this list whenever the text was</p> <p>changed. For changes to the selection, insertion cursor, and view, the user
interface code invoked additional methods in the text class, which then
added entries for those changes to the undo list. When undo or redo was
requested by the user, the user interface code invoked a method in the text
class, which then processed the entries in the undo list. For entries related
to text, it updated the internals of the text class; for entries related to other
things, such as the selection, the text class called back to the user interface
code to carry out the undo or redo.</p> <p>This approach resulted in an awkward set of features in the text class.
The core of undo/redo consists of a general-purpose mechanism for
managing a list of actions that have been executed and stepping through
them during undo and redo operations. The core was located in the text
class along with special-purpose handlers that implemented undo and redo
for specific things such as text and the selection. The special-purpose undo
handlers for the selection and the cursor had nothing to do with anything
else in the text class; they resulted in information leakage between the text
class and the user interface, as well as extra methods in each module to
pass undo information back and forth. If a new sort of undoable entity
were added to the system in the future, it would require changes to the text
class, including new methods specific to that entity. In addition, the
general-purpose undo core had little to do with the general-purpose text
facilities in the class.</p> <p>These problems can be solved by extracting the general-purpose core
of the undo/redo mechanism and placing it in a separate class:</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">History</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Action</span> <span class="token punctuation">{</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">redo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">undo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token class-name">History</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">}</span>

    <span class="token keyword">void</span> <span class="token function">addAction</span><span class="token punctuation">(</span><span class="token class-name">Action</span> action<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">}</span>
    <span class="token keyword">void</span> <span class="token function">addFence</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">}</span>

    <span class="token keyword">void</span> <span class="token function">undo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">}</span>
    <span class="token keyword">void</span> <span class="token function">redo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>In this design, the History class manages a collection of objects that</p> <p>implement the interface History.Action. Each History.Action describes a
single operation, such as a text insertion or a change in the cursor location,
and it provides methods that can undo or redo the operation. The History</p> <p>class knows nothing about the information stored in the actions or how
they implement their undo and redo methods. History maintains a history
list describing all of the actions executed over the lifetime of an
application, and it provides undo and redo methods that walk backwards</p> <p>and forwards through the list in response to user-requested undos and
redos, calling undo and redo methods in the <code>History.Actions</code>.</p> <p><code>History.Actions</code> are special-purpose objects: each one understands a
particular kind of undoable operation. They are implemented outside the
History class, in modules that understand particular kinds of undoable
actions. The text class might implement <code>UndoableInsert</code> and</p> <p>UndoableDelete objects to describe text insertions and deletions. Whenever
it inserts text, the text class creates a new <code>UndoableInsert</code> object describing the insertion and invokes History.addAction to add it to the history list. The editor’s user interface code might create <code>UndoableSelection</code> and <code>UndoableCursor</code> objects that describe changes to the selection and insertion cursor.</p> <p>The History class also allows actions to be grouped so that, for example, a single undo request from the user can restore deleted text, reselect the deleted text, and reposition the insertion cursor. There are a number of ways to group actions; the History class uses fences, which are markers placed in the history list to separate groups of related actions.</p> <p>Each call to <code>History.redo</code> walks backwards through the history list, undoing actions until it reaches the next fence. The placement of fences is determined by higher-level code by invoking History.addFence.</p> <p>This approach divides the functionality of undo into three categories, each of which is implemented in a different place:</p> <p>A general-purpose mechanism for managing and grouping actions
and invoking undo/redo operations (implemented by the History
class).</p> <p>The specifics of particular actions (implemented by a variety of
classes, each of which understands a small number of action types).
The policy for grouping actions (implemented by high-level user
interface code to provide the right overall application behavior).</p> <p>Each of these categories can be implemented without any understanding of
the other categories. The History class does not know what kind of actions</p> <p>are being undone; it could be used in a variety of applications. Each action
class understands only a single kind of action, and neither the History
class nor the action classes needs to be aware of the policy for grouping
actions.</p> <p>The key design decision was the one that separated the general-purpose
part of the undo mechanism from the special-purpose parts and put the
general-purpose part in a class by itself. Once that was done, the rest of the
design fell out naturally.</p> <p>Note: the suggestion to separate general-purpose code from special-
purpose code refers to code related to a particular mechanism. For
example, special-purpose undo code (such as code to undo a text insertion)
should be separated from general-purpose undo code (such as code to
manage the history list). However, it often makes sense to combine
special-purpose code for one mechanism with general-purpose code for
another. The text class is an example of this: it implements a general-
purpose mechanism for managing text, but it includes special-purpose
code related to undoing. The undo code is special-purpose because it only
handles undo operations for text modifications. It doesn’t make sense to
combine this code with the general-purpose undo infrastructure in the
History class, but it does make sense to put it in the text class, since it is closely related to other text functions.</p> <h2 id="_9-8-splitting-and-joining-methods"><a href="#_9-8-splitting-and-joining-methods" class="header-anchor">#</a> 9.8    Splitting and joining methods</h2> <p>The issue of when to subdivide applies not just to classes, but also to
methods: are there times when it is better to divide an existing method</p> <p>into multiple smaller methods? Or, should two smaller methods be
combined into one larger one? Long methods tend to be more difficult to
understand than shorter ones, so many people argue that length alone is a
good justification for breaking up a method. Students in classes are often
given rigid criteria, such as “Split up any method longer than 20 lines!”</p> <p>However, length by itself is rarely a good reason for splitting up a
method. In general, developers tend to break up methods too much.
Splitting up a method introduces additional interfaces, which add to
complexity. It also separates the pieces of the original method, which
makes the code harder to read if the pieces are actually related. You
shouldn’t break up a method unless it makes the overall system simpler;
I’ll discuss how this might happen below.</p> <p>Long methods aren’t always bad. For example, suppose a method
contains five 20-line blocks of code that are executed in order. If the
blocks are relatively independent, then the method can be read and
understood one block at a time; there’s not much benefit in moving each
of the blocks into a separate method. If the blocks have complex
interactions, it’s even more important to keep them together so readers can
see all of the code at once; if each block is in a separate method, readers
will have to flip back and forth between these spread-out methods in order
to understand how they work together. Methods containing hundreds of
lines of code are fine if they have a simple signature and are easy to read.
These methods are deep (lots of functionality, simple interface), which is
good.</p> <p><img src="/docs/assets/img/image--024.48936cd0.jpg" alt="Image"></p> <p><strong>Figure 9.3</strong>: <em>A method (a) can be split either by by extracting a subtask (b) or by dividing its functionality into two separate methods (c). A method should not be split if it results in shallow methods, as in (d).</em></p> <p>When designing methods, the most important goal is to provide clean
and simple abstractions. Each method should do one thing and do it
completely. The method should have a clean and simple interface, so that
users don’t need to have much information in their heads in order to use it
correctly. The method should be deep: its interface should be much
simpler than its implementation. If a method has all of these properties,
then it probably doesn’t matter whether it is long or not.</p> <p>Splitting up a method only makes sense if it results in cleaner
abstractions, overall. There are two ways to do this, which are diagrammed
in Figure 9.3. The best way is by factoring out a subtask into a separate
method, as shown in Figure 9.3(b). The subdivision results in a child
method containing the subtask and a parent method containing the
remainder of the original method; the parent invokes the child. The
interface of the new parent method is the same as the original method.
This form of subdivision makes sense if there is a subtask that is cleanly
separable from the rest of the original method, which means (a) someone
reading the child method doesn’t need to know anything about the parent
method and (b) someone reading the parent method doesn’t need to
understand the implementation of the child method. Typically this means
that the child method is relatively general-purpose: it could conceivably
be used by other methods besides the parent. If you make a split of this
form and then find yourself flipping back and forth between the parent and
child to understand how they work together, that is a red flag (“Conjoined
Methods”) indicating that the split was probably a bad idea.</p> <p>The second way to break up a method is to split it into two separate
methods, each visible to callers of the original method, as in Figure 9.3(c).
This makes sense if the original method had an overly complex interface
because it tried to do multiple things that were not closely related. If this
is the case, it may be possible to divide the method’s functionality into
two or more smaller methods, each of which has only a part of the original
method’s functionality. If you make a split like this, the interface for each
of the resulting methods should be simpler than the interface of the
original method. Ideally, most callers should only need to invoke one of
the two new methods; if callers must invoke both of the new methods, then
that adds complexity, which makes it less likely that the split is a good idea. The new methods will be more focused in what they do. It is a good sign if the new methods are more general-purpose than the original
method (i.e., you can imagine using them separately in other situations).</p> <p>Splits of the form shown in Figure 9.3(c) don’t make sense very often, because they result in callers having to deal with multiple methods instead of one. When you split this way, you run the risk of ending up with several
shallow methods, as in Figure 9.3(d). If the caller has to invoke each of the separate methods, passing state back and forth between them, then splitting is not a good idea. If you’re considering a split like the one in
Figure 9.3(c), you should judge it based on whether it simplifies things for callers.</p> <p>There are also situations where a system can be made simpler by
joining methods together. For example, joining methods might replace two
shallow methods with one deeper method; it might eliminate duplication
of code; it might eliminate dependencies between the original methods, or
intermediate data structures; it might result in better encapsulation, so that
knowledge that was previously present in multiple places is now isolated
in a single place; or it might result in a simpler interface, as discussed in
Section 9.2.</p> <div class="custom-block danger"><p class="custom-block-title">Conjoined Methods</p> <p>It should be possible to understand each method independently. If you
can’t understand the implementation of one method without also
understanding the implementation of another, that’s a red flag. This red
flag can occur in other contexts as well: if two pieces of code are
physically separated, but each can only be understood by looking at the
other, that is a red flag.</p></div> <h2 id="_9-9-conclusion"><a href="#_9-9-conclusion" class="header-anchor">#</a> 9.9    Conclusion</h2> <p>The decision to split or join modules should be based on complexity. Pick
the structure that results in the best information hiding, the fewest
dependencies, and the deepest interfaces.</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/docs/kungfu/philosophy/c8.html" class="prev">
        8.  Pull Complexity Downwards
      </a></span> <span class="next"><a href="/docs/kungfu/philosophy/c10.html">
        10.  Dene Errors Out Of Existence
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----><!----><!----></div></div>
    <script src="/docs/assets/js/app.feff3dbb.js" defer></script><script src="/docs/assets/js/2.aca46d71.js" defer></script><script src="/docs/assets/js/23.dc13f196.js" defer></script><script src="/docs/assets/js/27.5ed2ce18.js" defer></script>
  </body>
</html>
