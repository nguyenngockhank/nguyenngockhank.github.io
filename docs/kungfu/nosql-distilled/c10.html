<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Chapter 10. Column-Family Stores | Nguyễn Khánk&#39;s Wiki</title>
    <meta name="generator" content="VuePress 1.7.1">
    <link rel="apple-touch-icon" sizes="180x180" href="../public/favicons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="../public/favicons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="../public/favicons/favicon-16x16.png">
    <link rel="manifest" href="../public/favicons/manifest.json">
    <link rel="mask-icon" href="../public/favicons/safari-pinned-tab.svg" color="#3a0839">
    <link rel="shortcut icon" href="../public/favicons/favicon.ico">
    <meta name="description" content="Wikipedia của tui">
    <meta name="msapplication-TileColor" content="#3a0839">
    <meta name="msapplication-config" content="../public/favicons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    
    <link rel="preload" href="/docs/assets/css/0.styles.5d974432.css" as="style"><link rel="preload" href="/docs/assets/js/app.b4ead7d5.js" as="script"><link rel="preload" href="/docs/assets/js/2.918c4e99.js" as="script"><link rel="preload" href="/docs/assets/js/20.e52878dd.js" as="script"><link rel="preload" href="/docs/assets/js/29.c1c2752a.js" as="script"><link rel="prefetch" href="/docs/assets/js/10.4283d323.js"><link rel="prefetch" href="/docs/assets/js/100.42c2b1a6.js"><link rel="prefetch" href="/docs/assets/js/101.00c41e2c.js"><link rel="prefetch" href="/docs/assets/js/102.49792ffc.js"><link rel="prefetch" href="/docs/assets/js/103.99b2c6d4.js"><link rel="prefetch" href="/docs/assets/js/104.301230b7.js"><link rel="prefetch" href="/docs/assets/js/105.173e6f92.js"><link rel="prefetch" href="/docs/assets/js/106.ec9ce09e.js"><link rel="prefetch" href="/docs/assets/js/107.229552d6.js"><link rel="prefetch" href="/docs/assets/js/108.7b2a7659.js"><link rel="prefetch" href="/docs/assets/js/109.727bfe47.js"><link rel="prefetch" href="/docs/assets/js/11.4a6e3b38.js"><link rel="prefetch" href="/docs/assets/js/110.33c9178c.js"><link rel="prefetch" href="/docs/assets/js/111.569d2d1a.js"><link rel="prefetch" href="/docs/assets/js/112.2ea7304b.js"><link rel="prefetch" href="/docs/assets/js/113.ec10e0db.js"><link rel="prefetch" href="/docs/assets/js/114.1f22aac0.js"><link rel="prefetch" href="/docs/assets/js/115.f388e068.js"><link rel="prefetch" href="/docs/assets/js/116.abf42656.js"><link rel="prefetch" href="/docs/assets/js/117.031bdf88.js"><link rel="prefetch" href="/docs/assets/js/118.e5c64f79.js"><link rel="prefetch" href="/docs/assets/js/119.53c1e885.js"><link rel="prefetch" href="/docs/assets/js/12.02069f09.js"><link rel="prefetch" href="/docs/assets/js/120.de8760d6.js"><link rel="prefetch" href="/docs/assets/js/121.61b3da65.js"><link rel="prefetch" href="/docs/assets/js/122.e277e3a4.js"><link rel="prefetch" href="/docs/assets/js/123.8b0fed5d.js"><link rel="prefetch" href="/docs/assets/js/124.bd850364.js"><link rel="prefetch" href="/docs/assets/js/125.43bd7947.js"><link rel="prefetch" href="/docs/assets/js/126.cb145b01.js"><link rel="prefetch" href="/docs/assets/js/127.6acd6b6a.js"><link rel="prefetch" href="/docs/assets/js/128.5296a6b1.js"><link rel="prefetch" href="/docs/assets/js/129.d4389ff5.js"><link rel="prefetch" href="/docs/assets/js/13.cb8aa3b4.js"><link rel="prefetch" href="/docs/assets/js/130.7e868873.js"><link rel="prefetch" href="/docs/assets/js/131.ac70496d.js"><link rel="prefetch" href="/docs/assets/js/132.d7ef51b5.js"><link rel="prefetch" href="/docs/assets/js/133.85889cbf.js"><link rel="prefetch" href="/docs/assets/js/134.20ff45e8.js"><link rel="prefetch" href="/docs/assets/js/135.860987ac.js"><link rel="prefetch" href="/docs/assets/js/136.7db1226a.js"><link rel="prefetch" href="/docs/assets/js/137.d8136c20.js"><link rel="prefetch" href="/docs/assets/js/138.3ef4df6c.js"><link rel="prefetch" href="/docs/assets/js/139.019ecec9.js"><link rel="prefetch" href="/docs/assets/js/14.80bd7d37.js"><link rel="prefetch" href="/docs/assets/js/140.dc95ea98.js"><link rel="prefetch" href="/docs/assets/js/141.7f7699ee.js"><link rel="prefetch" href="/docs/assets/js/142.2c400013.js"><link rel="prefetch" href="/docs/assets/js/143.72b5ebc2.js"><link rel="prefetch" href="/docs/assets/js/144.b12d6479.js"><link rel="prefetch" href="/docs/assets/js/145.6f206d38.js"><link rel="prefetch" href="/docs/assets/js/146.dfe0bebd.js"><link rel="prefetch" href="/docs/assets/js/147.dec9bd8b.js"><link rel="prefetch" href="/docs/assets/js/148.43d1eec3.js"><link rel="prefetch" href="/docs/assets/js/149.4c4c5113.js"><link rel="prefetch" href="/docs/assets/js/15.2ded5d71.js"><link rel="prefetch" href="/docs/assets/js/150.cdeb529d.js"><link rel="prefetch" href="/docs/assets/js/151.3f7380c1.js"><link rel="prefetch" href="/docs/assets/js/152.f497f0ee.js"><link rel="prefetch" href="/docs/assets/js/153.5a12e617.js"><link rel="prefetch" href="/docs/assets/js/154.d00316eb.js"><link rel="prefetch" href="/docs/assets/js/155.2908e29c.js"><link rel="prefetch" href="/docs/assets/js/156.a1a2a096.js"><link rel="prefetch" href="/docs/assets/js/157.4781f488.js"><link rel="prefetch" href="/docs/assets/js/158.fd0de87b.js"><link rel="prefetch" href="/docs/assets/js/159.ed53ea7e.js"><link rel="prefetch" href="/docs/assets/js/16.d611f2a0.js"><link rel="prefetch" href="/docs/assets/js/160.c9a19179.js"><link rel="prefetch" href="/docs/assets/js/161.fe664a32.js"><link rel="prefetch" href="/docs/assets/js/162.8c4f75b5.js"><link rel="prefetch" href="/docs/assets/js/163.7227e6d3.js"><link rel="prefetch" href="/docs/assets/js/164.3d3433de.js"><link rel="prefetch" href="/docs/assets/js/165.f0fc832c.js"><link rel="prefetch" href="/docs/assets/js/166.0c7bbd11.js"><link rel="prefetch" href="/docs/assets/js/167.1c1c85bc.js"><link rel="prefetch" href="/docs/assets/js/168.5b4e634a.js"><link rel="prefetch" href="/docs/assets/js/169.54d5e41e.js"><link rel="prefetch" href="/docs/assets/js/17.f1b68785.js"><link rel="prefetch" href="/docs/assets/js/170.a3357d67.js"><link rel="prefetch" href="/docs/assets/js/171.8d63dbcd.js"><link rel="prefetch" href="/docs/assets/js/172.63f98852.js"><link rel="prefetch" href="/docs/assets/js/173.b333350e.js"><link rel="prefetch" href="/docs/assets/js/174.dc40e10a.js"><link rel="prefetch" href="/docs/assets/js/175.59cd9d9e.js"><link rel="prefetch" href="/docs/assets/js/176.cc482ddf.js"><link rel="prefetch" href="/docs/assets/js/177.971ae04b.js"><link rel="prefetch" href="/docs/assets/js/178.b68cbc37.js"><link rel="prefetch" href="/docs/assets/js/179.1fac2c61.js"><link rel="prefetch" href="/docs/assets/js/18.70e59dd2.js"><link rel="prefetch" href="/docs/assets/js/180.c5268110.js"><link rel="prefetch" href="/docs/assets/js/181.6e123d8e.js"><link rel="prefetch" href="/docs/assets/js/182.7822bbc1.js"><link rel="prefetch" href="/docs/assets/js/183.f424f358.js"><link rel="prefetch" href="/docs/assets/js/184.f8497f64.js"><link rel="prefetch" href="/docs/assets/js/185.3f8fe2bf.js"><link rel="prefetch" href="/docs/assets/js/186.fccb649c.js"><link rel="prefetch" href="/docs/assets/js/187.7d8e0e79.js"><link rel="prefetch" href="/docs/assets/js/188.8540c578.js"><link rel="prefetch" href="/docs/assets/js/189.3d167b41.js"><link rel="prefetch" href="/docs/assets/js/19.01735f4f.js"><link rel="prefetch" href="/docs/assets/js/190.4049e000.js"><link rel="prefetch" href="/docs/assets/js/191.6598fdcb.js"><link rel="prefetch" href="/docs/assets/js/192.bc915af2.js"><link rel="prefetch" href="/docs/assets/js/193.ed136290.js"><link rel="prefetch" href="/docs/assets/js/194.9f955b46.js"><link rel="prefetch" href="/docs/assets/js/195.9e2835c5.js"><link rel="prefetch" href="/docs/assets/js/196.9dd10962.js"><link rel="prefetch" href="/docs/assets/js/197.e3181f62.js"><link rel="prefetch" href="/docs/assets/js/198.a5b651aa.js"><link rel="prefetch" href="/docs/assets/js/199.11676413.js"><link rel="prefetch" href="/docs/assets/js/200.42b2ab26.js"><link rel="prefetch" href="/docs/assets/js/201.066c5526.js"><link rel="prefetch" href="/docs/assets/js/202.b0097152.js"><link rel="prefetch" href="/docs/assets/js/203.a4a28a7e.js"><link rel="prefetch" href="/docs/assets/js/204.dee831a7.js"><link rel="prefetch" href="/docs/assets/js/205.c6897ae6.js"><link rel="prefetch" href="/docs/assets/js/206.f9a3568f.js"><link rel="prefetch" href="/docs/assets/js/207.f94e47ab.js"><link rel="prefetch" href="/docs/assets/js/208.5e4f846d.js"><link rel="prefetch" href="/docs/assets/js/209.7a6f22d2.js"><link rel="prefetch" href="/docs/assets/js/21.cd7f7169.js"><link rel="prefetch" href="/docs/assets/js/210.bb5abd1b.js"><link rel="prefetch" href="/docs/assets/js/211.6099de41.js"><link rel="prefetch" href="/docs/assets/js/212.38958804.js"><link rel="prefetch" href="/docs/assets/js/213.f0d155be.js"><link rel="prefetch" href="/docs/assets/js/214.7a635d00.js"><link rel="prefetch" href="/docs/assets/js/215.15cf68fd.js"><link rel="prefetch" href="/docs/assets/js/216.e080f1b6.js"><link rel="prefetch" href="/docs/assets/js/217.beac65cb.js"><link rel="prefetch" href="/docs/assets/js/218.9eace1d5.js"><link rel="prefetch" href="/docs/assets/js/219.72360021.js"><link rel="prefetch" href="/docs/assets/js/22.9d9d752c.js"><link rel="prefetch" href="/docs/assets/js/220.d8b70fae.js"><link rel="prefetch" href="/docs/assets/js/221.ee7b6805.js"><link rel="prefetch" href="/docs/assets/js/222.1591a420.js"><link rel="prefetch" href="/docs/assets/js/223.cf41d88b.js"><link rel="prefetch" href="/docs/assets/js/224.c235cbc3.js"><link rel="prefetch" href="/docs/assets/js/225.d6b66ffe.js"><link rel="prefetch" href="/docs/assets/js/226.9e5d17b4.js"><link rel="prefetch" href="/docs/assets/js/227.704fbd06.js"><link rel="prefetch" href="/docs/assets/js/228.95d7f7f6.js"><link rel="prefetch" href="/docs/assets/js/229.eb0eaf23.js"><link rel="prefetch" href="/docs/assets/js/23.c73f51b1.js"><link rel="prefetch" href="/docs/assets/js/230.c865269c.js"><link rel="prefetch" href="/docs/assets/js/231.9b6bf106.js"><link rel="prefetch" href="/docs/assets/js/232.fb319cdd.js"><link rel="prefetch" href="/docs/assets/js/233.07926c24.js"><link rel="prefetch" href="/docs/assets/js/234.4693fdd8.js"><link rel="prefetch" href="/docs/assets/js/235.8521cf01.js"><link rel="prefetch" href="/docs/assets/js/236.713aedcd.js"><link rel="prefetch" href="/docs/assets/js/237.06cf552a.js"><link rel="prefetch" href="/docs/assets/js/238.a7a6b283.js"><link rel="prefetch" href="/docs/assets/js/239.0f101dba.js"><link rel="prefetch" href="/docs/assets/js/24.8deda813.js"><link rel="prefetch" href="/docs/assets/js/240.011ce3ab.js"><link rel="prefetch" href="/docs/assets/js/241.ce73a729.js"><link rel="prefetch" href="/docs/assets/js/242.629cd7a8.js"><link rel="prefetch" href="/docs/assets/js/243.0ddc04d2.js"><link rel="prefetch" href="/docs/assets/js/244.4dd5edd5.js"><link rel="prefetch" href="/docs/assets/js/245.326a938f.js"><link rel="prefetch" href="/docs/assets/js/246.8386535e.js"><link rel="prefetch" href="/docs/assets/js/247.e73acf4b.js"><link rel="prefetch" href="/docs/assets/js/248.fc7e52d2.js"><link rel="prefetch" href="/docs/assets/js/249.dafdef37.js"><link rel="prefetch" href="/docs/assets/js/25.6640913c.js"><link rel="prefetch" href="/docs/assets/js/250.648ceaef.js"><link rel="prefetch" href="/docs/assets/js/251.6650d82b.js"><link rel="prefetch" href="/docs/assets/js/252.8670482a.js"><link rel="prefetch" href="/docs/assets/js/253.2086a1d9.js"><link rel="prefetch" href="/docs/assets/js/254.df0f4172.js"><link rel="prefetch" href="/docs/assets/js/255.91c17e17.js"><link rel="prefetch" href="/docs/assets/js/256.18638a00.js"><link rel="prefetch" href="/docs/assets/js/257.50ee16d8.js"><link rel="prefetch" href="/docs/assets/js/258.3be6b7a1.js"><link rel="prefetch" href="/docs/assets/js/259.1b23f345.js"><link rel="prefetch" href="/docs/assets/js/26.45f2052e.js"><link rel="prefetch" href="/docs/assets/js/260.cf01ad49.js"><link rel="prefetch" href="/docs/assets/js/261.726ba6ed.js"><link rel="prefetch" href="/docs/assets/js/262.bc71b488.js"><link rel="prefetch" href="/docs/assets/js/263.8e23382d.js"><link rel="prefetch" href="/docs/assets/js/264.22e2572a.js"><link rel="prefetch" href="/docs/assets/js/265.98ab4565.js"><link rel="prefetch" href="/docs/assets/js/266.19ea8edd.js"><link rel="prefetch" href="/docs/assets/js/267.e9f07441.js"><link rel="prefetch" href="/docs/assets/js/268.985021b2.js"><link rel="prefetch" href="/docs/assets/js/269.70efcdf3.js"><link rel="prefetch" href="/docs/assets/js/27.be6b9008.js"><link rel="prefetch" href="/docs/assets/js/270.88472ffb.js"><link rel="prefetch" href="/docs/assets/js/271.d26cfac9.js"><link rel="prefetch" href="/docs/assets/js/272.661d758a.js"><link rel="prefetch" href="/docs/assets/js/273.583aa88c.js"><link rel="prefetch" href="/docs/assets/js/274.3e9d9f53.js"><link rel="prefetch" href="/docs/assets/js/275.f4c94a86.js"><link rel="prefetch" href="/docs/assets/js/276.0cb85151.js"><link rel="prefetch" href="/docs/assets/js/277.b1d25d5a.js"><link rel="prefetch" href="/docs/assets/js/278.e3a71da8.js"><link rel="prefetch" href="/docs/assets/js/279.1c74d069.js"><link rel="prefetch" href="/docs/assets/js/28.18aa08dc.js"><link rel="prefetch" href="/docs/assets/js/280.070f04e5.js"><link rel="prefetch" href="/docs/assets/js/281.a2ac78f8.js"><link rel="prefetch" href="/docs/assets/js/282.f1bf6af6.js"><link rel="prefetch" href="/docs/assets/js/283.7734c9d4.js"><link rel="prefetch" href="/docs/assets/js/284.b9f143e9.js"><link rel="prefetch" href="/docs/assets/js/285.7b3ebede.js"><link rel="prefetch" href="/docs/assets/js/286.ff4b5902.js"><link rel="prefetch" href="/docs/assets/js/287.6ebccf77.js"><link rel="prefetch" href="/docs/assets/js/288.0c555089.js"><link rel="prefetch" href="/docs/assets/js/289.6b141618.js"><link rel="prefetch" href="/docs/assets/js/290.165ddf38.js"><link rel="prefetch" href="/docs/assets/js/291.9031c475.js"><link rel="prefetch" href="/docs/assets/js/292.8e07a61b.js"><link rel="prefetch" href="/docs/assets/js/293.0da1115b.js"><link rel="prefetch" href="/docs/assets/js/294.629e5c7c.js"><link rel="prefetch" href="/docs/assets/js/295.3f01797a.js"><link rel="prefetch" href="/docs/assets/js/296.86a9dae4.js"><link rel="prefetch" href="/docs/assets/js/297.4784b985.js"><link rel="prefetch" href="/docs/assets/js/298.5f169b71.js"><link rel="prefetch" href="/docs/assets/js/299.4bb95d1d.js"><link rel="prefetch" href="/docs/assets/js/3.3ae7df1d.js"><link rel="prefetch" href="/docs/assets/js/30.9bdb3685.js"><link rel="prefetch" href="/docs/assets/js/300.ae1a0124.js"><link rel="prefetch" href="/docs/assets/js/301.d96b828d.js"><link rel="prefetch" href="/docs/assets/js/302.a47d34c6.js"><link rel="prefetch" href="/docs/assets/js/303.f9c26c67.js"><link rel="prefetch" href="/docs/assets/js/304.df5c7691.js"><link rel="prefetch" href="/docs/assets/js/305.9e699a00.js"><link rel="prefetch" href="/docs/assets/js/306.603b6de1.js"><link rel="prefetch" href="/docs/assets/js/307.2272c3b3.js"><link rel="prefetch" href="/docs/assets/js/308.b3f373b1.js"><link rel="prefetch" href="/docs/assets/js/309.25f5305b.js"><link rel="prefetch" href="/docs/assets/js/31.cfc8abdf.js"><link rel="prefetch" href="/docs/assets/js/310.2aa91375.js"><link rel="prefetch" href="/docs/assets/js/311.fa6ecde6.js"><link rel="prefetch" href="/docs/assets/js/312.fef32880.js"><link rel="prefetch" href="/docs/assets/js/313.556d352b.js"><link rel="prefetch" href="/docs/assets/js/314.ef09f94c.js"><link rel="prefetch" href="/docs/assets/js/315.89594428.js"><link rel="prefetch" href="/docs/assets/js/316.0795ac28.js"><link rel="prefetch" href="/docs/assets/js/317.ef51ae89.js"><link rel="prefetch" href="/docs/assets/js/318.03b35d3e.js"><link rel="prefetch" href="/docs/assets/js/319.0557037b.js"><link rel="prefetch" href="/docs/assets/js/32.3bbc5c7f.js"><link rel="prefetch" href="/docs/assets/js/320.fbf27d31.js"><link rel="prefetch" href="/docs/assets/js/321.e2cee440.js"><link rel="prefetch" href="/docs/assets/js/322.c9fcd7bc.js"><link rel="prefetch" href="/docs/assets/js/323.c9ddc24d.js"><link rel="prefetch" href="/docs/assets/js/324.800de769.js"><link rel="prefetch" href="/docs/assets/js/325.3e3e1fd3.js"><link rel="prefetch" href="/docs/assets/js/326.e95197e4.js"><link rel="prefetch" href="/docs/assets/js/327.e3596e05.js"><link rel="prefetch" href="/docs/assets/js/328.b4d62048.js"><link rel="prefetch" href="/docs/assets/js/329.75b52747.js"><link rel="prefetch" href="/docs/assets/js/33.a8732cb1.js"><link rel="prefetch" href="/docs/assets/js/330.ed1b3277.js"><link rel="prefetch" href="/docs/assets/js/331.5e9ba03a.js"><link rel="prefetch" href="/docs/assets/js/332.8ef54c1e.js"><link rel="prefetch" href="/docs/assets/js/333.39ac0134.js"><link rel="prefetch" href="/docs/assets/js/334.a22cb708.js"><link rel="prefetch" href="/docs/assets/js/335.d735a278.js"><link rel="prefetch" href="/docs/assets/js/336.073ac2fd.js"><link rel="prefetch" href="/docs/assets/js/337.6ec30486.js"><link rel="prefetch" href="/docs/assets/js/338.9bc7e525.js"><link rel="prefetch" href="/docs/assets/js/339.51f841b6.js"><link rel="prefetch" href="/docs/assets/js/34.e8441b4b.js"><link rel="prefetch" href="/docs/assets/js/340.4dfdf2c9.js"><link rel="prefetch" href="/docs/assets/js/341.efb157d6.js"><link rel="prefetch" href="/docs/assets/js/342.9ca8e50f.js"><link rel="prefetch" href="/docs/assets/js/343.c63347f6.js"><link rel="prefetch" href="/docs/assets/js/344.d8b10de5.js"><link rel="prefetch" href="/docs/assets/js/345.3c4fcd0a.js"><link rel="prefetch" href="/docs/assets/js/346.666e8f50.js"><link rel="prefetch" href="/docs/assets/js/347.4a027625.js"><link rel="prefetch" href="/docs/assets/js/348.6ca3eb9b.js"><link rel="prefetch" href="/docs/assets/js/349.c3218174.js"><link rel="prefetch" href="/docs/assets/js/35.e7924732.js"><link rel="prefetch" href="/docs/assets/js/350.fbb194fa.js"><link rel="prefetch" href="/docs/assets/js/351.963126a8.js"><link rel="prefetch" href="/docs/assets/js/352.3a50a0f2.js"><link rel="prefetch" href="/docs/assets/js/36.9b7389f6.js"><link rel="prefetch" href="/docs/assets/js/37.b349e1b2.js"><link rel="prefetch" href="/docs/assets/js/38.274473ed.js"><link rel="prefetch" href="/docs/assets/js/39.7861b96e.js"><link rel="prefetch" href="/docs/assets/js/4.06bfbfa3.js"><link rel="prefetch" href="/docs/assets/js/40.b6ef8165.js"><link rel="prefetch" href="/docs/assets/js/41.4f781f6b.js"><link rel="prefetch" href="/docs/assets/js/42.9a373490.js"><link rel="prefetch" href="/docs/assets/js/43.e7704c36.js"><link rel="prefetch" href="/docs/assets/js/44.14a48bd2.js"><link rel="prefetch" href="/docs/assets/js/45.3e73358d.js"><link rel="prefetch" href="/docs/assets/js/46.1fdfadcf.js"><link rel="prefetch" href="/docs/assets/js/47.afa5b3db.js"><link rel="prefetch" href="/docs/assets/js/48.edccde39.js"><link rel="prefetch" href="/docs/assets/js/49.7e4371b0.js"><link rel="prefetch" href="/docs/assets/js/5.ddf4d874.js"><link rel="prefetch" href="/docs/assets/js/50.26a71893.js"><link rel="prefetch" href="/docs/assets/js/51.90bb429e.js"><link rel="prefetch" href="/docs/assets/js/52.6cdf6849.js"><link rel="prefetch" href="/docs/assets/js/53.fbd6b90e.js"><link rel="prefetch" href="/docs/assets/js/54.fed4281f.js"><link rel="prefetch" href="/docs/assets/js/55.e69c8f4b.js"><link rel="prefetch" href="/docs/assets/js/56.b123d75f.js"><link rel="prefetch" href="/docs/assets/js/57.3a112f1b.js"><link rel="prefetch" href="/docs/assets/js/58.4e4f1015.js"><link rel="prefetch" href="/docs/assets/js/59.98658790.js"><link rel="prefetch" href="/docs/assets/js/6.58f5a117.js"><link rel="prefetch" href="/docs/assets/js/60.d442e095.js"><link rel="prefetch" href="/docs/assets/js/61.a4c1f13f.js"><link rel="prefetch" href="/docs/assets/js/62.4f6b7c6d.js"><link rel="prefetch" href="/docs/assets/js/63.4ae50f16.js"><link rel="prefetch" href="/docs/assets/js/64.347b7121.js"><link rel="prefetch" href="/docs/assets/js/65.5066b4c8.js"><link rel="prefetch" href="/docs/assets/js/66.d70d7482.js"><link rel="prefetch" href="/docs/assets/js/67.4e03a46e.js"><link rel="prefetch" href="/docs/assets/js/68.a58a892f.js"><link rel="prefetch" href="/docs/assets/js/69.7cdb653b.js"><link rel="prefetch" href="/docs/assets/js/7.ad5e56c5.js"><link rel="prefetch" href="/docs/assets/js/70.3c506fe2.js"><link rel="prefetch" href="/docs/assets/js/71.df205d03.js"><link rel="prefetch" href="/docs/assets/js/72.0836bf4e.js"><link rel="prefetch" href="/docs/assets/js/73.291ac97c.js"><link rel="prefetch" href="/docs/assets/js/74.f91c0c8c.js"><link rel="prefetch" href="/docs/assets/js/75.67821a32.js"><link rel="prefetch" href="/docs/assets/js/76.a7b67e46.js"><link rel="prefetch" href="/docs/assets/js/77.b0b9bcc5.js"><link rel="prefetch" href="/docs/assets/js/78.822f82e6.js"><link rel="prefetch" href="/docs/assets/js/79.1208ebb5.js"><link rel="prefetch" href="/docs/assets/js/8.f7eb5c5a.js"><link rel="prefetch" href="/docs/assets/js/80.08151f2a.js"><link rel="prefetch" href="/docs/assets/js/81.4875242a.js"><link rel="prefetch" href="/docs/assets/js/82.01072168.js"><link rel="prefetch" href="/docs/assets/js/83.dca4263b.js"><link rel="prefetch" href="/docs/assets/js/84.ef779c87.js"><link rel="prefetch" href="/docs/assets/js/85.96e2e908.js"><link rel="prefetch" href="/docs/assets/js/86.46ec2d9c.js"><link rel="prefetch" href="/docs/assets/js/87.d481580b.js"><link rel="prefetch" href="/docs/assets/js/88.de64ade1.js"><link rel="prefetch" href="/docs/assets/js/89.1d4a5652.js"><link rel="prefetch" href="/docs/assets/js/9.f5a26d2d.js"><link rel="prefetch" href="/docs/assets/js/90.b768d08f.js"><link rel="prefetch" href="/docs/assets/js/91.cabd9a63.js"><link rel="prefetch" href="/docs/assets/js/92.23b979ce.js"><link rel="prefetch" href="/docs/assets/js/93.51a50f94.js"><link rel="prefetch" href="/docs/assets/js/94.5317f1bd.js"><link rel="prefetch" href="/docs/assets/js/95.027c7164.js"><link rel="prefetch" href="/docs/assets/js/96.c6afebdc.js"><link rel="prefetch" href="/docs/assets/js/97.ef1d7856.js"><link rel="prefetch" href="/docs/assets/js/98.bdf7d478.js"><link rel="prefetch" href="/docs/assets/js/99.724a8624.js">
    <link rel="stylesheet" href="/docs/assets/css/0.styles.5d974432.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/docs/" class="home-link router-link-active"><!----> <span class="site-name">Nguyễn Khánk's Wiki</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/docs/architect/" class="nav-link">
  Architecture
</a></div><div class="nav-item"><a href="/docs/kungfu/letsgo.html" class="nav-link">
  Kungfu
</a></div><div class="nav-item"><a href="https://nguyenngockhank.github.io" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Home
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/docs/architect/" class="nav-link">
  Architecture
</a></div><div class="nav-item"><a href="/docs/kungfu/letsgo.html" class="nav-link">
  Kungfu
</a></div><div class="nav-item"><a href="https://nguyenngockhank.github.io" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Home
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>The Art of Readable Code</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Clean Code</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>A Philosophy of Software Design</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Building Microservices</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>97 Things Every Programmer Should Know</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>NoSql Distilled</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/docs/kungfu/nosql-distilled/00.html" class="sidebar-link">NoSQL Distilled</a></li><li><a href="/docs/kungfu/nosql-distilled/c0.html" class="sidebar-link">Preface</a></li><li><a href="/docs/kungfu/nosql-distilled/c1.html" class="sidebar-link">Chapter 1. Why NoSQL?</a></li><li><a href="/docs/kungfu/nosql-distilled/c2.html" class="sidebar-link">Chapter 2. Aggregate Data Models</a></li><li><a href="/docs/kungfu/nosql-distilled/c3.html" class="sidebar-link">Chapter 3. More Details on Data Models</a></li><li><a href="/docs/kungfu/nosql-distilled/c4.html" class="sidebar-link">Chapter 4. Distribution Models</a></li><li><a href="/docs/kungfu/nosql-distilled/c5.html" class="sidebar-link">Chapter 5. Consistency</a></li><li><a href="/docs/kungfu/nosql-distilled/c6.html" class="sidebar-link">Chapter 6. Version Stamps</a></li><li><a href="/docs/kungfu/nosql-distilled/c7.html" class="sidebar-link">Chapter 7. Map-Reduce</a></li><li><a href="/docs/kungfu/nosql-distilled/c8.html" class="sidebar-link">Chapter 8. Key-Value Databases</a></li><li><a href="/docs/kungfu/nosql-distilled/c9.html" class="sidebar-link">Chapter 9. Document Databases</a></li><li><a href="/docs/kungfu/nosql-distilled/c10.html" aria-current="page" class="active sidebar-link">Chapter 10. Column-Family Stores</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docs/kungfu/nosql-distilled/c10.html#_10-1-what-is-a-column-family-data-store" class="sidebar-link">10.1. What Is a Column-Family Data Store?</a></li><li class="sidebar-sub-header"><a href="/docs/kungfu/nosql-distilled/c10.html#_10-2-features" class="sidebar-link">10.2. Features</a></li><li class="sidebar-sub-header"><a href="/docs/kungfu/nosql-distilled/c10.html#_10-3-suitable-use-cases" class="sidebar-link">10.3. Suitable Use Cases</a></li><li class="sidebar-sub-header"><a href="/docs/kungfu/nosql-distilled/c10.html#_10-4-when-not-to-use" class="sidebar-link">10.4. When Not to Use</a></li></ul></li><li><a href="/docs/kungfu/nosql-distilled/c11.html" class="sidebar-link">Chapter 11. Graph Databases</a></li><li><a href="/docs/kungfu/nosql-distilled/c12.html" class="sidebar-link">Chapter 12. Schema Migrations</a></li><li><a href="/docs/kungfu/nosql-distilled/c13.html" class="sidebar-link">Chapter 13. Polyglot Persistence</a></li><li><a href="/docs/kungfu/nosql-distilled/c14.html" class="sidebar-link">Chapter 14. Beyond NoSQL</a></li><li><a href="/docs/kungfu/nosql-distilled/c15.html" class="sidebar-link">Chapter 15. Choosing Your Database</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Others</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="chapter-10-column-family-stores"><a href="#chapter-10-column-family-stores" class="header-anchor">#</a> Chapter 10. Column-Family Stores</h1> <p>Column-family stores, such as Cassandra [Cassandra], HBase [Hbase], Hypertable [Hypertable], and
Amazon SimpleDB [Amazon SimpleDB], allow you to store data with keys mapped to values and the
values grouped into multiple column families, each column family being a map of data.</p> <p><img src="/docs/assets/img/image--040.413484e3.jpg" alt="img"></p> <h2 id="_10-1-what-is-a-column-family-data-store"><a href="#_10-1-what-is-a-column-family-data-store" class="header-anchor">#</a> 10.1. What Is a Column-Family Data Store?</h2> <p>There are many column-family databases. In this chapter, we will talk about Cassandra but also
reference other column-family databases to discuss features that may be of interest in particular
scenarios.</p> <p>Column-family databases store data in column families as rows that have many columns associated
with a row key (Figure 10.1). Column families are groups of related data that is often accessed
together. For a Customer, we would often access their Profile information at the same time, but not
their Orders.</p> <p><img src="/docs/assets/img/image--041.a2ea71bc.jpg" alt="img"></p> <p><strong>Figure 10.1. Cassandra’s data model with column families</strong></p> <p>Cassandra is one of the popular column-family databases; there are others, such as HBase,
Hypertable, and Amazon DynamoDB [Amazon DynamoDB]. Cassandra can be described as fast and
easily scalable with write operations spread across the cluster. The cluster does not have a master
node, so any read and write can be handled by any node in the cluster.</p> <h2 id="_10-2-features"><a href="#_10-2-features" class="header-anchor">#</a> 10.2. Features</h2> <p>Let’s start by looking at how data is structured in Cassandra. The basic unit of storage in Cassandra is
a column. A Cassandra column consists of a name-value pair where the name also behaves as the key.
Each of these key-value pairs is a single column and is always stored with a timestamp value. The
timestamp is used to expire data, resolve write conflicts, deal with stale data, and do other things.
Once the column data is no longer used, the space can be reclaimed later during a compaction phase.</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
    name<span class="token operator">:</span> <span class="token string">&quot;fullName&quot;</span><span class="token punctuation">,</span>
    value<span class="token operator">:</span> <span class="token string">&quot;Martin Fowler&quot;</span><span class="token punctuation">,</span>
    timestamp<span class="token operator">:</span> <span class="token number">12345667890</span>
<span class="token punctuation">}</span>
</code></pre></div><p>The column has a key of firstName and the value of Martin and has a timestamp attached to it. A
row is a collection of columns attached or linked to a key; a collection of similar rows makes a
column family. When the columns in a column family are simple columns, the column family is known
as <strong>standard column family</strong>.</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token comment">//column family</span>
<span class="token punctuation">{</span>
    <span class="token comment">//row</span>
    <span class="token property">&quot;pramod-sadalage&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
        firstName<span class="token operator">:</span> <span class="token string">&quot;Pramod&quot;</span><span class="token punctuation">,</span>
        lastName<span class="token operator">:</span> <span class="token string">&quot;Sadalage&quot;</span><span class="token punctuation">,</span>
        lastVisit<span class="token operator">:</span> <span class="token string">&quot;2012/12/12&quot;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//row</span>
    <span class="token property">&quot;martin-fowler&quot;</span> <span class="token operator">:</span> <span class="token punctuation">{</span>
        firstName<span class="token operator">:</span> <span class="token string">&quot;Martin&quot;</span><span class="token punctuation">,</span>
        lastName<span class="token operator">:</span> <span class="token string">&quot;Fowler&quot;</span><span class="token punctuation">,</span>
        location<span class="token operator">:</span> <span class="token string">&quot;Boston&quot;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Each column family can be compared to a container of rows in an RDBMS table where the key
identifies the row and the row consists on multiple columns. The difference is that various rows do
not have to have the same columns, and columns can be added to any row at any time without having
to add it to other rows. We have the pramod-sadalage row and the martin-fowler row with
different columns; both rows are part of the column family.</p> <p>When a column consists of a map of columns, then we have a <strong>super column</strong>. A super column
consists of a name and a value which is a map of columns. Think of a super column as a container of
columns.</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
    name<span class="token operator">:</span> <span class="token string">&quot;book:978-0767905923&quot;</span><span class="token punctuation">,</span>
    value<span class="token operator">:</span> <span class="token punctuation">{</span>
        author<span class="token operator">:</span> <span class="token string">&quot;Mitch Albon&quot;</span><span class="token punctuation">,</span>
        title<span class="token operator">:</span> <span class="token string">&quot;Tuesdays with Morrie&quot;</span><span class="token punctuation">,</span>
        isbn<span class="token operator">:</span> <span class="token string">&quot;978-0767905923&quot;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>When we use super columns to create a column family, we get a super column family.</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token comment">//super column family</span>
<span class="token punctuation">{</span>
    <span class="token comment">//row</span>
    name<span class="token operator">:</span> <span class="token string">&quot;billing:martin-fowler&quot;</span><span class="token punctuation">,</span>
        value<span class="token operator">:</span> <span class="token punctuation">{</span>
        address<span class="token operator">:</span> <span class="token punctuation">{</span>
            name<span class="token operator">:</span> <span class="token string">&quot;address:default&quot;</span><span class="token punctuation">,</span>
            value<span class="token operator">:</span> <span class="token punctuation">{</span>
                fullName<span class="token operator">:</span> <span class="token string">&quot;Martin Fowler&quot;</span><span class="token punctuation">,</span>
                street<span class="token operator">:</span><span class="token string">&quot;100 N. Main Street&quot;</span><span class="token punctuation">,</span>
                zip<span class="token operator">:</span> <span class="token string">&quot;20145&quot;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        billing<span class="token operator">:</span> <span class="token punctuation">{</span>
            name<span class="token operator">:</span> <span class="token string">&quot;billing:default&quot;</span><span class="token punctuation">,</span>
            value<span class="token operator">:</span> <span class="token punctuation">{</span>
                creditcard<span class="token operator">:</span> <span class="token string">&quot;8888-8888-8888-8888&quot;</span><span class="token punctuation">,</span>
                expDate<span class="token operator">:</span> <span class="token string">&quot;12/2016&quot;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//row</span>
    name<span class="token operator">:</span> <span class="token string">&quot;billing:pramod-sadalage&quot;</span><span class="token punctuation">,</span>
    value<span class="token operator">:</span> <span class="token punctuation">{</span>
        address<span class="token operator">:</span> <span class="token punctuation">{</span>
            name<span class="token operator">:</span> <span class="token string">&quot;address:default&quot;</span><span class="token punctuation">,</span>
            value<span class="token operator">:</span> <span class="token punctuation">{</span>
                fullName<span class="token operator">:</span> <span class="token string">&quot;Pramod Sadalage&quot;</span><span class="token punctuation">,</span>
                street<span class="token operator">:</span><span class="token string">&quot;100 E. State Parkway&quot;</span><span class="token punctuation">,</span>
                zip<span class="token operator">:</span> <span class="token string">&quot;54130&quot;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        billing<span class="token operator">:</span> <span class="token punctuation">{</span>
            name<span class="token operator">:</span> <span class="token string">&quot;billing:default&quot;</span><span class="token punctuation">,</span>
            value<span class="token operator">:</span> <span class="token punctuation">{</span>
                creditcard<span class="token operator">:</span> <span class="token string">&quot;9999-8888-7777-4444&quot;</span><span class="token punctuation">,</span>
                expDate<span class="token operator">:</span> <span class="token string">&quot;01/2016&quot;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Super column families are good to keep related data together, but when some of the columns are
not needed most of the time, the columns are still fetched and deserialized by Cassandra, which may
not be optimal.</p> <p>Cassandra puts the standard and super column families into <strong>keyspaces</strong>. A keyspace is similar to a
database in RDBMS where all column families related to the application are stored. Keyspaces have
to be created so that column families can be assigned to them:</p> <p>create keyspace ecommerce</p> <h3 id="_10-2-1-consistency"><a href="#_10-2-1-consistency" class="header-anchor">#</a> <strong>10.2.1. Consistency</strong></h3> <p>When a write is received by Cassandra, the data is first recorded in a commit log, then written to an</p> <p>in-memory structure known as <strong>memtable</strong>. A write operation is considered successful once it’s
written to the commit log and the memtable. Writes are batched in memory and periodically written
out to structures known as <strong>SSTable</strong>. SSTables are not written to again after they are flushed; if there
are changes to the data, a new SSTable is written. Unused SSTables are reclaimed by <strong>compactation</strong>.</p> <p>Let’s look at the read operation to see how consistency settings affect it. If we have a consistency
setting of ONE as the default for all read operations, then when a read request is made, Cassandra
returns the data from the first replica, even if the data is stale. If the data is stale, subsequent reads
will get the latest (newest) data; this process is known as <strong>read repair</strong>. The low consistency level is
good to use when you do not care if you get stale data and/or if you have high read performance
requirements.</p> <p>Similarly, if you are doing writes, Cassandra would write to one node’s commit log and return a
response to the client. The consistency of ONE is good if you have very high write performance
requirements and also do not mind if some writes are lost, which may happen if the node goes down
before the write is replicated to other nodes.</p> <div class="language-java extra-class"><pre class="language-java"><code>quorum <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ConfigurableConsistencyLevel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
quorum<span class="token punctuation">.</span><span class="token function">setDefaultReadConsistencyLevel</span><span class="token punctuation">(</span><span class="token class-name">HConsistencyLevel</span><span class="token punctuation">.</span>QUORUM<span class="token punctuation">)</span><span class="token punctuation">;</span>
quorum<span class="token punctuation">.</span><span class="token function">setDefaultWriteConsistencyLevel</span><span class="token punctuation">(</span><span class="token class-name">HConsistencyLevel</span><span class="token punctuation">.</span>QUORUM<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Using the <code>QUORUM</code> consistency setting for both read and write operations ensures that majority of the
nodes respond to the read and the column with the newest timestamp is returned back to the client,
while the replicas that do not have the newest data are repaired via the read repair operations. During
write operations, the QUORUM consistency setting means that the write has to propagate to the majority
of the nodes before it is considered successful and the client is notified.</p> <p>Using ALL as consistency level means that all nodes will have to respond to reads or writes, which
will make the cluster not tolerant to faults—even when one node is down, the write or read is
blocked and reported as a failure. It’s therefore upon the system designers to tune the consistency
levels as the application requirements change. Within the same application, there may be different
requirements of consistency; they can also change based on each operation, for example showing
review comments for a product has different consistency requirements compared to reading the status
of the last order placed by the customer.</p> <p>During <strong>keyspace</strong> creation, we can configure how many replicas of the data we need to store. This
number determines the replication factor of the data. If you have a replication factor of 3, the data
copied on to three nodes. When writing and reading data with Cassandra, if you specify the
consistency values of 2, you get that R + W is greater than the replication factor (2 + 2 &gt; 3) which
gives you better consistency during writes and reads.</p> <p>We can run the node repair command for the keyspace and force Cassandra to compare every key
it’s responsible for with the rest of the replicas. As this operation is expensive, we can also just
repair a specific column family or a list of column families:</p> <p>repair ecommerce</p> <p>repair ecommerce customerInfo</p> <p>While a node is down, the data that was supposed to be stored by that node is handed off to other
nodes. As the node comes back online, the changes made to the data are handed back to the node. This</p> <p>technique is known as <strong>hinted handoff</strong>. Hinted handoff allows for faster restore of failed nodes.</p> <h3 id="_10-2-2-transactions"><a href="#_10-2-2-transactions" class="header-anchor">#</a> <strong>10.2.2. Transactions</strong></h3> <p>Cassandra does not have transactions in the traditional sense—where we could start multiple writes
and then decide if we want to commit the changes or not. In Cassandra, a write is atomic at the row
level, which means inserting or updating columns for a given row key will be treated as a single
write and will either succeed or fail. Writes are first written to commit logs and memtables, and are
only considered good when the write to commit log and memtable was successful. If a node goes
down, the commit log is used to apply changes to the node, just like the <strong>redo log</strong> in Oracle.</p> <p>You can use external transaction libraries, such as ZooKeeper [ZooKeeper], to synchronize your
writes and reads. There are also libraries such as Cages [Cages] that allow you to wrap your
transactions over ZooKeeper.</p> <h3 id="_10-2-3-availability"><a href="#_10-2-3-availability" class="header-anchor">#</a> <strong>10.2.3. Availability</strong></h3> <p>Cassandra is by design highly available, since there is no master in the cluster and every node is a
peer in the cluster. The availability of a cluster can be increased by reducing the consistency level of
the requests. Availability is governed by the (R + W) &gt; N formula (“Quorums,” p. 57 ) where W is the
minimum number of nodes where the write must be successfully written, R is the minimum number of
nodes that must respond successfully to a read, and N is the number of nodes participating in the
replication of data. You can tune the availability by changing the R and W values for a fixed value of N.</p> <p>In a 10-node Cassandra cluster with a replication factor for the keyspace set to 3 (N = 3), if we set
R = 2 and W = 2, then we have (2 + 2) &gt; 3. In this scenario, when one node goes down,
availability is not affected much, as the data can be retrieved from the other two nodes. If W = 2 and
R = 1, when two nodes are down the cluster is not available for write but we can still read.
Similarly, if R = 2 and W = 1, we can write but the cluster is not available for read. With the <code>R + W &gt; N</code> equation, you are making conscious decisions about consistency tradeoffs.</p> <p>You should set up your keyspaces and read/write operations based on your needs—higher
availability for write or higher availability for read.</p> <h3 id="_10-2-4-query-features"><a href="#_10-2-4-query-features" class="header-anchor">#</a> <strong>10.2.4. Query Features</strong></h3> <p>When designing the data model in Cassandra, it is advised to make the columns and column families
optimized for reading the data, as it does not have a rich query language; as data is inserted in the
column families, data in each row is sorted by column names. If we have a column that is retrieved
much more often than other columns, it’s better performance-wise to use that value for the row key
instead.</p> <h3 id="_10-2-4-1-basic-queries"><a href="#_10-2-4-1-basic-queries" class="header-anchor">#</a> <strong>10.2.4.1. Basic Queries</strong></h3> <p>Basic queries that can be run using a Cassandra client include the GET, SET, and DEL. Before starting
to query for data, we have to issue the keyspace command use ecommerce;. This ensures that all of
our queries are run against the keyspace that we put our data into. Before starting to use the column
family in the keyspace, we have to define the column family.</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">COLUMN</span> FAMILY Customer
<span class="token keyword">WITH</span> comparator <span class="token operator">=</span> UTF8Type
<span class="token operator">AND</span> key_validation_class<span class="token operator">=</span>UTF8Type
<span class="token operator">AND</span> column_metadata <span class="token operator">=</span> <span class="token punctuation">[</span>
    {column_name: city<span class="token punctuation">,</span> validation_class: UTF8Type}
    {column_name: name<span class="token punctuation">,</span> validation_class: UTF8Type}
    {column_name: web<span class="token punctuation">,</span> validation_class: UTF8Type}
<span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre></div><p>We have a column family named Customer with name, city, and web columns, and we are
inserting data in the column family with a Cassandra client.</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">SET</span> Customer<span class="token punctuation">[</span><span class="token string">'mfowler'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'city'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token string">'Boston'</span><span class="token punctuation">;</span>
<span class="token keyword">SET</span> Customer<span class="token punctuation">[</span><span class="token string">'mfowler'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token string">'Martin Fowler'</span><span class="token punctuation">;</span>
<span class="token keyword">SET</span> Customer<span class="token punctuation">[</span><span class="token string">'mfowler'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'web'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token string">'www.martinfowler.com'</span><span class="token punctuation">;</span>
</code></pre></div><p>Using the  <a href="https://hector-client.github.io/hector/build/html/" target="_blank" rel="noopener noreferrer">Hector<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> Java client, we can insert the same data in the column family.</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">ColumnFamilyTemplate</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> template <span class="token operator">=</span> cassandra<span class="token punctuation">.</span><span class="token function">getColumnFamilyTemplate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">ColumnFamilyUpdater</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> updater <span class="token operator">=</span> template<span class="token punctuation">.</span><span class="token function">createUpdater</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">String</span> name <span class="token operator">:</span> values<span class="token punctuation">.</span><span class="token function">keySet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    updater<span class="token punctuation">.</span><span class="token function">setString</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> values<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> 

<span class="token keyword">try</span> <span class="token punctuation">{</span>
    template<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>updater<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">HectorException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">handleException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>We can read the data back using the GET command. There are multiple ways to get the data; we can
get the whole column family.</p> <div class="language-sql extra-class"><pre class="language-sql"><code>GET Customer<span class="token punctuation">[</span><span class="token string">'mfowler'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre></div><p>We can even get just the column we are interested in from the column family.</p> <div class="language-sql extra-class"><pre class="language-sql"><code>GET Customer<span class="token punctuation">[</span><span class="token string">'mfowler'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'web'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre></div><p>Getting the specific column we need is more efficient, as only the data we care about is returned—
which saves lots of data movement, especially when the column family has a large number of
columns. Updating the data is the same as using the SET command for the column that needs to be set
to the new value. Using DEL command, we can delete either a column or the entire column family.</p> <div class="language-sql extra-class"><pre class="language-sql"><code>DEL Customer<span class="token punctuation">[</span><span class="token string">'mfowler'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'city'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

DEL Customer<span class="token punctuation">[</span><span class="token string">'mfowler'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="_10-2-4-2-advanced-queries-and-indexing"><a href="#_10-2-4-2-advanced-queries-and-indexing" class="header-anchor">#</a> <strong>10.2.4.2. Advanced Queries and Indexing</strong></h3> <p>Cassandra allows you to index columns other than the keys for the column family. We can define an
index on the city column.</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">UPDATE</span> <span class="token keyword">COLUMN</span> FAMILY Customer
<span class="token keyword">WITH</span> comparator <span class="token operator">=</span> UTF8Type 
<span class="token operator">AND</span> column_metadata <span class="token operator">=</span> <span class="token punctuation">[</span>{column_name: city<span class="token punctuation">,</span> validation_class: UTF8Type<span class="token punctuation">,</span> index_type: <span class="token keyword">KEYS</span>}<span class="token punctuation">]</span><span class="token punctuation">;</span>
</code></pre></div><p>We can now query directly against the indexed column.</p> <div class="language-sql extra-class"><pre class="language-sql"><code>GET Customer <span class="token keyword">WHERE</span> city <span class="token operator">=</span> <span class="token string">'Boston'</span><span class="token punctuation">;</span>
</code></pre></div><p>These indexes are implemented as <em>bit-mapped</em> indexes and perform well for low-cardinality
column values.</p> <h3 id="_10-2-4-3-cassandra-query-language-cql"><a href="#_10-2-4-3-cassandra-query-language-cql" class="header-anchor">#</a> <strong>10.2.4.3. Cassandra Query Language (CQL)</strong></h3> <p>Cassandra has a query language that supports SQL-like commands, known as Cassandra Query Language (CQL). We can use the CQL commands to create a column family.</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">CREATE</span> COLUMNFAMILY Customer <span class="token punctuation">(</span>
    <span class="token keyword">KEY</span> <span class="token keyword">varchar</span> <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span><span class="token punctuation">,</span>
    name <span class="token keyword">varchar</span><span class="token punctuation">,</span>
    city <span class="token keyword">varchar</span><span class="token punctuation">,</span>
    web <span class="token keyword">varchar</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>We insert the same data using CQL.</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> Customer <span class="token punctuation">(</span><span class="token keyword">KEY</span><span class="token punctuation">,</span> name<span class="token punctuation">,</span> city<span class="token punctuation">,</span> web<span class="token punctuation">)</span>
<span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">'mfowler'</span><span class="token punctuation">,</span> <span class="token string">'Martin Fowler'</span><span class="token punctuation">,</span> <span class="token string">'Boston'</span><span class="token punctuation">,</span> <span class="token string">'www.martinfowler.com'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>We can read data using the SELECT command. Here we read all the columns:</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> Customer
</code></pre></div><p>Or, we could just <code>SELECT</code> the columns we need.</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">SELECT</span> name<span class="token punctuation">,</span>web <span class="token keyword">FROM</span> Customer
</code></pre></div><p>Indexing columns are created using the CREATE INDEX command, and then can be used to query the
data.</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">SELECT</span> name<span class="token punctuation">,</span>web <span class="token keyword">FROM</span> Customer <span class="token keyword">WHERE</span> city<span class="token operator">=</span><span class="token string">'Boston'</span>
</code></pre></div><p>CQL has many more features for querying data, but it does not have all the features that SQL has.
CQL does not allow joins or subqueries, and its where clauses are typically simple.</p> <h3 id="_10-2-5-scaling"><a href="#_10-2-5-scaling" class="header-anchor">#</a> <strong>10.2.5. Scaling</strong></h3> <p>Scaling an existing Cassandra cluster is a matter of adding more nodes. As no single node is a master,
when we add nodes to the cluster we are improving the capacity of the cluster to support more writes
and reads. This type of horizontal scaling allows you to have maximum uptime, as the cluster keeps
serving requests from the clients while new nodes are being added to the cluster.</p> <h2 id="_10-3-suitable-use-cases"><a href="#_10-3-suitable-use-cases" class="header-anchor">#</a> 10.3. Suitable Use Cases</h2> <p>Let’s discuss some of the problems where column-family databases are a good fit.</p> <h3 id="_10-3-1-event-logging"><a href="#_10-3-1-event-logging" class="header-anchor">#</a> <strong>10.3.1. Event Logging</strong></h3> <p>Column-family databases with their ability to store any data structures are a great choice to store
event information, such as application state or errors encountered by the application. Within the
enterprise, all applications can write their events to Cassandra with their own columns and the
rowkey of the form appname:timestamp. Since we can scale writes, Cassandra would work ideally
for an event logging system (Figure 10.2).</p> <p><img src="/docs/assets/img/image--042.c57c62b1.jpg" alt="img"></p> <p><strong>Figure 10.2. Event logging with Cassandra</strong></p> <h3 id="_10-3-2-content-management-systems-blogging-platforms"><a href="#_10-3-2-content-management-systems-blogging-platforms" class="header-anchor">#</a> <strong>10.3.2. Content Management Systems, Blogging Platforms</strong></h3> <p>Using column families, you can store blog entries with tags, categories, links, and trackbacks in
different columns. Comments can be either stored in the same row or moved to a different keyspace;
similarly, blog users and the actual blogs can be put into different column families.</p> <h3 id="_10-3-3-counters"><a href="#_10-3-3-counters" class="header-anchor">#</a> <strong>10.3.3. Counters</strong></h3> <p>Often, in web applications you need to count and categorize visitors of a page to calculate analytics.
You can use the CounterColumnType during creation of a column family.</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">COLUMN</span> FAMILY visit_counter
<span class="token keyword">WITH</span> default_validation_class<span class="token operator">=</span>CounterColumnType
<span class="token operator">AND</span> key_validation_class<span class="token operator">=</span>UTF8Type <span class="token operator">AND</span> comparator<span class="token operator">=</span>UTF8Type<span class="token punctuation">;</span>
</code></pre></div><p>Once a column family is created, you can have arbitrary columns for each page visited within the
web application for every user.</p> <div class="language-sql extra-class"><pre class="language-sql"><code>INCR visit_counter<span class="token punctuation">[</span><span class="token string">'mfowler'</span><span class="token punctuation">]</span><span class="token punctuation">[</span>home<span class="token punctuation">]</span> <span class="token keyword">BY</span> <span class="token number">1</span><span class="token punctuation">;</span>
INCR visit_counter<span class="token punctuation">[</span><span class="token string">'mfowler'</span><span class="token punctuation">]</span><span class="token punctuation">[</span>products<span class="token punctuation">]</span> <span class="token keyword">BY</span> <span class="token number">1</span><span class="token punctuation">;</span>
INCR visit_counter<span class="token punctuation">[</span><span class="token string">'mfowler'</span><span class="token punctuation">]</span><span class="token punctuation">[</span>contactus<span class="token punctuation">]</span> <span class="token keyword">BY</span> <span class="token number">1</span><span class="token punctuation">;</span>
</code></pre></div><p>Incrementing counters using CQL:</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">UPDATE</span> visit_counter <span class="token keyword">SET</span> home <span class="token operator">=</span> home <span class="token operator">+</span> <span class="token number">1</span> <span class="token keyword">WHERE</span> <span class="token keyword">KEY</span><span class="token operator">=</span><span class="token string">'mfowler'</span>
</code></pre></div><h3 id="_10-3-4-expiring-usage"><a href="#_10-3-4-expiring-usage" class="header-anchor">#</a> <strong>10.3.4. Expiring Usage</strong></h3> <p>You may provide demo access to users, or may want to show ad banners on a website for a specific
time. You can do this by using <strong>expiring columns</strong> : Cassandra allows you to have columns which, after
a given time, are deleted automatically. This time is known as TTL (Time To Live) and is defined in
seconds. The column is deleted after the TTL has elapsed; when the column does not exist, the access
can be revoked or the banner can be removed.</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">SET</span> Customer<span class="token punctuation">[</span><span class="token string">'mfowler'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'demo_access'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'allowed'</span> <span class="token keyword">WITH</span> ttl<span class="token operator">=</span><span class="token number">2592000</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="_10-4-when-not-to-use"><a href="#_10-4-when-not-to-use" class="header-anchor">#</a> 10.4. When Not to Use</h2> <p>There are problems for which column-family databases are not the best solutions, such as systems that
require ACID transactions for writes and reads. If you need the database to aggregate the data using
queries (such as SUM or AVG), you have to do this on the client side using data retrieved by the client
from all the rows.</p> <p>Cassandra is not great for early prototypes or initial tech spikes: During the early stages, we are
not sure how the query patterns may change, and as the query patterns change, we have to change the
column family design. This causes friction for the product innovation team and slows down developer
productivity. RDBMS impose high cost on schema change, which is traded off for a low cost of query
change; in Cassandra, the cost may be higher for query change as compared to schema change.</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/docs/kungfu/nosql-distilled/c9.html" class="prev">
        Chapter 9. Document Databases
      </a></span> <span class="next"><a href="/docs/kungfu/nosql-distilled/c11.html">
        Chapter 11. Graph Databases
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----><!----><!----></div></div>
    <script src="/docs/assets/js/app.b4ead7d5.js" defer></script><script src="/docs/assets/js/2.918c4e99.js" defer></script><script src="/docs/assets/js/20.e52878dd.js" defer></script><script src="/docs/assets/js/29.c1c2752a.js" defer></script>
  </body>
</html>
