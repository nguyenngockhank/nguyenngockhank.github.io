<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>11. One Task at a Time | Nguyễn Khánk&#39;s Wiki</title>
    <meta name="generator" content="VuePress 1.7.1">
    <link rel="apple-touch-icon" sizes="180x180" href="../public/favicons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="../public/favicons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="../public/favicons/favicon-16x16.png">
    <link rel="manifest" href="../public/favicons/manifest.json">
    <link rel="mask-icon" href="../public/favicons/safari-pinned-tab.svg" color="#3a0839">
    <link rel="shortcut icon" href="../public/favicons/favicon.ico">
    <meta name="description" content="Wikipedia của tui">
    <meta name="msapplication-TileColor" content="#3a0839">
    <meta name="msapplication-config" content="../public/favicons/browserconfig.xml">
    <meta name="theme-color" content="#ffffff">
    
    <link rel="preload" href="/docs/assets/css/0.styles.970a6dfd.css" as="style"><link rel="preload" href="/docs/assets/js/app.c492483c.js" as="script"><link rel="preload" href="/docs/assets/js/2.856a8128.js" as="script"><link rel="preload" href="/docs/assets/js/289.ab4a1a17.js" as="script"><link rel="preload" href="/docs/assets/js/36.391a9f77.js" as="script"><link rel="prefetch" href="/docs/assets/js/10.3291fc0c.js"><link rel="prefetch" href="/docs/assets/js/100.81311183.js"><link rel="prefetch" href="/docs/assets/js/101.216816a1.js"><link rel="prefetch" href="/docs/assets/js/102.87c58567.js"><link rel="prefetch" href="/docs/assets/js/103.878edd3c.js"><link rel="prefetch" href="/docs/assets/js/104.a5b24c58.js"><link rel="prefetch" href="/docs/assets/js/105.23baa084.js"><link rel="prefetch" href="/docs/assets/js/106.433fc1fb.js"><link rel="prefetch" href="/docs/assets/js/107.f150c798.js"><link rel="prefetch" href="/docs/assets/js/108.b41b1ed8.js"><link rel="prefetch" href="/docs/assets/js/109.8f478603.js"><link rel="prefetch" href="/docs/assets/js/11.6cdcda92.js"><link rel="prefetch" href="/docs/assets/js/110.6cccca37.js"><link rel="prefetch" href="/docs/assets/js/111.4938f11a.js"><link rel="prefetch" href="/docs/assets/js/112.fb2a0eb9.js"><link rel="prefetch" href="/docs/assets/js/113.62654284.js"><link rel="prefetch" href="/docs/assets/js/114.8685f809.js"><link rel="prefetch" href="/docs/assets/js/115.6fd5485c.js"><link rel="prefetch" href="/docs/assets/js/116.36b2940a.js"><link rel="prefetch" href="/docs/assets/js/117.da51aaea.js"><link rel="prefetch" href="/docs/assets/js/118.2f447c9b.js"><link rel="prefetch" href="/docs/assets/js/119.7ff401fe.js"><link rel="prefetch" href="/docs/assets/js/12.f1d5adcd.js"><link rel="prefetch" href="/docs/assets/js/120.923f3607.js"><link rel="prefetch" href="/docs/assets/js/121.63ac027c.js"><link rel="prefetch" href="/docs/assets/js/122.6a433d90.js"><link rel="prefetch" href="/docs/assets/js/123.dc6794d7.js"><link rel="prefetch" href="/docs/assets/js/124.3a7d947a.js"><link rel="prefetch" href="/docs/assets/js/125.b7f00a50.js"><link rel="prefetch" href="/docs/assets/js/126.a6fde49f.js"><link rel="prefetch" href="/docs/assets/js/127.7f850c60.js"><link rel="prefetch" href="/docs/assets/js/128.e4f76b54.js"><link rel="prefetch" href="/docs/assets/js/129.03ab9ad0.js"><link rel="prefetch" href="/docs/assets/js/13.013b988b.js"><link rel="prefetch" href="/docs/assets/js/130.2b001c12.js"><link rel="prefetch" href="/docs/assets/js/131.98e1561d.js"><link rel="prefetch" href="/docs/assets/js/132.18f7e18d.js"><link rel="prefetch" href="/docs/assets/js/133.7e7dc675.js"><link rel="prefetch" href="/docs/assets/js/134.340629ca.js"><link rel="prefetch" href="/docs/assets/js/135.ceaa57c2.js"><link rel="prefetch" href="/docs/assets/js/136.e2e33daf.js"><link rel="prefetch" href="/docs/assets/js/137.fda00dd6.js"><link rel="prefetch" href="/docs/assets/js/138.e696c660.js"><link rel="prefetch" href="/docs/assets/js/139.ed073e9d.js"><link rel="prefetch" href="/docs/assets/js/14.c9e48adb.js"><link rel="prefetch" href="/docs/assets/js/140.a51cab16.js"><link rel="prefetch" href="/docs/assets/js/141.e26700f9.js"><link rel="prefetch" href="/docs/assets/js/142.0903456d.js"><link rel="prefetch" href="/docs/assets/js/143.67e8910e.js"><link rel="prefetch" href="/docs/assets/js/144.99cdab05.js"><link rel="prefetch" href="/docs/assets/js/145.1b17f483.js"><link rel="prefetch" href="/docs/assets/js/146.f428eaeb.js"><link rel="prefetch" href="/docs/assets/js/147.f0a78dc1.js"><link rel="prefetch" href="/docs/assets/js/148.f83a37f1.js"><link rel="prefetch" href="/docs/assets/js/149.2d34fd6e.js"><link rel="prefetch" href="/docs/assets/js/15.9e09f773.js"><link rel="prefetch" href="/docs/assets/js/150.5f4d1802.js"><link rel="prefetch" href="/docs/assets/js/151.7f84c24f.js"><link rel="prefetch" href="/docs/assets/js/152.0383ef6b.js"><link rel="prefetch" href="/docs/assets/js/153.b6dbf14a.js"><link rel="prefetch" href="/docs/assets/js/154.8a6b0da2.js"><link rel="prefetch" href="/docs/assets/js/155.e327d864.js"><link rel="prefetch" href="/docs/assets/js/156.093e1cb1.js"><link rel="prefetch" href="/docs/assets/js/157.0dd88190.js"><link rel="prefetch" href="/docs/assets/js/158.1a831dba.js"><link rel="prefetch" href="/docs/assets/js/159.d4b5293c.js"><link rel="prefetch" href="/docs/assets/js/16.d74a3ed6.js"><link rel="prefetch" href="/docs/assets/js/160.7793b58c.js"><link rel="prefetch" href="/docs/assets/js/161.bb276599.js"><link rel="prefetch" href="/docs/assets/js/162.4e86a537.js"><link rel="prefetch" href="/docs/assets/js/163.94e1b1b2.js"><link rel="prefetch" href="/docs/assets/js/164.7573b5b2.js"><link rel="prefetch" href="/docs/assets/js/165.36c9997d.js"><link rel="prefetch" href="/docs/assets/js/166.f00b3aeb.js"><link rel="prefetch" href="/docs/assets/js/167.ca374158.js"><link rel="prefetch" href="/docs/assets/js/168.7c427316.js"><link rel="prefetch" href="/docs/assets/js/169.16b730b3.js"><link rel="prefetch" href="/docs/assets/js/17.0ce88974.js"><link rel="prefetch" href="/docs/assets/js/170.e8809cf1.js"><link rel="prefetch" href="/docs/assets/js/171.f45a0622.js"><link rel="prefetch" href="/docs/assets/js/172.733e9639.js"><link rel="prefetch" href="/docs/assets/js/173.678d98be.js"><link rel="prefetch" href="/docs/assets/js/174.07874c82.js"><link rel="prefetch" href="/docs/assets/js/175.329faa7c.js"><link rel="prefetch" href="/docs/assets/js/176.76c2b785.js"><link rel="prefetch" href="/docs/assets/js/177.30e5669b.js"><link rel="prefetch" href="/docs/assets/js/178.c434a76a.js"><link rel="prefetch" href="/docs/assets/js/179.164c8be7.js"><link rel="prefetch" href="/docs/assets/js/18.6b6cd600.js"><link rel="prefetch" href="/docs/assets/js/180.53ff95bf.js"><link rel="prefetch" href="/docs/assets/js/181.a0fb7fd1.js"><link rel="prefetch" href="/docs/assets/js/182.19043208.js"><link rel="prefetch" href="/docs/assets/js/183.d7978137.js"><link rel="prefetch" href="/docs/assets/js/184.94dfc188.js"><link rel="prefetch" href="/docs/assets/js/185.1028c6b3.js"><link rel="prefetch" href="/docs/assets/js/186.cf5eab7f.js"><link rel="prefetch" href="/docs/assets/js/187.b8c396c5.js"><link rel="prefetch" href="/docs/assets/js/188.04dbce65.js"><link rel="prefetch" href="/docs/assets/js/189.6b099be5.js"><link rel="prefetch" href="/docs/assets/js/19.5bf12704.js"><link rel="prefetch" href="/docs/assets/js/190.a3fd182c.js"><link rel="prefetch" href="/docs/assets/js/191.4f9ecbba.js"><link rel="prefetch" href="/docs/assets/js/192.cbe43669.js"><link rel="prefetch" href="/docs/assets/js/193.2845793f.js"><link rel="prefetch" href="/docs/assets/js/194.b4d252ad.js"><link rel="prefetch" href="/docs/assets/js/195.9cd2816f.js"><link rel="prefetch" href="/docs/assets/js/196.1a0d3246.js"><link rel="prefetch" href="/docs/assets/js/197.f6dc0480.js"><link rel="prefetch" href="/docs/assets/js/198.66055dca.js"><link rel="prefetch" href="/docs/assets/js/199.fb193e12.js"><link rel="prefetch" href="/docs/assets/js/20.b9750772.js"><link rel="prefetch" href="/docs/assets/js/200.5f9b1137.js"><link rel="prefetch" href="/docs/assets/js/201.33c401b5.js"><link rel="prefetch" href="/docs/assets/js/202.03c20ca0.js"><link rel="prefetch" href="/docs/assets/js/203.45ecaa65.js"><link rel="prefetch" href="/docs/assets/js/204.6fdeb0c5.js"><link rel="prefetch" href="/docs/assets/js/205.a5966ed5.js"><link rel="prefetch" href="/docs/assets/js/206.b8c4b665.js"><link rel="prefetch" href="/docs/assets/js/207.17e4fe9b.js"><link rel="prefetch" href="/docs/assets/js/208.9b5f8084.js"><link rel="prefetch" href="/docs/assets/js/209.b9a064e3.js"><link rel="prefetch" href="/docs/assets/js/21.aeb467bc.js"><link rel="prefetch" href="/docs/assets/js/210.90fcd2bc.js"><link rel="prefetch" href="/docs/assets/js/211.c389d768.js"><link rel="prefetch" href="/docs/assets/js/212.1c87c725.js"><link rel="prefetch" href="/docs/assets/js/213.68791e28.js"><link rel="prefetch" href="/docs/assets/js/214.d50f21d3.js"><link rel="prefetch" href="/docs/assets/js/215.5d4fdd3d.js"><link rel="prefetch" href="/docs/assets/js/216.6e1d8b9a.js"><link rel="prefetch" href="/docs/assets/js/217.c5e87463.js"><link rel="prefetch" href="/docs/assets/js/218.1d6f7755.js"><link rel="prefetch" href="/docs/assets/js/219.0b6f994a.js"><link rel="prefetch" href="/docs/assets/js/22.0130adaf.js"><link rel="prefetch" href="/docs/assets/js/220.82ae4d6b.js"><link rel="prefetch" href="/docs/assets/js/221.4b09b5a7.js"><link rel="prefetch" href="/docs/assets/js/222.d98f83bd.js"><link rel="prefetch" href="/docs/assets/js/223.a16591aa.js"><link rel="prefetch" href="/docs/assets/js/224.3da09c13.js"><link rel="prefetch" href="/docs/assets/js/225.5399f29a.js"><link rel="prefetch" href="/docs/assets/js/226.18afec57.js"><link rel="prefetch" href="/docs/assets/js/227.731b79b7.js"><link rel="prefetch" href="/docs/assets/js/228.1ddcc339.js"><link rel="prefetch" href="/docs/assets/js/229.dbdb6c70.js"><link rel="prefetch" href="/docs/assets/js/23.fb142352.js"><link rel="prefetch" href="/docs/assets/js/230.994a6958.js"><link rel="prefetch" href="/docs/assets/js/231.3cebc6b7.js"><link rel="prefetch" href="/docs/assets/js/232.d0a12022.js"><link rel="prefetch" href="/docs/assets/js/233.cbfc0f0f.js"><link rel="prefetch" href="/docs/assets/js/234.29fa9358.js"><link rel="prefetch" href="/docs/assets/js/235.4807343a.js"><link rel="prefetch" href="/docs/assets/js/236.cef5d8f6.js"><link rel="prefetch" href="/docs/assets/js/237.ae7d7f08.js"><link rel="prefetch" href="/docs/assets/js/238.9abfb333.js"><link rel="prefetch" href="/docs/assets/js/239.1b3bc46b.js"><link rel="prefetch" href="/docs/assets/js/24.f94a1991.js"><link rel="prefetch" href="/docs/assets/js/240.2d27a80d.js"><link rel="prefetch" href="/docs/assets/js/241.5b95418b.js"><link rel="prefetch" href="/docs/assets/js/242.9354bb08.js"><link rel="prefetch" href="/docs/assets/js/243.92f43f45.js"><link rel="prefetch" href="/docs/assets/js/244.391ed31a.js"><link rel="prefetch" href="/docs/assets/js/245.70f783c1.js"><link rel="prefetch" href="/docs/assets/js/246.0b8d4c86.js"><link rel="prefetch" href="/docs/assets/js/247.d4f04687.js"><link rel="prefetch" href="/docs/assets/js/248.da94ac46.js"><link rel="prefetch" href="/docs/assets/js/249.2971a2a1.js"><link rel="prefetch" href="/docs/assets/js/25.d518276a.js"><link rel="prefetch" href="/docs/assets/js/250.cf598886.js"><link rel="prefetch" href="/docs/assets/js/251.7a3dce3e.js"><link rel="prefetch" href="/docs/assets/js/252.bf56b7ba.js"><link rel="prefetch" href="/docs/assets/js/253.339d604e.js"><link rel="prefetch" href="/docs/assets/js/254.5ca847dd.js"><link rel="prefetch" href="/docs/assets/js/255.0a594a88.js"><link rel="prefetch" href="/docs/assets/js/256.edb5c85f.js"><link rel="prefetch" href="/docs/assets/js/257.4184b381.js"><link rel="prefetch" href="/docs/assets/js/258.a47fc026.js"><link rel="prefetch" href="/docs/assets/js/259.ba7e1916.js"><link rel="prefetch" href="/docs/assets/js/26.8bfff88c.js"><link rel="prefetch" href="/docs/assets/js/260.769326f1.js"><link rel="prefetch" href="/docs/assets/js/261.d745ffc1.js"><link rel="prefetch" href="/docs/assets/js/262.738c9dd3.js"><link rel="prefetch" href="/docs/assets/js/263.e0abaa82.js"><link rel="prefetch" href="/docs/assets/js/264.46866614.js"><link rel="prefetch" href="/docs/assets/js/265.53897cc7.js"><link rel="prefetch" href="/docs/assets/js/266.e5248332.js"><link rel="prefetch" href="/docs/assets/js/267.35be5b3a.js"><link rel="prefetch" href="/docs/assets/js/268.5ea9c996.js"><link rel="prefetch" href="/docs/assets/js/269.7f0e23ab.js"><link rel="prefetch" href="/docs/assets/js/27.932a6b97.js"><link rel="prefetch" href="/docs/assets/js/270.50cc6f84.js"><link rel="prefetch" href="/docs/assets/js/271.1b7514ca.js"><link rel="prefetch" href="/docs/assets/js/272.828a66b3.js"><link rel="prefetch" href="/docs/assets/js/273.1876ebe8.js"><link rel="prefetch" href="/docs/assets/js/274.680ced97.js"><link rel="prefetch" href="/docs/assets/js/275.8fb2d49c.js"><link rel="prefetch" href="/docs/assets/js/276.c96d5b83.js"><link rel="prefetch" href="/docs/assets/js/277.017cc9e4.js"><link rel="prefetch" href="/docs/assets/js/278.71ba1570.js"><link rel="prefetch" href="/docs/assets/js/279.e48f295a.js"><link rel="prefetch" href="/docs/assets/js/28.78a7641d.js"><link rel="prefetch" href="/docs/assets/js/280.e0c12555.js"><link rel="prefetch" href="/docs/assets/js/281.68763689.js"><link rel="prefetch" href="/docs/assets/js/282.793de5f0.js"><link rel="prefetch" href="/docs/assets/js/283.f98da721.js"><link rel="prefetch" href="/docs/assets/js/284.730bf305.js"><link rel="prefetch" href="/docs/assets/js/285.ee6f7266.js"><link rel="prefetch" href="/docs/assets/js/286.822761e1.js"><link rel="prefetch" href="/docs/assets/js/287.be32e29f.js"><link rel="prefetch" href="/docs/assets/js/288.df680456.js"><link rel="prefetch" href="/docs/assets/js/29.4b4c859d.js"><link rel="prefetch" href="/docs/assets/js/290.954fbd46.js"><link rel="prefetch" href="/docs/assets/js/291.d0c630e1.js"><link rel="prefetch" href="/docs/assets/js/292.07704ad2.js"><link rel="prefetch" href="/docs/assets/js/293.bd2c4598.js"><link rel="prefetch" href="/docs/assets/js/294.34eade9b.js"><link rel="prefetch" href="/docs/assets/js/295.bcf9fd2d.js"><link rel="prefetch" href="/docs/assets/js/296.bcf12792.js"><link rel="prefetch" href="/docs/assets/js/297.c251174f.js"><link rel="prefetch" href="/docs/assets/js/298.fe9c2a51.js"><link rel="prefetch" href="/docs/assets/js/299.37c3be81.js"><link rel="prefetch" href="/docs/assets/js/3.d6b4d677.js"><link rel="prefetch" href="/docs/assets/js/30.a7ab4c54.js"><link rel="prefetch" href="/docs/assets/js/300.077298fa.js"><link rel="prefetch" href="/docs/assets/js/301.77be66d7.js"><link rel="prefetch" href="/docs/assets/js/302.5b77b67a.js"><link rel="prefetch" href="/docs/assets/js/303.10a66e8c.js"><link rel="prefetch" href="/docs/assets/js/304.13ad4c20.js"><link rel="prefetch" href="/docs/assets/js/305.f7f2a6b0.js"><link rel="prefetch" href="/docs/assets/js/306.ef7772d6.js"><link rel="prefetch" href="/docs/assets/js/307.d7902e0c.js"><link rel="prefetch" href="/docs/assets/js/308.70ee1184.js"><link rel="prefetch" href="/docs/assets/js/309.daa5cfdc.js"><link rel="prefetch" href="/docs/assets/js/31.8466040e.js"><link rel="prefetch" href="/docs/assets/js/310.91f8266c.js"><link rel="prefetch" href="/docs/assets/js/311.8a8d8362.js"><link rel="prefetch" href="/docs/assets/js/312.baf58c24.js"><link rel="prefetch" href="/docs/assets/js/313.904e3ac5.js"><link rel="prefetch" href="/docs/assets/js/314.d3833780.js"><link rel="prefetch" href="/docs/assets/js/315.1d76114f.js"><link rel="prefetch" href="/docs/assets/js/316.5dc9cfd7.js"><link rel="prefetch" href="/docs/assets/js/317.5e3e90c2.js"><link rel="prefetch" href="/docs/assets/js/318.99d54d17.js"><link rel="prefetch" href="/docs/assets/js/319.e8c0dead.js"><link rel="prefetch" href="/docs/assets/js/32.0fa8ff68.js"><link rel="prefetch" href="/docs/assets/js/320.637d816d.js"><link rel="prefetch" href="/docs/assets/js/321.cbeb9d4d.js"><link rel="prefetch" href="/docs/assets/js/322.7afef6c1.js"><link rel="prefetch" href="/docs/assets/js/323.c7efcb67.js"><link rel="prefetch" href="/docs/assets/js/324.681f6ff8.js"><link rel="prefetch" href="/docs/assets/js/325.9b0c4199.js"><link rel="prefetch" href="/docs/assets/js/326.39095ef9.js"><link rel="prefetch" href="/docs/assets/js/327.2cb5ccfa.js"><link rel="prefetch" href="/docs/assets/js/328.88901d0d.js"><link rel="prefetch" href="/docs/assets/js/329.bdad60d7.js"><link rel="prefetch" href="/docs/assets/js/33.49cfac2b.js"><link rel="prefetch" href="/docs/assets/js/330.0a0620ab.js"><link rel="prefetch" href="/docs/assets/js/331.3618e453.js"><link rel="prefetch" href="/docs/assets/js/332.e20dc3e7.js"><link rel="prefetch" href="/docs/assets/js/333.3182cd9f.js"><link rel="prefetch" href="/docs/assets/js/334.f2dd013b.js"><link rel="prefetch" href="/docs/assets/js/335.59dc3635.js"><link rel="prefetch" href="/docs/assets/js/336.9f1ef35d.js"><link rel="prefetch" href="/docs/assets/js/337.b4b2a44e.js"><link rel="prefetch" href="/docs/assets/js/338.0973eeed.js"><link rel="prefetch" href="/docs/assets/js/339.adb37abf.js"><link rel="prefetch" href="/docs/assets/js/34.a7f30473.js"><link rel="prefetch" href="/docs/assets/js/340.8c4ff7f8.js"><link rel="prefetch" href="/docs/assets/js/341.cbc805a3.js"><link rel="prefetch" href="/docs/assets/js/342.09ba6671.js"><link rel="prefetch" href="/docs/assets/js/343.b1c161eb.js"><link rel="prefetch" href="/docs/assets/js/344.ce874046.js"><link rel="prefetch" href="/docs/assets/js/345.c4e895ef.js"><link rel="prefetch" href="/docs/assets/js/346.b675b779.js"><link rel="prefetch" href="/docs/assets/js/347.0f35108d.js"><link rel="prefetch" href="/docs/assets/js/348.c7d7ead6.js"><link rel="prefetch" href="/docs/assets/js/349.0625fe28.js"><link rel="prefetch" href="/docs/assets/js/35.68ff1ef1.js"><link rel="prefetch" href="/docs/assets/js/350.2a87f415.js"><link rel="prefetch" href="/docs/assets/js/351.ab67fa5f.js"><link rel="prefetch" href="/docs/assets/js/352.63edd968.js"><link rel="prefetch" href="/docs/assets/js/353.18f3a707.js"><link rel="prefetch" href="/docs/assets/js/354.f4c30752.js"><link rel="prefetch" href="/docs/assets/js/355.4b62bf2a.js"><link rel="prefetch" href="/docs/assets/js/356.f0f56526.js"><link rel="prefetch" href="/docs/assets/js/357.67cb1a55.js"><link rel="prefetch" href="/docs/assets/js/358.64e6be0c.js"><link rel="prefetch" href="/docs/assets/js/359.a11bd390.js"><link rel="prefetch" href="/docs/assets/js/360.0d389fbe.js"><link rel="prefetch" href="/docs/assets/js/361.96930b4b.js"><link rel="prefetch" href="/docs/assets/js/362.bfadef5e.js"><link rel="prefetch" href="/docs/assets/js/363.37408c7f.js"><link rel="prefetch" href="/docs/assets/js/364.8cc9d7de.js"><link rel="prefetch" href="/docs/assets/js/365.0af6a905.js"><link rel="prefetch" href="/docs/assets/js/366.1ac811d1.js"><link rel="prefetch" href="/docs/assets/js/367.f83c42e5.js"><link rel="prefetch" href="/docs/assets/js/368.e8bad47a.js"><link rel="prefetch" href="/docs/assets/js/369.b06e6062.js"><link rel="prefetch" href="/docs/assets/js/37.c4c8145b.js"><link rel="prefetch" href="/docs/assets/js/370.194be3a3.js"><link rel="prefetch" href="/docs/assets/js/371.679c8445.js"><link rel="prefetch" href="/docs/assets/js/372.e96ffb99.js"><link rel="prefetch" href="/docs/assets/js/373.fe224fc4.js"><link rel="prefetch" href="/docs/assets/js/374.86d12b26.js"><link rel="prefetch" href="/docs/assets/js/375.f6169193.js"><link rel="prefetch" href="/docs/assets/js/376.6be3d107.js"><link rel="prefetch" href="/docs/assets/js/377.bb7e9b0b.js"><link rel="prefetch" href="/docs/assets/js/378.13f4af80.js"><link rel="prefetch" href="/docs/assets/js/379.ff5f1c50.js"><link rel="prefetch" href="/docs/assets/js/38.d09614fb.js"><link rel="prefetch" href="/docs/assets/js/380.06bd1707.js"><link rel="prefetch" href="/docs/assets/js/381.480a89e7.js"><link rel="prefetch" href="/docs/assets/js/382.a5406bf9.js"><link rel="prefetch" href="/docs/assets/js/383.7a9b2650.js"><link rel="prefetch" href="/docs/assets/js/384.e31d8074.js"><link rel="prefetch" href="/docs/assets/js/385.6298428a.js"><link rel="prefetch" href="/docs/assets/js/386.1072096a.js"><link rel="prefetch" href="/docs/assets/js/387.6befb147.js"><link rel="prefetch" href="/docs/assets/js/388.845f8fb4.js"><link rel="prefetch" href="/docs/assets/js/389.96d2d723.js"><link rel="prefetch" href="/docs/assets/js/39.5fedc48c.js"><link rel="prefetch" href="/docs/assets/js/390.37fdbd66.js"><link rel="prefetch" href="/docs/assets/js/391.67715266.js"><link rel="prefetch" href="/docs/assets/js/392.406a2aa0.js"><link rel="prefetch" href="/docs/assets/js/393.93ac37a7.js"><link rel="prefetch" href="/docs/assets/js/394.16535088.js"><link rel="prefetch" href="/docs/assets/js/395.1d7cd973.js"><link rel="prefetch" href="/docs/assets/js/396.ea4a5495.js"><link rel="prefetch" href="/docs/assets/js/397.7fc418cd.js"><link rel="prefetch" href="/docs/assets/js/398.ebeffecd.js"><link rel="prefetch" href="/docs/assets/js/399.2a0cde0e.js"><link rel="prefetch" href="/docs/assets/js/4.57508cff.js"><link rel="prefetch" href="/docs/assets/js/40.e5d9922d.js"><link rel="prefetch" href="/docs/assets/js/400.a50a9fc0.js"><link rel="prefetch" href="/docs/assets/js/401.f7c62f29.js"><link rel="prefetch" href="/docs/assets/js/402.a7242411.js"><link rel="prefetch" href="/docs/assets/js/403.839e9d1c.js"><link rel="prefetch" href="/docs/assets/js/404.2bed9738.js"><link rel="prefetch" href="/docs/assets/js/405.9b7cbc1e.js"><link rel="prefetch" href="/docs/assets/js/406.2467b963.js"><link rel="prefetch" href="/docs/assets/js/407.352f97ea.js"><link rel="prefetch" href="/docs/assets/js/408.49f95167.js"><link rel="prefetch" href="/docs/assets/js/409.0a233bee.js"><link rel="prefetch" href="/docs/assets/js/41.55ab8f0e.js"><link rel="prefetch" href="/docs/assets/js/410.b2356464.js"><link rel="prefetch" href="/docs/assets/js/411.0f4cb822.js"><link rel="prefetch" href="/docs/assets/js/412.4510f34c.js"><link rel="prefetch" href="/docs/assets/js/413.5b2f8d9b.js"><link rel="prefetch" href="/docs/assets/js/414.ba1fdada.js"><link rel="prefetch" href="/docs/assets/js/415.2f6a99f1.js"><link rel="prefetch" href="/docs/assets/js/416.da3323a2.js"><link rel="prefetch" href="/docs/assets/js/417.58f023c6.js"><link rel="prefetch" href="/docs/assets/js/418.60494fab.js"><link rel="prefetch" href="/docs/assets/js/419.240bdd90.js"><link rel="prefetch" href="/docs/assets/js/42.00e59ca5.js"><link rel="prefetch" href="/docs/assets/js/420.9fb50678.js"><link rel="prefetch" href="/docs/assets/js/421.9fc67443.js"><link rel="prefetch" href="/docs/assets/js/422.368384b4.js"><link rel="prefetch" href="/docs/assets/js/423.5e91447c.js"><link rel="prefetch" href="/docs/assets/js/424.0c769864.js"><link rel="prefetch" href="/docs/assets/js/425.d0542977.js"><link rel="prefetch" href="/docs/assets/js/426.28c2402b.js"><link rel="prefetch" href="/docs/assets/js/427.b447f867.js"><link rel="prefetch" href="/docs/assets/js/428.9504e6de.js"><link rel="prefetch" href="/docs/assets/js/429.c0b6056e.js"><link rel="prefetch" href="/docs/assets/js/43.5bd326a4.js"><link rel="prefetch" href="/docs/assets/js/430.8812942d.js"><link rel="prefetch" href="/docs/assets/js/431.b0491d47.js"><link rel="prefetch" href="/docs/assets/js/44.dc171c44.js"><link rel="prefetch" href="/docs/assets/js/45.d52c2eea.js"><link rel="prefetch" href="/docs/assets/js/46.f59336ee.js"><link rel="prefetch" href="/docs/assets/js/47.d9cbd6cc.js"><link rel="prefetch" href="/docs/assets/js/48.fcdce34f.js"><link rel="prefetch" href="/docs/assets/js/49.47f4f2e6.js"><link rel="prefetch" href="/docs/assets/js/5.2621ab50.js"><link rel="prefetch" href="/docs/assets/js/50.fe3794d5.js"><link rel="prefetch" href="/docs/assets/js/51.e0f0353d.js"><link rel="prefetch" href="/docs/assets/js/52.f9e4e3ad.js"><link rel="prefetch" href="/docs/assets/js/53.9bcb4ee0.js"><link rel="prefetch" href="/docs/assets/js/54.27c13f69.js"><link rel="prefetch" href="/docs/assets/js/55.39147605.js"><link rel="prefetch" href="/docs/assets/js/56.3a1897a2.js"><link rel="prefetch" href="/docs/assets/js/57.a9dad334.js"><link rel="prefetch" href="/docs/assets/js/58.ba493265.js"><link rel="prefetch" href="/docs/assets/js/59.69056001.js"><link rel="prefetch" href="/docs/assets/js/6.bb6ec349.js"><link rel="prefetch" href="/docs/assets/js/60.f5ce601b.js"><link rel="prefetch" href="/docs/assets/js/61.2b8243e2.js"><link rel="prefetch" href="/docs/assets/js/62.e5d87970.js"><link rel="prefetch" href="/docs/assets/js/63.ce15e236.js"><link rel="prefetch" href="/docs/assets/js/64.96ba6ae3.js"><link rel="prefetch" href="/docs/assets/js/65.9a6b7947.js"><link rel="prefetch" href="/docs/assets/js/66.c539ef14.js"><link rel="prefetch" href="/docs/assets/js/67.1a3e2647.js"><link rel="prefetch" href="/docs/assets/js/68.da0b2af7.js"><link rel="prefetch" href="/docs/assets/js/69.31c7c3fb.js"><link rel="prefetch" href="/docs/assets/js/7.1c180f4c.js"><link rel="prefetch" href="/docs/assets/js/70.dea6e73c.js"><link rel="prefetch" href="/docs/assets/js/71.6740197c.js"><link rel="prefetch" href="/docs/assets/js/72.be4867df.js"><link rel="prefetch" href="/docs/assets/js/73.5e69a78d.js"><link rel="prefetch" href="/docs/assets/js/74.99c4aae2.js"><link rel="prefetch" href="/docs/assets/js/75.660a673b.js"><link rel="prefetch" href="/docs/assets/js/76.f5f09510.js"><link rel="prefetch" href="/docs/assets/js/77.21547749.js"><link rel="prefetch" href="/docs/assets/js/78.4509fe2f.js"><link rel="prefetch" href="/docs/assets/js/79.1cb4fb11.js"><link rel="prefetch" href="/docs/assets/js/8.19d8fd8c.js"><link rel="prefetch" href="/docs/assets/js/80.93e417a1.js"><link rel="prefetch" href="/docs/assets/js/81.76f014cf.js"><link rel="prefetch" href="/docs/assets/js/82.96314704.js"><link rel="prefetch" href="/docs/assets/js/83.5b91c6f9.js"><link rel="prefetch" href="/docs/assets/js/84.36193f03.js"><link rel="prefetch" href="/docs/assets/js/85.168ed10b.js"><link rel="prefetch" href="/docs/assets/js/86.2ea3d1b4.js"><link rel="prefetch" href="/docs/assets/js/87.d3e65e3e.js"><link rel="prefetch" href="/docs/assets/js/88.3578ab66.js"><link rel="prefetch" href="/docs/assets/js/89.7c8352b2.js"><link rel="prefetch" href="/docs/assets/js/9.e5d07a7c.js"><link rel="prefetch" href="/docs/assets/js/90.0498019a.js"><link rel="prefetch" href="/docs/assets/js/91.ac881f4d.js"><link rel="prefetch" href="/docs/assets/js/92.9f7574c0.js"><link rel="prefetch" href="/docs/assets/js/93.2deac8d4.js"><link rel="prefetch" href="/docs/assets/js/94.22f8df19.js"><link rel="prefetch" href="/docs/assets/js/95.1184b651.js"><link rel="prefetch" href="/docs/assets/js/96.6b592680.js"><link rel="prefetch" href="/docs/assets/js/97.f4c599ff.js"><link rel="prefetch" href="/docs/assets/js/98.964571d8.js"><link rel="prefetch" href="/docs/assets/js/99.f676c60f.js">
    <link rel="stylesheet" href="/docs/assets/css/0.styles.970a6dfd.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/docs/" class="home-link router-link-active"><!----> <span class="site-name">Nguyễn Khánk's Wiki</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/docs/architect/" class="nav-link">
  Architecture
</a></div><div class="nav-item"><a href="https://nguyenngockhank.github.io" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Home
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/docs/architect/" class="nav-link">
  Architecture
</a></div><div class="nav-item"><a href="https://nguyenngockhank.github.io" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Home
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>The Art of Readable Code</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/docs/kungfu/artofcode/c1.html" class="sidebar-link">1. Code Should Be Easy to Understand</a></li><li><a href="/docs/kungfu/artofcode/c2.html" class="sidebar-link">2. Packing Information into Names</a></li><li><a href="/docs/kungfu/artofcode/c3.html" class="sidebar-link">3. Names That Can’t Be Misconstrued</a></li><li><a href="/docs/kungfu/artofcode/c4.html" class="sidebar-link">4. Aesthetics</a></li><li><a href="/docs/kungfu/artofcode/c5.html" class="sidebar-link">5. Knowing What to Comment</a></li><li><a href="/docs/kungfu/artofcode/c6.html" class="sidebar-link">6. Making Comments Precise and Compact</a></li><li><a href="/docs/kungfu/artofcode/c7.html" class="sidebar-link">7. Making Control Flow Easy to Read</a></li><li><a href="/docs/kungfu/artofcode/c8.html" class="sidebar-link">8. Breaking Down Giant Expressions</a></li><li><a href="/docs/kungfu/artofcode/c9.html" class="sidebar-link">9. Variables and Readability</a></li><li><a href="/docs/kungfu/artofcode/c10.html" class="sidebar-link">10. Extracting Unrelated Subproblems</a></li><li><a href="/docs/kungfu/artofcode/c11.html" aria-current="page" class="active sidebar-link">11. One Task at a Time</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/docs/kungfu/artofcode/c11.html#tasks-can-be-small" class="sidebar-link">Tasks Can Be Small</a></li><li class="sidebar-sub-header"><a href="/docs/kungfu/artofcode/c11.html#extracting-values-from-an-object" class="sidebar-link">Extracting Values from an Object</a></li><li class="sidebar-sub-header"><a href="/docs/kungfu/artofcode/c11.html#a-larger-example" class="sidebar-link">A Larger Example</a></li><li class="sidebar-sub-header"><a href="/docs/kungfu/artofcode/c11.html#summary" class="sidebar-link">Summary</a></li></ul></li><li><a href="/docs/kungfu/artofcode/c12.html" class="sidebar-link">12. Turning Thoughts into Code</a></li><li><a href="/docs/kungfu/artofcode/c13.html" class="sidebar-link">13. Writing Less Code</a></li><li><a href="/docs/kungfu/artofcode/c14.html" class="sidebar-link">14. Testing and Readability</a></li><li><a href="/docs/kungfu/artofcode/c15.html" class="sidebar-link">15. Designing and Implementing a “Minute/Hour Counter”</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>A Philosophy of Software Design</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Building Microservices</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>97 Things Every Programmer Should Know</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>NoSql Distilled</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Go</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Others</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="_11-one-task-at-a-time"><a href="#_11-one-task-at-a-time" class="header-anchor">#</a> 11. One Task at a Time</h1> <p>Code that does multiple things at once is harder to understand. A single block of code might be initializing new objects, cleansing data, parsing inputs, and applying business logic, all at the same time. If all that code is woven together, it will be harder to understand than if each “task” is started and completed on its own.</p> <div class="custom-block tip"><p class="custom-block-title">K E Y I D E A</p> <p>Code should be organized so that it’s doing only one task at a time.</p></div> <p>Said another way, this chapter is about “defragmenting” your code. The following diagram illustrates this process: the left side shows the various tasks a piece of code is doing, and the right side shows that same code after it’s been organized to do one task at a time.</p> <p>You might have heard the advice that “functions should do only one thing.” Our advice is similar, but isn’t always about function boundaries. Sure, breaking a large function into multiple smaller functions can be good. But even if you don’t do this, you can still organize the code inside that large function so it feels like there are separate logical sections.</p> <p>Here’s the process we use to make code do “one task at a time”:</p> <ol><li>List out all the “tasks” your code is doing. We use the word “task” very loosely—it could be as small as “make sure this object is valid” or as vague as “iterate through every node in the tree.”</li> <li>Try to separate those tasks as much as you can into different functions or at least different
sections of code.</li></ol> <p>In this chapter, we’ll show you a number of examples of how to do this.</p> <h2 id="tasks-can-be-small"><a href="#tasks-can-be-small" class="header-anchor">#</a> Tasks Can Be Small</h2> <p>Suppose there’s a voting widget on a blog where a user can vote a comment “Up” or “Down.”</p> <p>The total score of a comment is the sum over all votes: +1 for each “Up” vote, –1 for each “Down” vote.</p> <p>Here are the three states a user’s vote can be in, and how it would affect the total score:</p> <p>When the user clicks one of the buttons (to make/change her vote), the following JavaScript is called:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">vote_changed</span><span class="token punctuation">(</span>old_vote<span class="token punctuation">,</span> new_vote<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// each vote is &quot;Up&quot;, &quot;Down&quot;, or &quot;&quot;</span>
</code></pre></div><p>This function updates the total score and works for all combinations of old_vote/new_vote:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> <span class="token function-variable function">vote_changed</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">old_vote<span class="token punctuation">,</span> new_vote</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> score <span class="token operator">=</span> <span class="token function">get_score</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>new_vote <span class="token operator">!==</span> old_vote<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>new_vote <span class="token operator">===</span> <span class="token string">'Up'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            score <span class="token operator">+=</span> <span class="token punctuation">(</span>old_vote <span class="token operator">===</span> <span class="token string">'Down'</span><span class="token operator">?</span> <span class="token number">2</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>new_vote <span class="token operator">===</span> <span class="token string">'Down'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            score <span class="token operator">-=</span> <span class="token punctuation">(</span>old_vote <span class="token operator">===</span> <span class="token string">'Up'</span><span class="token operator">?</span> <span class="token number">2</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>new_vote <span class="token operator">===</span> <span class="token string">''</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            score <span class="token operator">+=</span> <span class="token punctuation">(</span>old_vote <span class="token operator">===</span> <span class="token string">'Up'</span><span class="token operator">?</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token function">set_score</span><span class="token punctuation">(</span>score<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>Even though the code is pretty short, it’s doing a lot. There are lots of intricate details, and it’s hard to tell at a glance whether there are any off-by-one errors, typos, or other bugs.</p> <p>The code may seem to be doing only one thing (updating the score), but there are actually <em>two</em> tasks being performed at once:</p> <ol><li>old_vote and new_vote are being “parsed” into numerical values.</li> <li>score is being updated.</li></ol> <p>We can make the code easier to read by solving each task separately. The following code solves the first task, of parsing the vote into a numerical value:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> <span class="token function-variable function">vote_value</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">vote</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>vote <span class="token operator">===</span> <span class="token string">'Up'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>vote <span class="token operator">===</span> <span class="token string">'Down'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>Now the rest of the code can solve the second task, updating score:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> <span class="token function-variable function">vote_changed</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">old_vote<span class="token punctuation">,</span> new_vote</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> score <span class="token operator">=</span> <span class="token function">get_score</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    score <span class="token operator">-=</span> <span class="token function">vote_value</span><span class="token punctuation">(</span>old_vote<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// remove the old vote</span>
    score <span class="token operator">+=</span> <span class="token function">vote_value</span><span class="token punctuation">(</span>new_vote<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// add the new vote</span>

    <span class="token function">set_score</span><span class="token punctuation">(</span>score<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>As you can see, this version of the code takes a lot less mental effort to convince yourself that it works. That’s a big part of what makes code “easy to understand.”</p> <h2 id="extracting-values-from-an-object"><a href="#extracting-values-from-an-object" class="header-anchor">#</a> Extracting Values from an Object</h2> <p>We once had some JavaScript that formatted a user’s location into a friendly string of <em>“City, Country”</em> like “<em>Santa Monica, USA</em>” or “<em>Paris, France.</em>” We were given a <code>location_info</code> dictionary with plenty of structured information. All we had to do was pick a “ <em>City</em> ” and a “ <em>Country</em> ” from all the fields and concatenate them together.</p> <p>The following illustration shows example input/output:</p> <p>It seems easy so far, but the tricky part is that <em>any or all of these four values might be missing</em>. Here’s how we dealt with that:</p> <ul><li>When choosing the “City,” we preferred to use the “LocalityName” (city/town) if available, then the “SubAdministrativeAreaName” (larger city/county), then the “AdministrativeAreaName” (state/territory).</li> <li>If all three were missing, the “City” was affectionately given the default “Middle-of-Nowhere.”</li> <li>If the “CountryName” was missing, “Planet Earth” was used as a default.</li></ul> <p>The following figure shows two examples of handling missing values.</p> <p>Here is the code we wrote to implement this task:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> place <span class="token operator">=</span> location_info<span class="token punctuation">[</span><span class="token string">&quot;LocalityName&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// e.g. &quot;Santa Monica&quot;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>place<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    place <span class="token operator">=</span> location_info<span class="token punctuation">[</span><span class="token string">&quot;SubAdministrativeAreaName&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// e.g. &quot;Los Angeles&quot;</span>
<span class="token punctuation">}</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>place<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    place <span class="token operator">=</span> location_info<span class="token punctuation">[</span><span class="token string">&quot;AdministrativeAreaName&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// e.g. &quot;California&quot;</span>
<span class="token punctuation">}</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>place<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    place <span class="token operator">=</span> <span class="token string">&quot;Middle-of-Nowhere&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>location_info<span class="token punctuation">[</span><span class="token string">&quot;CountryName&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    place <span class="token operator">+=</span> <span class="token string">&quot;, &quot;</span> <span class="token operator">+</span> location_info<span class="token punctuation">[</span><span class="token string">&quot;CountryName&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// e.g. &quot;USA&quot;</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    place <span class="token operator">+=</span> <span class="token string">&quot;, Planet Earth&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">return</span> place<span class="token punctuation">;</span>
</code></pre></div><p>Sure, it's a little messy, but it got the job done.</p> <p>But a few days later, we needed to improve the functionality: for locations in the United States, we wanted to display the <em>state</em> instead of the country (if possible). So instead of “Santa Monica, USA” it would return “Santa Monica, California.”</p> <p>Adding this feature to the previous code would have made it much uglier.</p> <h3 id="applying-one-task-at-a-time"><a href="#applying-one-task-at-a-time" class="header-anchor">#</a> <strong>Applying “One Task at a Time”</strong></h3> <p>Rather than bend this code to our will, we stopped and realized that it was already doing multiple tasks at the same time:</p> <ol><li>Extracting values from the dictionary location_info</li> <li>Going through a preference order for “City,” defaulting to “Middle-of-Nowhere” if it couldn’t find anything</li> <li>Getting the “Country,” and using “Planet Earth” if there wasn’t one</li> <li>Updating place</li></ol> <p>So instead, we rewrote the original code to solve each of these tasks independently.</p> <p>The first task (extracting values from location_info) was easy to solve on its own:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> town <span class="token operator">=</span> location_info<span class="token punctuation">[</span><span class="token string">&quot;LocalityName&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// e.g. &quot;Santa Monica&quot;</span>
<span class="token keyword">var</span> city <span class="token operator">=</span> location_info<span class="token punctuation">[</span><span class="token string">&quot;SubAdministrativeAreaName&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// e.g. &quot;Los Angeles&quot;</span>
<span class="token keyword">var</span> state <span class="token operator">=</span> location_info<span class="token punctuation">[</span><span class="token string">&quot;AdministrativeAreaName&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// e.g. &quot;CA&quot;</span>
<span class="token keyword">var</span> country <span class="token operator">=</span> location_info<span class="token punctuation">[</span><span class="token string">&quot;CountryName&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// e.g. &quot;USA&quot;</span>
</code></pre></div><p>At this point, we were done using location_info and didn’t have to remember those long and unintuitive keys. Instead, we had four simple variables to work with.</p> <p>Next, we had to figure out what the “second half” of the return value would be:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// Start with the default, and keep overwriting with the most specific value.</span>
<span class="token keyword">var</span> second_half <span class="token operator">=</span> <span class="token string">&quot;Planet Earth&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>country<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    second_half <span class="token operator">=</span> country<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>state <span class="token operator">&amp;&amp;</span> country <span class="token operator">===</span> <span class="token string">&quot;USA&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    second_half <span class="token operator">=</span> state<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Similarly, we could figure out the “first half”:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> first_half <span class="token operator">=</span> <span class="token string">&quot;Middle-of-Nowhere&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>state <span class="token operator">&amp;&amp;</span> country <span class="token operator">!==</span> <span class="token string">&quot;USA&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    first_half <span class="token operator">=</span> state<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>city<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    first_half <span class="token operator">=</span> city<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>town<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    first_half <span class="token operator">=</span> town<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Finally, we pieced the information together:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">return</span> first_half <span class="token operator">+</span> <span class="token string">&quot;, &quot;</span> <span class="token operator">+</span> second_half <span class="token punctuation">;</span>
</code></pre></div><p>The “defragmentation” illustration at the beginning of this chapter was actually a representation of the original solution and this new version. Here’s that same illustration, with more details filled in:</p> <p>As you can see, the four tasks in the second solution have been defragmented into distinct regions.</p> <h3 id="another-approach"><a href="#another-approach" class="header-anchor">#</a> <strong>Another Approach</strong></h3> <p>When refactoring code, there are often multiple ways to do it, and this case is no exception.</p> <p>Once you’ve separated some of the tasks, the code gets easier to think about, and you might come up with even better ways to refactor it.</p> <p>For instance, that earlier series of if statements requires some careful reading to know if every case works correctly. There are actually two subtasks going on simultaneously in that code:</p> <ol><li>Go through a list of variables, and pick the most preferred one that’s available.</li> <li>Use a different list, depending on whether the country is “USA”.</li></ol> <p>Looking back, you can see that the earlier code has the “if USA” logic interwoven with the rest of the logic. Instead, we can handle the USA and non-USA cases separately:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> first_half<span class="token punctuation">,</span> second_half<span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>country <span class="token operator">===</span> <span class="token string">&quot;USA&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    first_half <span class="token operator">=</span> town <span class="token operator">||</span> city <span class="token operator">||</span> <span class="token string">&quot;Middle-of-Nowhere&quot;</span><span class="token punctuation">;</span>
    second_half <span class="token operator">=</span> state <span class="token operator">||</span> <span class="token string">&quot;USA&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    first_half <span class="token operator">=</span> town <span class="token operator">||</span> city <span class="token operator">||</span> state <span class="token operator">||</span> <span class="token string">&quot;Middle-of-Nowhere&quot;</span><span class="token punctuation">;</span>
    second_half <span class="token operator">=</span> country <span class="token operator">||</span> <span class="token string">&quot;Planet Earth&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">return</span> first_half <span class="token operator">+</span> <span class="token string">&quot;, &quot;</span> <span class="token operator">+</span> second_half<span class="token punctuation">;</span>
</code></pre></div><p>In case you aren’t familiar with JavaScript, <code>a || b || c</code> is idiomatic and evaluates to the first “truthy” value (in this case, a defined, nonempty string). This code has the benefit that it’s very easy to inspect the preference list and update it. Most of the if statements have been swept away, and the business logic is represented by fewer lines of code.</p> <h2 id="a-larger-example"><a href="#a-larger-example" class="header-anchor">#</a> A Larger Example</h2> <p>In a web-crawling system we built, a function named <code>UpdateCounts()</code> was called to increment various statistics after each web page was downloaded:</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">void</span> <span class="token function">UpdateCounts</span><span class="token punctuation">(</span>HttpDownload hd<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    counts<span class="token punctuation">[</span><span class="token string">&quot;Exit State&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">[</span> hd<span class="token punctuation">.</span><span class="token function">exit_state</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">]</span><span class="token operator">++</span><span class="token punctuation">;</span> <span class="token comment">// e.g. &quot;SUCCESS&quot; or &quot;FAILURE&quot;</span>
    counts<span class="token punctuation">[</span><span class="token string">&quot;Http Response&quot;</span><span class="token punctuation">]</span><span class="token punctuation">[</span> hd<span class="token punctuation">.</span><span class="token function">http_response</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">]</span><span class="token operator">++</span><span class="token punctuation">;</span> <span class="token comment">// e.g. &quot;404 NOT FOUND&quot;</span>
    counts<span class="token punctuation">[</span><span class="token string">&quot;Content-Type&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">[</span> hd<span class="token punctuation">.</span><span class="token function">content_type</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">]</span><span class="token operator">++</span><span class="token punctuation">;</span> <span class="token comment">// e.g. &quot;text/html&quot;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Well, that’s how we <em>wish</em> the code looked!</p> <p>In actuality, the <code>HttpDownload</code> object had none of the methods shown here. Instead, <code>HttpDownload</code> was a very large and complex class, with many nested classes, and we had to fish out those values ourselves. To make matters worse, sometimes those values were missing altogether—in which case we just used &quot;unknown&quot; as the default value.</p> <p>Because of all this, the real code was quite a mess:</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token comment">// WARNING: DO NOT STARE DIRECTLY AT THIS CODE FOR EXTENDED PERIODS OF TIME.</span>
<span class="token keyword">void</span> <span class="token function">UpdateCounts</span><span class="token punctuation">(</span>HttpDownload hd<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Figure out the Exit State, if available.</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>hd<span class="token punctuation">.</span><span class="token function">has_event_log</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token operator">!</span>hd<span class="token punctuation">.</span><span class="token function">event_log</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">has_exit_state</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        counts<span class="token punctuation">[</span><span class="token string">&quot;Exit State&quot;</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">&quot;unknown&quot;</span><span class="token punctuation">]</span><span class="token operator">++</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        string state_str <span class="token operator">=</span> <span class="token function">ExitStateTypeName</span><span class="token punctuation">(</span>hd<span class="token punctuation">.</span><span class="token function">event_log</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">exit_state</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        counts<span class="token punctuation">[</span><span class="token string">&quot;Exit State&quot;</span><span class="token punctuation">]</span><span class="token punctuation">[</span>state_str<span class="token punctuation">]</span><span class="token operator">++</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// If there are no HTTP headers at all, use &quot;unknown&quot; for the remaining elements.</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>hd<span class="token punctuation">.</span><span class="token function">has_http_headers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        counts<span class="token punctuation">[</span><span class="token string">&quot;Http Response&quot;</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">&quot;unknown&quot;</span><span class="token punctuation">]</span><span class="token operator">++</span><span class="token punctuation">;</span>
        counts<span class="token punctuation">[</span><span class="token string">&quot;Content-Type&quot;</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">&quot;unknown&quot;</span><span class="token punctuation">]</span><span class="token operator">++</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    HttpHeaders headers <span class="token operator">=</span> hd<span class="token punctuation">.</span><span class="token function">http_headers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Log the HTTP response, if known, otherwise log &quot;unknown&quot;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>headers<span class="token punctuation">.</span><span class="token function">has_response_code</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        counts<span class="token punctuation">[</span><span class="token string">&quot;Http Response&quot;</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">&quot;unknown&quot;</span><span class="token punctuation">]</span><span class="token operator">++</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        string code <span class="token operator">=</span> <span class="token function">StringPrintf</span><span class="token punctuation">(</span><span class="token string">&quot;%d&quot;</span><span class="token punctuation">,</span> headers<span class="token punctuation">.</span><span class="token function">response_code</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        counts<span class="token punctuation">[</span><span class="token string">&quot;Http Response&quot;</span><span class="token punctuation">]</span><span class="token punctuation">[</span>code<span class="token punctuation">]</span><span class="token operator">++</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// Log the Content-Type if known, otherwise log &quot;unknown&quot;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>headers<span class="token punctuation">.</span><span class="token function">has_content_type</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        counts<span class="token punctuation">[</span><span class="token string">&quot;Content-Type&quot;</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">&quot;unknown&quot;</span><span class="token punctuation">]</span><span class="token operator">++</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        string content_type <span class="token operator">=</span> <span class="token function">ContentTypeMime</span><span class="token punctuation">(</span>headers<span class="token punctuation">.</span><span class="token function">content_type</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        counts<span class="token punctuation">[</span><span class="token string">&quot;Content-Type&quot;</span><span class="token punctuation">]</span><span class="token punctuation">[</span>content_type<span class="token punctuation">]</span><span class="token operator">++</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>As you can see, there’s a lot of code, and a lot of logic, and even a few repeated lines of code. This code is not fun to read.</p> <p>In particular, this code switches back and forth between different tasks. Here are the different tasks interleaved throughout the code:</p> <ol><li>Using &quot;<code>unknown</code>&quot; as the default value for each key</li> <li>Detecting whether members of <code>HttpDownload</code> are missing</li> <li>Extracting the value and converting it to a string</li> <li>Updating <code>counts[]</code></li></ol> <p>We can improve the code by separating some of these tasks into distinct regions in the code:</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">void</span> <span class="token class-name">UpdateCounts</span><span class="token punctuation">(</span><span class="token class-name">HttpDownload</span> hd<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Task: define default values for each of the values we want to extract</span>
    string exit_state <span class="token operator">=</span> <span class="token string">&quot;unknown&quot;</span><span class="token punctuation">;</span>
    string http_response <span class="token operator">=</span> <span class="token string">&quot;unknown&quot;</span><span class="token punctuation">;</span>
    string content_type <span class="token operator">=</span> <span class="token string">&quot;unknown&quot;</span><span class="token punctuation">;</span>

    <span class="token comment">// Task: try to extract each value from HttpDownload, one by one</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>hd<span class="token punctuation">.</span><span class="token function">has_event_log</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> hd<span class="token punctuation">.</span><span class="token function">event_log</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">has_exit_state</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        exit_state <span class="token operator">=</span> <span class="token class-name">ExitStateTypeName</span><span class="token punctuation">(</span>hd<span class="token punctuation">.</span><span class="token function">event_log</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">exit_state</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>hd<span class="token punctuation">.</span><span class="token function">has_http_headers</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> hd<span class="token punctuation">.</span><span class="token function">http_headers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">has_response_code</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        http_response <span class="token operator">=</span> <span class="token class-name">StringPrintf</span><span class="token punctuation">(</span><span class="token string">&quot;%d&quot;</span><span class="token punctuation">,</span> hd<span class="token punctuation">.</span><span class="token function">http_headers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">response_code</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>hd<span class="token punctuation">.</span><span class="token function">has_http_headers</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> hd<span class="token punctuation">.</span><span class="token function">http_headers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">has_content_type</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        content_type <span class="token operator">=</span> <span class="token class-name">ContentTypeMime</span><span class="token punctuation">(</span>hd<span class="token punctuation">.</span><span class="token function">http_headers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">content_type</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// Task: update counts[]</span>
    counts<span class="token punctuation">[</span><span class="token string">&quot;Exit State&quot;</span><span class="token punctuation">]</span><span class="token punctuation">[</span>exit_state<span class="token punctuation">]</span><span class="token operator">++</span><span class="token punctuation">;</span>
    counts<span class="token punctuation">[</span><span class="token string">&quot;Http Response&quot;</span><span class="token punctuation">]</span><span class="token punctuation">[</span>http_response<span class="token punctuation">]</span><span class="token operator">++</span><span class="token punctuation">;</span>
    counts<span class="token punctuation">[</span><span class="token string">&quot;Content-Type&quot;</span><span class="token punctuation">]</span><span class="token punctuation">[</span>content_type<span class="token punctuation">]</span><span class="token operator">++</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>As you can see, the code has three separate regions with the following aims:</p> <ol><li>Define defaults for the three keys we are interested in.</li> <li>Extract the values, if available, for each of these keys, and convert them to strings.</li> <li>Update <code>counts[]</code> for each key/value.</li></ol> <p>What’s good about these regions is that they’re <em>isolated</em> from one another—while you’re reading one region, you don’t need to think about the other regions.</p> <p>Note that although we listed four tasks, we were able to separate only three of them. That’s perfectly fine: the tasks you list initially are just a starting point. Even separating <em>some</em> of them can help things a lot, as it did here.</p> <h3 id="further-improvements"><a href="#further-improvements" class="header-anchor">#</a> <strong>Further Improvements</strong></h3> <p>This new version of the code is a marked improvement from the original monstrosity. And notice that we didn’t even have to create other functions to perform this cleanup. As we mentioned before, the idea of “one task at a time” can help you clean up code regardless of function boundaries.</p> <p>However, we could also have improved this code another way, by introducing three helper functions:</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token keyword">void</span> <span class="token function">UpdateCounts</span><span class="token punctuation">(</span>HttpDownload hd<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    counts<span class="token punctuation">[</span><span class="token string">&quot;Exit State&quot;</span><span class="token punctuation">]</span><span class="token punctuation">[</span> <span class="token function">ExitState</span><span class="token punctuation">(</span>hd<span class="token punctuation">)</span> <span class="token punctuation">]</span><span class="token operator">++</span><span class="token punctuation">;</span>
    counts<span class="token punctuation">[</span><span class="token string">&quot;Http Response&quot;</span><span class="token punctuation">]</span><span class="token punctuation">[</span> <span class="token function">HttpResponse</span><span class="token punctuation">(</span>hd<span class="token punctuation">)</span> <span class="token punctuation">]</span><span class="token operator">++</span><span class="token punctuation">;</span>
    counts<span class="token punctuation">[</span><span class="token string">&quot;Content-Type&quot;</span><span class="token punctuation">]</span><span class="token punctuation">[</span> <span class="token function">ContentType</span><span class="token punctuation">(</span>hd<span class="token punctuation">)</span> <span class="token punctuation">]</span><span class="token operator">++</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>These functions would extract the corresponding value, or return “unknown”. For example:</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code>string <span class="token function">ExitState</span> <span class="token punctuation">(</span>HttpDownload hd<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>hd<span class="token punctuation">.</span><span class="token function">has_event_log</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> hd<span class="token punctuation">.</span><span class="token function">event_log</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">has_exit_state</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">ExitStateTypeName</span><span class="token punctuation">(</span>hd<span class="token punctuation">.</span><span class="token function">event_log</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">exit_state</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">&quot;unknown&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Notice that this alternative solution doesn’t even define any variables! As we mentioned in Chapter 9, <em>Variables and Readability</em> , variables that hold intermediate results can often be eliminated entirely.</p> <p>In this solution, we’ve simply “sliced” the problem in a different direction. Both solutions are highly readable, as they require the reader to think about only one task at a time.</p> <h2 id="summary"><a href="#summary" class="header-anchor">#</a> Summary</h2> <p>This chapter illustrates a simple technique for organizing your code: <strong>do only one task at a time</strong>.</p> <p>If you have code that’s difficult to read, try to list all of the tasks it’s doing. Some of these tasks might easily become separate functions (or classes). Others might just become logical “paragraphs” within a single function. The exact details of how you separate these tasks isn’t as important as the fact that they’re separated. The hard part is accurately describing all the little things your program is doing.</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/docs/kungfu/artofcode/c10.html" class="prev">
        10. Extracting Unrelated Subproblems
      </a></span> <span class="next"><a href="/docs/kungfu/artofcode/c12.html">
        12. Turning Thoughts into Code
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----><!----><!----></div></div>
    <script src="/docs/assets/js/app.c492483c.js" defer></script><script src="/docs/assets/js/2.856a8128.js" defer></script><script src="/docs/assets/js/289.ab4a1a17.js" defer></script><script src="/docs/assets/js/36.391a9f77.js" defer></script>
  </body>
</html>
