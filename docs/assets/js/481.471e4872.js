(window.webpackJsonp=window.webpackJsonp||[]).push([[481],{1715:function(e,s,t){"use strict";t.r(s);var o=t(7),a=Object(o.a)({},(function(){var e=this,s=e.$createElement,t=e._self._c||s;return t("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[t("h1",{attrs:{id:"node-module-resolution"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#node-module-resolution"}},[e._v("#")]),e._v(" Node Module Resolution")]),e._v(" "),t("h2",{attrs:{id:"core-modules"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#core-modules"}},[e._v("#")]),e._v(" Core modules")]),e._v(" "),t("p",[e._v("First, Node.js checks if your import is a core Node.js module, anything like, "),t("code",[e._v("os")]),e._v(", "),t("code",[e._v("node:asserts")]),e._v(", "),t("code",[e._v("fs")]),e._v(", etc.")]),e._v(" "),t("div",{staticClass:"language-js extra-class"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("import")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v(" join "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("from")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[e._v("'node:path'")]),e._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("import")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v(" writeFile "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("from")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[e._v("'fs'")]),e._v("\n")])])]),t("h2",{attrs:{id:"relative-modules"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#relative-modules"}},[e._v("#")]),e._v(" Relative modules")]),e._v(" "),t("ul",[t("li",[e._v("Secondly, Node.js checks if our imports start with "),t("code",[e._v("/")]),e._v(", "),t("code",[e._v("./")]),e._v(", or "),t("code",[e._v("../")]),e._v(". If it does, Node.js checks this path for files and directories and treats the import as a path.")]),e._v(" "),t("li",[e._v("If the path starts, "),t("code",[e._v("/")]),e._v(" Node.js will look for the module from the root of our file system.")]),e._v(" "),t("li",[e._v("If the path begins with "),t("code",[e._v("./")]),e._v(" of "),t("code",[e._v("../")]),e._v(" Node.js will search for the module relative to the current file's location.")])]),e._v(" "),t("p",[e._v("Let's say we are trying to import this module:")]),e._v(" "),t("div",{staticClass:"language-js extra-class"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("import")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v(" bar "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("from")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[e._v("'./foo'")]),e._v("\n")])])]),t("p",[e._v("Node.js will run the following checks "),t("strong",[e._v("import note")]),e._v(" that if one of these checks passes, the Node.js will not continue to the next steps")]),e._v(" "),t("ol",[t("li",[e._v("if "),t("code",[e._v("foo")]),e._v(" exists, execute by file extension. In this case, Node.js will throw an "),t("code",[e._v("ERR_UNKNOWN_FILE_EXTENSION")]),e._v(" because foo doesn't have any file extension.")]),e._v(" "),t("li",[e._v("if "),t("code",[e._v("foo.js")]),e._v(" exists, executes as a javascript module")]),e._v(" "),t("li",[e._v("if "),t("code",[e._v("foo.json")]),e._v(" exists, parses json, and returns JS object")]),e._v(" "),t("li",[e._v("if "),t("code",[e._v("foo.node")]),e._v(" exists, runs as a "),t("a",{attrs:{href:"https://nodejs.org/api/addons.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("binary add-on"),t("OutboundLink")],1),e._v(".")]),e._v(" "),t("li",[e._v("if "),t("code",[e._v("foo/package.json")]),e._v(" Node.JS will search for the main field. If present, Node.js will run steps 1–4 and 6–8 for the given path in "),t("code",[e._v("main")])]),e._v(" "),t("li",[e._v("if "),t("code",[e._v("foo/index.js")]),e._v(" exists, executes as a javascript module")]),e._v(" "),t("li",[e._v("if "),t("code",[e._v("foo/index.json")]),e._v(" exists, parse json, and rerun object")]),e._v(" "),t("li",[e._v("if "),t("code",[e._v("foo/index.node")]),e._v(" exists, runs as a binary add-on.")])]),e._v(" "),t("p",[e._v("If everything fails, Nodejs will throw "),t("code",[e._v("ERR_MODULE_NOT_FOUND")])]),e._v(" "),t("h2",{attrs:{id:"alias-modules"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#alias-modules"}},[e._v("#")]),e._v(" Alias Modules")]),e._v(" "),t("p",[e._v("Thirdly Node.js checks if our imports start with "),t("code",[e._v("#")]),e._v(". This import is like an alias to other files in our project, like the "),t("a",{attrs:{href:"https://webpack.js.org/configuration/resolve/",target:"_blank",rel:"noopener noreferrer"}},[e._v("Webpack alias"),t("OutboundLink")],1),e._v(" or "),t("a",{attrs:{href:"https://www.typescriptlang.org/tsconfig/#paths",target:"_blank",rel:"noopener noreferrer"}},[e._v("TypeScript path"),t("OutboundLink")],1),e._v(".")]),e._v(" "),t("p",[e._v("In general, you can define an alias that starts with # to a given path in your project")]),e._v(" "),t("div",{staticClass:"language-json extra-class"},[t("pre",{pre:!0,attrs:{class:"language-json"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n    "),t("span",{pre:!0,attrs:{class:"token property"}},[e._v('"name"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"my-site"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n    "),t("span",{pre:!0,attrs:{class:"token property"}},[e._v('"imports"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n        "),t("span",{pre:!0,attrs:{class:"token property"}},[e._v('"#foo"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"bar.js"')]),e._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n")])])]),t("p",[e._v("When Node.js resolve an import like this, it starts to go through all the parent folders of the current file and process the first package.json it finds")]),e._v(" "),t("p",[e._v("Given this directory tree")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("├── worspace/\n    └── package.json\n    ├── app-1/\n    |   ├── package.json\n    |   └── index.js\n    └── app-2/\n        └── index.js\n")])])]),t("ul",[t("li",[e._v("If we will run node "),t("code",[e._v("workspace/app-1/index.js")]),e._v(" Node.js will process only the "),t("code",[e._v("package.json")]),e._v(" in "),t("code",[e._v("workspace/app-1/pacakge.json")]),e._v(".")]),e._v(" "),t("li",[e._v("But if we will run node "),t("code",[e._v("workspace/app-2/index.js")]),e._v(" Node.js will check the "),t("code",[e._v("package.json")]),e._v(" "),t("code",[e._v("workspace/package.json")])])]),e._v(" "),t("p",[e._v("Let's say we are trying to import this module:")]),e._v(" "),t("div",{staticClass:"language-js extra-class"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("import")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v(" bar "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("from")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[e._v("'#foo'")]),e._v("\n")])])]),t("p",[e._v("Node.js will run the following checks "),t("strong",[e._v("import note")]),e._v(". If one of these checks fails Node.js, it will not continue to the next steps")]),e._v(" "),t("ol",[t("li",[e._v("Scans for the closes "),t("code",[e._v("package.json")])]),e._v(" "),t("li",[e._v("Search for the "),t("code",[e._v("imports")]),e._v(" field")]),e._v(" "),t("li",[e._v("Return resolved path that is configured. Throw an error that fails to resolve.")])]),e._v(" "),t("h2",{attrs:{id:"self-import-modules"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#self-import-modules"}},[e._v("#")]),e._v(" Self Import Modules")]),e._v(" "),t("p",[e._v("Fourthly, Node.js checks if the imports start with the name of our current scope.")]),e._v(" "),t("p",[e._v("Given this "),t("code",[e._v("package.json")])]),e._v(" "),t("div",{staticClass:"language-json extra-class"},[t("pre",{pre:!0,attrs:{class:"language-json"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n    "),t("span",{pre:!0,attrs:{class:"token property"}},[e._v('"name"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"my-site"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n    "),t("span",{pre:!0,attrs:{class:"token property"}},[e._v('"exports"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n        "),t("span",{pre:!0,attrs:{class:"token property"}},[e._v('"foo"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[e._v('"bar.js"')]),e._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n")])])]),t("p",[e._v("If we try to import "),t("code",[e._v("my-site/foo")]),e._v(". We will run "),t("code",[e._v("bar.js")]),e._v(".")]),e._v(" "),t("div",{staticClass:"language-js extra-class"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("import")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v(" bar "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("from")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[e._v("'my-site/foo'")]),e._v("\n")])])]),t("p",[e._v("The way that Node.js resolve this config is very similar to the resolution algorithm of the imports field. We can still import "),t("code",[e._v("foo")]),e._v(" form anywhere in the project, but instead of starting with "),t("code",[e._v("#")]),e._v(" the import must start this with our package name.")]),e._v(" "),t("h2",{attrs:{id:"node-modules"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#node-modules"}},[e._v("#")]),e._v(" Node Modules")]),e._v(" "),t("p",[e._v("And Finally, if none of our previous checks passed, Node.js will try to resolve the import from the "),t("code",[e._v("node_modules")]),e._v(" directory.")]),e._v(" "),t("p",[e._v("Given this workspace,")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("├── worspace/\n    └── node/\n        └── worspace/\n            └── source.js\n")])])]),t("p",[e._v("Node.js will check the flowing paths to see if they contain "),t("code",[e._v("node_moduels")]),e._v(" directory before throwing an error")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("// checks order\n\n1. /home/node/worspace/node_modules\n2. /home/node/node_modules\n3. /home/node_modules\n4. /node_modules\n")])])]),t("p",[e._v("In general, Node.js will check every parent folder in the tree until they get to the root, meaning every package installed on the roots "),t("code",[e._v("node_modules")]),e._v(" will be available to all the Node.js programs in your machine.")]),e._v(" "),t("p",[e._v("Let's say we import this module.")]),e._v(" "),t("div",{staticClass:"language-js extra-class"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("import")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v(" bar "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("from")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[e._v("'foo'")]),e._v("\n")])])]),t("p",[e._v("Node.js will run the following checks for each parent directory in the tree until the root. "),t("strong",[e._v("import note")]),e._v(" that if one of these checks passes, the Node.js will not continue to the next steps")]),e._v(" "),t("ol",[t("li",[e._v("if "),t("code",[e._v("node_modules/foo/package.json")]),e._v(" exists and has an exports field, resolve the exports field, like in the "),t("strong",[e._v("Self Import Modules")]),e._v(" section but with foo module instead of our workspace")]),e._v(" "),t("li",[e._v("if "),t("code",[e._v("node_modules/foo")]),e._v(" exists run the same file/directory resolving algorithm as in the "),t("strong",[e._v("relative modules")]),e._v(" section")])]),e._v(" "),t("p",[e._v("If everything fails, and Nodejs fails and can't find any modules, it will throw "),t("code",[e._v("ERR_MODULE_NOT_FOUND")]),e._v(".")]),e._v(" "),t("p",[e._v("Given this workspace")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v('/\n├── worspace/\n|   └── foo/\n|       └── index.js\n├── home/\n    └── node/\n        └── worspace/\n            └── node_modules\n            └── source.js <-- IMPORT "foo"\n')])])]),t("p",[e._v("Node.js will check all of these paths when trying to find our module.")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("/home/node/workspace/node_modules/ \n/home/node/node_modules/ \n/home/node_modules/ \n/node_modules/ \n/node_modules/foo/\n/node_modules/foo/index.js\n")])])])])}),[],!1,null,null,null);s.default=a.exports}}]);