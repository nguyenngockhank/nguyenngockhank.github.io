(window.webpackJsonp=window.webpackJsonp||[]).push([[135],{1020:function(e,t,a){e.exports=a.p+"assets/img/be.926c18cc.png"},1656:function(e,t,a){"use strict";a.r(t);var o=a(7),s=Object(o.a)({},(function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[o("h1",{attrs:{id:"designing-online-game"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#designing-online-game"}},[e._v("#")]),e._v(" Designing Online Game")]),e._v(" "),o("p",[e._v("It is crutial to recognize that multiplayer online game need synchronization of their states across various players with the following constraints.")]),e._v(" "),o("ol",[o("li",[e._v("Latency should be minimal.")]),e._v(" "),o("li",[e._v("Minimal bandthwidth taken for synchronization")]),e._v(" "),o("li",[e._v("Less jitter and choppyness in state update")])]),e._v(" "),o("p",[e._v("First lests model our game as bunch of objects (character, scenes elements etc) and each of this object have certian location , orientitaiton and other attribute. All we have to do is to synchronize these object across all the players. Synchronization can be though of a certain server. We can imagine this as a MVC kind of architechure in front end as well as backend. Model is the object states in a game for a player X, Controller running in the Server (validating the state changes) and sending update request to all the other players to update their model (and in turn views of all other players). Most single user Game can be also modelled in MVC kind of pattern.")]),e._v(" "),o("p",[o("strong",[e._v("What should you do to minimize latency:")]),e._v("\nBased on the speed of light and current technology:")]),e._v(" "),o("ul",[o("li",[e._v("it takes atleast 40ms to reach from east to west coast.")]),e._v(" "),o("li",[e._v("75 ms to reach from US to Europe")]),e._v(" "),o("li",[e._v("150 ms from US to Asia")])]),e._v(" "),o("p",[e._v("Hence keeping your user near to the Gaming server is the key for reducing the latency!")]),e._v(" "),o("p",[o("strong",[e._v("Why Do you need a gaming server, can you synchronize the states P2P within the players?")]),e._v(" This is one of the option but it is less secure. Server can act as a AS (authoritative server) to validate the inputs of the user. Remember User can hack the system and some trusted authority must validate the moves. Servers does that")]),e._v(" "),o("p",[o("strong",[e._v("What can you do to reduce the bandthwidth?")])]),e._v(" "),o("p",[e._v("Can we just transmit the actions of each users say in a bitvector of 64 possible actions.? This is a good idea to do as it need very small amout of data. We have to timestamp the data to that we know the sequence in which we have to apply this. So the datastructure is "),o("code",[e._v("<command_bit_vector,timestamp, useid>")]),e._v(" "),o("strong",[e._v("This is called deterministic lockstep")]),e._v(".")]),e._v(" "),o("p",[e._v("The problem is that system state can diverge if some of the "),o("strong",[e._v("action_bitvectors are not applied (in order)")]),e._v(". In this case the system states for all the players can diverge.")]),e._v(" "),o("p",[o("strong",[e._v("State Synchronization")])]),e._v(" "),o("div",{staticClass:"language- extra-class"},[o("pre",{pre:!0,attrs:{class:"language-text"}},[o("code",[e._v("Object_state: <position,orientation,linear velocity, angular velocity>\n")])])]),o("p",[e._v("Synchronize the state of objects. you can recreate the scene just by knowing the state information for the "),o("strong",[e._v("all the objects")]),e._v(" This takes lot of data to synchronized. (Maybe in MB’s). You can do smart encoding to compress.")]),e._v(" "),o("p",[e._v("You can synchronize the state of objects 30 times a second or so.You can still have jitter for inbetween time. You need a prediction module for interpolation")]),e._v(" "),o("p",[o("strong",[e._v("Do I have to use TCP?")])]),e._v(" "),o("p",[e._v("TCP will block the access to packets with id N+1 if the id Nth packet is missing. Retransmission can cause lot of latency for the packet N, untill than the whole game will stall. One solution is to have a playout buffer in which we buffer K packets from the stream and then only apply them smoothly. This is same idea as buffring the movie. (This does introduce some latency due to buffering)")]),e._v(" "),o("p",[e._v("We can also use UDP with redundant information or a relaible UDP (RUDP) for smoother information.")]),e._v(" "),o("p",[o("strong",[e._v("Rules of game:")])]),e._v(" "),o("p",[e._v("you have to do lot of if,else for each state of object. This can make the code messy.")]),e._v(" "),o("p",[o("strong",[e._v("Use state machine rather than if else of code to handle the combination of various state, action pairs in different objects.")])]),e._v(" "),o("p",[e._v("So think object in every object as a state. And for each state you can define the possibley of options and actions. Use State design Pattern for this")]),e._v(" "),o("h2",{attrs:{id:"backend-design"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#backend-design"}},[e._v("#")]),e._v(" Backend Design")]),e._v(" "),o("p",[o("img",{attrs:{src:a(1020),alt:"img"}})]),e._v(" "),o("p",[e._v("Notice we need CDN to distribute the resources (game patches and game installers). CDN is not streaming games like movies because game is a dynamic system")]),e._v(" "),o("p",[o("strong",[e._v("Patch server")]),e._v(" make sure all the player are running the same version of the game.")]),e._v(" "),o("p",[o("strong",[e._v("Login Server")]),e._v(" is doing auth of the user login and password")]),e._v(" "),o("p",[o("strong",[e._v("Loadbalancer + proxy server (API gateway)")])]),e._v(" "),o("p",[e._v("You Need API gateway to terminate the TCP/UDP connection.")]),e._v(" "),o("p",[o("strong",[e._v("WordServers")]),e._v(" is the main server which keeps the complete index mapping of "),o("code",[e._v("<user_id,game_session_id> → Area Game server")])]),e._v(" "),o("p",[o("strong",[e._v("Area Game server")]),e._v(" is serving a region (think geographic region) of a big game area. This help is scalablity as not all players are in same area of the game. So we shard based on geo-location.")]),e._v(" "),o("p",[e._v("Do we have to do static assignment of the region → AreaGame Server or we need dynamic?")]),e._v(" "),o("p",[e._v("Static can waste resouce as it might be that few users are in one area and other area have lot of of users. Maybe do dynamic region assignment (which will be more complex)")]),e._v(" "),o("p",[e._v("Also Area game servers need to pass information of the various player states to the adjecent region Area Game servers.")]),e._v(" "),o("h2",{attrs:{id:"refs"}},[o("a",{staticClass:"header-anchor",attrs:{href:"#refs"}},[e._v("#")]),e._v(" Refs")]),e._v(" "),o("p",[e._v("https://gafferongames.com/")]),e._v(" "),o("iframe",{attrs:{width:"560",height:"315",src:"https://www.youtube.com/embed/EU81tjgoKoI",title:"YouTube video player",frameborder:"0",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share",allowfullscreen:""}}),e._v(" "),o("iframe",{attrs:{width:"560",height:"315",src:"https://www.youtube.com/embed/K3Z1PY2vr3Q",title:"YouTube video player",frameborder:"0",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share",allowfullscreen:""}})])}),[],!1,null,null,null);t.default=s.exports}}]);