(window.webpackJsonp=window.webpackJsonp||[]).push([[402],{1604:function(e,t,a){"use strict";a.r(t);var s=a(7),i=Object(s.a)({},(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[a("h1",{attrs:{id:"design-shopping-cart"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#design-shopping-cart"}},[e._v("#")]),e._v(" Design shopping cart")]),e._v(" "),a("h2",{attrs:{id:"step-1-analyze-the-requirements-and-design-apis"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#step-1-analyze-the-requirements-and-design-apis"}},[e._v("#")]),e._v(" Step 1 - Analyze the requirements and design APIs")]),e._v(" "),a("p",[e._v("A shopping cart needs to support the following core features:")]),e._v(" "),a("ul",[a("li",[e._v("Creating a cart")]),e._v(" "),a("li",[e._v("Viewing a cart")]),e._v(" "),a("li",[e._v("Adding an item to a cart")]),e._v(" "),a("li",[e._v("Viewing items within a cart")])]),e._v(" "),a("p",[e._v("We are defining our resources as cart and item. Below, we’ve outlined the corresponding APIs:")]),e._v(" "),a("ul",[a("li",[e._v("Create a card "),a("code",[e._v("POST /v1/carts")])]),e._v(" "),a("li",[e._v("Viewing a cart "),a("code",[e._v("GET /v1/carts/{cartId}")])]),e._v(" "),a("li",[e._v("Adding an item to a cart "),a("code",[e._v("POST /v1/carts/mine/items")])]),e._v(" "),a("li",[e._v("Viewing items within a cart "),a("code",[e._v("GET /v1/carts/mine/items")])])]),e._v(" "),a("p",[e._v("Note that we use "),a("em",[e._v("mine")]),e._v(" as a special cart identifier because a user has only one shopping cart.")]),e._v(" "),a("p",[e._v("When we add an item to a cart, a Google-style API might specify the verb in the URL, like so:")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("POST /v1/carts/mine/items:add\n")])])]),a("p",[e._v("There are some who aren’t fans of colons in the URLs. In our view, developers should follow their organization’s API specifications. When we all speak the same language, we’re less prone to errors.")]),e._v(" "),a("h2",{attrs:{id:"step-2-optimizations"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#step-2-optimizations"}},[e._v("#")]),e._v(" Step 2 - Optimizations")]),e._v(" "),a("p",[e._v("Consider a shopping cart filled with many items. To enhance our query experience, we’ll introduce filtering, sorting, and pagination.")]),e._v(" "),a("h3",{attrs:{id:"_1-filtering"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-filtering"}},[e._v("#")]),e._v(" 1. Filtering")]),e._v(" "),a("p",[e._v("Let’s think about querying all red items in our cart. Here’s what the API would look like:")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("GET /v1/carts/mine/items?filter=red\n")])])]),a("p",[e._v("Note that we need to be cautious about providing broad filtering capabilities. This could potentially impact performance adversely. As a better alternative, we should offer structured filtering which limits the options to certain parameters like color and weight.")]),e._v(" "),a("p",[e._v("For product search pages, structured filtering becomes even more essential. They require additional filters like price, category, location, and more.")]),e._v(" "),a("h3",{attrs:{id:"_2-sorting"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-sorting"}},[e._v("#")]),e._v(" 2. Sorting")]),e._v(" "),a("p",[e._v("Imagine sorting items in the cart based on when they were added:")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("GET /v1/carts/mine/items?sort_by=time\n")])])]),a("p",[e._v("Similar to filtering, our sorting mechanism is also structured. We provide a set of predefined sorting fields for selection.")]),e._v(" "),a("h3",{attrs:{id:"_3-pagination"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-pagination"}},[e._v("#")]),e._v(" 3. Pagination")]),e._v(" "),a("p",[e._v("When there are more items than a single page can accommodate, we use a technique called "),a("em",[e._v("pagination")]),e._v(". This lets users navigate through pages of items.")]),e._v(" "),a("p",[e._v("There are two popular methods for pagination. They are offset pagination and cursor-based pagination.")]),e._v(" "),a("p",[e._v("Offset pagination works by using a page number and the desired count of results per page as parameters. This gives users the ability to see the total pages and the exact page number. An example could look like this:")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("GET /v1/carts?page={page}&count={count}\n")])])]),a("p",[e._v("The server uses the page and count parameters to calculate the exact offset and limit to request from the database. Implementing this with a relational database is simple. For example, with page = 2 and count = 10, a database query might look like this:")]),e._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("SELECT")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("*")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("FROM")]),e._v(" carts\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("WHERE")]),e._v(" cart_id "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("1234")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("ORDER")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("BY")]),e._v(" item_id "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("DESC")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("LIMIT")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("10")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("OFFSET")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("10")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])]),a("p",[e._v("Offset pagination is simple to implement. It gives the user the ability to jump to a specific page in the dataset.")]),e._v(" "),a("p",[e._v('However, offset pagination does not work well for large datasets. Performance can degrade as it requires the database to scan the table up to "offset + limit" rows. As the offset advances further in the dataset, the database still needs to perform wasteful table scans and discard many rows.')]),e._v(" "),a("p",[e._v("Offset pagination also does not work well for datasets that are being written too frequently. A good example is messages in a busy chat group. High data velocity can lead to duplicates or skipped results.")]),e._v(" "),a("p",[e._v("On the other hand, cursor-based pagination uses a pointer to a specific item. It returns results after that pointer in subsequent requests. This method is based on a unique, sequential column in the table, and it offers advantages in scalability and stability over offset pagination. It doesn't require rescanning the dataset up to the offset for each request.")]),e._v(" "),a("p",[e._v("An example of cursor-based pagination could look like this. It uses "),a("em",[e._v("maxPageSize")]),e._v(" and "),a("em",[e._v("pageToken")]),e._v(".")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("GET /v1/carts?maxPageSize={maxPageSize}&pageToken={pageToken}\n")])])]),a("p",[e._v("Response:")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("{\n    results: [...],   \n    nextPageToken={ xxx }\n}\n")])])]),a("p",[e._v("In the example, "),a("em",[e._v("pageToken")]),e._v(" is the cursor, and "),a("em",[e._v("maxPageSize")]),e._v(" defines the maximum results returned in a response.")]),e._v(" "),a("p",[e._v("Cursor-based pagination addresses the drawbacks of offset-based pagination. It scales well for a large dataset. The cursor points to a specific row on a primary column, and the database can use the index to jump to that specific location quickly, without resorting to a table scan. It also stabilizes the pagination window and it works well for fast-changing dataset. However, cursor-based pagination sacrifices the ability to jump to a specific page.")]),e._v(" "),a("h2",{attrs:{id:"step-3-security"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#step-3-security"}},[e._v("#")]),e._v(" Step 3 - Security")]),e._v(" "),a("p",[e._v("Many shopping carts allow item additions without signing in. This is known as anonymous cart functionality. These public APIs become potential DDoS attack targets. We must guard against attackers adding or removing a large number of items from tens of thousands of PCs, leading to system resource exhaustion.")]),e._v(" "),a("p",[e._v("When designing APIs, it’s crucial to employ appropriate rate-limiting algorithms for DDoS attack prevention. This can be implemented at the firewall or API gateway level. For example, firewalls can reject recurrent requests from a single IP address, while API gateway could limit “add to or remove from shopping cart” requests to 100 per minute.")])])}),[],!1,null,null,null);t.default=i.exports}}]);