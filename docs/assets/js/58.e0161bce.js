(window.webpackJsonp=window.webpackJsonp||[]).push([[58],{1649:function(e,t,a){"use strict";a.r(t);var n=a(7),s=Object(n.a)({},(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[n("h1",{attrs:{id:"design-google-docs"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#design-google-docs"}},[e._v("#")]),e._v(" Design Google Docs")]),e._v(" "),n("h2",{attrs:{id:"introduction"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#introduction"}},[e._v("#")]),e._v(" Introduction")]),e._v(" "),n("h3",{attrs:{id:"gathering-requirements"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#gathering-requirements"}},[e._v("#")]),e._v(" Gathering Requirements")]),e._v(" "),n("p",[n("strong",[e._v("In scope")]),e._v(" The application should be able to support the following requirements. The user\nshould be able to do following tasks")]),e._v(" "),n("ul",[n("li",[e._v("create a document")]),e._v(" "),n("li",[e._v("share a document")]),e._v(" "),n("li",[e._v("edit a document")])]),e._v(" "),n("p",[n("strong",[e._v("Out of scope")])]),e._v(" "),n("ul",[n("li",[e._v("User authentication for accessing the document")]),e._v(" "),n("li",[e._v("User should be able to chat on the document")]),e._v(" "),n("li",[e._v("User should be able to provide edit and view permissions to different users")]),e._v(" "),n("li",[e._v("User should be able to comment on the document")])]),e._v(" "),n("h2",{attrs:{id:"detailed-design"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#detailed-design"}},[e._v("#")]),e._v(" Detailed Design")]),e._v(" "),n("h3",{attrs:{id:"system-architecture"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#system-architecture"}},[e._v("#")]),e._v(" System Architecture")]),e._v(" "),n("p",[n("img",{attrs:{src:a(863),alt:"alt"}}),n("br"),e._v(" "),n("em",[e._v("Figure 10.1: System architecture for Google docs")])]),e._v(" "),n("h2",{attrs:{id:"system-components"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#system-components"}},[e._v("#")]),e._v(" System Components")]),e._v(" "),n("h3",{attrs:{id:"creating-a-document"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#creating-a-document"}},[e._v("#")]),e._v(" Creating a document")]),e._v(" "),n("p",[n("img",{attrs:{src:a(864),alt:"alt"}})]),e._v(" "),n("h3",{attrs:{id:"api-design-document-management-service"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#api-design-document-management-service"}},[e._v("#")]),e._v(" API Design: Document Management service")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("POST /collaborativeEditing/documents\n")])])]),n("p",[n("strong",[e._v("Request body")]),e._v(":")]),e._v(" "),n("ul",[n("li",[n("em",[e._v("Format")]),e._v(": Either html or markdown")]),e._v(" "),n("li",[n("em",[e._v("Content")]),e._v(": The html or markdown content of the new document")]),e._v(" "),n("li",[n("em",[e._v("title")]),e._v(": The title of the new document")]),e._v(" "),n("li",[n("em",[e._v("type")]),e._v(": Either document, spreadsheet or slides")])]),e._v(" "),n("p",[n("strong",[e._v("Sample Response:")]),e._v(" "),n("em",[e._v("documentId")]),e._v(": The url and the identifier to access the document")]),e._v(" "),n("h3",{attrs:{id:"editing-a-document"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#editing-a-document"}},[e._v("#")]),e._v(" Editing a document")]),e._v(" "),n("p",[n("img",{attrs:{src:a(865),alt:"alt"}})]),e._v(" "),n("h3",{attrs:{id:"differential-synchronization"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#differential-synchronization"}},[e._v("#")]),e._v(" Differential Synchronization")]),e._v(" "),n("p",[n("img",{attrs:{src:a(866),alt:"alt"}})]),e._v(" "),n("p",[e._v("The above diagram shows the simplest form of Differential Synchronization. The following walk-through starts with Client Text, Common Shadow and Server Text all being\nequal. Client Text and Server Text may be edited at any time. The goal is to keep these two\ntexts as close as possible with each other at all times.")]),e._v(" "),n("ol",[n("li",[e._v("Client Text is diffed against the Common Shadow.")]),e._v(" "),n("li",[e._v("This returns a list of edits which have been performed on Client Text.")]),e._v(" "),n("li",[e._v("Client Text is copied over to Common Shadow. This copy must be identical to the value of Client Text in step 1, so in a multi-threaded environment a snapshot of the text should have been taken.")]),e._v(" "),n("li",[e._v("The edits are applied to Server Text on a best-effort basis.")]),e._v(" "),n("li",[e._v("Server Text is updated with the result of the patch. Steps 4 and 5 must be atomic, but\nthey do not have to be blocking; they may be repeated until Server Text stays still\nlong enough.")])]),e._v(" "),n("p",[e._v("The process now repeats symmetrically in the other direction. This time the Common\nShadow is the same as Client Text was in the previous half of the synchronization, so the\nresulting diff will return modifications made to Server Text, not the result of the patch in\nstep 5. The enabling feature is that the patch algorithm is fuzzy, meaning patches may be\napplied even if the document has changed. Thus, if the client has typed a few keystrokes in\nthe time that the synchronization took to complete, the patches from the server are likely to\nhave enough recognizable context that they may still be applied successfully. However, if\nsome or all of the patches fail in step 4, they will automatically show up negatively in the\nfollowing diff and will be patched out of the Client Text. Hereâ€™s an example of actual data\nflow.")]),e._v(" "),n("ol",[n("li",[e._v('Client Text, Common Shadow and Server Text start out with the same string: "Macs\nhad the original point and click UI."')]),e._v(" "),n("li",[e._v('Client Text is edited (by the user) to say: "Macintoshes had the original point and\nclick interface." (edits underlined)')]),e._v(" "),n("li",[e._v("The Diff in step 1 returns the following two edits:")])]),e._v(" "),n("div",{staticClass:"language-git extra-class"},[n("pre",{pre:!0,attrs:{class:"language-git"}},[n("code",[n("span",{pre:!0,attrs:{class:"token coord"}},[e._v("@@ -1,11 +1,18 @@")]),e._v("\nMac\n"),n("span",{pre:!0,attrs:{class:"token inserted"}},[e._v("+intoshe")]),e._v("\ns had th\n"),n("span",{pre:!0,attrs:{class:"token coord"}},[e._v("@@ -35,7 +42,14 @@")]),e._v("\nick\n"),n("span",{pre:!0,attrs:{class:"token deleted"}},[e._v("-UI")]),e._v("\n"),n("span",{pre:!0,attrs:{class:"token inserted"}},[e._v("+interface")]),e._v("\n")])])]),n("ol",{attrs:{start:"4"}},[n("li",[e._v('Common Shadow is updated to also say: "Macintoshes had the original point and\nclick interface."')]),e._v(" "),n("li",[e._v('Meanwhile Server Text has been edited (by another user) to say: "Smith Wesson\nhad the original point and click UI." (edits underlined)')]),e._v(" "),n("li",[e._v('In step 4 both edits are patched onto Server Text. The first edit fails since the context\nhas changed too much to insert "intoshe" anywhere meaningful. The second edit\nsucceeds perfectly since the context matches.')]),e._v(" "),n("li",[e._v('results in a Server Text which says: "Smith Wesson had the original point and click\ninterface."')]),e._v(" "),n("li",[e._v("Now the reverse process starts. First the Diff compares Server Text with Common\nShadow and returns the following edit:")])]),e._v(" "),n("div",{staticClass:"language-git extra-class"},[n("pre",{pre:!0,attrs:{class:"language-git"}},[n("code",[n("span",{pre:!0,attrs:{class:"token coord"}},[e._v("@@ -1,15 +1,18 @@")]),e._v("\n"),n("span",{pre:!0,attrs:{class:"token deleted"}},[e._v("-Macintoshes")]),e._v("\n"),n("span",{pre:!0,attrs:{class:"token inserted"}},[e._v("+Smith & Wesson")]),e._v("\nhad\n")])])]),n("ol",{attrs:{start:"9"}},[n("li",[e._v('Finally, this patch is applied to Client Text, thus backing out the failed "Macs" ->\n"Macintoshes" edit and replacing it with "Smith Wesson". The "UI" -> "interface"\nedit is left untouched. Any changes which have been made to Client Text in the\nmeantime will be patched around and incorporated into the next synchronization\ncycle.')])]),e._v(" "),n("h3",{attrs:{id:"api-design-edit-patch-service"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#api-design-edit-patch-service"}},[e._v("#")]),e._v(" API Design: Edit Patch Service")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("POST /collaborativeEditing/documents/<document_id>/section/<section_id>\n")])])]),n("p",[n("strong",[e._v("Request Body")]),e._v(":")]),e._v(" "),n("ul",[n("li",[n("em",[e._v("format")]),e._v(": Either HTML or markdown")]),e._v(" "),n("li",[n("em",[e._v("diff_content")]),e._v(": the difference between client text and shadow")]),e._v(" "),n("li",[n("em",[e._v("type")]),e._v(": Either document, spreadsheet or slides")])]),e._v(" "),n("p",[n("strong",[e._v("Sample response:")]),e._v(" responsecode: 2xx, 5xx, 4xx")]),e._v(" "),n("h3",{attrs:{id:"api-design-document-management-service-2"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#api-design-document-management-service-2"}},[e._v("#")]),e._v(" API Design: document management service")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("POST /collaborativeEditing/documents/<document_id>/section/<section_id>\n")])])]),n("p",[n("strong",[e._v("Request Body:")])]),e._v(" "),n("ul",[n("li",[n("em",[e._v("format")]),e._v(": Either HTML or markdown")]),e._v(" "),n("li",[n("em",[e._v("diff_content")]),e._v(": the difference between client text and shadow")]),e._v(" "),n("li",[n("em",[e._v("type")]),e._v(": Either document, spreadsheet or slides")]),e._v(" "),n("li",[n("em",[e._v("location")]),e._v(": Where we insert the new content. Defaults to : "),n("code",[e._v("APPEND")]),e._v(".")])]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("0: APPEND - Append to the end of the document.\n1: PREPEND - Prepend to the beginning of the document.\n2: AFTER_SECTION - Insert after the section specified by section_id.\n3: BEFORE_SECTION - Insert before the section specified by section_id.\n4: REPLACE_SECTION - Delete the section specified by section_id and insert the new content at that location.\n5: DELETE_SECTION - Delete the section specified by section_id (no content required).\n")])])]),n("p",[n("strong",[e._v("Sample response:")]),e._v(" responsecode: 2xx, 5xx, 4xx")]),e._v(" "),n("h2",{attrs:{id:"data-mode"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#data-mode"}},[e._v("#")]),e._v(" Data Mode")]),e._v(" "),n("p",[e._v("We will use a key-value data store to store the document information.")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[e._v("{\n    documentId(HK): String\n    authorId: String,\n    title: String,\n    type: Enum(Document, Slide, Spreadsheet),\n    content: Map<String, SectionContent>\n}\n")])])]),n("p",[e._v("For example, an entry in this map will be "),n("code",[e._v("<UUID_1, {content: String, type: Enum (Document, Slide, Spreadsheet)}")])])])}),[],!1,null,null,null);t.default=s.exports},863:function(e,t,a){e.exports=a.p+"assets/img/57.3c1228bb.png"},864:function(e,t,a){e.exports=a.p+"assets/img/58.8b7c46f0.png"},865:function(e,t,a){e.exports=a.p+"assets/img/59.a9093b01.png"},866:function(e,t,a){e.exports=a.p+"assets/img/60.9b2dde92.png"}}]);