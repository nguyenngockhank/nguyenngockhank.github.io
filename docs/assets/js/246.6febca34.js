(window.webpackJsonp=window.webpackJsonp||[]).push([[246],{824:function(t,e,a){"use strict";a.r(e);var o=a(7),n=Object(o.a)({},(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"buildingmicroservices"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#buildingmicroservices"}},[t._v("#")]),t._v(" Building\tMicroservices")]),t._v(" "),a("h1",{attrs:{id:"preface"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#preface"}},[t._v("#")]),t._v(" Preface")]),t._v(" "),a("p",[t._v("Microservices\tare\tan\tapproach\tto\tdistributed\tsystems\tthat\tpromote\tthe\tuse\tof\tfinely\ngrained\tservices\twith\ttheir\town\tlifecycles,\twhich\tcollaborate\ttogether.\tBecause\nmicroservices\tare\tprimarily\tmodeled\taround\tbusiness\tdomains,\tthey\tavoid\tthe\tproblems\tof\ntraditional\ttiered\tarchitectures.\tMicroservices\talso\tintegrate\tnew\ttechnologies\tand\ntechniques\tthat\thave\temerged\tover\tthe\tlast\tdecade,\twhich\thelps\tthem\tavoid\tthe\tpitfalls\tof\nmany\tservice-oriented\tarchitecture\timplementations.")]),t._v(" "),a("p",[t._v("This\tbook\tis\tfull\tof\tconcrete\texamples\tof\tmicroservice\tuse\taround\tthe\tworld,\tincluding\tin\norganizations\tlike\tNetflix,\tAmazon,\tGilt,\tand\tthe\tREA\tgroup,\twho\thave\tall\tfound\tthat\tthe\nincreased\tautonomy\tthis\tarchitecture\tgives\ttheir\tteams\tis\ta\thuge\tadvantage.")]),t._v(" "),a("h2",{attrs:{id:"whoshouldreadthisbook"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#whoshouldreadthisbook"}},[t._v("#")]),t._v(" Who\tShould\tRead\tThis\tBook")]),t._v(" "),a("p",[t._v("The\tscope\tof\tthis\tbook\tis\tbroad,\tas\tthe\timplications\tof\tfine-grained\tmicroservice\narchitectures\tare\talso\tbroad.\tAs\tsuch,\tit\tshould\tappeal\tto\tpeople\tinterested\tin\taspects\tof\ndesign,\tdevelopment,\tdeployment,\ttesting,\tand\tmaintenance\tof\tsystems.\tThose\tof\tyou\twho\nhave\talready\tembarked\ton\tthe\tjourney\ttoward\tfiner-grained\tarchitectures,\twhether\tfor\ta\ngreenfield\tapplication\tor\tas\tpart\tof\tdecomposing\tan\texisting,\tmore\tmonolithic\tsystem,\twill\nfind\tplenty\tof\tpractical\tadvice\tto\thelp\tyou.\tIt\twill\talso\thelp\tthose\tof\tyou\twho\twant\tto\tknow\nwhat\tall\tthe\tfuss\tis\tabout,\tso\tthat\tyou\tcan\tdetermine\twhether\tmicroservices\tare\tright\tfor\nyou.")]),t._v(" "),a("h2",{attrs:{id:"whyiwrotethisbook"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#whyiwrotethisbook"}},[t._v("#")]),t._v(" Why\tI\tWrote\tThis\tBook")]),t._v(" "),a("p",[t._v("I\tstarted\tthinking\tabout\tthe\ttopic\tof\tapplication\tarchitectures\tmany\tyears\tago,\twhen\nworking\tto\thelp\tpeople\tdeliver\ttheir\tsoftware\tfaster.\tI\trealized\tthat\twhile\tinfrastructure\nautomation,\ttesting,\tand\tcontinuous\tdelivery\ttechniques\tcould\thelp,\tif\tthe\tfundamental\ndesign\tof\tthe\tsystem\tdoesn’t\tmake\tit\teasy\tto\tmake\tchanges,\tthen\tthere\tare\tlimits\tto\twhat\ncan\tbe\taccomplished.")]),t._v(" "),a("p",[t._v("At\tthe\tsame\ttime,\tmany\torganizations\twere\texperimenting\twith\tfiner-grained\tarchitectures\nto\taccomplish\tsimilar\tgoals,\tbut\talso\tto\tachieve\tthings\tlike\timproved\tscaling,\tincreasing\nautonomy\tof\tteams,\tor\tto\tmore\teasily\tembrace\tnew\ttechnologies.\tMy\town\texperiences,\tas\nwell\tas\tthose\tof\tmy\tcolleagues\tat\tThoughtWorks\tand\telsewhere,\treinforced\tthe\tfact\tthat\nusing\tlarger\tnumbers\tof\tservices\twith\ttheir\town\tindependent\tlifecycles\tresulted\tin\tmore\nheadaches\tthat\thad\tto\tbe\tdealt\twith.\tIn\tmany\tways,\tthis\tbook\twas\timagined\tas\ta\tone-stop\nshop\tthat\twould\thelp\tencompass\tthe\twide\tvariety\tof\ttopics\tthat\tare\tnecessary\tfor\nunderstanding\tmicroservices\t—\tsomething\tthat\twould\thave\thelped\tme\tgreatly\tin\tthe\tpast!")]),t._v(" "),a("h2",{attrs:{id:"awordonmicroservicestoday"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#awordonmicroservicestoday"}},[t._v("#")]),t._v(" A\tWord\ton\tMicroservices\tToday")]),t._v(" "),a("p",[t._v("Microservices\tis\ta\tfast-moving\ttopic.\tAlthough\tthe\tidea\tis\tnot\tnew\t(even\tif\tthe\tterm\titself\nis),\texperiences\tfrom\tpeople\tall\tover\tthe\tworld,\talong\twith\tthe\temergence\tof\tnew\ntechnologies,\tare\thaving\ta\tprofound\teffect\ton\thow\tthey\tare\tused.\tDue\tto\tthe\tfast\tpace\tof\nchange,\tI\thave\ttried\tto\tfocus\tthis\tbook\ton\tideas\tmore\tthan\tspecific\ttechnologies,\tknowing\nthat\timplementation\tdetails\talways\tchange\tfaster\tthan\tthe\tthoughts\tbehind\tthem.\nNonetheless,\tI\tfully\texpect\tthat\tin\ta\tfew\tyears\tfrom\tnow\twe’ll\thave\tlearned\teven\tmore\nabout\twhere\tmicroservices\tfit,\tand\thow\tto\tuse\tthem\twell.")]),t._v(" "),a("p",[t._v("So\twhile\tI\thave\tdone\tmy\tbest\tto\tdistill\tout\tthe\tessence\tof\tthe\ttopic\tin\tthis\tbook,\tif\tthis\ntopic\tinterests\tyou,\tbe\tprepared\tfor\tmany\tyears\tof\tcontinuous\tlearning\tto\tkeep\ton\ttop\tof\nthe\tstate\tof\tthe\tart!")]),t._v(" "),a("h2",{attrs:{id:"navigatingthisbook"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#navigatingthisbook"}},[t._v("#")]),t._v(" Navigating\tThis\tBook")]),t._v(" "),a("p",[t._v("This\tbook\tis\tprimarily\torganized\tin\ta\ttopic-based\tformat.\tAs\tsuch,\tyou\tmay\twant\tto\tjump\ninto\tthe\tspecific\ttopics\tthat\tinterest\tyou\tthe\tmost.\tWhile\tI\thave\tdone\tmy\tbest\tto\treference\nterms\tand\tideas\tin\tthe\tearlier\tchapters,\tI’d\tlike\tto\tthink\tthat\teven\tpeople\twho\tconsider\nthemselves\tfairly\texperienced\twill\tfind\tsomething\tof\tinterest\tin\tall\tchapters\there.\tI\twould\ncertainly\tsuggest\tthat\tyou\ttake\ta\tlook\tat\tChapter\t2,\twhich\ttouches\ton\tthe\tbreadth\tof\tthe\ntopic\tas\twell\tas\tproviding\tsome\tframing\tfor\thow\tI\tgo\tabout\tthings\tin\tcase\tif\tyou\twant\tto\ndive\tdeeper\tinto\tsome\tof\tthe\tlater\ttopics.")]),t._v(" "),a("p",[t._v("For\tpeople\tnew\tto\tthe\tsubject,\tI’ve\tstructured\tthe\tchapters\tin\ta\tway\tthat\tI\thope\twill\tmake\nsense\tto\tread\tfrom\tbeginning\tto\tend.")]),t._v(" "),a("p",[t._v("Here\tis\tan\toverview\tof\twhat\twe\tcover:")]),t._v(" "),a("p",[a("em",[t._v("Chapter\t1,\tMicroservices")])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("We’ll\tbegin\twith\tan\tintroduction\tto\tmicroservices,\tincluding\tthe\tkey\tbenefits\tas\twell\nas\tsome\tof\tthe\tdownsides.\n")])])]),a("p",[a("em",[t._v("Chapter\t2,\tThe\tEvolutionary\tArchitect")])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("This\tchapter\tdiscusses\tthe\tdifficulties\twe\tface\tin\tterms\tof\tmaking\ttrade-offs\tas\narchitects,\tand\tcovers\tspecifically\tjust\thow\tmany\tthings\twe\tneed\tto\tthink\tabout\twith\nmicroservices.\n")])])]),a("p",[a("em",[t._v("Chapter\t3,\tHow\tto\tModel\tServices")])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("Here\twe’ll\tstart\tto\tdefine\tthe\tboundary\tof\tmicroservices,\tusing\ttechniques\tfrom\ndomain-driven\tdesign\tto\thelp\tfocus\tour\tthinking.\n")])])]),a("p",[a("em",[t._v("Chapter\t4,\tIntegration")])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("This\tis\twhere\twe\tstart\tgetting\ta\tbit\tdeeper\tinto\tspecific\ttechnology\timplications,\tas\nwe\tdiscuss\twhat\tsorts\tof\tservice\tcollaboration\ttechniques\twill\thelp\tus\tmost.\tWe’ll\nalso\tdelve\tinto\tthe\ttopic\tof\tuser\tinterfaces\tand\tintegrating\twith\tlegacy\tand\ncommercial\toff-the-shelf\t(COTS)\tproducts.\n")])])]),a("p",[a("em",[t._v("Chapter\t5,\tSplitting\tthe\tMonolith")])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("Many\tpeople\tget\tinterested\tin\tmicroservices\tas\tan\tantidote\tto\tlarge,\thard-to-change\nmonolithic\tsystems,\tand\tthis\tis\texactly\twhat\twe’ll\tcover\tin\tdetail\tin\tthis\tchapter.\n")])])]),a("p",[a("em",[t._v("Chapter\t6,\tDeployment")])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("Although\tthis\tbook\tis\tprimarily\ttheoretical,\tfew\ttopics\tin\tthe\tbook\thave\tbeen\tas\nimpacted\tby\trecent\tchanges\tin\ttechnology\tas\tdeployment,\twhich\twe’ll\texplore\there.\n")])])]),a("p",[a("em",[t._v("Chapter\t7,\tTesting")])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("This\tchapter\tgoes\tdeep\tinto\tthe\ttopic\tof\ttesting,\tan\tarea\tof\tparticular\tconcern\twhen\nhandling\tthe\tdeployment\tof\tmultiple\tdiscrete\tservices.\tOf\tparticular\tnote\twill\tbe\tthe\nrole\tthat\tconsumer-driven\tcontracts\tcan\tplay\tin\thelping\tus\tensure\tthe\tquality\tof\tour\nsoftware.\n")])])]),a("p",[a("em",[t._v("Chapter\t8,\tMonitoring")])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("Testing\tour\tsoftware\tbefore\tproduction\tdoesn’t\thelp\tif\tproblems\toccur\tonce\twe\tgo\nlive,\tand\tthis\tchapter\texplores\thow\twe\tcan\tmonitor\tour\tfine-grained\tsystems\tand\tdeal\nwith\tsome\tof\tthe\temergent\tcomplexity\tof\tdistributed\tsystems.\n")])])]),a("p",[a("em",[t._v("Chapter\t9,\tSecurity")])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("Here\twe’ll\texamine\tthe\tsecurity\taspects\tof\tmicroservices\tand\tconsider\thow\tto\thandle\nuser-to-service\tand\tservice-to-service\tauthentication\tand\tauthorization.\tSecurity\tis\ta\nvery\timportant\ttopic\tin\tcomputing,\tone\tthat\tis\tall\ttoo\treadily\tignored.\tAlthough\tI\tam\nin\tno\tway\ta\tsecurity\texpert,\tI\thope\tthat\tthis\tchapter\twill\tat\tleast\thelp\tyou\tconsider\nsome\tof\tthe\taspects\tyou\tneed\tto\tbe\taware\tof\twhen\tbuilding\tsystems,\tand\nmicroservice\tsystems\tin\tparticular.\n")])])]),a("p",[a("em",[t._v("Chapter\t10,\tConway’s\tLaw\tand\tSystem\tDesign")])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("This\tchapter\tfocuses\ton\tthe\tinterplay\tof\torganizational\tstructure\tand\tarchitecture.\nMany\torganizations\thave\trealized\tthat\ttrouble\twill\toccur\tif\tyou\tdon’t\tkeep\tthe\ttwo\tin\nharmony.\tWe’ll\tattempt\tto\tget\tto\tthe\tbottom\tof\tthis\tdilemma,\tand\tconsider\tsome\ndifferent\tways\tto\talign\tsystem\tdesign\twith\tthe\tstructure\tof\tyour\tteams.\n")])])]),a("p",[a("em",[t._v("Chapter\t11,\tMicroservices\tat\tScale")])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("This\tis\twhere\twe\tstart\tlooking\tat\tdoing\tall\tof\tthis\tat\tscale,\tso\tthat\twe\tcan\thandle\tthe\nincreased\tchance\tof\tfailure\tthat\tcan\thappen\twith\tlarge\tnumbers\tof\tservices,\tas\twell\tas\nlarge\tvolumes\tof\ttraffic.\n")])])]),a("p",[a("em",[t._v("Chapter\t12,\tBringing\tIt\tAll\tTogether")])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("The\tfinal\tchapter\tattempts\tto\tdistill\tdown\tthe\tcore\tessence\tof\twhat\tmakes\nmicroservices\tdifferent.\tIt\tincludes\ta\tlist\tof\tseven\tmicroservices\tprinciples,\tas\twell\tas\na\twrap-up\tof\tthe\tkey\tpoints\tof\tthe\tbook.\n")])])]),a("h2",{attrs:{id:"conventionsusedinthisbook"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#conventionsusedinthisbook"}},[t._v("#")]),t._v(" Conventions\tUsed\tin\tThis\tBook")]),t._v(" "),a("p",[t._v("The\tfollowing\ttypographical\tconventions\tare\tused\tin\tthis\tbook:")]),t._v(" "),a("p",[a("em",[t._v("Italic")])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("Indicates\tnew\tterms,\tURLs,\temail\taddresses,\tfilenames,\tand\tfile\textensions.\n")])])]),a("p",[a("em",[t._v("Constant\twidth")])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("Used\tfor\tprogram\tlistings,\tas\twell\tas\twithin\tparagraphs\tto\trefer\tto\tprogram\telements\nsuch\tas\tvariable\tor\tfunction\tnames,\tdatabases,\tdata\ttypes,\tenvironment\tvariables,\nstatements,\tand\tkeywords.\n")])])]),a("p",[a("strong",[a("em",[t._v("Constant\twidth\tbold")])])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("Shows\tcommands\tor\tother\ttext\tthat\tshould\tbe\ttyped\tliterally\tby\tthe\tuser.\n")])])]),a("p",[a("em",[t._v("Constant\twidth\titalic")])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("Shows\ttext\tthat\tshould\tbe\treplaced\twith\tuser-supplied\tvalues\tor\tby\tvalues\tdetermined\nby\tcontext.\n")])])]),a("h2",{attrs:{id:"safari®booksonline"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#safari®booksonline"}},[t._v("#")]),t._v(" Safari®\tBooks\tOnline")]),t._v(" "),a("h2",{attrs:{id:"note"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#note"}},[t._v("#")]),t._v(" NOTE")]),t._v(" "),a("p",[a("em",[t._v("Safari\tBooks\tOnline")]),t._v(" \tis\tan\ton-demand\tdigital\tlibrary\tthat\tdelivers\texpert\tcontent\tin\tboth\nbook\tand\tvideo\tform\tfrom\tthe\tworld’s\tleading\tauthors\tin\ttechnology\tand\tbusiness.")]),t._v(" "),a("p",[t._v("Technology\tprofessionals,\tsoftware\tdevelopers,\tweb\tdesigners,\tand\tbusiness\tand\tcreative\nprofessionals\tuse\tSafari\tBooks\tOnline\tas\ttheir\tprimary\tresource\tfor\tresearch,\tproblem\nsolving,\tlearning,\tand\tcertification\ttraining.")]),t._v(" "),a("p",[t._v("Safari\tBooks\tOnline\toffers\ta\trange\tof\tplans\tand\tpricing\tfor\tenterprise,\tgovernment,\neducation,\tand\tindividuals.")]),t._v(" "),a("p",[t._v("Members\thave\taccess\tto\tthousands\tof\tbooks,\ttraining\tvideos,\tand\tprepublication\nmanuscripts\tin\tone\tfully\tsearchable\tdatabase\tfrom\tpublishers\tlike\tO’Reilly\tMedia,\nPrentice\tHall\tProfessional,\tAddison-Wesley\tProfessional,\tMicrosoft\tPress,\tSams,\tQue,\nPeachpit\tPress,\tFocal\tPress,\tCisco\tPress,\tJohn\tWiley\t&\tSons,\tSyngress,\tMorgan\nKaufmann,\tIBM\tRedbooks,\tPackt,\tAdobe\tPress,\tFT\tPress,\tApress,\tManning,\tNew\tRiders,\nMcGraw-Hill,\tJones\t&\tBartlett,\tCourse\tTechnology,\tand\thundreds\tmore.\tFor\tmore\ninformation\tabout\tSafari\tBooks\tOnline,\tplease\tvisit\tus\tonline.")]),t._v(" "),a("h2",{attrs:{id:"howtocontactus"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#howtocontactus"}},[t._v("#")]),t._v(" How\tto\tContact\tUs")]),t._v(" "),a("p",[t._v("Please\taddress\tcomments\tand\tquestions\tconcerning\tthis\tbook\tto\tthe\tpublisher:")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("O’Reilly\tMedia,\tInc.\n")])])]),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("1005\tGravenstein\tHighway\tNorth\n")])])]),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("Sebastopol,\tCA\t\n")])])]),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("800-998-9938\t(in\tthe\tUnited\tStates\tor\tCanada)\n")])])]),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("707-829-0515\t(international\tor\tlocal)\n")])])]),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("707-829-0104\t(fax)\n")])])]),a("p",[t._v("We\thave\ta\tweb\tpage\tfor\tthis\tbook,\twhere\twe\tlist\terrata,\texamples,\tand\tany\tadditional\ninformation.\tYou\tcan\taccess\tthis\tpage\tat\t "),a("em",[a("a",{attrs:{href:"http://bit.ly/building-microservices",target:"_blank",rel:"noopener noreferrer"}},[t._v("http://bit.ly/building-microservices"),a("OutboundLink")],1)]),t._v(".")]),t._v(" "),a("p",[t._v("To\tcomment\tor\task\ttechnical\tquestions\tabout\tthis\tbook,\tsend\temail\tto\n"),a("em",[t._v("bookquestions@oreilly.com")]),t._v(".")]),t._v(" "),a("p",[t._v("For\tmore\tinformation\tabout\tour\tbooks,\tcourses,\tconferences,\tand\tnews,\tsee\tour\twebsite\tat\n"),a("em",[a("a",{attrs:{href:"http://www.oreilly.com",target:"_blank",rel:"noopener noreferrer"}},[t._v("http://www.oreilly.com"),a("OutboundLink")],1)]),t._v(".")]),t._v(" "),a("p",[t._v("Find\tus\ton\tFacebook:\t "),a("em",[a("a",{attrs:{href:"http://facebook.com/oreilly",target:"_blank",rel:"noopener noreferrer"}},[t._v("http://facebook.com/oreilly"),a("OutboundLink")],1)])]),t._v(" "),a("p",[t._v("Follow\tus\ton\tTwitter:\t "),a("em",[a("a",{attrs:{href:"http://twitter.com/oreillymedia",target:"_blank",rel:"noopener noreferrer"}},[t._v("http://twitter.com/oreillymedia"),a("OutboundLink")],1)])]),t._v(" "),a("p",[t._v("Watch\tus\ton\tYouTube:\t "),a("em",[a("a",{attrs:{href:"http://www.youtube.com/oreillymedia",target:"_blank",rel:"noopener noreferrer"}},[t._v("http://www.youtube.com/oreillymedia"),a("OutboundLink")],1)])]),t._v(" "),a("h2",{attrs:{id:"acknowledgments"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#acknowledgments"}},[t._v("#")]),t._v(" Acknowledgments")]),t._v(" "),a("p",[t._v("This\tbook\tis\tdedicated\tto\tLindy\tStephens,\twithout\twhom\tit\twouldn’t\texist.\tShe\nencouraged\tme\tto\tstart\ton\tthis\tjourney,\tsupported\tme\tthroughout\tthe\toften\tstressful\nprocess\tof\twriting,\tand\tis\tthe\tbest\tpartner\tI\tcould\thave\tever\tasked\tfor.\tI\twould\talso\tlike\tto\ndedicate\tthis\tto\tmy\tdad,\tHoward\tNewman,\twho\thas\talways\tbeen\tthere\tfor\tme.\tThis\tis\tfor\nboth\tof\tyou.")]),t._v(" "),a("p",[t._v("I\twould\tlike\tto\tsingle\tout\tBen\tChristensen,\tVivek\tSubramaniam,\tand\tMartin\tFowler\tfor\nproviding\tdetailed\tfeedback\tthroughout\tthe\twriting\tprocess,\thelping\tshape\twhat\tthis\tbook\nbecame.\tI’d\talso\tlike\tto\tthank\tJames\tLewis,\twith\twhom\tI\thave\tconsumed\tmany\tbeers\ndiscussing\tthe\tideas\tpresented\tin\tthis\tbook.\tThis\tbook\twould\tbe\ta\tshadow\tof\titself\twithout\ntheir\thelp\tand\tguidance.")]),t._v(" "),a("p",[t._v("In\taddition,\tmany\tothers\tprovided\thelp\tand\tfeedback\ton\tearly\tversions\tof\tthe\tbook.\nSpecifically,\tI\twould\tlike\tto\tthank\t(in\tno\tparticular\torder)\tKane\tVenables,\tAnand\nKrishnaswamy,\tKent\tMcNeil,\tCharles\tHaynes,\tChris\tFord,\tAidy\tLewis,\tWill\tThames,\tJon\nEaves,\tRolf\tRussell,\tBadrinath\tJanakiraman,\tDaniel\tBryant,\tIan\tRobinson,\tJim\tWebber,\nStewart\tGleadow,\tEvan\tBottcher,\tEric\tSword,\tOlivia\tLeonard,\tand\tall\tmy\tother\tcolleagues\nat\tThoughtWorks\tand\tacross\tthe\tindustry\twho\thave\thelped\tme\tget\tthis\tfar.")]),t._v(" "),a("p",[t._v("Finally,\tI\twould\tlike\tto\tthank\tall\tthe\tpeople\tat\tO’Reilly,\tincluding\tMike\tLoukides\tfor\ngetting\tme\ton\tboard,\tmy\teditor\tBrian\tMacDonald,\tRachel\tMonaghan,\tKristen\tBrown,\nBetsy\tWaliszewski,\tand\tall\tthe\tother\tpeople\twho\thave\thelped\tin\tways\tI\tmay\tnever\tknow\nabout.")]),t._v(" "),a("h1",{attrs:{id:"chapter1-microservices"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#chapter1-microservices"}},[t._v("#")]),t._v(" Chapter\t1.\tMicroservices")]),t._v(" "),a("p",[t._v("For\tmany\tyears\tnow,\twe\thave\tbeen\tfinding\tbetter\tways\tto\tbuild\tsystems.\tWe\thave\tbeen\nlearning\tfrom\twhat\thas\tcome\tbefore,\tadopting\tnew\ttechnologies,\tand\tobserving\thow\ta\nnew\twave\tof\ttechnology\tcompanies\toperate\tin\tdifferent\tways\tto\tcreate\tIT\tsystems\tthat\nhelp\tmake\tboth\ttheir\tcustomers\tand\ttheir\town\tdevelopers\thappier.")]),t._v(" "),a("p",[t._v("Eric\tEvans’s\tbook\t "),a("em",[t._v("Domain-Driven\tDesign")]),t._v(" \t(Addison-Wesley)\thelped\tus\tunderstand\tthe\nimportance\tof\trepresenting\tthe\treal\tworld\tin\tour\tcode,\tand\tshowed\tus\tbetter\tways\tto\tmodel\nour\tsystems.\tThe\tconcept\tof\tcontinuous\tdelivery\tshowed\thow\twe\tcan\tmore\teffectively\tand\nefficiently\tget\tour\tsoftware\tinto\tproduction,\tinstilling\tin\tus\tthe\tidea\tthat\twe\tshould\ttreat\nevery\tcheck-in\tas\ta\trelease\tcandidate.\tOur\tunderstanding\tof\thow\tthe\tWeb\tworks\thas\tled\tus\nto\tdevelop\tbetter\tways\tof\thaving\tmachines\ttalk\tto\tother\tmachines.\tAlistair\tCockburn’s\nconcept\tof\thexagonal\tarchitecture\tguided\tus\taway\tfrom\tlayered\tarchitectures\twhere\nbusiness\tlogic\tcould\thide.\tVirtualization\tplatforms\tallowed\tus\tto\tprovision\tand\tresize\tour\nmachines\tat\twill,\twith\tinfrastructure\tautomation\tgiving\tus\ta\tway\tto\thandle\tthese\tmachines\nat\tscale.\tSome\tlarge,\tsuccessful\torganizations\tlike\tAmazon\tand\tGoogle\tespoused\tthe\tview\nof\tsmall\tteams\towning\tthe\tfull\tlifecycle\tof\ttheir\tservices.\tAnd,\tmore\trecently,\tNetflix\thas\nshared\twith\tus\tways\tof\tbuilding\tantifragile\tsystems\tat\ta\tscale\tthat\twould\thave\tbeen\thard\tto\ncomprehend\tjust\t10\tyears\tago.")]),t._v(" "),a("p",[t._v("Domain-driven\tdesign.\tContinuous\tdelivery.\tOn-demand\tvirtualization.\tInfrastructure\nautomation.\tSmall\tautonomous\tteams.\tSystems\tat\tscale.\tMicroservices\thave\temerged\tfrom\nthis\tworld.\tThey\tweren’t\tinvented\tor\tdescribed\tbefore\tthe\tfact;\tthey\temerged\tas\ta\ttrend,\tor\na\tpattern,\tfrom\treal-world\tuse.\tBut\tthey\texist\tonly\tbecause\tof\tall\tthat\thas\tgone\tbefore.\nThroughout\tthis\tbook,\tI\twill\tpull\tstrands\tout\tof\tthis\tprior\twork\tto\thelp\tpaint\ta\tpicture\tof\nhow\tto\tbuild,\tmanage,\tand\tevolve\tmicroservices.")]),t._v(" "),a("p",[t._v("Many\torganizations\thave\tfound\tthat\tby\tembracing\tfine-grained,\tmicroservice\narchitectures,\tthey\tcan\tdeliver\tsoftware\tfaster\tand\tembrace\tnewer\ttechnologies.\nMicroservices\tgive\tus\tsignificantly\tmore\tfreedom\tto\treact\tand\tmake\tdifferent\tdecisions,\nallowing\tus\tto\trespond\tfaster\tto\tthe\tinevitable\tchange\tthat\timpacts\tall\tof\tus.")]),t._v(" "),a("h2",{attrs:{id:"whataremicroservices"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#whataremicroservices"}},[t._v("#")]),t._v(" What\tAre\tMicroservices?")]),t._v(" "),a("p",[t._v("Microservices\tare\tsmall,\tautonomous\tservices\tthat\twork\ttogether.\tLet’s\tbreak\tthat\ndefinition\tdown\ta\tbit\tand\tconsider\tthe\tcharacteristics\tthat\tmake\tmicroservices\tdifferent.")]),t._v(" "),a("h2",{attrs:{id:"small-andfocusedondoingonethingwell"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#small-andfocusedondoingonethingwell"}},[t._v("#")]),t._v(" Small,\tand\tFocused\ton\tDoing\tOne\tThing\tWell")]),t._v(" "),a("p",[t._v("Codebases\tgrow\tas\twe\twrite\tcode\tto\tadd\tnew\tfeatures.\tOver\ttime,\tit\tcan\tbe\tdifficult\tto\nknow\twhere\ta\tchange\tneeds\tto\tbe\tmade\tbecause\tthe\tcodebase\tis\tso\tlarge.\tDespite\ta\tdrive\nfor\tclear,\tmodular\tmonolithic\tcodebases,\tall\ttoo\toften\tthese\tarbitrary\tin-process\nboundaries\tbreak\tdown.\tCode\trelated\tto\tsimilar\tfunctions\tstarts\tto\tbecome\tspread\tall\tover,\nmaking\tfixing\tbugs\tor\timplementations\tmore\tdifficult.")]),t._v(" "),a("p",[t._v("Within\ta\tmonolithic\tsystem,\twe\tfight\tagainst\tthese\tforces\tby\ttrying\tto\tensure\tour\tcode\tis\nmore\tcohesive,\toften\tby\tcreating\tabstractions\tor\tmodules.\tCohesion\t—\tthe\tdrive\tto\thave\nrelated\tcode\tgrouped\ttogether\t—\tis\tan\timportant\tconcept\twhen\twe\tthink\tabout\nmicroservices.\tThis\tis\treinforced\tby\tRobert\tC.\tMartin’s\tdefinition\tof\tthe\t "),a("em",[t._v("Single\nResponsibility\tPrinciple")]),t._v(" ,\twhich\tstates\t“Gather\ttogether\tthose\tthings\tthat\tchange\tfor\tthe\nsame\treason,\tand\tseparate\tthose\tthings\tthat\tchange\tfor\tdifferent\treasons.”")]),t._v(" "),a("p",[t._v("Microservices\ttake\tthis\tsame\tapproach\tto\tindependent\tservices.\tWe\tfocus\tour\tservice\nboundaries\ton\tbusiness\tboundaries,\tmaking\tit\tobvious\twhere\tcode\tlives\tfor\ta\tgiven\tpiece\nof\tfunctionality.\tAnd\tby\tkeeping\tthis\tservice\tfocused\ton\tan\texplicit\tboundary,\twe\tavoid\nthe\ttemptation\tfor\tit\tto\tgrow\ttoo\tlarge,\twith\tall\tthe\tassociated\tdifficulties\tthat\tthis\tcan\nintroduce.")]),t._v(" "),a("p",[t._v("The\tquestion\tI\tam\toften\tasked\tis\t "),a("em",[t._v("how\tsmall\tis\tsmall?")]),t._v(" \tGiving\ta\tnumber\tfor\tlines\tof\tcode\tis\nproblematic,\tas\tsome\tlanguages\tare\tmore\texpressive\tthan\tothers\tand\tcan\ttherefore\tdo\nmore\tin\tfewer\tlines\tof\tcode.\tWe\tmust\talso\tconsider\tthe\tfact\tthat\twe\tcould\tbe\tpulling\tin\nmultiple\tdependencies,\twhich\tthemselves\tcontain\tmany\tlines\tof\tcode.\tIn\taddition,\tsome\npart\tof\tyour\tdomain\tmay\tbe\tlegitimately\tcomplex,\trequiring\tmore\tcode.\tJon\tEaves\tat\nRealEstate.com.au\tin\tAustralia\tcharacterizes\ta\tmicroservice\tas\tsomething\tthat\tcould\tbe\nrewritten\tin\ttwo\tweeks,\ta\trule\tof\tthumb\tthat\tmakes\tsense\tfor\this\tparticular\tcontext.")]),t._v(" "),a("p",[t._v("Another\tsomewhat\ttrite\tanswer\tI\tcan\tgive\tis\t "),a("em",[t._v("small\tenough\tand\tno\tsmaller")]),t._v(" .\tWhen\tspeaking\nat\tconferences,\tI\tnearly\talways\task\tthe\tquestion\t "),a("em",[t._v("who\thas\ta\tsystem\tthat\tis\ttoo\tbig\tand\tthat\nyou’d\tlike\tto\tbreak\tdown")]),t._v(" ?\tNearly\teveryone\traises\ttheir\thands.\tWe\tseem\tto\thave\ta\tvery\ngood\tsense\tof\twhat\tis\ttoo\tbig,\tand\tso\tit\tcould\tbe\targued\tthat\tonce\ta\tpiece\tof\tcode\tno\nlonger\t "),a("em",[t._v("feels")]),t._v(" \ttoo\tbig,\tit’s\tprobably\tsmall\tenough.")]),t._v(" "),a("p",[t._v("A\tstrong\tfactor\tin\thelping\tus\tanswer\t "),a("em",[t._v("how\tsmall?")]),t._v(" \tis\thow\twell\tthe\tservice\taligns\tto\tteam\nstructures.\tIf\tthe\tcodebase\tis\ttoo\tbig\tto\tbe\tmanaged\tby\ta\tsmall\tteam,\tlooking\tto\tbreak\tit\ndown\tis\tvery\tsensible.\tWe’ll\ttalk\tmore\tabout\torganizational\talignment\tlater\ton.")]),t._v(" "),a("p",[t._v("When\tit\tcomes\tto\thow\tsmall\tis\tsmall\tenough,\tI\tlike\tto\tthink\tin\tthese\tterms:\tthe\tsmaller\tthe\nservice,\tthe\tmore\tyou\tmaximize\tthe\tbenefits\tand\tdownsides\tof\tmicroservice\tarchitecture.\nAs\tyou\tget\tsmaller,\tthe\tbenefits\taround\tinterdependence\tincrease.\tBut\tso\ttoo\tdoes\tsome\tof\nthe\tcomplexity\tthat\temerges\tfrom\thaving\tmore\tand\tmore\tmoving\tparts,\tsomething\tthat\twe\nwill\texplore\tthroughout\tthis\tbook.\tAs\tyou\tget\tbetter\tat\thandling\tthis\tcomplexity,\tyou\tcan\nstrive\tfor\tsmaller\tand\tsmaller\tservices.")]),t._v(" "),a("h2",{attrs:{id:"autonomous"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#autonomous"}},[t._v("#")]),t._v(" Autonomous")]),t._v(" "),a("p",[t._v("Our\tmicroservice\tis\ta\tseparate\tentity.\tIt\tmight\tbe\tdeployed\tas\tan\tisolated\tservice\ton\ta\nplatform\tas\ta\tservice\t(PAAS),\tor\tit\tmight\tbe\tits\town\toperating\tsystem\tprocess.\tWe\ttry\tto\navoid\tpacking\tmultiple\tservices\tonto\tthe\tsame\tmachine,\talthough\tthe\tdefinition\tof\n"),a("em",[t._v("machine")]),t._v(" \tin\ttoday’s\tworld\tis\tpretty\thazy!\tAs\twe’ll\tdiscuss\tlater,\talthough\tthis\tisolation\tcan\nadd\tsome\toverhead,\tthe\tresulting\tsimplicity\tmakes\tour\tdistributed\tsystem\tmuch\teasier\tto\nreason\tabout,\tand\tnewer\ttechnologies\tare\table\tto\tmitigate\tmany\tof\tthe\tchallenges\nassociated\twith\tthis\tform\tof\tdeployment.")]),t._v(" "),a("p",[t._v("All\tcommunication\tbetween\tthe\tservices\tthemselves\tare\tvia\tnetwork\tcalls,\tto\tenforce\nseparation\tbetween\tthe\tservices\tand\tavoid\tthe\tperils\tof\ttight\tcoupling.")]),t._v(" "),a("p",[t._v("These\tservices\tneed\tto\tbe\table\tto\tchange\tindependently\tof\teach\tother,\tand\tbe\tdeployed\tby\nthemselves\twithout\trequiring\tconsumers\tto\tchange.\tWe\tneed\tto\tthink\tabout\twhat\tour\nservices\tshould\texpose,\tand\twhat\tthey\tshould\tallow\tto\tbe\thidden.\tIf\tthere\tis\ttoo\tmuch\nsharing,\tour\tconsuming\tservices\tbecome\tcoupled\tto\tour\tinternal\trepresentations.\tThis\ndecreases\tour\tautonomy,\tas\tit\trequires\tadditional\tcoordination\twith\tconsumers\twhen\nmaking\tchanges.")]),t._v(" "),a("p",[t._v("Our\tservice\texposes\tan\tapplication\tprogramming\tinterface\t(API),\tand\tcollaborating\nservices\tcommunicate\twith\tus\tvia\tthose\tAPIs.\tWe\talso\tneed\tto\tthink\tabout\twhat\ntechnology\tis\tappropriate\tto\tensure\tthat\tthis\titself\tdoesn’t\tcouple\tconsumers.\tThis\tmay\nmean\tpicking\ttechnology-agnostic\tAPIs\tto\tensure\tthat\twe\tdon’t\tconstrain\ttechnology\nchoices.\tWe’ll\tcome\tback\ttime\tand\tagain\tto\tthe\timportance\tof\tgood,\tdecoupled\tAPIs\nthroughout\tthis\tbook.")]),t._v(" "),a("p",[t._v("Without\tdecoupling,\teverything\tbreaks\tdown\tfor\tus.\tThe\tgolden\trule:\tcan\tyou\tmake\ta\nchange\tto\ta\tservice\tand\tdeploy\tit\tby\titself\twithout\tchanging\tanything\telse?\tIf\tthe\tanswer\tis\nno,\tthen\tmany\tof\tthe\tadvantages\twe\tdiscuss\tthroughout\tthis\tbook\twill\tbe\thard\tfor\tyou\tto\nachieve.")]),t._v(" "),a("p",[t._v("To\tdo\tdecoupling\twell,\tyou’ll\tneed\tto\tmodel\tyour\tservices\tright\tand\tget\tthe\tAPIs\tright.\tI’ll\nbe\ttalking\tabout\tthat\ta\tlot.")]),t._v(" "),a("h2",{attrs:{id:"keybenefits"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#keybenefits"}},[t._v("#")]),t._v(" Key\tBenefits")]),t._v(" "),a("p",[t._v("The\tbenefits\tof\tmicroservices\tare\tmany\tand\tvaried.\tMany\tof\tthese\tbenefits\tcan\tbe\tlaid\tat\nthe\tdoor\tof\tany\tdistributed\tsystem.\tMicroservices,\thowever,\ttend\tto\tachieve\tthese\tbenefits\nto\ta\tgreater\tdegree\tprimarily\tdue\tto\thow\tfar\tthey\ttake\tthe\tconcepts\tbehind\tdistributed\nsystems\tand\tservice-oriented\tarchitecture.")]),t._v(" "),a("h2",{attrs:{id:"technologyheterogeneity"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#technologyheterogeneity"}},[t._v("#")]),t._v(" Technology\tHeterogeneity")]),t._v(" "),a("p",[t._v("With\ta\tsystem\tcomposed\tof\tmultiple,\tcollaborating\tservices,\twe\tcan\tdecide\tto\tuse\tdifferent\ntechnologies\tinside\teach\tone.\tThis\tallows\tus\tto\tpick\tthe\tright\ttool\tfor\teach\tjob,\trather\tthan\nhaving\tto\tselect\ta\tmore\tstandardized,\tone-size-fits-all\tapproach\tthat\toften\tends\tup\tbeing\nthe\tlowest\tcommon\tdenominator.")]),t._v(" "),a("p",[t._v("If\tone\tpart\tof\tour\tsystem\tneeds\tto\timprove\tits\tperformance,\twe\tmight\tdecide\tto\tuse\ta\ndifferent\ttechnology\tstack\tthat\tis\tbetter\table\tto\tachieve\tthe\tperformance\tlevels\trequired.\nWe\tmay\talso\tdecide\tthat\thow\twe\tstore\tour\tdata\tneeds\tto\tchange\tfor\tdifferent\tparts\tof\tour\nsystem.\tFor\texample,\tfor\ta\tsocial\tnetwork,\twe\tmight\tstore\tour\tusers’\tinteractions\tin\ta\ngraph-oriented\tdatabase\tto\treflect\tthe\thighly\tinterconnected\tnature\tof\ta\tsocial\tgraph,\tbut\nperhaps\tthe\tposts\tthe\tusers\tmake\tcould\tbe\tstored\tin\ta\tdocument-oriented\tdata\tstore,\tgiving\nrise\tto\ta\theterogeneous\tarchitecture\tlike\tthe\tone\tshown\tin\tFigure\t1-1.")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("Figure\t1-1.\tMicroservices\tcan\tallow\tyou\tto\tmore\teasily\tembrace\tdifferent\ttechnologies\n")])])]),a("p",[t._v("With\tmicroservices,\twe\tare\talso\table\tto\tadopt\ttechnology\tmore\tquickly,\tand\tunderstand\nhow\tnew\tadvancements\tmay\thelp\tus.\tOne\tof\tthe\tbiggest\tbarriers\tto\ttrying\tout\tand\nadopting\tnew\ttechnology\tis\tthe\trisks\tassociated\twith\tit.\tWith\ta\tmonolithic\tapplication,\tif\tI\nwant\tto\ttry\ta\tnew\tprogramming\tlanguage,\tdatabase,\tor\tframework,\tany\tchange\twill\timpact\na\tlarge\tamount\tof\tmy\tsystem.\tWith\ta\tsystem\tconsisting\tof\tmultiple\tservices,\tI\thave\nmultiple\tnew\tplaces\tin\twhich\tto\ttry\tout\ta\tnew\tpiece\tof\ttechnology.\tI\tcan\tpick\ta\tservice\tthat\nis\tperhaps\tlowest\trisk\tand\tuse\tthe\ttechnology\tthere,\tknowing\tthat\tI\tcan\tlimit\tany\tpotential\nnegative\timpact.\tMany\torganizations\tfind\tthis\tability\tto\tmore\tquickly\tabsorb\tnew\ntechnologies\tto\tbe\ta\treal\tadvantage\tfor\tthem.")]),t._v(" "),a("p",[t._v("Embracing\tmultiple\ttechnologies\tdoesn’t\tcome\twithout\tan\toverhead,\tof\tcourse.\tSome\norganizations\tchoose\tto\tplace\tsome\tconstraints\ton\tlanguage\tchoices.\tNetflix\tand\tTwitter,\nfor\texample,\tmostly\tuse\tthe\tJava\tVirtual\tMachine\t(JVM)\tas\ta\tplatform,\tas\tthey\thave\ta\nvery\tgood\tunderstanding\tof\tthe\treliability\tand\tperformance\tof\tthat\tsystem.\tThey\talso\ndevelop\tlibraries\tand\ttooling\tfor\tthe\tJVM\tthat\tmake\toperating\tat\tscale\tmuch\teasier,\tbut\nmake\tit\tmore\tdifficult\tfor\tnon-Java-based\tservices\tor\tclients.\tBut\tneither\tTwitter\tnor\nNetflix\tuse\tonly\tone\ttechnology\tstack\tfor\tall\tjobs,\teither.\tAnother\tcounterpoint\tto\tconcerns")]),t._v(" "),a("p",[t._v("about\tmixing\tin\tdifferent\ttechnologies\tis\tthe\tsize.\tIf\tI\treally\tcan\trewrite\tmy\tmicroservice\nin\ttwo\tweeks,\tyou\tmay\twell\tmitigate\tthe\trisks\tof\tembracing\tnew\ttechnology.")]),t._v(" "),a("p",[t._v("As\tyou’ll\tfind\tthroughout\tthis\tbook,\tjust\tlike\tmany\tthings\tconcerning\tmicroservices,\tit’s\nall\tabout\tfinding\tthe\tright\tbalance.\tWe’ll\tdiscuss\thow\tto\tmake\ttechnology\tchoices\tin\nChapter\t2,\twhich\tfocuses\ton\tevolutionary\tarchitecture;\tand\tin\tChapter\t4,\twhich\tdeals\twith\nintegration,\tyou’ll\tlearn\thow\tto\tensure\tthat\tyour\tservices\tcan\tevolve\ttheir\ttechnology\nindependently\tof\teach\tother\twithout\tundue\tcoupling.")]),t._v(" "),a("h2",{attrs:{id:"resilience"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#resilience"}},[t._v("#")]),t._v(" Resilience")]),t._v(" "),a("p",[t._v("A\tkey\tconcept\tin\tresilience\tengineering\tis\tthe\tbulkhead.\tIf\tone\tcomponent\tof\ta\tsystem\nfails,\tbut\tthat\tfailure\tdoesn’t\tcascade,\tyou\tcan\tisolate\tthe\tproblem\tand\tthe\trest\tof\tthe\nsystem\tcan\tcarry\ton\tworking.\tService\tboundaries\tbecome\tyour\tobvious\tbulkheads.\tIn\ta\nmonolithic\tservice,\tif\tthe\tservice\tfails,\teverything\tstops\tworking.\tWith\ta\tmonolithic\nsystem,\twe\tcan\trun\ton\tmultiple\tmachines\tto\treduce\tour\tchance\tof\tfailure,\tbut\twith\nmicroservices,\twe\tcan\tbuild\tsystems\tthat\thandle\tthe\ttotal\tfailure\tof\tservices\tand\tdegrade\nfunctionality\taccordingly.")]),t._v(" "),a("p",[t._v("We\tdo\tneed\tto\tbe\tcareful,\thowever.\tTo\tensure\tour\tmicroservice\tsystems\tcan\tproperly\nembrace\tthis\timproved\tresilience,\twe\tneed\tto\tunderstand\tthe\tnew\tsources\tof\tfailure\tthat\ndistributed\tsystems\thave\tto\tdeal\twith.\tNetworks\tcan\tand\twill\tfail,\tas\twill\tmachines.\tWe\nneed\tto\tknow\thow\tto\thandle\tthis,\tand\twhat\timpact\t(if\tany)\tit\tshould\thave\ton\tthe\tend\tuser\nof\tour\tsoftware.")]),t._v(" "),a("p",[t._v("We’ll\ttalk\tmore\tabout\tbetter\thandling\tresilience,\tand\thow\tto\thandle\tfailure\tmodes,\tin\nChapter\t11.")]),t._v(" "),a("h2",{attrs:{id:"scaling"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#scaling"}},[t._v("#")]),t._v(" Scaling")]),t._v(" "),a("p",[t._v("With\ta\tlarge,\tmonolithic\tservice,\twe\thave\tto\tscale\teverything\ttogether.\tOne\tsmall\tpart\tof\nour\toverall\tsystem\tis\tconstrained\tin\tperformance,\tbut\tif\tthat\tbehavior\tis\tlocked\tup\tin\ta\ngiant\tmonolithic\tapplication,\twe\thave\tto\thandle\tscaling\teverything\tas\ta\tpiece.\tWith\nsmaller\tservices,\twe\tcan\tjust\tscale\tthose\tservices\tthat\tneed\tscaling,\tallowing\tus\tto\trun\nother\tparts\tof\tthe\tsystem\ton\tsmaller,\tless\tpowerful\thardware,\tlike\tin\tFigure\t1-2.")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("Figure\t1-2.\tYou\tcan\ttarget\tscaling\tat\tjust\tthose\tmicroservices\tthat\tneed\tit\n")])])]),a("p",[t._v("Gilt,\tan\tonline\tfashion\tretailer,\tadopted\tmicroservices\tfor\tthis\texact\treason.\tStarting\tin\n2007\twith\ta\tmonolithic\tRails\tapplication,\tby\t2009\tGilt’s\tsystem\twas\tunable\tto\tcope\twith\nthe\tload\tbeing\tplaced\ton\tit.\tBy\tsplitting\tout\tcore\tparts\tof\tits\tsystem,\tGilt\twas\tbetter\table\tto\ndeal\twith\tits\ttraffic\tspikes,\tand\ttoday\thas\tover\t450\tmicroservices,\teach\tone\trunning\ton\nmultiple\tseparate\tmachines.")]),t._v(" "),a("p",[t._v("When\tembracing\ton-demand\tprovisioning\tsystems\tlike\tthose\tprovided\tby\tAmazon\tWeb\nServices,\twe\tcan\teven\tapply\tthis\tscaling\ton\tdemand\tfor\tthose\tpieces\tthat\tneed\tit.\tThis\nallows\tus\tto\tcontrol\tour\tcosts\tmore\teffectively.\tIt’s\tnot\toften\tthat\tan\tarchitectural\tapproach\ncan\tbe\tso\tclosely\tcorrelated\tto\tan\talmost\timmediate\tcost\tsavings.")]),t._v(" "),a("h2",{attrs:{id:"easeofdeployment"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#easeofdeployment"}},[t._v("#")]),t._v(" Ease\tof\tDeployment")]),t._v(" "),a("p",[t._v("A\tone-line\tchange\tto\ta\tmillion-line-long\tmonolithic\tapplication\trequires\tthe\twhole\napplication\tto\tbe\tdeployed\tin\torder\tto\trelease\tthe\tchange.\tThat\tcould\tbe\ta\tlarge-impact,\nhigh-risk\tdeployment.\tIn\tpractice,\tlarge-impact,\thigh-risk\tdeployments\tend\tup\thappening\ninfrequently\tdue\tto\tunderstandable\tfear.\tUnfortunately,\tthis\tmeans\tthat\tour\tchanges\tbuild\nup\tand\tbuild\tup\tbetween\treleases,\tuntil\tthe\tnew\tversion\tof\tour\tapplication\thitting\nproduction\thas\tmasses\tof\tchanges.\tAnd\tthe\tbigger\tthe\tdelta\tbetween\treleases,\tthe\thigher\nthe\trisk\tthat\twe’ll\tget\tsomething\twrong!")]),t._v(" "),a("p",[t._v("With\tmicroservices,\twe\tcan\tmake\ta\tchange\tto\ta\tsingle\tservice\tand\tdeploy\tit\tindependently\nof\tthe\trest\tof\tthe\tsystem.\tThis\tallows\tus\tto\tget\tour\tcode\tdeployed\tfaster.\tIf\ta\tproblem\tdoes\noccur,\tit\tcan\tbe\tisolated\tquickly\tto\tan\tindividual\tservice,\tmaking\tfast\trollback\teasy\tto\nachieve.\tIt\talso\tmeans\twe\tcan\tget\tour\tnew\tfunctionality\tout\tto\tcustomers\tfaster.\tThis\tis\none\tof\tthe\tmain\treasons\twhy\torganizations\tlike\tAmazon\tand\tNetflix\tuse\tthese\narchitectures\t—\tto\tensure\tthey\tremove\tas\tmany\timpediments\tas\tpossible\tto\tgetting\nsoftware\tout\tthe\tdoor.")]),t._v(" "),a("p",[t._v("The\ttechnology\tin\tthis\tspace\thas\tchanged\tgreatly\tin\tthe\tlast\tcouple\tof\tyears,\tand\twe’ll\tbe\nlooking\tmore\tdeeply\tinto\tthe\ttopic\tof\tdeployment\tin\ta\tmicroservice\tworld\tin\tChapter\t6.")]),t._v(" "),a("h2",{attrs:{id:"organizationalalignment"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#organizationalalignment"}},[t._v("#")]),t._v(" Organizational\tAlignment")]),t._v(" "),a("p",[t._v("Many\tof\tus\thave\texperienced\tthe\tproblems\tassociated\twith\tlarge\tteams\tand\tlarge\ncodebases.\tThese\tproblems\tcan\tbe\texacerbated\twhen\tthe\tteam\tis\tdistributed.\tWe\talso\nknow\tthat\tsmaller\tteams\tworking\ton\tsmaller\tcodebases\ttend\tto\tbe\tmore\tproductive.")]),t._v(" "),a("p",[t._v("Microservices\tallow\tus\tto\tbetter\talign\tour\tarchitecture\tto\tour\torganization,\thelping\tus\nminimize\tthe\tnumber\tof\tpeople\tworking\ton\tany\tone\tcodebase\tto\thit\tthe\tsweet\tspot\tof\tteam\nsize\tand\tproductivity.\tWe\tcan\talso\tshift\townership\tof\tservices\tbetween\tteams\tto\ttry\tto\tkeep\npeople\tworking\ton\tone\tservice\tcolocated.\tWe\twill\tgo\tinto\tmuch\tmore\tdetail\ton\tthis\ttopic\nwhen\twe\tdiscuss\tConway’s\tlaw\tin\tChapter\t10.")]),t._v(" "),a("h2",{attrs:{id:"composability"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#composability"}},[t._v("#")]),t._v(" Composability")]),t._v(" "),a("p",[t._v("One\tof\tthe\tkey\tpromises\tof\tdistributed\tsystems\tand\tservice-oriented\tarchitectures\tis\tthat\nwe\topen\tup\topportunities\tfor\treuse\tof\tfunctionality.\tWith\tmicroservices,\twe\tallow\tfor\tour\nfunctionality\tto\tbe\tconsumed\tin\tdifferent\tways\tfor\tdifferent\tpurposes.\tThis\tcan\tbe\nespecially\timportant\twhen\twe\tthink\tabout\thow\tour\tconsumers\tuse\tour\tsoftware.\tGone\tis\nthe\ttime\twhen\twe\tcould\tthink\tnarrowly\tabout\teither\tour\tdesktop\twebsite\tor\tmobile\napplication.\tNow\twe\tneed\tto\tthink\tof\tthe\tmyriad\tways\tthat\twe\tmight\twant\tto\tweave\ntogether\tcapabilities\tfor\tthe\tWeb,\tnative\tapplication,\tmobile\tweb,\ttablet\tapp,\tor\twearable\ndevice.\tAs\torganizations\tmove\taway\tfrom\tthinking\tin\tterms\tof\tnarrow\tchannels\tto\tmore\nholistic\tconcepts\tof\tcustomer\tengagement,\twe\tneed\tarchitectures\tthat\tcan\tkeep\tup.")]),t._v(" "),a("p",[t._v("With\tmicroservices,\tthink\tof\tus\topening\tup\tseams\tin\tour\tsystem\tthat\tare\taddressable\tby\noutside\tparties.\tAs\tcircumstances\tchange,\twe\tcan\tbuild\tthings\tin\tdifferent\tways.\tWith\ta\nmonolithic\tapplication,\tI\toften\thave\tone\tcoarse-grained\tseam\tthat\tcan\tbe\tused\tfrom\tthe\noutside.\tIf\tI\twant\tto\tbreak\tthat\tup\tto\tget\tsomething\tmore\tuseful,\tI’ll\tneed\ta\thammer!\tIn\nChapter\t5,\tI’ll\tdiscuss\tways\tfor\tyou\tto\tbreak\tapart\texisting\tmonolithic\tsystems,\tand\nhopefully\tchange\tthem\tinto\tsome\treusable,\tre-composable\tmicroservices.")]),t._v(" "),a("h2",{attrs:{id:"optimizingforreplaceability"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#optimizingforreplaceability"}},[t._v("#")]),t._v(" Optimizing\tfor\tReplaceability")]),t._v(" "),a("p",[t._v("If\tyou\twork\tat\ta\tmedium-size\tor\tbigger\torganization,\tchances\tare\tyou\tare\taware\tof\tsome\nbig,\tnasty\tlegacy\tsystem\tsitting\tin\tthe\tcorner.\tThe\tone\tno\tone\twants\tto\ttouch.\tThe\tone\tthat\nis\tvital\tto\thow\tyour\tcompany\truns,\tbut\tthat\thappens\tto\tbe\twritten\tin\tsome\todd\tFortran\nvariant\tand\truns\tonly\ton\thardware\tthat\treached\tend\tof\tlife\t25\tyears\tago.\tWhy\thasn’t\tit\nbeen\treplaced?\tYou\tknow\twhy:\tit’s\ttoo\tbig\tand\trisky\ta\tjob.")]),t._v(" "),a("p",[t._v("With\tour\tindividual\tservices\tbeing\tsmall\tin\tsize,\tthe\tcost\tto\treplace\tthem\twith\ta\tbetter\nimplementation,\tor\teven\tdelete\tthem\taltogether,\tis\tmuch\teasier\tto\tmanage.\tHow\toften\thave\nyou\tdeleted\tmore\tthan\ta\thundred\tlines\tof\tcode\tin\ta\tsingle\tday\tand\tnot\tworried\ttoo\tmuch\nabout\tit?\tWith\tmicroservices\toften\tbeing\tof\tsimilar\tsize,\tthe\tbarriers\tto\trewriting\tor\nremoving\tservices\tentirely\tare\tvery\tlow.")]),t._v(" "),a("p",[t._v("Teams\tusing\tmicroservice\tapproaches\tare\tcomfortable\twith\tcompletely\trewriting\tservices\nwhen\trequired,\tand\tjust\tkilling\ta\tservice\twhen\tit\tis\tno\tlonger\tneeded.\tWhen\ta\tcodebase\tis\njust\ta\tfew\thundred\tlines\tlong,\tit\tis\tdifficult\tfor\tpeople\tto\tbecome\temotionally\tattached\tto\nit,\tand\tthe\tcost\tof\treplacing\tit\tis\tpretty\tsmall.")]),t._v(" "),a("h2",{attrs:{id:"whataboutservice-orientedarchitecture"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#whataboutservice-orientedarchitecture"}},[t._v("#")]),t._v(" What\tAbout\tService-Oriented\tArchitecture?")]),t._v(" "),a("p",[t._v("Service-oriented\tarchitecture\t(SOA)\tis\ta\tdesign\tapproach\twhere\tmultiple\tservices\ncollaborate\tto\tprovide\tsome\tend\tset\tof\tcapabilities.\tA\tservice\there\ttypically\tmeans\ta\ncompletely\tseparate\toperating\tsystem\tprocess.\tCommunication\tbetween\tthese\tservices\noccurs\tvia\tcalls\tacross\ta\tnetwork\trather\tthan\tmethod\tcalls\twithin\ta\tprocess\tboundary.")]),t._v(" "),a("p",[t._v("SOA\temerged\tas\tan\tapproach\tto\tcombat\tthe\tchallenges\tof\tthe\tlarge\tmonolithic\napplications.\tIt\tis\tan\tapproach\tthat\taims\tto\tpromote\tthe\treusability\tof\tsoftware;\ttwo\tor\nmore\tend-user\tapplications,\tfor\texample,\tcould\tboth\tuse\tthe\tsame\tservices.\tIt\taims\tto\nmake\tit\teasier\tto\tmaintain\tor\trewrite\tsoftware,\tas\ttheoretically\twe\tcan\treplace\tone\tservice\nwith\tanother\twithout\tanyone\tknowing,\tas\tlong\tas\tthe\tsemantics\tof\tthe\tservice\tdon’t\nchange\ttoo\tmuch.")]),t._v(" "),a("p",[t._v("SOA\tat\tits\theart\tis\ta\tvery\tsensible\tidea.\tHowever,\tdespite\tmany\tefforts,\tthere\tis\ta\tlack\tof\ngood\tconsensus\ton\thow\tto\tdo\tSOA\t "),a("em",[t._v("well")]),t._v(" .\tIn\tmy\topinion,\tmuch\tof\tthe\tindustry\thas\tfailed\tto\nlook\tholistically\tenough\tat\tthe\tproblem\tand\tpresent\ta\tcompelling\talternative\tto\tthe\nnarrative\tset\tout\tby\tvarious\tvendors\tin\tthis\tspace.")]),t._v(" "),a("p",[t._v("Many\tof\tthe\tproblems\tlaid\tat\tthe\tdoor\tof\tSOA\tare\tactually\tproblems\twith\tthings\tlike\ncommunication\tprotocols\t(e.g.,\tSOAP),\tvendor\tmiddleware,\ta\tlack\tof\tguidance\tabout\nservice\tgranularity,\tor\tthe\twrong\tguidance\ton\tpicking\tplaces\tto\tsplit\tyour\tsystem.\tWe’ll\ntackle\teach\tof\tthese\tin\tturn\tthroughout\tthe\trest\tof\tthe\tbook.\tA\tcynic\tmight\tsuggest\tthat\nvendors\tco-opted\t(and\tin\tsome\tcases\tdrove)\tthe\tSOA\tmovement\tas\ta\tway\tto\tsell\tmore\nproducts,\tand\tthose\tselfsame\tproducts\tin\tthe\tend\tundermined\tthe\tgoal\tof\tSOA.")]),t._v(" "),a("p",[t._v("Much\tof\tthe\tconventional\twisdom\taround\tSOA\tdoesn’t\thelp\tyou\tunderstand\thow\tto\tsplit\nsomething\tbig\tinto\tsomething\tsmall.\tIt\tdoesn’t\ttalk\tabout\thow\tbig\tis\ttoo\tbig.\tIt\tdoesn’t\ttalk\nenough\tabout\treal-world,\tpractical\tways\tto\tensure\tthat\tservices\tdo\tnot\tbecome\toverly\ncoupled.\tThe\tnumber\tof\tthings\tthat\tgo\tunsaid\tis\twhere\tmany\tof\tthe\tpitfalls\tassociated\twith\nSOA\toriginate.")]),t._v(" "),a("p",[t._v("The\tmicroservice\tapproach\thas\temerged\tfrom\treal-world\tuse,\ttaking\tour\tbetter\nunderstanding\tof\tsystems\tand\tarchitecture\tto\tdo\tSOA\twell.\tSo\tyou\tshould\tinstead\tthink\tof\nmicroservices\tas\ta\tspecific\tapproach\tfor\tSOA\tin\tthe\tsame\tway\tthat\tXP\tor\tScrum\tare\nspecific\tapproaches\tfor\tAgile\tsoftware\tdevelopment.")]),t._v(" "),a("h2",{attrs:{id:"otherdecompositionaltechniques"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#otherdecompositionaltechniques"}},[t._v("#")]),t._v(" Other\tDecompositional\tTechniques")]),t._v(" "),a("p",[t._v("When\tyou\tget\tdown\tto\tit,\tmany\tof\tthe\tadvantages\tof\ta\tmicroservice-based\tarchitecture\ncome\tfrom\tits\tgranular\tnature\tand\tthe\tfact\tthat\tit\tgives\tyou\tmany\tmore\tchoices\tas\tto\thow\nto\tsolve\tproblems.\tBut\tcould\tsimilar\tdecompositional\ttechniques\tachieve\tthe\tsame\nbenefits?")]),t._v(" "),a("h2",{attrs:{id:"sharedlibraries"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#sharedlibraries"}},[t._v("#")]),t._v(" Shared\tLibraries")]),t._v(" "),a("p",[t._v("A\tvery\tstandard\tdecompositional\ttechnique\tthat\tis\tbuilt\tinto\tvirtually\tany\tlanguage\tis\nbreaking\tdown\ta\tcodebase\tinto\tmultiple\tlibraries.\tThese\tlibraries\tmay\tbe\tprovided\tby\tthird\nparties,\tor\tcreated\tin\tyour\town\torganization.")]),t._v(" "),a("p",[t._v("Libraries\tgive\tyou\ta\tway\tto\tshare\tfunctionality\tbetween\tteams\tand\tservices.\tI\tmight\tcreate\na\tset\tof\tuseful\tcollection\tutilities,\tfor\texample,\tor\tperhaps\ta\tstatistics\tlibrary\tthat\tcan\tbe\nreused.")]),t._v(" "),a("p",[t._v("Teams\tcan\torganize\tthemselves\taround\tthese\tlibraries,\tand\tthe\tlibraries\tthemselves\tcan\tbe\nreused.\tBut\tthere\tare\tsome\tdrawbacks.")]),t._v(" "),a("p",[t._v("First,\tyou\tlose\ttrue\ttechnology\theterogeneity.\tThe\tlibrary\ttypically\thas\tto\tbe\tin\tthe\tsame\nlanguage,\tor\tat\tthe\tvery\tleast\trun\ton\tthe\tsame\tplatform.\tSecond,\tthe\tease\twith\twhich\tyou\ncan\tscale\tparts\tof\tyour\tsystem\tindependently\tfrom\teach\tother\tis\tcurtailed.\tNext,\tunless\nyou’re\tusing\tdynamically\tlinked\tlibraries,\tyou\tcannot\tdeploy\ta\tnew\tlibrary\twithout\nredeploying\tthe\tentire\tprocess,\tso\tyour\tability\tto\tdeploy\tchanges\tin\tisolation\tis\treduced.\nAnd\tperhaps\tthe\tkicker\tis\tthat\tyou\tlack\tthe\tobvious\tseams\taround\twhich\tto\terect\narchitectural\tsafety\tmeasures\tto\tensure\tsystem\tresiliency.")]),t._v(" "),a("p",[t._v("Shared\tlibraries\tdo\thave\ttheir\tplace.\tYou’ll\tfind\tyourself\tcreating\tcode\tfor\tcommon\ttasks\nthat\taren’t\tspecific\tto\tyour\tbusiness\tdomain\tthat\tyou\twant\tto\treuse\tacross\tthe\torganization,\nwhich\tis\tan\tobvious\tcandidate\tfor\tbecoming\ta\treusable\tlibrary.\tYou\tdo\tneed\tto\tbe\tcareful,\nthough.\tShared\tcode\tused\tto\tcommunicate\tbetween\tservices\tcan\tbecome\ta\tpoint\tof\ncoupling,\tsomething\twe’ll\tdiscuss\tin\tChapter\t4.")]),t._v(" "),a("p",[t._v("Services\tcan\tand\tshould\tmake\theavy\tuse\tof\tthird-party\tlibraries\tto\treuse\tcommon\tcode.\nBut\tthey\tdon’t\tget\tus\tall\tthe\tway\tthere.")]),t._v(" "),a("h2",{attrs:{id:"modules"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#modules"}},[t._v("#")]),t._v(" Modules")]),t._v(" "),a("p",[t._v("Some\tlanguages\tprovide\ttheir\town\tmodular\tdecomposition\ttechniques\tthat\tgo\tbeyond\nsimple\tlibraries.\tThey\tallow\tsome\tlifecycle\tmanagement\tof\tthe\tmodules,\tsuch\tthat\tthey\ncan\tbe\tdeployed\tinto\ta\trunning\tprocess,\tallowing\tyou\tto\tmake\tchanges\twithout\ttaking\tthe\nwhole\tprocess\tdown.")]),t._v(" "),a("p",[t._v("The\tOpen\tSource\tGateway\tInitiative\t(OSGI)\tis\tworth\tcalling\tout\tas\tone\ttechnology-\nspecific\tapproach\tto\tmodular\tdecomposition.\tJava\titself\tdoesn’t\thave\ta\ttrue\tconcept\tof\nmodules,\tand\twe’ll\thave\tto\twait\tat\tleast\tuntil\tJava\t9\tto\tsee\tthis\tadded\tto\tthe\tlanguage.\nOSGI,\twhich\temerged\tas\ta\tframework\tto\tallow\tplug-ins\tto\tbe\tinstalled\tin\tthe\tEclipse\tJava\nIDE,\tis\tnow\tused\tas\ta\tway\tto\tretrofit\ta\tmodule\tconcept\tin\tJava\tvia\ta\tlibrary.")]),t._v(" "),a("p",[t._v("The\tproblem\twith\tOSGI\tis\tthat\tit\tis\ttrying\tto\tenforce\tthings\tlike\tmodule\tlifecycle\nmanagement\twithout\tenough\tsupport\tin\tthe\tlanguage\titself.\tThis\tresults\tin\tmore\twork\nhaving\tto\tbe\tdone\tby\tmodule\tauthors\tto\tdeliver\ton\tproper\tmodule\tisolation.\tWithin\ta\nprocess\tboundary,\tit\tis\talso\tmuch\teasier\tto\tfall\tinto\tthe\ttrap\tof\tmaking\tmodules\toverly\ncoupled\tto\teach\tother,\tcausing\tall\tsorts\tof\tproblems.\tMy\town\texperience\twith\tOSGI,\nwhich\tis\tmatched\tby\tthat\tof\tcolleagues\tin\tthe\tindustry,\tis\tthat\teven\twith\tgood\tteams\tit\tis\neasy\tfor\tOSGI\tto\tbecome\ta\tmuch\tbigger\tsource\tof\tcomplexity\tthan\tits\tbenefits\twarrant.")]),t._v(" "),a("p",[t._v("Erlang\tfollows\ta\tdifferent\tapproach,\tin\twhich\tmodules\tare\tbaked\tinto\tthe\tlanguage\nruntime.\tThus,\tErlang\tis\ta\tvery\tmature\tapproach\tto\tmodular\tdecomposition.\tErlang\nmodules\tcan\tbe\tstopped,\trestarted,\tand\tupgraded\twithout\tissue.\tErlang\teven\tsupports\nrunning\tmore\tthan\tone\tversion\tof\tthe\tmodule\tat\ta\tgiven\ttime,\tallowing\tfor\tmore\tgraceful\nmodule\tupgrading.")]),t._v(" "),a("p",[t._v("The\tcapabilities\tof\tErlang’s\tmodules\tare\timpressive\tindeed,\tbut\teven\tif\twe\tare\tlucky\nenough\tto\tuse\ta\tplatform\twith\tthese\tcapabilities,\twe\tstill\thave\tthe\tsame\tshortcomings\tas\nwe\tdo\twith\tnormal\tshared\tlibraries.\tWe\tare\tstrictly\tlimited\tin\tour\tability\tto\tuse\tnew\ntechnologies,\tlimited\tin\thow\twe\tcan\tscale\tindependently,\tcan\tdrift\ttoward\tintegration\ntechniques\tthat\tare\toverly\tcoupling,\tand\tlack\tseams\tfor\tarchitectural\tsafety\tmeasures.")]),t._v(" "),a("p",[t._v("There\tis\tone\tfinal\tobservation\tworth\tsharing.\tTechnically,\tit\tshould\tbe\tpossible\tto\tcreate\nwell-factored,\tindependent\tmodules\twithin\ta\tsingle\tmonolithic\tprocess.\tAnd\tyet\twe\trarely\nsee\tthis\thappen.\tThe\tmodules\tthemselves\tsoon\tbecome\ttightly\tcoupled\twith\tthe\trest\tof\tthe\ncode,\tsurrendering\tone\tof\ttheir\tkey\tbenefits.\tHaving\ta\tprocess\tboundary\tseparation\tdoes\nenforce\tclean\thygiene\tin\tthis\trespect\t(or\tat\tleast\tmakes\tit\tharder\tto\tdo\tthe\twrong\tthing!).\tI\nwouldn’t\tsuggest\tthat\tthis\tshould\tbe\tthe\tmain\tdriver\tfor\tprocess\tseparation,\tof\tcourse,\tbut\nit\tis\tinteresting\tthat\tthe\tpromises\tof\tmodular\tseparation\twithin\tprocess\tboundaries\trarely\ndeliver\tin\tthe\treal\tworld.")]),t._v(" "),a("p",[t._v("So\twhile\tmodular\tdecomposition\twithin\ta\tprocess\tboundary\tmay\tbe\tsomething\tyou\twant\nto\tdo\tas\twell\tas\tdecomposing\tyour\tsystem\tinto\tservices,\tby\titself\tit\twon’t\thelp\tsolve\neverything.\tIf\tyou\tare\ta\tpure\tErlang\tshop,\tthe\tquality\tof\tErlang’s\tmodule\timplementation")]),t._v(" "),a("p",[t._v("may\tget\tyou\ta\tvery\tlong\tway,\tbut\tI\tsuspect\tmany\tof\tyou\tare\tnot\tin\tthat\tsituation.\tFor\tthe\nrest\tof\tus,\twe\tshould\tsee\tmodules\tas\toffering\tthe\tsame\tsorts\tof\tbenefits\tas\tshared\tlibraries.")]),t._v(" "),a("h2",{attrs:{id:"nosilverbullet"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#nosilverbullet"}},[t._v("#")]),t._v(" No\tSilver\tBullet")]),t._v(" "),a("p",[t._v("Before\twe\tfinish,\tI\tshould\tcall\tout\tthat\tmicroservices\tare\tno\tfree\tlunch\tor\tsilver\tbullet,\tand\nmake\tfor\ta\tbad\tchoice\tas\ta\tgolden\thammer.\tThey\thave\tall\tthe\tassociated\tcomplexities\tof\ndistributed\tsystems,\tand\twhile\twe\thave\tlearned\ta\tlot\tabout\thow\tto\tmanage\tdistributed\nsystems\twell\t(which\twe’ll\tdiscuss\tthroughout\tthe\tbook)\tit\tis\tstill\thard.\tIf\tyou’re\tcoming\nfrom\ta\tmonolithic\tsystem\tpoint\tof\tview,\tyou’ll\thave\tto\tget\tmuch\tbetter\tat\thandling\ndeployment,\ttesting,\tand\tmonitoring\tto\tunlock\tthe\tbenefits\twe’ve\tcovered\tso\tfar.\tYou’ll\nalso\tneed\tto\tthink\tdifferently\tabout\thow\tyou\tscale\tyour\tsystems\tand\tensure\tthat\tthey\tare\nresilient.\tDon’t\talso\tbe\tsurprised\tif\tthings\tlike\tdistributed\ttransactions\tor\tCAP\ttheorem\nstart\tgiving\tyou\theadaches,\teither!")]),t._v(" "),a("p",[t._v("Every\tcompany,\torganization,\tand\tsystem\tis\tdifferent.\tA\tnumber\tof\tfactors\twill\tplay\tinto\nwhether\tor\tnot\tmicroservices\tare\tright\tfor\tyou,\tand\thow\taggressive\tyou\tcan\tbe\tin\tadopting\nthem.\tThroughout\teach\tchapter\tin\tthis\tbook\tI’ll\tattempt\tto\tgive\tyou\tguidance\thighlighting\nthe\tpotential\tpitfalls,\twhich\tshould\thelp\tyou\tchart\ta\tsteady\tpath.")]),t._v(" "),a("h2",{attrs:{id:"summary"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#summary"}},[t._v("#")]),t._v(" Summary")]),t._v(" "),a("p",[t._v("Hopefully\tby\tnow\tyou\tknow\twhat\ta\tmicroservice\tis,\twhat\tmakes\tit\tdifferent\tfrom\tother\ncompositional\ttechniques,\tand\twhat\tsome\tof\tthe\tkey\tadvantages\tare.\tIn\teach\tof\tthe\nfollowing\tchapters\twe\twill\tgo\tinto\tmore\tdetail\ton\thow\tto\tachieve\tthese\tbenefits\tand\thow\nto\tavoid\tsome\tof\tthe\tcommon\tpitfalls.")]),t._v(" "),a("p",[t._v("There\tare\ta\tnumber\tof\ttopics\tto\tcover,\tbut\twe\tneed\tto\tstart\tsomewhere.\tOne\tof\tthe\tmain\nchallenges\tthat\tmicroservices\tintroduce\tis\ta\tshift\tin\tthe\trole\tof\tthose\twho\toften\tguide\tthe\nevolution\tof\tour\tsystems:\tthe\tarchitects.\tWe’ll\tlook\tnext\tat\tsome\tdifferent\tapproaches\tto\nthis\trole\tthat\tcan\tensure\twe\tget\tthe\tmost\tout\tof\tthis\tnew\tarchitecture.")]),t._v(" "),a("h1",{attrs:{id:"chapter2-theevolutionaryarchitect"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#chapter2-theevolutionaryarchitect"}},[t._v("#")]),t._v(" Chapter\t2.\tThe\tEvolutionary\tArchitect")]),t._v(" "),a("p",[t._v("As\twe\thave\tseen\tso\tfar,\tmicroservices\tgive\tus\ta\tlot\tof\tchoice,\tand\taccordingly\ta\tlot\tof\ndecisions\tto\tmake.\tFor\texample,\thow\tmany\tdifferent\ttechnologies\tshould\twe\tuse,\tshould\nwe\tlet\tdifferent\tteams\tuse\tdifferent\tprogramming\tidioms,\tand\tshould\twe\tsplit\tor\tmerge\ta\nservice?\tHow\tdo\twe\tgo\tabout\tmaking\tthese\tdecisions?\tWith\tthe\tfaster\tpace\tof\tchange,\tand\nthe\tmore\tfluid\tenvironment\tthat\tthese\tarchitectures\tallow,\tthe\trole\tof\tthe\tarchitect\talso\thas\nto\tchange.\tIn\tthis\tchapter,\tI’ll\ttake\ta\tfairly\topinionated\tview\tof\twhat\tthe\trole\tof\tan\narchitect\tis,\tand\thopefully\tlaunch\tone\tfinal\tassault\ton\tthe\tivory\ttower.")]),t._v(" "),a("h2",{attrs:{id:"inaccuratecomparisons"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#inaccuratecomparisons"}},[t._v("#")]),t._v(" Inaccurate\tComparisons")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("You\tkeep\tusing\tthat\tword.\tI\tdo\tnot\tthink\tit\tmeans\twhat\tyou\tthink\tit\tmeans.\nInigo\tMontoya,\tfrom\t The\tPrincess\tBride\n")])])]),a("p",[t._v("Architects\thave\tan\timportant\tjob.\tThey\tare\tin\tcharge\tof\tmaking\tsure\twe\thave\ta\tjoined-up\ntechnical\tvision,\tone\tthat\tshould\thelp\tus\tdeliver\tthe\tsystem\tour\tcustomers\tneed.\tIn\tsome\nplaces,\tthey\tmay\tonly\thave\tto\twork\twith\tone\tteam,\tin\twhich\tcase\tthe\trole\tof\tthe\tarchitect\nand\ttechnical\tlead\tis\toften\tthe\tsame.\tIn\tothers,\tthey\tmay\tbe\tdefining\tthe\tvision\tfor\tan\nentire\tprogram\tof\twork,\tcoordinating\twith\tmultiple\tteams\tacross\tthe\tworld,\tor\tperhaps\neven\tan\tentire\torganization.\tAt\twhatever\tlevel\tthey\toperate,\tthe\trole\tis\ta\ttricky\tone\tto\tpin\ndown,\tand\tdespite\tit\toften\tbeing\tthe\tobvious\tcareer\tprogression\tfor\tdevelopers\tin\nenterprise\torganizations,\tit\tis\talso\ta\trole\tthat\tgets\tmore\tcriticism\tthan\tvirtually\tany\tother.\nMore\tthan\tany\tother\trole,\tarchitects\tcan\thave\ta\tdirect\timpact\ton\tthe\tquality\tof\tthe\tsystems\nbuilt,\ton\tthe\tworking\tconditions\tof\ttheir\tcolleagues,\tand\ton\ttheir\torganization’s\tability\tto\nrespond\tto\tchange,\tand\tyet\twe\tso\tfrequently\tseem\tto\tget\tthis\trole\twrong.\tWhy\tis\tthat?")]),t._v(" "),a("p",[t._v("Our\tindustry\tis\ta\tyoung\tone.\tThis\tis\tsomething\twe\tseem\tto\tforget,\tand\tyet\twe\thave\tonly\nbeen\tcreating\tprograms\tthat\trun\ton\twhat\twe\trecognize\tas\tcomputers\tfor\taround\t70\tyears.\nTherefore,\twe\tare\tconstantly\tlooking\tto\tother\tprofessions\tin\tan\tattempt\tto\texplain\twhat\twe\ndo.\tWe\taren’t\tmedical\tdoctors\tor\tengineers,\tbut\tnor\tare\twe\tplumbers\tor\telectricians.\nInstead,\twe\tfall\tinto\tsome\tmiddle\tground,\twhich\tmakes\tit\thard\tfor\tsociety\tto\tunderstand\nus,\tor\tfor\tus\tto\tunderstand\twhere\twe\tfit.")]),t._v(" "),a("p",[t._v("So\twe\tborrow\tfrom\tother\tprofessions.\tWe\tcall\tourselves\tsoftware\t“engineers,”\tor\n“architects.”\tBut\twe\taren’t,\tare\twe?\tArchitects\tand\tengineers\thave\ta\trigor\tand\tdiscipline\nwe\tcould\tonly\tdream\tof,\tand\ttheir\timportance\tin\tsociety\tis\twell\tunderstood.\tI\tremember\ntalking\tto\ta\tfriend\tof\tmine,\tthe\tday\tbefore\the\tbecame\ta\tqualified\tarchitect.\t“Tomorrow,”\the\nsaid,\t“if\tI\tgive\tyou\tadvice\tdown\tat\tthe\tpub\tabout\thow\tto\tbuild\tsomething\tand\tit’s\twrong,\tI\nget\theld\tto\taccount.\tI\tcould\tget\tsued,\tas\tin\tthe\teyes\tof\tthe\tlaw\tI\tam\tnow\ta\tqualified\narchitect\tand\tI\tshould\tbe\theld\tresponsible\tif\tI\tget\tit\twrong.”\tThe\timportance\tof\tthese\tjobs\nto\tsociety\tmeans\tthat\tthere\tare\trequired\tqualifications\tpeople\thave\tto\tmeet.\tIn\tthe\tUK,\tfor\nexample,\ta\tminimum\tof\tseven\tyears\tstudy\tis\trequired\tbefore\tyou\tcan\tbe\tcalled\tan\narchitect.\tBut\tthese\tjobs\tare\talso\tbased\ton\ta\tbody\tof\tknowledge\tgoing\tback\tthousands\tof\nyears.\tAnd\tus?\tNot\tquite.\tWhich\tis\talso\twhy\tI\tview\tmost\tforms\tof\tIT\tcertification\tas\nworthless,\tas\twe\tknow\tso\tlittle\tabout\twhat\t "),a("em",[t._v("good")]),t._v(" \tlooks\tlike.")]),t._v(" "),a("p",[t._v("Part\tof\tus\twants\trecognition,\tso\twe\tborrow\tnames\tfrom\tother\tprofessions\tthat\talready\thave\nthe\trecognition\twe\tas\tan\tindustry\tcrave.\tBut\tthis\tcan\tbe\tdoubly\tharmful.\tFirst,\tit\timplies\nwe\tknow\twhat\twe\tare\tdoing,\twhen\twe\tplainly\tdon’t.\tI\twouldn’t\tsay\tthat\tbuildings\tand\nbridges\tnever\tfall\tdown,\tbut\tthey\tfall\tdown\tmuch\tless\tthan\tthe\tnumber\tof\ttimes\tour\nprograms\twill\tcrash,\tmaking\tcomparisons\twith\tengineers\tquite\tunfair.\tSecond,\tthe\nanalogies\tbreak\tdown\tvery\tquickly\twhen\tgiven\teven\ta\tcursory\tglance.\tTo\tturn\tthings")]),t._v(" "),a("p",[t._v("around,\tif\tbridge\tbuilding\twere\tlike\tprogramming,\thalfway\tthrough\twe’d\tfind\tout\tthat\tthe\nfar\tbank\twas\tnow\t50\tmeters\tfarther\tout,\tthat\tit\twas\tactually\tmud\trather\tthan\tgranite,\tand\nthat\trather\tthan\tbuilding\ta\tfootbridge\twe\twere\tinstead\tbuilding\ta\troad\tbridge.\tOur\tsoftware\nisn’t\tconstrained\tby\tthe\tsame\tphysical\trules\tthat\treal\tarchitects\tor\tengineers\thave\tto\tdeal\nwith,\tand\twhat\twe\tcreate\tis\tdesigned\tto\tflex\tand\tadapt\tand\tevolve\twith\tuser\trequirements.")]),t._v(" "),a("p",[t._v("Perhaps\tthe\tterm\t "),a("em",[t._v("architect")]),t._v(" \thas\tdone\tthe\tmost\tharm.\tThe\tidea\tof\tsomeone\twho\tdraws\tup\ndetailed\tplans\tfor\tothers\tto\tinterpret,\tand\texpects\tthis\tto\tbe\tcarried\tout.\tThe\tbalance\tof\tpart\nartist,\tpart\tengineer,\toverseeing\tthe\tcreation\tof\twhat\tis\tnormally\ta\tsingular\tvision,\twith\tall\nother\tviewpoints\tbeing\tsubservient,\texcept\tfor\tthe\toccasional\tobjection\tfrom\tthe\tstructural\nengineer\tregarding\tthe\tlaws\tof\tphysics.\tIn\tour\tindustry,\tthis\tview\tof\tthe\tarchitect\tleads\tto\nsome\tterrible\tpractices.\tDiagram\tafter\tdiagram,\tpage\tafter\tpage\tof\tdocumentation,\tcreated\nwith\ta\tview\tto\tinform\tthe\tconstruction\tof\tthe\tperfect\tsystem,\twithout\ttaking\tinto\taccount\nthe\tfundamentally\tunknowable\tfuture.\tUtterly\tdevoid\tof\tany\tunderstanding\tas\tto\thow\thard\nit\twill\tbe\tto\timplement,\tor\twhether\tor\tnot\tit\twill\tactually\twork,\tlet\talone\thaving\tany\tability\nto\tchange\tas\twe\tlearn\tmore.")]),t._v(" "),a("p",[t._v("When\twe\tcompare\tourselves\tto\tengineers\tor\tarchitects,\twe\tare\tin\tdanger\tof\tdoing\neveryone\ta\tdisservice.\tUnfortunately,\twe\tare\tstuck\twith\tthe\tword\t "),a("em",[t._v("architect")]),t._v(" \tfor\tnow.\tSo\tthe\nbest\twe\tcan\tdo\tis\tto\tredefine\twhat\tit\tmeans\tin\tour\tcontext.")]),t._v(" "),a("h2",{attrs:{id:"anevolutionaryvisionforthearchitect"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#anevolutionaryvisionforthearchitect"}},[t._v("#")]),t._v(" An\tEvolutionary\tVision\tfor\tthe\tArchitect")]),t._v(" "),a("p",[t._v("Our\trequirements\tshift\tmore\trapidly\tthan\tthey\tdo\tfor\tpeople\twho\tdesign\tand\tbuild\nbuildings\t—\tas\tdo\tthe\ttools\tand\ttechniques\tat\tour\tdisposal.\tThe\tthings\twe\tcreate\tare\tnot\nfixed\tpoints\tin\ttime.\tOnce\tlaunched\tinto\tproduction,\tour\tsoftware\twill\tcontinue\tto\tevolve\nas\tthe\tway\tit\tis\tused\tchanges.\tFor\tmost\tthings\twe\tcreate,\twe\thave\tto\taccept\tthat\tonce\tthe\nsoftware\tgets\tinto\tthe\thands\tof\tour\tcustomers\twe\twill\thave\tto\treact\tand\tadapt,\trather\tthan\nit\tbeing\ta\tnever-changing\tartifact.\tThus,\tour\tarchitects\tneed\tto\tshift\ttheir\tthinking\taway\nfrom\tcreating\tthe\tperfect\tend\tproduct,\tand\tinstead\tfocus\ton\thelping\tcreate\ta\tframework\tin\nwhich\tthe\tright\tsystems\tcan\temerge,\tand\tcontinue\tto\tgrow\tas\twe\tlearn\tmore.")]),t._v(" "),a("p",[t._v("Although\tI\thave\tspent\tmuch\tof\tthe\tchapter\tso\tfar\twarning\tyou\toff\tcomparing\tourselves\ttoo\nmuch\tto\tother\tprofessions,\tthere\tis\tone\tanalogy\tthat\tI\tlike\twhen\tit\tcomes\tto\tthe\trole\tof\tthe\nIT\tarchitect\tand\tthat\tI\tthink\tbetter\tencapsulates\twhat\twe\twant\tthis\trole\tto\tbe.\tErik\nDoernenburg\tfirst\tshared\twith\tme\tthe\tidea\tthat\twe\tshould\tthink\tof\tour\trole\tmore\tas\ttown\nplanners\tthan\tarchitects\tfor\tthe\tbuilt\tenvironment.\tThe\trole\tof\tthe\ttown\tplanner\tshould\tbe\nfamiliar\tto\tany\tof\tyou\twho\thave\tplayed\tSimCity\tbefore.\tA\ttown\tplanner’s\trole\tis\tto\tlook\tat\na\tmultitude\tof\tsources\tof\tinformation,\tand\tthen\tattempt\tto\toptimize\tthe\tlayout\tof\ta\tcity\tto\nbest\tsuit\tthe\tneeds\tof\tthe\tcitizens\ttoday,\ttaking\tinto\taccount\tfuture\tuse.\tThe\tway\the\ninfluences\thow\tthe\tcity\tevolves,\tthough,\tis\tinteresting.\tHe\tdoes\tnot\tsay,\t“build\tthis\nspecific\tbuilding\tthere”;\tinstead,\the\t "),a("em",[t._v("zones\ta\tcity")]),t._v(" .\tSo\tas\tin\tSimCity,\tyou\tmight\tdesignate\npart\tof\tyour\tcity\tas\tan\tindustrial\tzone,\tand\tanother\tpart\tas\ta\tresidential\tzone.\tIt\tis\tthen\tup\nto\tother\tpeople\tto\tdecide\twhat\texact\tbuildings\tget\tcreated,\tbut\tthere\tare\trestrictions:\tif\tyou\nwant\tto\tbuild\ta\tfactory,\tit\twill\tneed\tto\tbe\tin\tan\tindustrial\tzone.\tRather\tthan\tworrying\ttoo\nmuch\tabout\twhat\thappens\tin\tone\tzone,\tthe\ttown\tplanner\twill\tinstead\tspend\tfar\tmore\ttime\nworking\tout\thow\tpeople\tand\tutilities\tmove\tfrom\tone\tzone\tto\tanother.")]),t._v(" "),a("p",[t._v("More\tthan\tone\tperson\thas\tlikened\ta\tcity\tto\ta\tliving\tcreature.\tThe\tcity\tchanges\tover\ttime.\tIt\nshifts\tand\tevolves\tas\tits\toccupants\tuse\tit\tin\tdifferent\tways,\tor\tas\texternal\tforces\tshape\tit.\nThe\ttown\tplanner\tdoes\this\tbest\tto\tanticipate\tthese\tchanges,\tbut\taccepts\tthat\ttrying\tto\texert\ndirect\tcontrol\tover\tall\taspects\tof\twhat\thappens\tis\tfutile.")]),t._v(" "),a("p",[t._v("The\tcomparison\twith\tsoftware\tshould\tbe\tobvious.\tAs\tour\tusers\tuse\tour\tsoftware,\twe\tneed\nto\treact\tand\tchange.\tWe\tcannot\tforesee\teverything\tthat\twill\thappen,\tand\tso\trather\tthan\nplan\tfor\tany\teventuality,\twe\tshould\tplan\tto\tallow\tfor\tchange\tby\tavoiding\tthe\turge\tto\noverspecify\tevery\tlast\tthing.\tOur\tcity\t—\tthe\tsystem\t—\tneeds\tto\tbe\ta\tgood,\thappy\tplace\tfor\neveryone\twho\tuses\tit.\tOne\tthing\tthat\tpeople\toften\tforget\tis\tthat\tour\tsystem\tdoesn’t\tjust\naccommodate\tusers;\tit\talso\taccommodates\tdevelopers\tand\toperations\tpeople\twho\talso\nhave\tto\twork\tthere,\tand\twho\thave\tthe\tjob\tof\tmaking\tsure\tit\tcan\tchange\tas\trequired.\tTo\nborrow\ta\tterm\tfrom\tFrank\tBuschmann,\tarchitects\thave\ta\tduty\tto\tensure\tthat\tthe\tsystem\tis\n"),a("em",[t._v("habitable")]),t._v(" \tfor\tdevelopers\ttoo.")]),t._v(" "),a("p",[t._v("A\ttown\tplanner,\tjust\tlike\tan\tarchitect,\talso\tneeds\tto\tknow\twhen\this\tplan\tisn’t\tbeing")]),t._v(" "),a("p",[t._v("followed.\tAs\the\tis\tless\tprescriptive,\tthe\tnumber\tof\ttimes\the\tneeds\tto\tget\tinvolved\tto\ncorrect\tdirection\tshould\tbe\tminimal,\tbut\tif\tsomeone\tdecides\tto\tbuild\ta\tsewage\tplant\tin\ta\nresidential\tarea,\the\tneeds\tto\tbe\table\tto\tshut\tit\tdown.")]),t._v(" "),a("p",[t._v("So\tour\tarchitects\tas\ttown\tplanners\tneed\tto\tset\tdirection\tin\tbroad\tstrokes,\tand\tonly\tget\ninvolved\tin\tbeing\thighly\tspecific\tabout\timplementation\tdetail\tin\tlimited\tcases.\tThey\tneed\nto\tensure\tthat\tthe\tsystem\tis\tfit\tfor\tpurpose\tnow,\tbut\talso\ta\tplatform\tfor\tthe\tfuture.\tAnd\nthey\tneed\tto\tensure\tthat\tit\tis\ta\tsystem\tthat\tmakes\tusers\tand\tdevelopers\tequally\thappy.\tThis\nsounds\tlike\ta\tpretty\ttall\torder.\tWhere\tdo\twe\tstart?")]),t._v(" "),a("h2",{attrs:{id:"zoning"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#zoning"}},[t._v("#")]),t._v(" Zoning")]),t._v(" "),a("p",[t._v("So,\tto\tcontinue\tthe\tmetaphor\tof\tthe\tarchitect\tas\ttown\tplanner\tfor\ta\tmoment,\twhat\tare\tour\nzones?\tThese\tare\tour\tservice\tboundaries,\tor\tperhaps\tcoarse-grained\tgroups\tof\tservices.\tAs\narchitects,\twe\tneed\tto\tworry\tmuch\tless\tabout\twhat\thappens\t "),a("em",[t._v("inside")]),t._v(" \tthe\tzone\tthan\twhat\nhappens\t "),a("em",[t._v("between")]),t._v(" \tthe\tzones.\tThat\tmeans\twe\tneed\tto\tspend\ttime\tthinking\tabout\thow\tour\nservices\ttalk\tto\teach\tother,\tor\tensuring\tthat\twe\tcan\tproperly\tmonitor\tthe\toverall\thealth\tof\nour\tsystem.\tHow\tinvolved\twe\tget\tinside\tthe\tzone\twill\tvary\tsomewhat.\tMany\torganizations\nhave\tadopted\tmicroservices\tin\torder\tto\tmaximize\tfor\tautonomy\tof\tteams,\tsomething\twe’ll\nexpand\ton\tin\tChapter\t10.\tIf\tyou\tare\tin\tsuch\tan\torganization,\tyou\twill\trely\tmore\ton\tthe\nteam\tto\tmake\tthe\tright\tlocal\tdecision.")]),t._v(" "),a("p",[t._v("But\tbetween\tthe\tzones,\tor\tthe\tboxes\ton\tour\ttraditional\tarchitecture\tdiagram,\twe\tneed\tto\tbe\ncareful;\tgetting\tthings\twrong\there\tleads\tto\tall\tsorts\tof\tproblems\tand\tcan\tbe\tvery\thard\tto\ncorrect.")]),t._v(" "),a("p",[t._v("Within\teach\tservice,\tyou\tmay\tbe\tOK\twith\tthe\tteam\twho\towns\tthat\tzone\tpicking\ta\tdifferent\ntechnology\tstack\tor\tdata\tstore.\tOther\tconcerns\tmay\tkick\tin\there,\tof\tcourse.\tYour\ninclination\tto\tlet\tteams\tpick\tthe\tright\ttool\tfor\tthe\tjob\tmay\tbe\ttempered\tby\tthe\tfact\tthat\tit\nbecomes\tharder\tto\thire\tpeople\tor\tmove\tthem\tbetween\tteams\tif\tyou\thave\t10\tdifferent\ntechnology\tstacks\tto\tsupport.\tSimilarly,\tif\teach\tteam\tpicks\ta\tcompletely\tdifferent\tdata\nstore,\tyou\tmay\tfind\tyourself\tlacking\tenough\texperience\tto\trun\tany\tof\tthem\tat\tscale.\nNetflix,\tfor\texample,\thas\tmostly\tstandardized\ton\tCassandra\tas\ta\tdata-store\ttechnology.\nAlthough\tit\tmay\tnot\tbe\tthe\tbest\tfit\tfor\tall\tof\tits\tcases,\tNetflix\tfeels\tthat\tthe\tvalue\tgained\tby\nbuilding\ttooling\tand\texpertise\taround\tCassandra\tis\tmore\timportant\tthan\thaving\tto\tsupport\nand\toperate\tat\tscale\tmultiple\tother\tplatforms\tthat\tmay\tbe\ta\tbetter\tfit\tfor\tcertain\ttasks.\nNetflix\tis\tan\textreme\texample,\twhere\tscale\tis\tlikely\tthe\tstrongest\toverriding\tfactor,\tbut\nyou\tget\tthe\tidea.")]),t._v(" "),a("p",[t._v("Between\tservices\tis\twhere\tthings\tcan\tget\tmessy,\thowever.\tIf\tone\tservice\tdecides\tto\texpose\nREST\tover\tHTTP,\tanother\tmakes\tuse\tof\tprotocol\tbuffers,\tand\ta\tthird\tuses\tJava\tRMI,\tthen\nintegration\tcan\tbecome\ta\tnightmare\tas\tconsuming\tservices\thave\tto\tunderstand\tand\tsupport\nmultiple\tstyles\tof\tinterchange.\tThis\tis\twhy\tI\ttry\tto\tstick\tto\tthe\tguideline\tthat\twe\tshould\t“be\nworried\tabout\twhat\thappens\tbetween\tthe\tboxes,\tand\tbe\tliberal\tin\twhat\thappens\tinside.”")]),t._v(" "),a("p",[a("strong",[t._v("THE\tCODING\tARCHITECT")]),t._v("\nIf\twe\tare\tto\tensure\tthat\tthe\tsystems\twe\tcreate\tare\thabitable\tfor\tour\tdevelopers,\tthen\tour\tarchitects\tneed\tto\nunderstand\tthe\timpact\tof\ttheir\tdecisions.\tAt\tthe\tvery\tleast,\tthis\tmeans\tspending\ttime\twith\tthe\tteam,\tand\tideally\tit\nshould\tmean\tthat\tthese\tdevelopers\tactually\tspend\ttime\tcoding\twith\tthe\tteam\ttoo.\tFor\tthose\tof\tyou\twho\tpractice\tpair\nprogramming,\tit\tbecomes\ta\tsimple\tmatter\tfor\tan\tarchitect\tto\tjoin\ta\tteam\tfor\ta\tshort\tperiod\tas\tone\tmember\tof\tthe\npair.\tIdeally,\tyou\tshould\twork\ton\tnormal\tstories,\tto\treally\tunderstand\twhat\t "),a("em",[t._v("normal")]),t._v(" \twork\tis\tlike.\tI\tcannot\temphasize\nhow\timportant\tit\tis\tfor\tthe\tarchitect\tto\tactually\tsit\twith\tthe\tteam!\tThis\tis\tsignificantly\tmore\teffective\tthan\thaving\ta\ncall\tor\tjust\tlooking\tat\ther\tcode.\nAs\tfor\thow\toften\tyou\tshould\tdo\tthis,\tthat\tdepends\tgreatly\ton\tthe\tsize\tof\tthe\tteam(s)\tyou\tare\tworking\twith.\tBut\tthe\nkey\tis\tthat\tit\tshould\tbe\ta\troutine\tactivity.\tIf\tyou\tare\tworking\twith\tfour\tteams,\tfor\texample,\tspending\thalf\ta\tday\twith\neach\tteam\tevery\tfour\tweeks\tensures\tyou\tbuild\tan\tawareness\tand\timproved\tcommunications\twith\tthe\tteams\tyou\tare\nworking\twith.")]),t._v(" "),a("h2",{attrs:{id:"aprincipledapproach"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#aprincipledapproach"}},[t._v("#")]),t._v(" A\tPrincipled\tApproach")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("Rules\tare\tfor\tthe\tobedience\tof\tfools\tand\tthe\tguidance\tof\twise\tmen.\nGenerally\tattributed\tto\tDouglas\tBader\n")])])]),a("p",[t._v("Making\tdecisions\tin\tsystem\tdesign\tis\tall\tabout\ttrade-offs,\tand\tmicroservice\tarchitectures\ngive\tus\tlots\tof\ttrade-offs\tto\tmake!\tWhen\tpicking\ta\tdatastore,\tdo\twe\tpick\ta\tplatform\tthat\nwe\thave\tless\texperience\twith,\tbut\tthat\tgives\tus\tbetter\tscaling?\tIs\tit\tOK\tfor\tus\tto\thave\ttwo\ndifferent\ttechnology\tstacks\tin\tour\tsystem?\tWhat\tabout\tthree?\tSome\tdecisions\tcan\tbe\tmade\ncompletely\ton\tthe\tspot\twith\tinformation\tavailable\tto\tus,\tand\tthese\tare\tthe\teasiest\tto\tmake.\nBut\twhat\tabout\tthose\tdecisions\tthat\tmight\thave\tto\tbe\tmade\ton\tincomplete\tinformation?")]),t._v(" "),a("p",[t._v("Framing\there\tcan\thelp,\tand\ta\tgreat\tway\tto\thelp\tframe\tour\tdecision\tmaking\tis\tto\tdefine\ta\nset\tof\tprinciples\tand\tpractices\tthat\tguide\tit,\tbased\ton\tgoals\tthat\twe\tare\ttrying\tto\tachieve.\nLet’s\tlook\tat\teach\tin\tturn.")]),t._v(" "),a("h2",{attrs:{id:"strategicgoals"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#strategicgoals"}},[t._v("#")]),t._v(" Strategic\tGoals")]),t._v(" "),a("p",[t._v("The\trole\tof\tthe\tarchitect\tis\talready\tdaunting\tenough,\tso\tluckily\twe\tusually\tdon’t\thave\tto\nalso\tdefine\tstrategic\tgoals!\tStrategic\tgoals\tshould\tspeak\tto\twhere\tyour\tcompany\tis\tgoing,\nand\thow\tit\tsees\titself\tas\tbest\tmaking\tits\tcustomers\thappy.\tThese\twill\tbe\thigh-level\tgoals,\nand\tmay\tnot\tinclude\ttechnology\tat\tall.\tThey\tcould\tbe\tdefined\tat\ta\tcompany\tlevel\tor\ta\ndivision\tlevel.\tThey\tmight\tbe\tthings\tlike\t“Expand\tinto\tSoutheast\tAsia\tto\tunlock\tnew\nmarkets,”\tor\t“Let\tthe\tcustomer\tachieve\tas\tmuch\tas\tpossible\tusing\tself-service.”\tThe\tkey\tis\nthat\tthis\tis\twhere\tyour\torganization\tis\theaded,\tso\tyou\tneed\tto\tmake\tsure\tthe\ttechnology\tis\naligned\tto\tit.")]),t._v(" "),a("p",[t._v("If\tyou’re\tthe\tperson\tdefining\tthe\tcompany’s\ttechnical\tvision,\tthis\tmay\tmean\tyou’ll\tneed\tto\nspend\tmore\ttime\twith\tthe\tnontechnical\tparts\tof\tyour\torganization\t(or\t "),a("em",[t._v("the\tbusiness")]),t._v(" ,\tas\tthey\nare\toften\tcalled).\tWhat\tis\tthe\tdriving\tvision\tfor\tthe\tbusiness?\tAnd\thow\tdoes\tit\tchange?")]),t._v(" "),a("h2",{attrs:{id:"principles"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#principles"}},[t._v("#")]),t._v(" Principles")]),t._v(" "),a("p",[t._v("Principles\tare\trules\tyou\thave\tmade\tin\torder\tto\talign\twhat\tyou\tare\tdoing\tto\tsome\tlarger\ngoal,\tand\twill\tsometimes\tchange.\tFor\texample,\tif\tone\tof\tyour\tstrategic\tgoals\tas\tan\norganization\tis\tto\tdecrease\tthe\ttime\tto\tmarket\tfor\tnew\tfeatures,\tyou\tmay\tdefine\ta\tprinciple\nthat\tsays\tthat\tdelivery\tteams\thave\tfull\tcontrol\tover\tthe\tlifecycle\tof\ttheir\tsoftware\tto\tship\nwhenever\tthey\tare\tready,\tindependently\tof\tany\tother\tteam.\tIf\tanother\tgoal\tis\tthat\tyour\norganization\tis\tmoving\tto\taggressively\tgrow\tits\toffering\tin\tother\tcountries,\tyou\tmay\ndecide\tto\timplement\ta\tprinciple\tthat\tthe\tentire\tsystem\tmust\tbe\tportable\tto\tallow\tfor\tit\tto\tbe\ndeployed\tlocally\tin\torder\tto\trespect\tsovereignty\tof\tdata.")]),t._v(" "),a("p",[t._v("You\tprobably\tdon’t\twant\tloads\tof\tthese.\tFewer\tthan\t10\tis\ta\tgood\tnumber\t—\tsmall\tenough\nthat\tpeople\tcan\tremember\tthem,\tor\tto\tfit\ton\tsmall\tposters.\tThe\tmore\tprinciples\tyou\thave,\nthe\tgreater\tthe\tchance\tthat\tthey\toverlap\tor\tcontradict\teach\tother.")]),t._v(" "),a("p",[t._v("Heroku’s\t12\tFactors\tare\ta\tset\tof\tdesign\tprinciples\tstructured\taround\tthe\tgoal\tof\thelping\nyou\tcreate\tapplications\tthat\twork\twell\ton\tthe\tHeroku\tplatform.\tThey\talso\tmay\twell\tmake\nsense\tin\tother\tcontexts.\tSome\tof\tthe\tprinciples\tare\tactually\tconstraints\tbased\ton\tbehaviors\nyour\tapplication\tneeds\tto\texhibit\tin\torder\tto\twork\ton\tHeroku.\tA\tconstraint\tis\treally\nsomething\tthat\tis\tvery\thard\t(or\tvirtually\timpossible)\tto\tchange,\twhereas\tprinciples\tare\nthings\twe\tdecide\tto\tchoose.\tYou\tmay\tdecide\tto\texplicitly\tcall\tout\tthose\tthings\tthat\tare\nprinciples\tversus\tthose\tthat\tare\tconstraints,\tto\thelp\tindicate\tthose\tthings\tyou\treally\tcan’t\nchange.\tPersonally,\tI\tthink\tthere\tcan\tbe\tsome\tvalue\tin\tkeeping\tthem\tin\tthe\tsame\tlist\tto\nencourage\tchallenging\tconstraints\tevery\tnow\tand\tthen\tand\tsee\tif\tthey\treally\tare\nimmovable!")]),t._v(" "),a("h2",{attrs:{id:"practices"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#practices"}},[t._v("#")]),t._v(" Practices")]),t._v(" "),a("p",[t._v("Our\tpractices\tare\thow\twe\tensure\tour\tprinciples\tare\tbeing\tcarried\tout.\tThey\tare\ta\tset\tof\ndetailed,\tpractical\tguidance\tfor\tperforming\ttasks.\tThey\twill\toften\tbe\ttechnology-specific,\nand\tshould\tbe\tlow\tlevel\tenough\tthat\tany\tdeveloper\tcan\tunderstand\tthem.\tPractices\tcould\ninclude\tcoding\tguidelines,\tthe\tfact\tthat\tall\tlog\tdata\tneeds\tto\tbe\tcaptured\tcentrally,\tor\tthat\nHTTP/REST\tis\tthe\tstandard\tintegration\tstyle.\tDue\tto\ttheir\ttechnical\tnature,\tpractices\twill\noften\tchange\tmore\toften\tthan\tprinciples.")]),t._v(" "),a("p",[t._v("As\twith\tprinciples,\tsometimes\tpractices\treflect\tconstraints\tin\tyour\torganization.\tFor\nexample,\tif\tyou\tsupport\tonly\tCentOS,\tthis\twill\tneed\tto\tbe\treflected\tin\tyour\tpractices.")]),t._v(" "),a("p",[t._v("Practices\tshould\tunderpin\tour\tprinciples.\tA\tprinciple\tstating\tthat\tdelivery\tteams\tcontrol\nthe\tfull\tlifecycle\tof\ttheir\tsystems\tmay\tmean\tyou\thave\ta\tpractice\tstating\tthat\tall\tservices\nare\tdeployed\tinto\tisolated\tAWS\taccounts,\tproviding\tself-service\tmanagement\tof\tthe\nresources\tand\tisolation\tfrom\tother\tteams.")]),t._v(" "),a("h2",{attrs:{id:"combiningprinciplesandpractices"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#combiningprinciplesandpractices"}},[t._v("#")]),t._v(" Combining\tPrinciples\tand\tPractices")]),t._v(" "),a("p",[t._v("One\tperson’s\tprinciples\tare\tanother’s\tpractices.\tYou\tmight\tdecide\tto\tcall\tthe\tuse\tof\nHTTP/REST\ta\tprinciple\trather\tthan\ta\tpractice,\tfor\texample.\tAnd\tthat\twould\tbe\tfine.\tThe\nkey\tpoint\tis\tthat\tthere\tis\tvalue\tin\thaving\toverarching\tideas\tthat\tguide\thow\tthe\tsystem\nevolves,\tand\tin\thaving\tenough\tdetail\tso\tthat\tpeople\tknow\thow\tto\timplement\tthose\tideas.\nFor\ta\tsmall\tenough\tgroup,\tperhaps\ta\tsingle\tteam,\tcombining\tprinciples\tand\tpractices\nmight\tbe\tOK.\tHowever,\tfor\tlarger\torganizations,\twhere\tthe\ttechnology\tand\tworking\npractices\tmay\tdiffer,\tyou\tmay\twant\ta\tdifferent\tset\tof\tpractices\tin\tdifferent\tplaces,\tas\tlong\nas\tthey\tboth\tmap\tto\ta\tcommon\tset\tof\tprinciples.\tA\t.NET\tteam,\tfor\texample,\tmight\thave\none\tset\tof\tpractices,\tand\ta\tJava\tteam\tanother,\twith\ta\tset\tof\tpractices\tcommon\tto\tboth.\tThe\nprinciples,\tthough,\tcould\tbe\tthe\tsame\tfor\tboth.")]),t._v(" "),a("h2",{attrs:{id:"areal-worldexample"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#areal-worldexample"}},[t._v("#")]),t._v(" A\tReal-World\tExample")]),t._v(" "),a("p",[t._v("My\tcolleague\tEvan\tBottcher\tdeveloped\tthe\tdiagram\tshown\tin\tFigure\t2-1\tin\tthe\tcourse\tof\nworking\twith\tone\tof\tour\tclients.\tThe\tfigure\tshows\tthe\tinterplay\tof\tgoals,\tprinciples,\tand\npractices\tin\ta\tvery\tclear\tformat.\tOver\tthe\tcourse\tof\ta\tcouple\tyears,\tthe\tpractices\ton\tthe\tfar\nright\twill\tchange\tfairly\tregularly,\twhereas\tthe\tprinciples\tremain\tfairly\tstatic.\tA\tdiagram\nsuch\tas\tthis\tcan\tbe\tprinted\tnicely\ton\ta\tsingle\tsheet\tof\tpaper\tand\tshared,\tand\teach\tidea\tis\nsimple\tenough\tfor\tthe\taverage\tdeveloper\tto\tremember.\tThere\tis,\tof\tcourse,\tmore\tdetail\nbehind\teach\tpoint\there,\tbut\tbeing\table\tto\tarticulate\tthis\tin\tsummary\tform\tis\tvery\tuseful.")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("Figure\t2-1.\tA\treal-world\texample\tof\tprinciples\tand\tpractices\n")])])]),a("p",[t._v("It\tmakes\tsense\tto\thave\tdocumentation\tsupporting\tsome\tof\tthese\titems.\tIn\tthe\tmain,\nthough,\tI\tlike\tthe\tidea\tof\thaving\texample\tcode\tthat\tyou\tcan\tlook\tat,\tinspect,\tand\trun,\nwhich\tembodies\tthese\tideas.\tEven\tbetter,\twe\tcan\tcreate\ttooling\tthat\tdoes\tthe\tright\tthing\nout\tof\tthe\tbox.\tWe’ll\tdiscuss\tthat\tin\tmore\tdepth\tmomentarily.")]),t._v(" "),a("h2",{attrs:{id:"therequiredstandard"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#therequiredstandard"}},[t._v("#")]),t._v(" The\tRequired\tStandard")]),t._v(" "),a("p",[t._v("When\tyou’re\tworking\tthrough\tyour\tpractices\tand\tthinking\tabout\tthe\ttrade-offs\tyou\tneed\tto\nmake,\tone\tof\tthe\tcore\tbalances\tto\tfind\tis\thow\tmuch\tvariability\tto\tallow\tin\tyour\tsystem.\nOne\tof\tthe\tkey\tways\tto\tidentify\twhat\tshould\tbe\tconstant\tfrom\tservice\tto\tservice\tis\tto\ndefine\twhat\ta\twell-behaved,\tgood\tservice\tlooks\tlike.\tWhat\tis\ta\t“good\tcitizen”\tservice\tin\nyour\tsystem?\tWhat\tcapabilities\tdoes\tit\tneed\tto\thave\tto\tensure\tthat\tyour\tsystem\tis\nmanageable\tand\tthat\tone\tbad\tservice\tdoesn’t\tbring\tdown\tthe\twhole\tsystem?\tAnd,\tas\twith\npeople,\twhat\ta\tgood\tcitizen\tis\tin\tone\tcontext\tdoes\tnot\treflect\twhat\tit\tlooks\tlike\tsomewhere\nelse.\tNonetheless,\tthere\tare\tsome\tcommon\tcharacteristics\tof\twell-behaved\tservices\tthat\tI\nthink\tare\tfairly\timportant\tto\tobserve.\tThese\tare\tthe\tfew\tkey\tareas\twhere\tallowing\ttoo\nmuch\tdivergence\tcan\tresult\tin\ta\tpretty\ttorrid\ttime.\tAs\tBen\tChristensen\tfrom\tNetflix\tputs\nit,\twhen\twe\tthink\tabout\tthe\tbigger\tpicture,\t“it\tneeds\tto\tbe\ta\tcohesive\tsystem\tmade\tof\nmany\tsmall\tparts\twith\tautonomous\tlifecycles\tbut\tall\tcoming\ttogether.”\tSo\twe\tneed\tto\tfind\nthe\tbalance\tbetween\toptimizing\tfor\tautonomy\tof\tthe\tindividual\tmicroservice\twithout\nlosing\tsight\tof\tthe\tbigger\tpicture.\tDefining\tclear\tattributes\tthat\teach\tservice\tshould\thave\tis\none\tway\tof\tbeing\tclear\tas\tto\twhere\tthat\tbalance\tsits.")]),t._v(" "),a("h2",{attrs:{id:"monitoring"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#monitoring"}},[t._v("#")]),t._v(" Monitoring")]),t._v(" "),a("p",[t._v("It\tis\tessential\tthat\twe\tare\table\tto\tdraw\tup\tcoherent,\tcross-service\tviews\tof\tour\tsystem\nhealth.\tThis\thas\tto\tbe\ta\tsystem-wide\tview,\tnot\ta\tservice-specific\tview.\tAs\twe’ll\tdiscuss\tin\nChapter\t8,\tknowing\tthe\thealth\tof\tan\tindividual\tservice\tis\tuseful,\tbut\toften\tonly\twhen\nyou’re\ttrying\tto\tdiagnose\ta\twider\tproblem\tor\tunderstand\ta\tlarger\ttrend.\tTo\tmake\tthis\tas\neasy\tas\tpossible,\tI\twould\tsuggest\tensuring\tthat\tall\tservices\temit\thealth\tand\tgeneral\nmonitoring-related\tmetrics\tin\tthe\tsame\tway.")]),t._v(" "),a("p",[t._v("You\tmight\tchoose\tto\tadopt\ta\tpush\tmechanism,\twhere\teach\tservice\tneeds\tto\tpush\tthis\tdata\ninto\ta\tcentral\tlocation.\tFor\tyour\tmetrics\tthis\tmight\tbe\tGraphite,\tand\tfor\tyour\thealth\tit\nmight\tbe\tNagios.\tOr\tyou\tmight\tdecide\tto\tuse\tpolling\tsystems\tthat\tscrape\tdata\tfrom\tthe\nnodes\tthemselves.\tBut\twhatever\tyou\tpick,\ttry\tto\tkeep\tit\tstandardized.\tMake\tthe\ntechnology\tinside\tthe\tbox\topaque,\tand\tdon’t\trequire\tthat\tyour\tmonitoring\tsystems\tchange\nin\torder\tto\tsupport\tit.\tLogging\tfalls\tinto\tthe\tsame\tcategory\there:\twe\tneed\tit\tin\tone\tplace.")]),t._v(" "),a("h2",{attrs:{id:"interfaces"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#interfaces"}},[t._v("#")]),t._v(" Interfaces")]),t._v(" "),a("p",[t._v("Picking\ta\tsmall\tnumber\tof\tdefined\tinterface\ttechnologies\thelps\tintegrate\tnew\tconsumers.\nHaving\tone\tstandard\tis\ta\tgood\tnumber.\tTwo\tisn’t\ttoo\tbad,\teither.\tHaving\t20\tdifferent\nstyles\tof\tintegration\tis\tbad.\tThis\tisn’t\tjust\tabout\tpicking\tthe\ttechnology\tand\tthe\tprotocol.\tIf\nyou\tpick\tHTTP/REST,\tfor\texample,\twill\tyou\tuse\tverbs\tor\tnouns?\tHow\twill\tyou\thandle\npagination\tof\tresources?\tHow\twill\tyou\thandle\tversioning\tof\tend\tpoints?")]),t._v(" "),a("h2",{attrs:{id:"architecturalsafety"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#architecturalsafety"}},[t._v("#")]),t._v(" Architectural\tSafety")]),t._v(" "),a("p",[t._v("We\tcannot\tafford\tfor\tone\tbadly\tbehaved\tservice\tto\truin\tthe\tparty\tfor\teveryone.\tWe\thave\tto\nensure\tthat\tour\tservices\tshield\tthemselves\taccordingly\tfrom\tunhealthy,\tdownstream\tcalls.\nThe\tmore\tservices\twe\thave\tthat\tdo\tnot\tproperly\thandle\tthe\tpotential\tfailure\tof\tdownstream\ncalls,\tthe\tmore\tfragile\tour\tsystems\twill\tbe.\tThis\tmeans\tyou\twill\tprobably\twant\tto\tmandate\nas\ta\tminimum\tthat\teach\tdownstream\tservice\tgets\tits\town\tconnection\tpool,\tand\tyou\tmay\neven\tgo\tas\tfar\tas\tto\tsay\tthat\teach\talso\tuses\ta\tcircuit\tbreaker.\tThis\twill\tget\tcovered\tin\tmore\ndepth\twhen\twe\tdiscuss\tmicroservices\tat\tscale\tin\tChapter\t11.")]),t._v(" "),a("p",[t._v("Playing\tby\tthe\trules\tis\timportant\twhen\tit\tcomes\tto\tresponse\tcodes,\ttoo.\tIf\tyour\tcircuit\nbreakers\trely\ton\tHTTP\tcodes,\tand\tone\tservice\tdecides\tto\tsend\tback\t2XX\tcodes\tfor\terrors,\nor\tconfuses\t4XX\tcodes\twith\t5XX\tcodes,\tthen\tthese\tsafety\tmeasures\tcan\tfall\tapart.\tSimilar\nconcerns\twould\tapply\teven\tif\tyou’re\tnot\tusing\tHTTP;\tknowing\tthe\tdifference\tbetween\ta\nrequest\tthat\twas\tOK\tand\tprocessed\tcorrectly,\ta\trequest\tthat\twas\tbad\tand\tthus\tprevented\nthe\tservice\tfrom\tdoing\tanything\twith\tit,\tand\ta\trequest\tthat\tmight\tbe\tOK\tbut\twe\tcan’t\ttell\nbecause\tthe\tserver\twas\tdown\tis\tkey\tto\tensuring\twe\tcan\tfail\tfast\tand\ttrack\tdown\tissues.\tIf\nour\tservices\tplay\tfast\tand\tloose\twith\tthese\trules,\twe\tend\tup\twith\ta\tmore\tvulnerable\nsystem.")]),t._v(" "),a("h2",{attrs:{id:"governancethroughcode"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#governancethroughcode"}},[t._v("#")]),t._v(" Governance\tThrough\tCode")]),t._v(" "),a("p",[t._v("Getting\ttogether\tand\tagreeing\ton\thow\tthings\tcan\tbe\tdone\tis\ta\tgood\tidea.\tBut\tspending\ntime\tmaking\tsure\tpeople\tare\tfollowing\tthese\tguidelines\tis\tless\tfun,\tas\tis\tplacing\ta\tburden\non\tdevelopers\tto\timplement\tall\tthese\tstandard\tthings\tyou\texpect\teach\tservice\tto\tdo.\tI\tam\ta\ngreat\tbeliever\tin\tmaking\tit\teasy\tto\tdo\tthe\tright\tthing.\tTwo\ttechniques\tI\thave\tseen\twork\nwell\there\tare\tusing\texemplars\tand\tproviding\tservice\ttemplates.")]),t._v(" "),a("h2",{attrs:{id:"exemplars"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#exemplars"}},[t._v("#")]),t._v(" Exemplars")]),t._v(" "),a("p",[t._v("Written\tdocumentation\tis\tgood,\tand\tuseful.\tI\tclearly\tsee\tthe\tvalue;\tafter\tall,\tI’ve\twritten\nthis\tbook.\tBut\tdevelopers\talso\tlike\tcode,\tand\tcode\tthey\tcan\trun\tand\texplore.\tIf\tyou\thave\ta\nset\tof\tstandards\tor\tbest\tpractices\tyou\twould\tlike\tto\tencourage,\tthen\thaving\texemplars\tthat\nyou\tcan\tpoint\tpeople\tto\tis\tuseful.\tThe\tidea\tis\tthat\tpeople\tcan’t\tgo\tfar\twrong\tjust\tby\nimitating\tsome\tof\tthe\tbetter\tparts\tof\tyour\tsystem.")]),t._v(" "),a("p",[t._v("Ideally,\tthese\tshould\tbe\treal-world\tservices\tyou\thave\tthat\tget\tthings\tright,\trather\tthan\nisolated\tservices\tthat\tare\tjust\timplemented\tto\tbe\t "),a("em",[t._v("perfect\texamples")]),t._v(" .\tBy\tensuring\tyour\nexemplars\tare\tactually\tbeing\tused,\tyou\tensure\tthat\tall\tthe\tprinciples\tyou\thave\tactually\nmake\tsense.")]),t._v(" "),a("h2",{attrs:{id:"tailoredservicetemplate"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#tailoredservicetemplate"}},[t._v("#")]),t._v(" Tailored\tService\tTemplate")]),t._v(" "),a("p",[t._v("Wouldn’t\tit\tbe\tgreat\tif\tyou\tcould\tmake\tit\treally\teasy\tfor\tall\tdevelopers\tto\tfollow\tmost\tof\nthe\tguidelines\tyou\thave\twith\tvery\tlittle\twork?\tWhat\tif,\tout\tof\tthe\tbox,\tthe\tdevelopers\thad\nmost\tof\tthe\tcode\tin\tplace\tto\timplement\tthe\tcore\tattributes\tthat\teach\tservice\tneeds?")]),t._v(" "),a("p",[t._v("Dropwizard\tand\tKaryon\tare\ttwo\topen\tsource,\tJVM-based\tmicrocontainers.\tThey\twork\tin\nsimilar\tways,\tpulling\ttogether\ta\tset\tof\tlibraries\tto\tprovide\tfeatures\tlike\thealth\tchecking,\nserving\tHTTP,\tor\texposing\tmetrics.\tSo,\tout\tof\tthe\tbox,\tyou\thave\ta\tservice\tcomplete\twith\nan\tembedded\tservlet\tcontainer\tthat\tcan\tbe\tlaunched\tfrom\tthe\tcommand\tline.\tThis\tis\ta\ngreat\tway\tto\tget\tgoing,\tbut\twhy\tstop\tthere?\tWhile\tyou’re\tat\tit,\twhy\tnot\ttake\tsomething\nlike\ta\tDropwizard\tor\tKaryon,\tand\tadd\tmore\tfeatures\tso\tthat\tit\tbecomes\tcompliant\tfor\tyour\ncontext?")]),t._v(" "),a("p",[t._v("For\texample,\tyou\tmight\twant\tto\tmandate\tthe\tuse\tof\tcircuit\tbreakers.\tIn\tthat\tcase,\tyou\nmight\tintegrate\ta\tcircuit\tbreaker\tlibrary\tlike\tHystrix.\tOr\tyou\tmight\thave\ta\tpractice\tthat\tall\nyour\tmetrics\tneed\tto\tbe\tsent\tto\ta\tcentral\tGraphite\tserver,\tso\tperhaps\tpull\tin\tan\topen\tsource\nlibrary\tlike\tDropwizard’s\tMetrics\tand\tconfigure\tit\tso\tthat,\tout\tof\tthe\tbox,\tresponse\ttimes\nand\terror\trates\tare\tpushed\tautomatically\tto\ta\tknown\tlocation.")]),t._v(" "),a("p",[t._v("By\ttailoring\tsuch\ta\tservice\ttemplate\tfor\tyour\town\tset\tof\tdevelopment\tpractices,\tyou\tensure\nthat\tteams\tcan\tget\tgoing\tfaster,\tand\talso\tthat\tdevelopers\thave\tto\tgo\tout\tof\ttheir\tway\tto\nmake\ttheir\tservices\tbadly\tbehaved.")]),t._v(" "),a("p",[t._v("Of\tcourse,\tif\tyou\tembraced\tmultiple\tdisparate\ttechnology\tstacks,\tyou’d\tneed\ta\tmatching\nservice\ttemplate\tfor\teach.\tThis\tmay\tbe\ta\tway\tyou\tsubtly\tconstrain\tlanguage\tchoices\tin\nyour\tteams,\tthough.\tIf\tthe\tin-house\tservice\ttemplate\tsupports\tonly\tJava,\tthen\tpeople\tmay\nbe\tdiscouraged\tfrom\tpicking\talternative\tstacks\tif\tthey\thave\tto\tdo\tlots\tmore\twork\nthemselves.\tNetflix,\tfor\texample,\tis\tespecially\tconcerned\twith\taspects\tlike\tfault\ttolerance,\nto\tensure\tthat\tthe\toutage\tof\tone\tpart\tof\tits\tsystem\tcannot\ttake\teverything\tdown.\tTo\thandle\nthis,\ta\tlarge\tamount\tof\twork\thas\tbeen\tdone\tto\tensure\tthat\tthere\tare\tclient\tlibraries\ton\tthe\nJVM\tto\tprovide\tteams\twith\tthe\ttools\tthey\tneed\tto\tkeep\ttheir\tservices\twell\tbehaved.\nAnyone\tintroducing\ta\tnew\ttechnology\tstack\twould\tmean\thaving\tto\treproduce\tall\tthis\neffort.\tThe\tmain\tconcern\tfor\tNetflix\tis\tless\tabout\tthe\tduplicated\teffort,\tand\tmore\tabout\tthe\nfact\tthat\tit\tis\tso\teasy\tto\tget\tthis\twrong.\tThe\trisk\tof\ta\tservice\tgetting\tnewly\timplemented\nfault\ttolerance\twrong\tis\thigh\tif\tit\tcould\timpact\tmore\tof\tthe\tsystem.\tNetflix\tmitigates\tthis\nby\tusing\t "),a("em",[t._v("sidecar\tservices")]),t._v(" ,\twhich\tcommunicate\tlocally\twith\ta\tJVM\tthat\tis\tusing\tthe\nappropriate\tlibraries.")]),t._v(" "),a("p",[t._v("You\tdo\thave\tto\tbe\tcareful\tthat\tcreating\tthe\tservice\ttemplate\tdoesn’t\tbecome\tthe\tjob\tof\ta\ncentral\ttools\tor\tarchitecture\tteam\twho\tdictates\thow\tthings\tshould\tbe\tdone,\talbeit\tvia\tcode.\nDefining\tthe\tpractices\tyou\tuse\tshould\tbe\ta\tcollective\tactivity,\tso\tideally\tyour\tteam(s)\nshould\ttake\tjoint\tresponsibility\tfor\tupdating\tthis\ttemplate\t(an\tinternal\topen\tsource\napproach\tworks\twell\there).")]),t._v(" "),a("p",[t._v("I\thave\talso\tseen\tmany\ta\tteam’s\tmorale\tand\tproductivity\tdestroyed\tby\thaving\ta\tmandated\nframework\tthrust\tupon\tthem.\tIn\ta\tdrive\tto\timprove\tcode\treuse,\tmore\tand\tmore\twork\tis\nplaced\tinto\ta\tcentralized\tframework\tuntil\tit\tbecomes\tan\toverwhelming\tmonstrosity.\tIf\tyou\ndecide\tto\tuse\ta\ttailored\tservice\ttemplate,\tthink\tvery\tcarefully\tabout\twhat\tits\tjob\tis.\tIdeally,\nits\tuse\tshould\tbe\tpurely\toptional,\tbut\tif\tyou\tare\tgoing\tto\tbe\tmore\tforceful\tin\tits\tadoption\nyou\tneed\tto\tunderstand\tthat\tease\tof\tuse\tfor\tthe\tdevelopers\thas\tto\tbe\ta\tprime\tguiding\tforce.")]),t._v(" "),a("p",[t._v("Also\tbe\taware\tof\tthe\tperils\tof\tshared\tcode.\tIn\tour\tdesire\tto\tcreate\treusable\tcode,\twe\tcan\nintroduce\tsources\tof\tcoupling\tbetween\tservices.\tAt\tleast\tone\torganization\tI\tspoke\tto\tis\tso\nworried\tabout\tthis\tthat\tit\tactually\tcopies\tits\tservice\ttemplate\tcode\tmanually\tinto\teach\nservice.\tThis\tmeans\tthat\tan\tupgrade\tto\tthe\tcore\tservice\ttemplate\ttakes\tlonger\tto\tbe\tapplied\nacross\tits\tsystem,\tbut\tthis\tis\tless\tconcerning\tto\tit\tthan\tthe\tdanger\tof\tcoupling.\tOther\tteams\nI\thave\tspoken\tto\thave\tsimply\ttreated\tthe\tservice\ttemplate\tas\ta\tshared\tbinary\tdependency,\nalthough\tthey\thave\tto\tbe\tvery\tdiligent\tin\tnot\tletting\tthe\ttendency\tfor\tDRY\t(don’t\trepeat\nyourself)\tresult\tin\tan\toverly\tcoupled\tsystem!\tThis\tis\ta\tnuanced\ttopic,\tso\twe’ll\texplore\tit\tin\nmore\tdetail\tin\tChapter\t4.")]),t._v(" "),a("h2",{attrs:{id:"technicaldebt"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#technicaldebt"}},[t._v("#")]),t._v(" Technical\tDebt")]),t._v(" "),a("p",[t._v("We\tare\toften\tput\tin\tsituations\twhere\twe\tcannot\tfollow\tthrough\tto\tthe\tletter\ton\tour\ntechnical\tvision.\tOften,\twe\tneed\tto\tmake\ta\tchoice\tto\tcut\ta\tfew\tcorners\tto\tget\tsome\turgent\nfeatures\tout.\tThis\tis\tjust\tone\tmore\ttrade-off\tthat\twe’ll\tfind\tourselves\thaving\tto\tmake.\tOur\ntechnical\tvision\texists\tfor\ta\treason.\tIf\twe\tdeviate\tfrom\tthis\treason,\tit\tmight\thave\ta\tshort-\nterm\tbenefit\tbut\ta\tlong-term\tcost.\tA\tconcept\tthat\thelps\tus\tunderstand\tthis\ttrade-off\tis\ntechnical\tdebt.\tWhen\twe\taccrue\ttechnical\tdebt,\tjust\tlike\tdebt\tin\tthe\treal\tworld\tit\thas\tan\nongoing\tcost,\tand\tis\tsomething\twe\twant\tto\tpay\tdown.")]),t._v(" "),a("p",[t._v("Sometimes\ttechnical\tdebt\tisn’t\tjust\tsomething\twe\tcause\tby\ttaking\tshortcuts.\tWhat\thappens\nif\tour\tvision\tfor\tthe\tsystem\tchanges,\tbut\tnot\tall\tof\tour\tsystem\tmatches?\tIn\tthis\tsituation,\ntoo,\twe\thave\tcreated\tnew\tsources\tof\ttechnical\tdebt.")]),t._v(" "),a("p",[t._v("The\tarchitect’s\tjob\tis\tto\tlook\tat\tthe\tbigger\tpicture,\tand\tunderstand\tthis\tbalance.\tHaving\nsome\tview\tas\tto\tthe\tlevel\tof\tdebt,\tand\twhere\tto\tget\tinvolved,\tis\timportant.\tDepending\ton\nyour\torganization,\tyou\tmight\tbe\table\tto\tprovide\tgentle\tguidance,\tbut\thave\tthe\tteams\nthemselves\tdecide\thow\tto\ttrack\tand\tpay\tdown\tthe\tdebt.\tFor\tother\torganizations,\tyou\tmay\nneed\tto\tbe\tmore\tstructured,\tperhaps\tmaintaining\ta\tdebt\tlog\tthat\tis\treviewed\tregularly.")]),t._v(" "),a("h2",{attrs:{id:"exceptionhandling"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#exceptionhandling"}},[t._v("#")]),t._v(" Exception\tHandling")]),t._v(" "),a("p",[t._v("So\tour\tprinciples\tand\tpractices\tguide\thow\tour\tsystems\tshould\tbe\tbuilt.\tBut\twhat\thappens\nwhen\tour\tsystem\tdeviates\tfrom\tthis?\tSometimes\twe\tmake\ta\tdecision\tthat\tis\tjust\tan\nexception\tto\tthe\trule.\tIn\tthese\tcases,\tit\tmight\tbe\tworth\tcapturing\tsuch\ta\tdecision\tin\ta\tlog\nsomewhere\tfor\tfuture\treference.\tIf\tenough\t "),a("em",[t._v("exceptions")]),t._v(" \tare\tfound,\tit\tmay\teventually\tmake\nsense\tto\tchange\tthe\tprinciple\tor\tpractice\tto\treflect\ta\tnew\tunderstanding\tof\tthe\tworld.\tFor\nexample,\twe\tmight\thave\ta\tpractice\tthat\tstates\tthat\twe\twill\talways\tuse\tMySQL\tfor\tdata\nstorage.\tBut\tthen\twe\tsee\tcompelling\treasons\tto\tuse\tCassandra\tfor\thighly\tscalable\tstorage,\nat\twhich\tpoint\twe\tchange\tour\tpractice\tto\tsay,\t“Use\tMySQL\tfor\tmost\tstorage\trequirements,\nunless\tyou\texpect\tlarge\tgrowth\tin\tvolumes,\tin\twhich\tcase\tuse\tCassandra.”")]),t._v(" "),a("p",[t._v("It’s\tprobably\tworth\treiterating,\tthough,\tthat\tevery\torganization\tis\tdifferent.\tI’ve\tworked\nwith\tsome\tcompanies\twhere\tthe\tdevelopment\tteams\thave\ta\thigh\tdegree\tof\ttrust\tand\nautonomy,\tand\tthere\tthe\tprinciples\tare\tlightweight\t(and\tthe\tneed\tfor\tovert\texception\nhandling\tis\tgreatly\treduced\tif\tnot\teliminated).\tIn\tmore\tstructured\torganizations\tin\twhich\ndevelopers\thave\tless\tfreedom,\ttracking\texceptions\tmay\tbe\tvital\tto\tensure\tthat\tthe\trules\tput\nin\tplace\tproperly\treflect\tthe\tchallenges\tpeople\tare\tfacing.\tWith\tall\tthat\tsaid,\tI\tam\ta\tfan\tof\nmicroservices\tas\ta\tway\tof\toptimizing\tfor\tautonomy\tof\tteams,\tgiving\tthem\tas\tmuch\nfreedom\tas\tpossible\tto\tsolve\tthe\tproblem\tat\thand.\tIf\tyou\tare\tworking\tin\tan\torganization\nthat\tplaces\tlots\tof\trestrictions\ton\thow\tdevelopers\tcan\tdo\ttheir\twork,\tthen\tmicroservices\nmay\tnot\tbe\tfor\tyou.")]),t._v(" "),a("h2",{attrs:{id:"governanceandleadingfromthecenter"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#governanceandleadingfromthecenter"}},[t._v("#")]),t._v(" Governance\tand\tLeading\tfrom\tthe\tCenter")]),t._v(" "),a("p",[t._v("Part\tof\twhat\tarchitects\tneed\tto\thandle\tis\tgovernance.\tWhat\tdo\tI\tmean\tby\t "),a("em",[t._v("governance")]),t._v(" ?\tIt\nturns\tout\tthe\tControl\tObjectives\tfor\tInformation\tand\tRelated\tTechnology\t(COBIT)\thas\ta\npretty\tgood\tdefinition:")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("Governance\tensures\tthat\tenterprise\tobjectives\tare\tachieved\tby\tevaluating\tstakeholder\nneeds,\tconditions\tand\toptions;\tsetting\tdirection\tthrough\tprioritisation\tand\tdecision\nmaking;\tand\tmonitoring\tperformance,\tcompliance\tand\tprogress\tagainst\tagreed-on\ndirection\tand\tobjectives.\nCOBIT\t5\n")])])]),a("p",[t._v("Governance\tcan\tapply\tto\tmultiple\tthings\tin\tthe\tforum\tof\tIT.\tWe\twant\tto\tfocus\ton\tthe\naspect\tof\ttechnical\tgovernance,\tsomething\tI\tfeel\tis\tthe\tjob\tof\tthe\tarchitect.\tIf\tone\tof\tthe\narchitect’s\tjobs\tis\tensuring\tthere\tis\ta\ttechnical\tvision,\tthen\tgovernance\tis\tabout\tensuring\nwhat\twe\tare\tbuilding\tmatches\tthis\tvision,\tand\tevolving\tthe\tvision\tif\tneeded.")]),t._v(" "),a("p",[t._v("Architects\tare\tresponsible\tfor\ta\tlot\tof\tthings.\tThey\tneed\tto\tensure\tthere\tis\ta\tset\tof\nprinciples\tthat\tcan\tguide\tdevelopment,\tand\tthat\tthese\tprinciples\tmatch\tthe\torganization’s\nstrategy.\tThey\tneed\tto\tmake\tsure\tas\twell\tthat\tthese\tprinciples\tdon’t\trequire\tworking\npractices\tthat\tmake\tdevelopers\tmiserable.\tThey\tneed\tto\tkeep\tup\tto\tdate\twith\tnew\ntechnology,\tand\tknow\twhen\tto\tmake\tthe\tright\ttrade-offs.\tThis\tis\tan\tawful\tlot\tof\nresponsibility.\tAll\tthat,\tand\tthey\talso\tneed\tto\tcarry\tpeople\twith\tthem\t—\tthat\tis,\tto\tensure\nthat\tthe\tcolleagues\tthey\tare\tworking\twith\tunderstand\tthe\tdecisions\tbeing\tmade\tand\tare\nbrought\tin\tto\tcarry\tthem\tout.\tOh,\tand\tas\twe’ve\talready\tmentioned:\tthey\tneed\tto\tspend\nsome\ttime\twith\tthe\tteams\tto\tunderstand\tthe\timpact\tof\ttheir\tdecisions,\tand\tperhaps\teven\ncode\ttoo.")]),t._v(" "),a("p",[t._v("A\ttall\torder?\tAbsolutely.\tBut\tI\tam\tfirmly\tof\tthe\topinion\tthat\tthey\tshouldn’t\tdo\tthis\talone.\nA\tproperly\tfunctioning\tgovernance\tgroup\tcan\twork\ttogether\tto\tshare\tthe\twork\tand\tshape\nthe\tvision.")]),t._v(" "),a("p",[t._v("Normally,\tgovernance\tis\ta\tgroup\tactivity.\tIt\tcould\tbe\tan\tinformal\tchat\twith\ta\tsmall\tenough\nteam,\tor\ta\tmore\tstructured\tregular\tmeeting\twith\tformal\tgroup\tmembership\tfor\ta\tlarger\nscope.\tThis\tis\twhere\tI\tthink\tthe\tprinciples\twe\tcovered\tearlier\tshould\tbe\tdiscussed\tand\nchanged\tas\trequired.\tThis\tgroup\tneeds\tto\tbe\tled\tby\ta\ttechnologist,\tand\tto\tconsist\npredominantly\tof\tpeople\twho\tare\texecuting\tthe\twork\tbeing\tgoverned.\tThis\tgroup\tshould\nalso\tbe\tresponsible\tfor\ttracking\tand\tmanaging\ttechnical\trisks.")]),t._v(" "),a("p",[t._v("A\tmodel\tI\tgreatly\tfavor\tis\thaving\tthe\tarchitect\tchair\tthe\tgroup,\tbut\thaving\tthe\tbulk\tof\tthe\ngroup\tdrawn\tfrom\tthe\ttechnologists\tof\teach\tdelivery\tteam\t—\tthe\tleads\tof\teach\tteam\tat\ta\nminimum.\tThe\tarchitect\tis\tresponsible\tfor\tmaking\tsure\tthe\tgroup\tworks,\tbut\tthe\tgroup\tas\ta\nwhole\tis\tresponsible\tfor\tgovernance.\tThis\tshares\tthe\tload,\tand\tensures\tthat\tthere\tis\ta\nhigher\tlevel\tof\tbuy-in.\tIt\talso\tensures\tthat\tinformation\tflows\tfreely\tfrom\tthe\tteams\tinto\tthe\ngroup,\tand\tas\ta\tresult,\tthe\tdecision\tmaking\tis\tmuch\tmore\tsensible\tand\tinformed.")]),t._v(" "),a("p",[t._v("Sometimes,\tthe\tgroup\tmay\tmake\tdecisions\twith\twhich\tthe\tarchitect\tdisagrees.\tAt\tthis\npoint,\twhat\tis\tthe\tarchitect\tto\tdo?\tHaving\tbeen\tin\tthis\tposition\tbefore,\tI\tcan\ttell\tyou\tthis\tis\none\tof\tthe\tmost\tchallenging\tsituations\tto\tface.\tOften,\tI\ttake\tthe\tapproach\tthat\tI\tshould\tgo\nwith\tthe\tgroup\tdecision.\tI\ttake\tthe\tview\tthat\tI’ve\tdone\tmy\tbest\tto\tconvince\tpeople,\tbut\nultimately\tI\twasn’t\tconvincing\tenough.\tThe\tgroup\tis\toften\tmuch\twiser\tthan\tthe\tindividual,\nand\tI’ve\tbeen\tproven\twrong\tmore\tthan\tonce!\tAnd\timagine\thow\tdisempowering\tit\tcan\tbe\nfor\ta\tgroup\tto\thave\tbeen\tgiven\tspace\tto\tcome\tup\twith\ta\tdecision,\tand\tthen\tultimately\tbe\nignored.\tBut\tsometimes\tI\thave\toverruled\tthe\tgroup.\tBut\twhy,\tand\twhen?\tHow\tdo\tyou\tpick\nthe\tlines?")]),t._v(" "),a("p",[t._v("Think\tabout\tteaching\tchildren\tto\tride\ta\tbike.\tYou\tcan’t\tride\tit\tfor\tthem.\tYou\twatch\tthem\nwobble,\tbut\tif\tyou\tstepped\tin\tevery\ttime\tit\tlooked\tlike\tthey\tmight\tfall\toff,\tthen\tthey’d\nnever\tlearn,\tand\tin\tany\tcase\tthey\tfall\toff\tfar\tless\tthan\tyou\tthink\tthey\twill!\tBut\tif\tyou\tsee\nthem\tabout\tto\tveer\tinto\ttraffic,\tor\tinto\ta\tnearby\tduck\tpond,\tthen\tyou\thave\tto\tstep\tin.\nLikewise,\tas\tan\tarchitect,\tyou\tneed\tto\thave\ta\tfirm\tgrasp\tof\twhen,\tfiguratively,\tyour\tteam\tis\nsteering\tinto\ta\tduck\tpond.\tYou\talso\tneed\tto\tbe\taware\tthat\teven\tif\tyou\tknow\tyou\tare\tright\nand\toverrule\tthe\tteam,\tthis\tcan\tundermine\tyour\tposition\tand\talso\tmake\tthe\tteam\tfeel\tthat\nthey\tdon’t\thave\ta\tsay.\tSometimes\tthe\tright\tthing\tis\tto\tgo\talong\twith\ta\tdecision\tyou\tdon’t\nagree\twith.\tKnowing\twhen\tto\tdo\tthis\tand\twhen\tnot\tto\tis\ttough,\tbut\tis\tsometimes\tvital.")]),t._v(" "),a("h2",{attrs:{id:"buildingateam"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#buildingateam"}},[t._v("#")]),t._v(" Building\ta\tTeam")]),t._v(" "),a("p",[t._v("Being\tthe\tmain\tpoint\tperson\tresponsible\tfor\tthe\ttechnical\tvision\tof\tyour\tsystem\tand\nensuring\tthat\tyou’re\texecuting\ton\tthis\tvision\tisn’t\tjust\tabout\tmaking\ttechnology\tdecisions.\nIt’s\tthe\tpeople\tyou\twork\twith\twho\twill\tbe\tdoing\tthe\twork.\tMuch\tof\tthe\trole\tof\tthe\ntechnical\tleader\tis\tabout\thelping\tgrow\tthem\t—\tto\thelp\tthem\tunderstand\tthe\tvision\nthemselves\t—\tand\talso\tensuring\tthat\tthey\tcan\tbe\tactive\tparticipants\tin\tshaping\tand\nimplementing\tthe\tvision\ttoo.")]),t._v(" "),a("p",[t._v("Helping\tthe\tpeople\taround\tyou\ton\ttheir\town\tcareer\tgrowth\tcan\ttake\tmany\tforms,\tmost\tof\nwhich\tare\toutside\tthe\tscope\tof\tthis\tbook.\tThere\tis\tone\taspect,\tthough,\twhere\ta\nmicroservice\tarchitecture\tis\tespecially\trelevant.\tWith\tlarger,\tmonolithic\tsystems,\tthere\tare\nfewer\topportunities\tfor\tpeople\tto\tstep\tup\tand\t "),a("em",[t._v("own")]),t._v(" \tsomething.\tWith\tmicroservices,\ton\tthe\nother\thand,\twe\thave\tmultiple\tautonomous\tcodebases\tthat\twill\thave\ttheir\town\tindependent\nlifecycles.\tHelping\tpeople\tstep\tup\tby\thaving\tthem\ttake\townership\tof\tindividual\tservices\nbefore\taccepting\tmore\tresponsibility\tcan\tbe\ta\tgreat\tway\tto\thelp\tthem\tachieve\ttheir\town\ncareer\tgoals,\tand\tat\tthe\tsame\ttime\tlightens\tthe\tload\ton\twhoever\tis\tin\tcharge!")]),t._v(" "),a("p",[t._v("I\tam\ta\tstrong\tbeliever\tthat\tgreat\tsoftware\tcomes\tfrom\tgreat\tpeople.\tIf\tyou\tworry\tonly\nabout\tthe\ttechnology\tside\tof\tthe\tequation,\tyou’re\tmissing\tway\tmore\tthan\thalf\tof\tthe\npicture.")]),t._v(" "),a("h2",{attrs:{id:"summary-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#summary-2"}},[t._v("#")]),t._v(" Summary")]),t._v(" "),a("p",[t._v("To\tsummarize\tthis\tchapter,\there\tare\twhat\tI\tsee\tas\tthe\tcore\tresponsibilities\tof\tthe\nevolutionary\tarchitect:")]),t._v(" "),a("p",[a("em",[t._v("Vision")])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("Ensure\tthere\tis\ta\tclearly\tcommunicated\ttechnical\tvision\tfor\tthe\tsystem\tthat\twill\thelp\nyour\tsystem\tmeet\tthe\trequirements\tof\tyour\tcustomers\tand\torganization\n")])])]),a("p",[a("em",[t._v("Empathy")])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("Understand\tthe\timpact\tof\tyour\tdecisions\ton\tyour\tcustomers\tand\tcolleagues\n")])])]),a("p",[a("em",[t._v("Collaboration")])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("Engage\twith\tas\tmany\tof\tyour\tpeers\tand\tcolleagues\tas\tpossible\tto\thelp\tdefine,\trefine,\nand\texecute\tthe\tvision\n")])])]),a("p",[a("em",[t._v("Adaptability")])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("Make\tsure\tthat\tthe\ttechnical\tvision\tchanges\tas\tyour\tcustomers\tor\torganization\nrequires\tit\n")])])]),a("p",[a("em",[t._v("Autonomy")])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("Find\tthe\tright\tbalance\tbetween\tstandardizing\tand\tenabling\tautonomy\tfor\tyour\tteams\n")])])]),a("p",[a("em",[t._v("Governance")])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("Ensure\tthat\tthe\tsystem\tbeing\timplemented\tfits\tthe\ttechnical\tvision\n")])])]),a("p",[t._v("The\tevolutionary\tarchitect\tis\tone\twho\tunderstands\tthat\tpulling\toff\tthis\tfeat\tis\ta\tconstant\nbalancing\tact.\tForces\tare\talways\tpushing\tyou\tone\tway\tor\tanother,\tand\tunderstanding\nwhere\tto\tpush\tback\tor\twhere\tto\tgo\twith\tthe\tflow\tis\toften\tsomething\tthat\tcomes\tonly\twith\nexperience.\tBut\tthe\tworst\treaction\tto\tall\tthese\tforces\tthat\tpush\tus\ttoward\tchange\tis\tto\nbecome\tmore\trigid\tor\tfixed\tin\tour\tthinking.")]),t._v(" "),a("p",[t._v("While\tmuch\tof\tthe\tadvice\tin\tthis\tchapter\tcan\tapply\tto\tany\tsystems\tarchitect,\tmicroservices\ngive\tus\tmany\tmore\tdecisions\tto\tmake.\tTherefore,\tbeing\tbetter\table\tto\tbalance\tall\tof\tthese\ntrade-offs\tis\tessential.")]),t._v(" "),a("p",[t._v("In\tthe\tnext\tchapter,\twe’ll\ttake\tsome\tof\tour\tnewfound\tawareness\tof\tthe\tarchitect’s\trole\twith\nus\tas\twe\tstart\tthinking\tabout\thow\tto\tfind\tthe\tright\tboundaries\tfor\tour\tmicroservices.")]),t._v(" "),a("h1",{attrs:{id:"chapter3-howtomodelservices"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#chapter3-howtomodelservices"}},[t._v("#")]),t._v(" Chapter\t3.\tHow\tto\tModel\tServices")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("My\topponent’s\treasoning\treminds\tme\tof\tthe\theathen,\twho,\tbeing\tasked\ton\twhat\tthe\nworld\tstood,\treplied,\t“On\ta\ttortoise.”\tBut\ton\twhat\tdoes\tthe\ttortoise\tstand?\t“On\nanother\ttortoise.”\nJoseph\tBarker\t(1854)\n")])])]),a("p",[t._v("So\tyou\tknow\twhat\tmicroservices\tare,\tand\thopefully\thave\ta\tsense\tof\ttheir\tkey\tbenefits.\nYou’re\tprobably\teager\tnow\tto\tgo\tand\tstart\tmaking\tthem,\tright?\tBut\twhere\tto\tstart?\tIn\tthis\nchapter,\twe’ll\tlook\tat\thow\tto\tthink\tabout\tthe\tboundaries\tof\tyour\tmicroservices\tthat\twill\nhopefully\tmaximize\tthe\tupsides\tand\tavoid\tsome\tof\tthe\tpotential\tdownsides.\tBut\tfirst,\twe\nneed\tsomething\tto\twork\twith.")]),t._v(" "),a("h2",{attrs:{id:"introducingmusiccorp"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#introducingmusiccorp"}},[t._v("#")]),t._v(" Introducing\tMusicCorp")]),t._v(" "),a("p",[t._v("Books\tabout\tideas\twork\tbetter\twith\texamples.\tWhere\tpossible,\tI’ll\tbe\tsharing\tstories\tfrom\nreal-world\tsituations,\tbut\tI’ve\tfound\tit’s\talso\tuseful\tto\thave\ta\tfictional\tdomain\twith\twhich\nto\twork.\tThroughout\tthe\tbook,\twe’ll\tbe\treturning\tto\tthis\tdomain,\tseeing\thow\tthe\tconcept\nof\tmicroservices\tworks\twithin\tthis\tworld.")]),t._v(" "),a("p",[t._v("So\tlet’s\tturn\tour\tattention\tto\tthe\tcutting-edge\tonline\tretailer\tMusicCorp.\tMusicCorp\twas\nrecently\ta\tbrick-and-mortar\tretailer,\tbut\tafter\tthe\tbottom\tdropped\tout\tof\tthe\tgramophone\nrecord\tbusiness\tit\tfocused\tmore\tand\tmore\tof\tits\tefforts\tonline.\tThe\tcompany\thas\ta\twebsite,\nbut\tfeels\tthat\tnow\tis\tthe\ttime\tto\tdouble-down\ton\tthe\tonline\tworld.\tAfter\tall,\tthose\tiPods\nare\tjust\ta\tpassing\tfad\t(Zunes\tare\tway\tbetter,\tobviously)\tand\tmusic\tfans\tare\tquite\thappy\tto\nwait\tfor\tCDs\tto\tarrive\tat\ttheir\tdoorsteps.\tQuality\tover\tconvenience,\tright?\tAnd\twhile\nwe’re\tat\tit,\twhat’s\tthis\tSpotify\tthing\tpeople\tkeep\ttalking\tabout\t—\tsome\tsort\tof\tskin\ntreatment\tfor\tteenagers?")]),t._v(" "),a("p",[t._v("Despite\tbeing\ta\tlittle\tbehind\tthe\tcurve,\tMusicCorp\thas\tgrand\tambitions.\tLuckily,\tit\thas\ndecided\tthat\tits\tbest\tchance\tof\ttaking\tover\tthe\tworld\tis\tby\tmaking\tsure\tit\tcan\tmake\nchanges\tas\teasily\tas\tpossible.\tMicroservices\tfor\tthe\twin!")]),t._v(" "),a("h2",{attrs:{id:"whatmakesagoodservice"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#whatmakesagoodservice"}},[t._v("#")]),t._v(" What\tMakes\ta\tGood\tService?")]),t._v(" "),a("p",[t._v("Before\tthe\tteam\tfrom\tMusicCorp\ttears\toff\tinto\tthe\tdistance,\tcreating\tservice\tafter\tservice\nin\tan\tattempt\tto\tdeliver\teight-track\ttapes\tto\tall\tand\tsundry,\tlet’s\tput\tthe\tbrakes\ton\tand\ttalk\na\tbit\tabout\tthe\tmost\timportant\tunderlying\tidea\twe\tneed\tto\tkeep\tin\tmind.\tWhat\tmakes\ta\ngood\tservice?\tIf\tyou’ve\tsurvived\ta\tfailed\tSOA\timplementation,\tyou\tmay\thave\tsome\tidea\nwhere\tI’m\tgoing\tnext.\tBut\tjust\tin\tcase\tyou\taren’t\tthat\t(un)fortunate,\tI\twant\tyou\tto\tfocus\ton\ntwo\tkey\tconcepts:\t "),a("em",[t._v("loose\tcoupling")]),t._v(" \tand\t "),a("em",[t._v("high\tcohesion")]),t._v(" .\tWe’ll\ttalk\tin\tdetail\tthroughout\tthe\nbook\tabout\tother\tideas\tand\tpractices,\tbut\tthey\tare\tall\tfor\tnaught\tif\twe\tget\tthese\ttwo\tthing\nwrong.")]),t._v(" "),a("p",[t._v("Despite\tthe\tfact\tthat\tthese\ttwo\tterms\tare\tused\ta\tlot,\tespecially\tin\tthe\tcontext\tof\tobject-\noriented\tsystems,\tit\tis\tworth\tdiscussing\twhat\tthey\tmean\tin\tterms\tof\tmicroservices.")]),t._v(" "),a("h2",{attrs:{id:"loosecoupling"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#loosecoupling"}},[t._v("#")]),t._v(" Loose\tCoupling")]),t._v(" "),a("p",[t._v("When\tservices\tare\tloosely\tcoupled,\ta\tchange\tto\tone\tservice\tshould\tnot\trequire\ta\tchange\tto\nanother.\tThe\twhole\tpoint\tof\ta\tmicroservice\tis\tbeing\table\tto\tmake\ta\tchange\tto\tone\tservice\nand\tdeploy\tit,\twithout\tneeding\tto\tchange\tany\tother\tpart\tof\tthe\tsystem.\tThis\tis\treally\tquite\nimportant.")]),t._v(" "),a("p",[t._v("What\tsort\tof\tthings\tcause\ttight\tcoupling?\tA\tclassic\tmistake\tis\tto\tpick\tan\tintegration\tstyle\nthat\ttightly\tbinds\tone\tservice\tto\tanother,\tcausing\tchanges\tinside\tthe\tservice\tto\trequire\ta\nchange\tto\tconsumers.\tWe’ll\tdiscuss\thow\tto\tavoid\tthis\tin\tmore\tdepth\tin\tChapter\t4.")]),t._v(" "),a("p",[t._v("A\tloosely\tcoupled\tservice\tknows\tas\tlittle\tas\tit\tneeds\tto\tabout\tthe\tservices\twith\twhich\tit\ncollaborates.\tThis\talso\tmeans\twe\tprobably\twant\tto\tlimit\tthe\tnumber\tof\tdifferent\ttypes\tof\ncalls\tfrom\tone\tservice\tto\tanother,\tbecause\tbeyond\tthe\tpotential\tperformance\tproblem,\nchatty\tcommunication\tcan\tlead\tto\ttight\tcoupling.")]),t._v(" "),a("h2",{attrs:{id:"highcohesion"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#highcohesion"}},[t._v("#")]),t._v(" High\tCohesion")]),t._v(" "),a("p",[t._v("We\twant\trelated\tbehavior\tto\tsit\ttogether,\tand\tunrelated\tbehavior\tto\tsit\telsewhere.\tWhy?\nWell,\tif\twe\twant\tto\tchange\tbehavior,\twe\twant\tto\tbe\table\tto\tchange\tit\tin\tone\tplace,\tand\nrelease\tthat\tchange\tas\tsoon\tas\tpossible.\tIf\twe\thave\tto\tchange\tthat\tbehavior\tin\tlots\tof\ndifferent\tplaces,\twe’ll\thave\tto\trelease\tlots\tof\tdifferent\tservices\t(perhaps\tat\tthe\tsame\ttime)\nto\tdeliver\tthat\tchange.\tMaking\tchanges\tin\tlots\tof\tdifferent\tplaces\tis\tslower,\tand\tdeploying\nlots\tof\tservices\tat\tonce\tis\trisky\t—\tboth\tof\twhich\twe\twant\tto\tavoid.")]),t._v(" "),a("p",[t._v("So\twe\twant\tto\tfind\tboundaries\twithin\tour\tproblem\tdomain\tthat\thelp\tensure\tthat\trelated\nbehavior\tis\tin\tone\tplace,\tand\tthat\tcommunicate\twith\tother\tboundaries\tas\tloosely\tas\npossible.")]),t._v(" "),a("h2",{attrs:{id:"theboundedcontext"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#theboundedcontext"}},[t._v("#")]),t._v(" The\tBounded\tContext")]),t._v(" "),a("p",[t._v("Eric\tEvans’s\tbook\t "),a("em",[t._v("Domain-Driven\tDesign")]),t._v(" \t(Addison-Wesley)\tfocuses\ton\thow\tto\tcreate\nsystems\tthat\tmodel\treal-world\tdomains.\tThe\tbook\tis\tfull\tof\tgreat\tideas\tlike\tusing\nubiquitous\tlanguage,\trepository\tabstractions,\tand\tthe\tlike,\tbut\tthere\tis\tone\tvery\timportant\nconcept\tEvans\tintroduces\tthat\tcompletely\tpassed\tme\tby\tat\tfirst:\t "),a("em",[t._v("bounded\tcontext")]),t._v(" .\tThe\tidea\nis\tthat\tany\tgiven\tdomain\tconsists\tof\tmultiple\tbounded\tcontexts,\tand\tresiding\twithin\teach\nare\tthings\t(Eric\tuses\tthe\tword\t "),a("em",[t._v("model")]),t._v(" \ta\tlot,\twhich\tis\tprobably\tbetter\tthan\t "),a("em",[t._v("things")]),t._v(" )\tthat\tdo\tnot\nneed\tto\tbe\tcommunicated\toutside\tas\twell\tas\tthings\tthat\tare\tshared\texternally\twith\tother\nbounded\tcontexts.\tEach\tbounded\tcontext\thas\tan\texplicit\tinterface,\twhere\tit\tdecides\twhat\nmodels\tto\tshare\twith\tother\tcontexts.")]),t._v(" "),a("p",[t._v("Another\tdefinition\tof\tbounded\tcontexts\tI\tlike\tis\t“a\tspecific\tresponsibility\tenforced\tby")]),t._v(" "),a("p",[t._v("explicit\tboundaries.”^1 \tIf\tyou\twant\tinformation\tfrom\ta\tbounded\tcontext,\tor\twant\tto\tmake\nrequests\tof\tfunctionality\twithin\ta\tbounded\tcontext,\tyou\tcommunicate\twith\tits\texplicit\nboundary\tusing\tmodels.\tIn\this\tbook,\tEvans\tuses\tthe\tanalogy\tof\tcells,\twhere\t“[c]ells\tcan\nexist\tbecause\ttheir\tmembranes\tdefine\twhat\tis\tin\tand\tout\tand\tdetermine\twhat\tcan\tpass.”")]),t._v(" "),a("p",[t._v("Let’s\treturn\tfor\ta\tmoment\tto\tthe\tMusicCorp\tbusiness.\tOur\tdomain\tis\tthe\twhole\tbusiness\tin\nwhich\twe\tare\toperating.\tIt\tcovers\teverything\tfrom\tthe\twarehouse\tto\tthe\treception\tdesk,\nfrom\tfinance\tto\tordering.\tWe\tmay\tor\tmay\tnot\tmodel\tall\tof\tthat\tin\tour\tsoftware,\tbut\tthat\tis\nnonetheless\tthe\tdomain\tin\twhich\twe\tare\toperating.\tLet’s\tthink\tabout\tparts\tof\tthat\tdomain\nthat\tlook\tlike\tthe\tbounded\tcontexts\tthat\tEvans\trefers\tto.\tAt\tMusicCorp,\tour\twarehouse\tis\ta\nhive\tof\tactivity\t—\tmanaging\torders\tbeing\tshipped\tout\t(and\tthe\todd\treturn),\ttaking\tdelivery\nof\tnew\tstock,\thaving\tforklift\ttruck\traces,\tand\tso\ton.\tElsewhere,\tthe\tfinance\tdepartment\tis\nperhaps\tless\tfun-loving,\tbut\tstill\thas\ta\tvery\timportant\tfunction\tinside\tour\torganization.\nThese\temployees\tmanage\tpayroll,\tkeep\tthe\tcompany\taccounts,\tand\tproduce\timportant\nreports.\tLots\tof\treports.\tThey\tprobably\talso\thave\tinteresting\tdesk\ttoys.")]),t._v(" "),a("h2",{attrs:{id:"sharedandhiddenmodels"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#sharedandhiddenmodels"}},[t._v("#")]),t._v(" Shared\tand\tHidden\tModels")]),t._v(" "),a("p",[t._v("For\tMusicCorp,\twe\tcan\tthen\tconsider\tthe\tfinance\tdepartment\tand\tthe\twarehouse\tto\tbe\ttwo\nseparate\tbounded\tcontexts.\tThey\tboth\thave\tan\texplicit\tinterface\tto\tthe\toutside\tworld\t(in\nterms\tof\tinventory\treports,\tpay\tslips,\tetc.),\tand\tthey\thave\tdetails\tthat\tonly\tthey\tneed\tto\nknow\tabout\t(forklift\ttrucks,\tcalculators).")]),t._v(" "),a("p",[t._v("Now\tthe\tfinance\tdepartment\tdoesn’t\tneed\tto\tknow\tabout\tthe\tdetailed\tinner\tworkings\tof\tthe\nwarehouse.\tIt\tdoes\tneed\tto\tknow\tsome\tthings,\tthough\t—\tfor\texample\tit\tneeds\tto\tknow\nabout\tstock\tlevels\tto\tkeep\tthe\taccounts\tup\tto\tdate.\tFigure\t3-1\tshows\tan\texample\tcontext\ndiagram.\tWe\tsee\tconcepts\tthat\tare\tinternal\tto\tthe\twarehouse,\tlike\tPicker\t(people\twho\tpick\norders),\tshelves\tthat\trepresent\tstock\tlocations,\tand\tso\ton.\tLikewise,\tthe\tcompany’s\tgeneral\nledger\tis\tintegral\tto\tfinance\tbut\tis\tnot\tshared\texternally\there.")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("Figure\t3-1.\tA\tshared\tmodel\tbetween\tthe\tfinance\tdepartment\tand\tthe\twarehouse\n")])])]),a("p",[t._v("To\tbe\table\tto\twork\tout\tthe\tvaluation\tof\tthe\tcompany,\tthough,\tthe\tfinance\temployees\tneed\ninformation\tabout\tthe\tstock\twe\thold.\tThe\tstock\titem\tthen\tbecomes\ta\tshared\tmodel\nbetween\tthe\ttwo\tcontexts.\tHowever,\tnote\tthat\twe\tdon’t\tneed\tto\tblindly\texpose\teverything\nabout\tthe\tstock\titem\tfrom\tthe\twarehouse\tcontext.\tFor\texample,\talthough\tinternally\twe\nkeep\ta\trecord\ton\ta\tstock\titem\tas\tto\twhere\tit\tshould\tlive\twithin\tthe\twarehouse,\tthat\tdoesn’t\nneed\tto\tbe\texposed\tin\tthe\tshared\tmodel.\tSo\tthere\tis\tthe\tinternal-only\trepresentation,\tand\nthe\texternal\trepresentation\twe\texpose.\tIn\tmany\tways,\tthis\tforeshadows\tthe\tdiscussion\naround\tREST\tin\tChapter\t4.")]),t._v(" "),a("p",[t._v("Sometimes\twe\tmay\tencounter\tmodels\twith\tthe\tsame\tname\tthat\thave\tvery\tdifferent\nmeanings\tin\tdifferent\tcontexts\ttoo.\tFor\texample,\twe\tmight\thave\tthe\tconcept\tof\ta\treturn,\nwhich\trepresents\ta\tcustomer\tsending\tsomething\tback.\tWithin\tthe\tcontext\tof\tthe\tcustomer,\na\treturn\tis\tall\tabout\tprinting\ta\tshipping\tlabel,\tdispatching\ta\tpackage,\tand\twaiting\tfor\ta\nrefund.\tFor\tthe\twarehouse,\tthis\tcould\trepresent\ta\tpackage\tthat\tis\tabout\tto\tarrive,\tand\ta\nstock\titem\tthat\tneeds\tto\tbe\trestocked.\tIt\tfollows\tthat\twithin\tthe\twarehouse\twe\tstore\nadditional\tinformation\tassociated\twith\tthe\treturn\tthat\trelates\tto\tthe\ttasks\tto\tbe\tcarried\tout;")]),t._v(" "),a("p",[t._v("for\texample,\twe\tmay\tgenerate\ta\trestock\trequest.\tThe\tshared\tmodel\tof\tthe\treturn\tbecomes\nassociated\twith\tdifferent\tprocesses\tand\tsupporting\tentities\twithin\teach\tbounded\tcontext,\nbut\tthat\tis\tvery\tmuch\tan\tinternal\tconcern\twithin\tthe\tcontext\titself.")]),t._v(" "),a("h2",{attrs:{id:"modulesandservices"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#modulesandservices"}},[t._v("#")]),t._v(" Modules\tand\tServices")]),t._v(" "),a("p",[t._v("By\tthinking\tclearly\tabout\twhat\tmodels\tshould\tbe\tshared,\tand\tnot\tsharing\tour\tinternal\nrepresentations,\twe\tavoid\tone\tof\tthe\tpotential\tpitfalls\tthat\tcan\tresult\tin\ttight\tcoupling\t(the\nopposite\tof\twhat\twe\twant).\tWe\thave\talso\tidentified\ta\tboundary\twithin\tour\tdomain\twhere\nall\tlike-minded\tbusiness\tcapabilities\tshould\tlive,\tgiving\tus\tthe\thigh\tcohesion\twe\twant.\nThese\tbounded\tcontexts,\tthen,\tlend\tthemselves\textremely\twell\tto\tbeing\tcompositional\nboundaries.")]),t._v(" "),a("p",[t._v("As\twe\tdiscussed\tin\tChapter\t1,\twe\thave\tthe\toption\tof\tusing\tmodules\twithin\ta\tprocess\nboundary\tto\tkeep\trelated\tcode\ttogether\tand\tattempt\tto\treduce\tthe\tcoupling\tto\tother\nmodules\tin\tthe\tsystem.\tWhen\tyou’re\tstarting\tout\ton\ta\tnew\tcodebase,\tthis\tis\tprobably\ta\ngood\tplace\tto\tbegin.\tSo\tonce\tyou\thave\tfound\tyour\tbounded\tcontexts\tin\tyour\tdomain,\nmake\tsure\tthey\tare\tmodeled\twithin\tyour\tcodebase\tas\tmodules,\twith\tshared\tand\thidden\nmodels.")]),t._v(" "),a("p",[t._v("These\tmodular\tboundaries\tthen\tbecome\texcellent\tcandidates\tfor\tmicroservices.\tIn\tgeneral,\nmicroservices\tshould\tcleanly\talign\tto\tbounded\tcontexts.\tOnce\tyou\tbecome\tvery\tproficient,\nyou\tmay\tdecide\tto\tskip\tthe\tstep\tof\tkeeping\tthe\tbounded\tcontext\tmodeled\tas\ta\tmodule\nwithin\ta\tmore\tmonolithic\tsystem,\tand\tjump\tstraight\tfor\ta\tseparate\tservice.\tWhen\tstarting\nout,\thowever,\tkeep\ta\tnew\tsystem\ton\tthe\tmore\tmonolithic\tside;\tgetting\tservice\tboundaries\nwrong\tcan\tbe\tcostly,\tso\twaiting\tfor\tthings\tto\tstabilize\tas\tyou\tget\tto\tgrips\twith\ta\tnew\ndomain\tis\tsensible.\tWe’ll\tdiscuss\tthis\tmore\tin\tChapter\t5,\talong\twith\ttechniques\tto\thelp\nbreak\tapart\texisting\tsystems\tinto\tmicroservices.")]),t._v(" "),a("p",[t._v("So,\tif\tour\tservice\tboundaries\talign\tto\tthe\tbounded\tcontexts\tin\tour\tdomain,\tand\tour\nmicroservices\trepresent\tthose\tbounded\tcontexts,\twe\tare\toff\tto\tan\texcellent\tstart\tin\nensuring\tthat\tour\tmicroservices\tare\tloosely\tcoupled\tand\tstrongly\tcohesive.")]),t._v(" "),a("h2",{attrs:{id:"prematuredecomposition"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#prematuredecomposition"}},[t._v("#")]),t._v(" Premature\tDecomposition")]),t._v(" "),a("p",[t._v("At\tThoughtWorks,\twe\tourselves\texperienced\tthe\tchallenges\tof\tsplitting\tout\tmicroservices\ntoo\tquickly.\tAside\tfrom\tconsulting,\twe\talso\tcreate\ta\tfew\tproducts.\tOne\tof\tthem\tis\tSnapCI,\na\thosted\tcontinuous\tintegration\tand\tcontinuous\tdelivery\ttool\t(we’ll\tdiscuss\tthose\tconcepts\nlater\tin\tChapter\t6).\tThe\tteam\thad\tpreviously\tworked\ton\tanother\tsimilar\ttool,\tGo-CD,\ta\nnow\topen\tsource\tcontinuous\tdelivery\ttool\tthat\tcan\tbe\tdeployed\tlocally\trather\tthan\tbeing\nhosted\tin\tthe\tcloud.")]),t._v(" "),a("p",[t._v("Although\tthere\twas\tsome\tcode\treuse\tvery\tearly\ton\tbetween\tthe\tSnapCI\tand\tGo-CD\nprojects,\tin\tthe\tend\tSnapCI\tturned\tout\tto\tbe\ta\tcompletely\tnew\tcodebase.\tNonetheless,\tthe\nprevious\texperience\tof\tthe\tteam\tin\tthe\tdomain\tof\tCD\ttooling\temboldened\tthem\tto\tmove\nmore\tquickly\tin\tidentifying\tboundaries,\tand\tbuilding\ttheir\tsystem\tas\ta\tset\tof\nmicroservices.")]),t._v(" "),a("p",[t._v("After\ta\tfew\tmonths,\tthough,\tit\tbecame\tclear\tthat\tthe\tuse\tcases\tof\tSnapCI\twere\tsubtly\ndifferent\tenough\tthat\tthe\tinitial\ttake\ton\tthe\tservice\tboundaries\twasn’t\tquite\tright.\tThis\tled\nto\tlots\tof\tchanges\tbeing\tmade\tacross\tservices,\tand\tan\tassociated\thigh\tcost\tof\tchange.\nEventually\tthe\tteam\tmerged\tthe\tservices\tback\tinto\tone\tmonolithic\tsystem,\tgiving\tthem\ntime\tto\tbetter\tunderstand\twhere\tthe\tboundaries\tshould\texist.\tA\tyear\tlater,\tthe\tteam\twas\nthen\table\tto\tsplit\tthe\tmonolithic\tsystem\tapart\tinto\tmicroservices,\twhose\tboundaries\tproved\nto\tbe\tmuch\tmore\tstable.\tThis\tis\tfar\tfrom\tthe\tonly\texample\tof\tthis\tsituation\tI\thave\tseen.\nPrematurely\tdecomposing\ta\tsystem\tinto\tmicroservices\tcan\tbe\tcostly,\tespecially\tif\tyou\tare\nnew\tto\tthe\tdomain.\tIn\tmany\tways,\thaving\tan\texisting\tcodebase\tyou\twant\tto\tdecompose\ninto\tmicroservices\tis\tmuch\teasier\tthan\ttrying\tto\tgo\tto\tmicroservices\tfrom\tthe\tbeginning.")]),t._v(" "),a("h2",{attrs:{id:"businesscapabilities"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#businesscapabilities"}},[t._v("#")]),t._v(" Business\tCapabilities")]),t._v(" "),a("p",[t._v("When\tyou\tstart\tto\tthink\tabout\tthe\tbounded\tcontexts\tthat\texist\tin\tyour\torganization,\tyou\nshould\tbe\tthinking\tnot\tin\tterms\tof\tdata\tthat\tis\tshared,\tbut\tabout\tthe\tcapabilities\tthose\ncontexts\tprovide\tthe\trest\tof\tthe\tdomain.\tThe\twarehouse\tmay\tprovide\tthe\tcapability\tto\tget\ta\ncurrent\tstock\tlist,\tfor\texample,\tor\tthe\tfinance\tcontext\tmay\twell\texpose\tthe\tend-of-month\naccounts\tor\tlet\tyou\tset\tup\tpayroll\tfor\ta\tnew\trecruit.\tThese\tcapabilities\tmay\trequire\tthe\ninterchange\tof\tinformation\t—\tshared\tmodels\t—\tbut\tI\thave\tseen\ttoo\toften\tthat\tthinking\nabout\t "),a("em",[t._v("data")]),t._v(" \tleads\tto\tanemic,\tCRUD-based\t(create,\tread,\tupdate,\tdelete)\tservices.\tSo\task\nfirst\t“What\tdoes\tthis\tcontext\tdo?”,\tand\tthen\t“So\twhat\tdata\tdoes\tit\tneed\tto\tdo\tthat?”")]),t._v(" "),a("p",[t._v("When\tmodeled\tas\tservices,\tthese\tcapabilities\tbecome\tthe\tkey\toperations\tthat\twill\tbe\nexposed\tover\tthe\twire\tto\tother\tcollaborators.")]),t._v(" "),a("h2",{attrs:{id:"turtlesallthewaydown"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#turtlesallthewaydown"}},[t._v("#")]),t._v(" Turtles\tAll\tthe\tWay\tDown")]),t._v(" "),a("p",[t._v("At\tthe\tstart,\tyou\twill\tprobably\tidentify\ta\tnumber\tof\tcoarse-grained\tbounded\tcontexts.\tBut\nthese\tbounded\tcontexts\tcan\tin\tturn\tcontain\tfurther\tbounded\tcontexts.\tFor\texample,\tyou\ncould\tdecompose\tthe\twarehouse\tinto\tcapabilities\tassociated\twith\torder\tfulfillment,\ninventory\tmanagement,\tor\tgoods\treceiving.\tWhen\tconsidering\tthe\tboundaries\tof\tyour\nmicroservices,\tfirst\tthink\tin\tterms\tof\tthe\tlarger,\tcoarser-grained\tcontexts,\tand\tthen\nsubdivide\talong\tthese\tnested\tcontexts\twhen\tyou’re\tlooking\tfor\tthe\tbenefits\tof\tsplitting\tout\nthese\tseams.")]),t._v(" "),a("p",[t._v("I\thave\tseen\tthese\tnested\tcontexts\tremaining\thidden\tto\tother,\tcollaborating\tmicroservices\nto\tgreat\teffect.\tTo\tthe\toutside\tworld,\tthey\tare\tstill\tmaking\tuse\tof\tbusiness\tcapabilities\tin\nthe\twarehouse,\tbut\tthey\tare\tunaware\tthat\ttheir\trequests\tare\tactually\tbeing\tmapped\ntransparently\tto\ttwo\tor\tmore\tseparate\tservices,\tas\tyou\tcan\tsee\tin\tFigure\t3-2.\tSometimes,\nyou\twill\tdecide\tit\tmakes\tmore\tsense\tfor\tthe\thigher-level\tbounded\tcontext\tto\tnot\tbe\nexplicitly\tmodeled\tas\ta\tservice\tboundary,\tas\tin\tFigure\t3-3,\tso\trather\tthan\ta\tsingle\nwarehouse\tboundary,\tyou\tmight\tinstead\tsplit\tout\tinventory,\torder\tfulfillment,\tand\tgoods\nreceiving.")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("Figure\t3-2.\tMicroservices\trepresenting\tnested\tbounded\tcontexts\thidden\tinside\tthe\twarehouse\n")])])]),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("Figure\t3-3.\tThe\tbounded\tcontexts\tinside\tthe\twarehouse\tbeing\tpopped\tup\tinto\ttheir\town\ttop-level\tcontexts\n")])])]),a("p",[t._v("In\tgeneral,\tthere\tisn’t\ta\thard-and-fast\trule\tas\tto\twhat\tapproach\tmakes\tthe\tmost\tsense.\nHowever,\twhether\tyou\tchoose\tthe\tnested\tapproach\tover\tthe\tfull\tseparation\tapproach\nshould\tbe\tbased\ton\tyour\torganizational\tstructure.\tIf\torder\tfulfillment,\tinventory\nmanagement,\tand\tgoods\treceiving\tare\tmanaged\tby\tdifferent\tteams,\tthey\tprobably\tdeserve\ntheir\tstatus\tas\t "),a("em",[t._v("top-level")]),t._v(" \tmicroservices.\tIf,\ton\tthe\tother\thand,\tall\tof\tthem\tare\tmanaged\tby\none\tteam,\tthen\tthe\tnested\tmodel\tmakes\tmore\tsense.\tThis\tis\tbecause\tof\tthe\tinterplay\tof\norganizational\tstructures\tand\tsoftware\tarchitecture,\twhich\twe\twill\tdiscuss\ttoward\tthe\tend\nof\tthe\tbook\tin\tChapter\t10.")]),t._v(" "),a("p",[t._v("Another\treason\tto\tprefer\tthe\tnested\tapproach\tcould\tbe\tto\tchunk\tup\tyour\tarchitecture\tto\nsimplify\ttesting.\tFor\texample,\twhen\ttesting\tservices\tthat\tconsume\tthe\twarehouse,\tI\tdon’t\nhave\tto\tstub\teach\tservice\tinside\tthe\twarehouse\tcontext,\tjust\tthe\tmore\tcoarse-grained\tAPI.\nThis\tcan\talso\tgive\tyou\ta\tunit\tof\tisolation\twhen\tconsidering\tlarger-scoped\ttests.\tI\tmay,\tfor\nexample,\tdecide\tto\thave\tend-to-end\ttests\twhere\tI\tlaunch\tall\tservices\tinside\tthe\twarehouse\ncontext,\tbut\tfor\tall\tother\tcollaborators\tI\tmight\tstub\tthem\tout.\tWe’ll\texplore\tmore\tabout\ntesting\tand\tisolation\tin\tChapter\t7.")]),t._v(" "),a("h2",{attrs:{id:"communicationintermsofbusinessconcepts"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#communicationintermsofbusinessconcepts"}},[t._v("#")]),t._v(" Communication\tin\tTerms\tof\tBusiness\tConcepts")]),t._v(" "),a("p",[t._v("The\tchanges\twe\timplement\tto\tour\tsystem\tare\toften\tabout\tchanges\tthe\tbusiness\twants\tto\nmake\tto\thow\tthe\tsystem\tbehaves.\tWe\tare\tchanging\tfunctionality\t—\tcapabilities\t—\tthat\tare\nexposed\tto\tour\tcustomers.\tIf\tour\tsystems\tare\tdecomposed\talong\tthe\tbounded\tcontexts\tthat\nrepresent\tour\tdomain,\tthe\tchanges\twe\twant\tto\tmake\tare\tmore\tlikely\tto\tbe\tisolated\tto\tone,\nsingle\tmicroservice\tboundary.\tThis\treduces\tthe\tnumber\tof\tplaces\twe\tneed\tto\tmake\ta\nchange,\tand\tallows\tus\tto\tdeploy\tthat\tchange\tquickly.")]),t._v(" "),a("p",[t._v("It’s\talso\timportant\tto\tthink\tof\tthe\tcommunication\tbetween\tthese\tmicroservices\tin\tterms\tof\nthe\tsame\tbusiness\tconcepts.\tThe\tmodeling\tof\tyour\tsoftware\tafter\tyour\tbusiness\tdomain\nshouldn’t\tstop\tat\tthe\tidea\tof\tbounded\tcontexts.\tThe\tsame\tterms\tand\tideas\tthat\tare\tshared\nbetween\tparts\tof\tyour\torganization\tshould\tbe\treflected\tin\tyour\tinterfaces.\tIt\tcan\tbe\tuseful\nto\tthink\tof\tforms\tbeing\tsent\tbetween\tthese\tmicroservices,\tmuch\tas\tforms\tare\tsent\taround\nan\torganization.")]),t._v(" "),a("h2",{attrs:{id:"thetechnicalboundary"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#thetechnicalboundary"}},[t._v("#")]),t._v(" The\tTechnical\tBoundary")]),t._v(" "),a("p",[t._v("It\tcan\tbe\tuseful\tto\tlook\tat\twhat\tcan\tgo\twrong\twhen\tservices\tare\tmodeled\tincorrectly.\tA\nwhile\tback,\ta\tfew\tcolleagues\tand\tI\twere\tworking\twith\ta\tclient\tin\tCalifornia,\thelping\tthe\ncompany\tadopt\tsome\tcleaner\tcode\tpractices\tand\tmove\tmore\ttoward\tautomated\ttesting.\nWe’d\tstarted\twith\tsome\tof\tthe\tlow-hanging\tfruit,\tsuch\tas\tservice\tdecomposition,\twhen\twe\nnoticed\tsomething\tmuch\tmore\tworrying.\tI\tcan’t\tgo\tinto\ttoo\tmuch\tdetail\tas\tto\twhat\tthe\napplication\tdid,\tbut\tit\twas\ta\tpublic-facing\tapplication\twith\ta\tlarge,\tglobal\tcustomer\tbase.")]),t._v(" "),a("p",[t._v("The\tteam,\tand\tsystem,\thad\tgrown.\tOriginally\tone\tperson’s\tvision,\tthe\tsystem\thad\ttaken\ton\nmore\tand\tmore\tfeatures,\tand\tmore\tand\tmore\tusers.\tEventually,\tthe\torganization\tdecided\tto\nincrease\tthe\tcapacity\tof\tthe\tteam\tby\thaving\ta\tnew\tgroup\tof\tdevelopers\tbased\tin\tBrazil\ttake\non\tsome\tof\tthe\twork.\tThe\tsystem\tgot\tsplit\tup,\twith\tthe\tfront\thalf\tof\tthe\tapplication\tbeing\nessentially\tstateless,\timplementing\tthe\tpublic-facing\twebsite,\tas\tshown\tin\tFigure\t3-4.\tThe\nback\thalf\tof\tthe\tsystem\twas\tsimply\ta\tremote\tprocedure\tcall\t(RPC)\tinterface\tover\ta\tdata\nstore.\tEssentially,\timagine\tyou’d\ttaken\ta\trepository\tlayer\tin\tyour\tcodebase\tand\tmade\tthis\ta\nseparate\tservice.")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("Figure\t3-4.\tA\tservice\tboundary\tsplit\tacross\ta\ttechnical\tseam\n")])])]),a("p",[t._v("Changes\tfrequently\thad\tto\tbe\tmade\tto\tboth\tservices.\tBoth\tservices\tspoke\tin\tterms\tof\tlow-\nlevel,\tRPC-style\tmethod\tcalls,\twhich\twere\toverly\tbrittle\t(we’ll\tdiscuss\tthis\tfuther\tin\nChapter\t4).\tThe\tservice\tinterface\twas\talso\tvery\tchatty\ttoo,\tresulting\tin\tperformance\tissues.\nThis\tresulted\tin\tthe\tneed\tfor\telaborate\tRPC-batching\tmechanisms.\tI\tcalled\tthis\t "),a("em",[t._v("onion\narchitecture")]),t._v(" ,\tas\tit\thad\tlots\tof\tlayers\tand\tmade\tme\tcry\twhen\twe\thad\tto\tcut\tthrough\tit.")]),t._v(" "),a("p",[t._v("Now\ton\tthe\tface\tof\tit,\tthe\tidea\tof\tsplitting\tthe\tpreviously\tmonolithic\tsystem\talong\ngeographical/organizational\tlines\tmakes\tperfect\tsense,\tas\twe’ll\texpand\ton\tin\tChapter\t10.\nHere,\thowever,\trather\tthan\ttaking\ta\tvertical,\tbusiness-focused\tslice\tthrough\tthe\tstack,\tthe\nteam\tpicked\twhat\twas\tpreviously\tan\tin-process\tAPI\tand\tmade\ta\thorizontal\tslice.")]),t._v(" "),a("p",[t._v("Making\tdecisions\tto\tmodel\tservice\tboundaries\talong\ttechnical\tseams\tisn’t\talways\twrong.\tI\nhave\tcertainly\tseen\tthis\tmake\tlots\tof\tsense\twhen\tan\torganization\tis\tlooking\tto\tachieve\ncertain\tperformance\tobjectives,\tfor\texample.\tHowever,\tit\tshould\tbe\tyour\tsecondary\tdriver")]),t._v(" "),a("p",[t._v("for\tfinding\tthese\tseams,\tnot\tyour\tprimary\tone.")]),t._v(" "),a("h2",{attrs:{id:"summary-3"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#summary-3"}},[t._v("#")]),t._v(" Summary")]),t._v(" "),a("p",[t._v("In\tthis\tchapter,\tyou’ve\tlearned\ta\tbit\tabout\twhat\tmakes\ta\tgood\tservice,\tand\thow\tto\tfind\nseams\tin\tour\tproblem\tspace\tthat\tgive\tus\tthe\tdual\tbenefits\tof\tboth\tloose\tcoupling\tand\thigh\ncohesion.\tBounded\tcontexts\tare\ta\tvital\ttool\tin\thelping\tus\tfind\tthese\tseams,\tand\tby\taligning\nour\tmicroservices\tto\tthese\tboundaries\twe\tensure\tthat\tthe\tresulting\tsystem\thas\tevery\nchance\tof\tkeeping\tthose\tvirtues\tintact.\tWe’ve\talso\tgot\ta\thint\tabout\thow\twe\tcan\tsubdivide\nour\tmicroservices\tfurther,\tsomething\twe’ll\texplore\tin\tmore\tdepth\tlater.\tAnd\twe\talso\nintroduced\tMusicCorp,\tthe\texample\tdomain\tthat\twe\twill\tuse\tthroughout\tthis\tbook.")]),t._v(" "),a("p",[t._v("The\tideas\tpresented\tin\tEric\tEvans’s\t "),a("em",[t._v("Domain-Driven\tDesign")]),t._v(" \tare\tvery\tuseful\tto\tus\tin\nfinding\tsensible\tboundaries\tfor\tour\tservices,\tand\tI’ve\tjust\tscratched\tthe\tsurface\there.\tI\nrecommend\tVaughn\tVernon’s\tbook\t "),a("em",[t._v("Implementing\tDomain-Driven\tDesign")]),t._v(" \t(Addison-\nWesley)\tto\thelp\tyou\tunderstand\tthe\tpracticalities\tof\tthis\tapproach.")]),t._v(" "),a("p",[t._v("Although\tthis\tchapter\thas\tbeen\tmostly\thigh-level,\twe\tneed\tto\tget\tmuch\tmore\ttechnical\tin\nthe\tnext.\tThere\tare\tmany\tpitfalls\tassociated\twith\timplementing\tinterfaces\tbetween\nservices\tthat\tcan\tlead\tto\tall\tsorts\tof\ttrouble,\tand\twe\twill\thave\tto\ttake\ta\tdeep\tdive\tinto\tthis\ntopic\tif\twe\tare\tto\tkeep\tour\tsystems\tfrom\tbecoming\ta\tgiant,\ttangled\tmess.")]),t._v(" "),a("p",[t._v("(^1) "),a("em",[a("a",{attrs:{href:"http://bit.ly/bounded-context-explained",target:"_blank",rel:"noopener noreferrer"}},[t._v("http://bit.ly/bounded-context-explained"),a("OutboundLink")],1)])]),t._v(" "),a("h1",{attrs:{id:"chapter4-integration"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#chapter4-integration"}},[t._v("#")]),t._v(" Chapter\t4.\tIntegration")]),t._v(" "),a("p",[t._v("Getting\tintegration\tright\tis\tthe\tsingle\tmost\timportant\taspect\tof\tthe\ttechnology\tassociated\nwith\tmicroservices\tin\tmy\topinion.\tDo\tit\twell,\tand\tyour\tmicroservices\tretain\ttheir\nautonomy,\tallowing\tyou\tto\tchange\tand\trelease\tthem\tindependent\tof\tthe\twhole.\tGet\tit\nwrong,\tand\tdisaster\tawaits.\tHopefully\tonce\tyou’ve\tread\tthis\tchapter\tyou’ll\tlearn\thow\tto\navoid\tsome\tof\tthe\tbiggest\tpitfalls\tthat\thave\tplagued\tother\tattempts\tat\tSOA\tand\tcould\tyet\nawait\tyou\tin\tyour\tjourney\tto\tmicroservices.")]),t._v(" "),a("h2",{attrs:{id:"lookingfortheidealintegrationtechnology"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#lookingfortheidealintegrationtechnology"}},[t._v("#")]),t._v(" Looking\tfor\tthe\tIdeal\tIntegration\tTechnology")]),t._v(" "),a("p",[t._v("There\tis\ta\tbewildering\tarray\tof\toptions\tout\tthere\tfor\thow\tone\tmicroservice\tcan\ttalk\tto\nanother.\tBut\twhich\tis\tthe\tright\tone:\tSOAP?\tXML-RPC?\tREST?\tProtocol\tbuffers?\tWe’ll\ndive\tinto\tthose\tin\ta\tmoment,\tbut\tbefore\twe\tdo,\tlet’s\tthink\tabout\twhat\twe\twant\tout\tof\nwhatever\ttechnology\twe\tpick.")]),t._v(" "),a("h2",{attrs:{id:"avoidbreakingchanges"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#avoidbreakingchanges"}},[t._v("#")]),t._v(" Avoid\tBreaking\tChanges")]),t._v(" "),a("p",[t._v("Every\tnow\tand\tthen,\twe\tmay\tmake\ta\tchange\tthat\trequires\tour\tconsumers\tto\talso\tchange.\nWe’ll\tdiscuss\thow\tto\thandle\tthis\tlater,\tbut\twe\twant\tto\tpick\ttechnology\tthat\tensures\tthis\nhappens\tas\trarely\tas\tpossible.\tFor\texample,\tif\ta\tmicroservice\tadds\tnew\tfields\tto\ta\tpiece\tof\ndata\tit\tsends\tout,\texisting\tconsumers\tshouldn’t\tbe\timpacted.")]),t._v(" "),a("h2",{attrs:{id:"keepyourapistechnology-agnostic"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#keepyourapistechnology-agnostic"}},[t._v("#")]),t._v(" Keep\tYour\tAPIs\tTechnology-Agnostic")]),t._v(" "),a("p",[t._v("If\tyou\thave\tbeen\tin\tthe\tIT\tindustry\tfor\tmore\tthan\t15\tminutes,\tyou\tdon’t\tneed\tme\tto\ttell\nyou\tthat\twe\twork\tin\ta\tspace\tthat\tis\tchanging\trapidly.\tThe\tone\tcertainty\t "),a("em",[t._v("is")]),t._v(" \tchange.\tNew\ntools,\tframeworks,\tand\tlanguages\tare\tcoming\tout\tall\tthe\ttime,\timplementing\tnew\tideas\nthat\tcan\thelp\tus\twork\tfaster\tand\tmore\teffectively.\tRight\tnow,\tyou\tmight\tbe\ta\t.NET\tshop.\nBut\twhat\tabout\tin\ta\tyear\tfrom\tnow,\tor\tfive\tyears\tfrom\tnow?\tWhat\tif\tyou\twant\tto\nexperiment\twith\tan\talternative\ttechnology\tstack\tthat\tmight\tmake\tyou\tmore\tproductive?")]),t._v(" "),a("p",[t._v("I\tam\ta\tbig\tfan\tof\tkeeping\tmy\toptions\topen,\twhich\tis\twhy\tI\tam\tsuch\ta\tfan\tof\tmicroservices.\nIt\tis\talso\twhy\tI\tthink\tit\tis\tvery\timportant\tto\tensure\tthat\tyou\tkeep\tthe\tAPIs\tused\tfor\ncommunication\tbetween\tmicroservices\ttechnology-agnostic.\tThis\tmeans\tavoiding\nintegration\ttechnology\tthat\tdictates\twhat\ttechnology\tstacks\twe\tcan\tuse\tto\timplement\tour\nmicroservices.")]),t._v(" "),a("h2",{attrs:{id:"makeyourservicesimpleforconsumers"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#makeyourservicesimpleforconsumers"}},[t._v("#")]),t._v(" Make\tYour\tService\tSimple\tfor\tConsumers")]),t._v(" "),a("p",[t._v("We\twant\tto\tmake\tit\teasy\tfor\tconsumers\tto\tuse\tour\tservice.\tHaving\ta\tbeautifully\tfactored\nmicroservice\tdoesn’t\tcount\tfor\tmuch\tif\tthe\tcost\tof\tusing\tit\tas\ta\tconsumer\tis\tsky\thigh!\tSo\nlet’s\tthink\tabout\twhat\tmakes\tit\teasy\tfor\tconsumers\tto\tuse\tour\twonderful\tnew\tservice.\nIdeally,\twe’d\tlike\tto\tallow\tour\tclients\tfull\tfreedom\tin\ttheir\ttechnology\tchoice,\tbut\ton\tthe\nother\thand,\tproviding\ta\tclient\tlibrary\tcan\tease\tadoption.\tOften,\thowever,\tsuch\tlibraries\tare\nincompatible\twith\tother\tthings\twe\twant\tto\tachieve.\tFor\texample,\twe\tmight\tuse\tclient\nlibraries\tto\tmake\tit\teasy\tfor\tconsumers,\tbut\tthis\tcan\tcome\tat\tthe\tcost\tof\tincreased\ncoupling.")]),t._v(" "),a("h2",{attrs:{id:"hideinternalimplementationdetail"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#hideinternalimplementationdetail"}},[t._v("#")]),t._v(" Hide\tInternal\tImplementation\tDetail")]),t._v(" "),a("p",[t._v("We\tdon’t\twant\tour\tconsumers\tto\tbe\tbound\tto\tour\tinternal\timplementation.\tThis\tleads\tto\nincreased\tcoupling.\tThis\tmeans\tthat\tif\twe\twant\tto\tchange\tsomething\tinside\tour\nmicroservice,\twe\tcan\tbreak\tour\tconsumers\tby\trequiring\tthem\tto\talso\tchange.\tThat\nincreases\tthe\tcost\tof\tchange\t—\tthe\texact\tresult\twe\tare\ttrying\tto\tavoid.\tIt\talso\tmeans\twe\nare\tless\tlikely\tto\twant\tto\tmake\ta\tchange\tfor\tfear\tof\thaving\tto\tupgrade\tour\tconsumers,\nwhich\tcan\tlead\tto\tincreased\ttechnical\tdebt\twithin\tthe\tservice.\tSo\tany\ttechnology\tthat\npushes\tus\tto\texpose\tinternal\trepresentation\tdetail\tshould\tbe\tavoided.")]),t._v(" "),a("h2",{attrs:{id:"interfacingwithcustomers"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#interfacingwithcustomers"}},[t._v("#")]),t._v(" Interfacing\twith\tCustomers")]),t._v(" "),a("p",[t._v("Now\tthat\twe’ve\tgot\ta\tfew\tguidelines\tthat\tcan\thelp\tus\tselect\ta\tgood\ttechnology\tto\tuse\tfor\nintegration\tbetween\tservices,\tlet’s\tlook\tat\tsome\tof\tthe\tmost\tcommon\toptions\tout\tthere\tand\ntry\tto\twork\tout\twhich\tone\tworks\tbest\tfor\tus.\tTo\thelp\tus\tthink\tthis\tthrough,\tlet’s\tpick\ta\nreal-world\texample\tfrom\tMusicCorp.")]),t._v(" "),a("p",[t._v("Customer\tcreation\tat\tfirst\tglance\tcould\tbe\tconsidered\ta\tsimple\tset\tof\tCRUD\toperations,\nbut\tfor\tmost\tsystems\tit\tis\tmore\tcomplex\tthan\tthat.\tEnrolling\ta\tnew\tcustomer\tmay\tneed\tto\nkick\toff\tadditional\tprocesses,\tlike\tsetting\tup\tfinancial\tpayments\tor\tsending\tout\twelcome\nemails.\tAnd\twhen\twe\tchange\tor\tdelete\ta\tcustomer,\tother\tbusiness\tprocesses\tmight\tget\ntriggered\tas\twell.")]),t._v(" "),a("p",[t._v("So\twith\tthat\tin\tmind,\twe\tshould\tlook\tat\tsome\tdifferent\tways\tin\twhich\twe\tmight\twant\tto\nwork\twith\tcustomers\tin\tour\tMusicCorp\tsystem.")]),t._v(" "),a("h2",{attrs:{id:"theshareddatabase"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#theshareddatabase"}},[t._v("#")]),t._v(" The\tShared\tDatabase")]),t._v(" "),a("p",[t._v("By\tfar\tthe\tmost\tcommon\tform\tof\tintegration\tthat\tI\tor\tany\tof\tmy\tcolleagues\tsee\tin\tthe\nindustry\tis\tdatabase\t(DB)\tintegration.\tIn\tthis\tworld,\tif\tother\tservices\twant\tinformation\nfrom\ta\tservice,\tthey\treach\tinto\tthe\tdatabase.\tAnd\tif\tthey\twant\tto\tchange\tit,\tthey\treach\tinto\nthe\tdatabase!\tThis\tis\treally\tsimple\twhen\tyou\tfirst\tthink\tabout\tit,\tand\tis\tprobably\tthe\tfastest\nform\tof\tintegration\tto\tstart\twith\t—\twhich\tprobably\texplains\tits\tpopularity.")]),t._v(" "),a("p",[t._v("Figure\t4-1\tshows\tour\tregistration\tUI,\twhich\tcreates\tcustomers\tby\tperforming\tSQL\noperations\tdirectly\ton\tthe\tdatabase.\tIt\talso\tshows\tour\tcall\tcenter\tapplication\tthat\tviews\tand\nedits\tcustomer\tdata\tby\trunning\tSQL\ton\tthe\tdatabase.\tAnd\tthe\twarehouse\tupdates\ninformation\tabout\tcustomer\torders\tby\tquerying\tthe\tdatabase.\tThis\tis\ta\tcommon\tenough\npattern,\tbut\tit’s\tone\tfraught\twith\tdifficulties.")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("Figure\t4-1.\tUsing\tDB\tintegration\tto\taccess\tand\tchange\tcustomer\tinformation\n")])])]),a("p",[t._v("First,\twe\tare\tallowing\texternal\tparties\tto\tview\tand\tbind\tto\tinternal\timplementation\tdetails.\nThe\tdata\tstructures\tI\tstore\tin\tthe\tDB\tare\tfair\tgame\tto\tall;\tthey\tare\tshared\tin\ttheir\tentirety\nwith\tall\tother\tparties\twith\taccess\tto\tthe\tdatabase.\tIf\tI\tdecide\tto\tchange\tmy\tschema\tto\tbetter\nrepresent\tmy\tdata,\tor\tmake\tmy\tsystem\teasier\tto\tmaintain,\tI\tcan\tbreak\tmy\tconsumers.\tThe\nDB\tis\teffectively\ta\tvery\tlarge,\tshared\tAPI\tthat\tis\talso\tquite\tbrittle.\tIf\tI\twant\tto\tchange\tthe\nlogic\tassociated\twith,\tsay,\thow\tthe\thelpdesk\tmanages\tcustomers\tand\tthis\trequires\ta\tchange\nto\tthe\tdatabase,\tI\thave\tto\tbe\textremely\tcareful\tthat\tI\tdon’t\tbreak\tparts\tof\tthe\tschema\tused\nby\tother\tservices.\tThis\tsituation\tnormally\tresults\tin\trequiring\ta\tlarge\tamount\tof\tregression\ntesting.")]),t._v(" "),a("p",[t._v("Second,\tmy\tconsumers\tare\ttied\tto\ta\tspecific\ttechnology\tchoice.\tPerhaps\tright\tnow\tit\nmakes\tsense\tto\tstore\tcustomers\tin\ta\trelational\tdatabase,\tso\tmy\tconsumers\tuse\tan\nappropriate\t(potentially\tDB-specific)\tdriver\tto\ttalk\tto\tit.\tWhat\tif\tover\ttime\twe\trealize\twe\nwould\tbe\tbetter\toff\tstoring\tdata\tin\ta\tnonrelational\tdatabase?\tCan\tit\tmake\tthat\tdecision?\tSo\nconsumers\tare\tintimately\ttied\tto\tthe\timplementation\tof\tthe\tcustomer\tservice.\tAs\twe\ndiscussed\tearlier,\twe\treally\twant\tto\tensure\tthat\timplementation\tdetail\tis\thidden\tfrom\nconsumers\tto\tallow\tour\tservice\ta\tlevel\tof\tautonomy\tin\tterms\tof\thow\tit\tchanges\tits\ninternals\tover\ttime.\tGoodbye,\tloose\tcoupling.")]),t._v(" "),a("p",[t._v("Finally,\tlet’s\tthink\tabout\tbehavior\tfor\ta\tmoment.\tThere\tis\tgoing\tto\tbe\tlogic\tassociated\twith\nhow\ta\tcustomer\tis\tchanged.\tWhere\tis\tthat\tlogic?\tIf\tconsumers\tare\tdirectly\tmanipulating\nthe\tDB,\tthen\tthey\thave\tto\town\tthe\tassociated\tlogic.\tThe\tlogic\tto\tperform\tthe\tsame\tsorts\tof\nmanipulation\tto\ta\tcustomer\tmay\tnow\tbe\tspread\tamong\tmultiple\tconsumers.\tIf\tthe\nwarehouse,\tregistration\tUI,\tand\tcall\tcenter\tUI\tall\tneed\tto\tedit\tcustomer\tinformation,\tI\tneed\nto\tfix\ta\tbug\tor\tchange\tthe\tbehavior\tin\tthree\tdifferent\tplaces,\tand\tdeploy\tthose\tchanges\ttoo.\nGoodbye,\tcohesion.")]),t._v(" "),a("p",[t._v("Remember\twhen\twe\ttalked\tabout\tthe\tcore\tprinciples\tbehind\tgood\tmicroservices?\tStrong\ncohesion\tand\tloose\tcoupling\t—\twith\tdatabase\tintegration,\twe\tlose\tboth\tthings.\tDatabase\nintegration\tmakes\tit\teasy\tfor\tservices\tto\tshare\tdata,\tbut\tdoes\tnothing\tabout\t "),a("em",[t._v("sharing\nbehavior")]),t._v(" .\tOur\tinternal\trepresentation\tis\texposed\tover\tthe\twire\tto\tour\tconsumers,\tand\tit\tcan\nbe\tvery\tdifficult\tto\tavoid\tmaking\tbreaking\tchanges,\twhich\tinevitably\tleads\tto\ta\tfear\tof\tany\nchange\tat\tall.\tAvoid\tat\t(nearly)\tall\tcosts.")]),t._v(" "),a("p",[t._v("For\tthe\trest\tof\tthe\tchapter,\twe’ll\texplore\tdifferent\tstyles\tof\tintegration\tthat\tinvolve\ncollaborating\tservices,\twhich\tthemselves\thide\ttheir\town\tinternal\trepresentations.")]),t._v(" "),a("h2",{attrs:{id:"synchronousversusasynchronous"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#synchronousversusasynchronous"}},[t._v("#")]),t._v(" Synchronous\tVersus\tAsynchronous")]),t._v(" "),a("p",[t._v("Before\twe\tstart\tdiving\tinto\tthe\tspecifics\tof\tdifferent\ttechnology\tchoices,\twe\tshould\tdiscuss\none\tof\tthe\tmost\timportant\tdecisions\twe\tcan\tmake\tin\tterms\tof\thow\tservices\tcollaborate.\nShould\tcommunication\tbe\tsynchronous\tor\tasynchronous?\tThis\tfundamental\tchoice\ninevitably\tguides\tus\ttoward\tcertain\timplementation\tdetail.")]),t._v(" "),a("p",[t._v("With\tsynchronous\tcommunication,\ta\tcall\tis\tmade\tto\ta\tremote\tserver,\twhich\tblocks\tuntil\nthe\toperation\tcompletes.\tWith\tasynchronous\tcommunication,\tthe\tcaller\tdoesn’t\twait\tfor\nthe\toperation\tto\tcomplete\tbefore\treturning,\tand\tmay\tnot\teven\tcare\twhether\tor\tnot\tthe\noperation\tcompletes\tat\tall.")]),t._v(" "),a("p",[t._v("Synchronous\tcommunication\tcan\tbe\teasier\tto\treason\tabout.\tWe\tknow\twhen\tthings\thave\ncompleted\tsuccessfully\tor\tnot.\tAsynchronous\tcommunication\tcan\tbe\tvery\tuseful\tfor\tlong-\nrunning\tjobs,\twhere\tkeeping\ta\tconnection\topen\tfor\ta\tlong\tperiod\tof\ttime\tbetween\tthe\nclient\tand\tserver\tis\timpractical.\tIt\talso\tworks\tvery\twell\twhen\tyou\tneed\tlow\tlatency,\twhere\nblocking\ta\tcall\twhile\twaiting\tfor\tthe\tresult\tcan\tslow\tthings\tdown.\tDue\tto\tthe\tnature\tof\nmobile\tnetworks\tand\tdevices,\tfiring\toff\trequests\tand\tassuming\tthings\thave\tworked\t(unless\ntold\totherwise)\tcan\tensure\tthat\tthe\tUI\tremains\tresponsive\teven\tif\tthe\tnetwork\tis\thighly\nlaggy.\tOn\tthe\tflipside,\tthe\ttechnology\tto\thandle\tasynchronous\tcommunication\tcan\tbe\ta\tbit\nmore\tinvolved,\tas\twe’ll\tdiscuss\tshortly.")]),t._v(" "),a("p",[t._v("These\ttwo\tdifferent\tmodes\tof\tcommunication\tcan\tenable\ttwo\tdifferent\tidiomatic\tstyles\tof\ncollaboration:\t "),a("em",[t._v("request/response")]),t._v(" \tor\t "),a("em",[t._v("event-based")]),t._v(" .\tWith\trequest/response,\ta\tclient\tinitiates\ta\nrequest\tand\twaits\tfor\tthe\tresponse.\tThis\tmodel\tclearly\taligns\twell\tto\tsynchronous\ncommunication,\tbut\tcan\twork\tfor\tasynchronous\tcommunication\ttoo.\tI\tmight\tkick\toff\tan\noperation\tand\tregister\ta\tcallback,\tasking\tthe\tserver\tto\tlet\tme\tknow\twhen\tmy\toperation\thas\ncompleted.")]),t._v(" "),a("p",[t._v("With\tan\tevent-based\tcollaboration,\twe\tinvert\tthings.\tInstead\tof\ta\tclient\tinitiating\trequests\nasking\tfor\tthings\tto\tbe\tdone,\tit\tinstead\tsays\t "),a("em",[t._v("this\tthing\thappened")]),t._v(" \tand\texpects\tother\tparties\nto\tknow\twhat\tto\tdo.\tWe\tnever\ttell\tanyone\telse\twhat\tto\tdo.\tEvent-based\tsystems\tby\ttheir\nnature\tare\tasynchronous.\tThe\tsmarts\tare\tmore\tevenly\tdistributed\t—\tthat\tis,\tthe\tbusiness\nlogic\tis\tnot\tcentralized\tinto\tcore\tbrains,\tbut\tinstead\tpushed\tout\tmore\tevenly\tto\tthe\tvarious\ncollaborators.\tEvent-based\tcollaboration\tis\talso\thighly\tdecoupled.\tThe\tclient\tthat\temits\tan\nevent\tdoesn’t\thave\tany\tway\tof\tknowing\twho\tor\twhat\twill\treact\tto\tit,\twhich\talso\tmeans\tthat\nyou\tcan\tadd\tnew\tsubscribers\tto\tthese\tevents\twithout\tthe\tclient\tever\tneeding\tto\tknow.")]),t._v(" "),a("p",[t._v("So\tare\tthere\tany\tother\tdrivers\tthat\tmight\tpush\tus\tto\tpick\tone\tstyle\tover\tanother?\tOne\nimportant\tfactor\tto\tconsider\tis\thow\twell\tthese\tstyles\tare\tsuited\tfor\tsolving\tan\toften-\ncomplex\tproblem:\thow\tdo\twe\thandle\tprocesses\tthat\tspan\tservice\tboundaries\tand\tmay\tbe\nlong\trunning?")]),t._v(" "),a("h2",{attrs:{id:"orchestrationversuschoreography"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#orchestrationversuschoreography"}},[t._v("#")]),t._v(" Orchestration\tVersus\tChoreography")]),t._v(" "),a("p",[t._v("As\twe\tstart\tto\tmodel\tmore\tand\tmore\tcomplex\tlogic,\twe\thave\tto\tdeal\twith\tthe\tproblem\tof\nmanaging\tbusiness\tprocesses\tthat\tstretch\tacross\tthe\tboundary\tof\tindividual\tservices.\tAnd\nwith\tmicroservices,\twe’ll\thit\tthis\tlimit\tsooner\tthan\tusual.\tLet’s\ttake\tan\texample\tfrom\nMusicCorp,\tand\tlook\tat\twhat\thappens\twhen\twe\tcreate\ta\tcustomer:")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("1 .\tA\tnew\trecord\tis\tcreated\tin\tthe\tloyalty\tpoints\tbank\tfor\tthe\tcustomer.\n")])])]),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("2 .\tOur\tpostal\tsystem\tsends\tout\ta\twelcome\tpack.\n")])])]),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("3 .\tWe\tsend\ta\twelcome\temail\tto\tthe\tcustomer.\n")])])]),a("p",[t._v("This\tis\tvery\teasy\tto\tmodel\tconceptually\tas\ta\tflowchart,\tas\twe\tdo\tin\tFigure\t4-2.")]),t._v(" "),a("p",[t._v("When\tit\tcomes\tto\tactually\timplementing\tthis\tflow,\tthere\tare\ttwo\tstyles\tof\tarchitecture\twe\ncould\tfollow.\tWith\torchestration,\twe\trely\ton\ta\tcentral\tbrain\tto\tguide\tand\tdrive\tthe\tprocess,\nmuch\tlike\tthe\tconductor\tin\tan\torchestra.\tWith\tchoreography,\twe\tinform\teach\tpart\tof\tthe\nsystem\tof\tits\tjob,\tand\tlet\tit\twork\tout\tthe\tdetails,\tlike\tdancers\tall\tfinding\ttheir\tway\tand\nreacting\tto\tothers\taround\tthem\tin\ta\tballet.")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("Figure\t4-2.\tThe\tprocess\tfor\tcreating\ta\tnew\tcustomer\n")])])]),a("p",[t._v("Let’s\tthink\tabout\twhat\tan\torchestration\tsolution\twould\tlook\tlike\tfor\tthis\tflow.\tHere,\nprobably\tthe\tsimplest\tthing\tto\tdo\twould\tbe\tto\thave\tour\tcustomer\tservice\tact\tas\tthe\tcentral\nbrain.\tOn\tcreation,\tit\ttalks\tto\tthe\tloyalty\tpoints\tbank,\temail\tservice,\tand\tpostal\tservice\tas\nwe\tsee\tin\tFigure\t4-3,\tthrough\ta\tseries\tof\trequest/response\tcalls.\tThe\tcustomer\tservice")]),t._v(" "),a("p",[t._v("itself\tcan\tthen\ttrack\twhere\ta\tcustomer\tis\tin\tthis\tprocess.\tIt\tcan\tcheck\tto\tsee\tif\tthe\ncustomer’s\taccount\thas\tbeen\tset\tup,\tor\tthe\temail\tsent,\tor\tthe\tpost\tdelivered.\tWe\tget\tto\ttake\nthe\tflowchart\tin\tFigure\t4-2\tand\tmodel\tit\tdirectly\tinto\tcode.\tWe\tcould\teven\tuse\ttooling\tthat\nimplements\tthis\tfor\tus,\tperhaps\tusing\tan\tappropriate\trules\tengine.\tCommercial\ttools\texist\nfor\tthis\tvery\tpurpose\tin\tthe\tform\tof\tbusiness\tprocess\tmodeling\tsoftware.\tAssuming\twe\tuse\nsynchronous\trequest/response,\twe\tcould\teven\tknow\tif\teach\tstage\thas\tworked.")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("Figure\t4-3.\tHandling\tcustomer\tcreation\tvia\torchestration\n")])])]),a("p",[t._v("The\tdownside\tto\tthis\torchestration\tapproach\tis\tthat\tthe\tcustomer\tservice\tcan\tbecome\ttoo\nmuch\tof\ta\tcentral\tgoverning\tauthority.\tIt\tcan\tbecome\tthe\thub\tin\tthe\tmiddle\tof\ta\tweb,\tand\ta\ncentral\tpoint\twhere\tlogic\tstarts\tto\tlive.\tI\thave\tseen\tthis\tapproach\tresult\tin\ta\tsmall\tnumber\nof\tsmart\t“god”\tservices\ttelling\tanemic\tCRUD-based\tservices\twhat\tto\tdo.")]),t._v(" "),a("p",[t._v("With\ta\tchoreographed\tapproach,\twe\tcould\tinstead\tjust\thave\tthe\tcustomer\tservice\temit\tan\nevent\tin\tan\tasynchronous\tmanner,\tsaying\t "),a("em",[t._v("Customer\tcreated")]),t._v(" .\tThe\temail\tservice,\tpostal\nservice,\tand\tloyalty\tpoints\tbank\tthen\tjust\tsubscribe\tto\tthese\tevents\tand\treact\taccordingly,\nas\tin\tFigure\t4-4.\tThis\tapproach\tis\tsignificantly\tmore\tdecoupled.\tIf\tsome\tother\tservice\nneeded\tto\treach\tto\tthe\tcreation\tof\ta\tcustomer,\tit\tjust\tneeds\tto\tsubscribe\tto\tthe\tevents\tand\ndo\tits\tjob\twhen\tneeded.\tThe\tdownside\tis\tthat\tthe\texplicit\tview\tof\tthe\tbusiness\tprocess\twe\nsee\tin\tFigure\t4-2\tis\tnow\tonly\timplicitly\treflected\tin\tour\tsystem.")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("Figure\t4-4.\tHandling\tcustomer\tcreation\tvia\tchoreography\n")])])]),a("p",[t._v("This\tmeans\tadditional\twork\tis\tneeded\tto\tensure\tthat\tyou\tcan\tmonitor\tand\ttrack\tthat\tthe\nright\tthings\thave\thappened.\tFor\texample,\twould\tyou\tknow\tif\tthe\tloyalty\tpoints\tbank\thad\ta\nbug\tand\tfor\tsome\treason\tdidn’t\tset\tup\tthe\tcorrect\taccount?\tOne\tapproach\tI\tlike\tfor\tdealing\nwith\tthis\tis\tto\tbuild\ta\tmonitoring\tsystem\tthat\texplicitly\tmatches\tthe\tview\tof\tthe\tbusiness\nprocess\tin\tFigure\t4-2,\tbut\tthen\ttracks\twhat\teach\tof\tthe\tservices\tdoes\tas\tindependent\nentities,\tletting\tyou\tsee\todd\texceptions\tmapped\tonto\tthe\tmore\texplicit\tprocess\tflow.\tThe\nflowchart\twe\tsaw\tearlier\tisn’t\tthe\tdriving\tforce,\tbut\tjust\tone\tlens\tthrough\twhich\twe\tcan\nsee\thow\tthe\tsystem\tis\tbehaving.")]),t._v(" "),a("p",[t._v("In\tgeneral,\tI\thave\tfound\tthat\tsystems\tthat\ttend\tmore\ttoward\tthe\tchoreographed\tapproach\nare\tmore\tloosely\tcoupled,\tand\tare\tmore\tflexible\tand\tamenable\tto\tchange.\tYou\tdo\tneed\tto\ndo\textra\twork\tto\tmonitor\tand\ttrack\tthe\tprocesses\tacross\tsystem\tboundaries,\thowever.\tI\nhave\tfound\tmost\theavily\torchestrated\timplementations\tto\tbe\textremely\tbrittle,\twith\ta\nhigher\tcost\tof\tchange.\tWith\tthat\tin\tmind,\tI\tstrongly\tprefer\taiming\tfor\ta\tchoreographed\nsystem,\twhere\teach\tservice\tis\tsmart\tenough\tto\tunderstand\tits\trole\tin\tthe\twhole\tdance.")]),t._v(" "),a("p",[t._v("There\tare\tquite\ta\tfew\tfactors\tto\tunpack\there.\tSynchronous\tcalls\tare\tsimpler,\tand\twe\tget\tto\nknow\tif\tthings\tworked\tstraightaway.\tIf\twe\tlike\tthe\tsemantics\tof\trequest/response\tbut\tare\ndealing\twith\tlonger-lived\tprocesses,\twe\tcould\tjust\tinitiate\tasynchronous\trequests\tand\twait\nfor\tcallbacks.\tOn\tthe\tother\thand,\tasynchronous\tevent\tcollaboration\thelps\tus\tadopt\ta\nchoreographed\tapproach,\twhich\tcan\tyield\tsignificantly\tmore\tdecoupled\tservices\t—\nsomething\twe\twant\tto\tstrive\tfor\tto\tensure\tour\tservices\tare\tindependently\treleasable.")]),t._v(" "),a("p",[t._v("We\tare,\tof\tcourse,\tfree\tto\tmix\tand\tmatch.\tSome\ttechnologies\twill\tfit\tmore\tnaturally\tinto\none\tstyle\tor\tanother.\tWe\tdo,\thowever,\tneed\tto\tappreciate\tsome\tof\tthe\tdifferent\ttechnical\nimplementation\tdetails\tthat\twill\tfurther\thelp\tus\tmake\tthe\tright\tcall.")]),t._v(" "),a("p",[t._v("To\tstart\twith,\tlet’s\tlook\tat\ttwo\ttechnologies\tthat\tfit\twell\twhen\twe\tare\tconsidering\nrequest/response:\tremote\tprocedure\tcall\t(RPC)\tand\tREpresentational\tState\tTransfer\n(REST).")]),t._v(" "),a("h2",{attrs:{id:"remoteprocedurecalls"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#remoteprocedurecalls"}},[t._v("#")]),t._v(" Remote\tProcedure\tCalls")]),t._v(" "),a("p",[a("em",[t._v("Remote\tprocedure\tcall")]),t._v(" \trefers\tto\tthe\ttechnique\tof\tmaking\ta\tlocal\tcall\tand\thaving\tit\texecute\non\ta\tremote\tservice\tsomewhere.\tThere\tare\ta\tnumber\tof\tdifferent\ttypes\tof\tRPC\ttechnology\nout\tthere.\tSome\tof\tthis\ttechnology\trelies\ton\thaving\tan\tinterface\tdefinition\t(SOAP,\tThrift,\nprotocol\tbuffers).\tThe\tuse\tof\ta\tseparate\tinterface\tdefinition\tcan\tmake\tit\teasier\tto\tgenerate\nclient\tand\tserver\tstubs\tfor\tdifferent\ttechnology\tstacks,\tso,\tfor\texample,\tI\tcould\thave\ta\tJava\nserver\texposing\ta\tSOAP\tinterface,\tand\ta\t.NET\tclient\tgenerated\tfrom\tthe\tWeb\tService\nDefinition\tLanguage\t(WSDL)\tdefinition\tof\tthe\tinterface.\tOther\ttechnology,\tlike\tJava\tRMI,\ncalls\tfor\ta\ttighter\tcoupling\tbetween\tthe\tclient\tand\tserver,\trequiring\tthat\tboth\tuse\tthe\tsame\nunderlying\ttechnology\tbut\tavoid\tthe\tneed\tfor\ta\tshared\tinterface\tdefinition.\tAll\tthese\ntechnologies,\thowever,\thave\tthe\tsame,\tcore\tcharacteristic\tin\tthat\tthey\tmake\ta\tlocal\tcall\nlook\tlike\ta\tremote\tcall.")]),t._v(" "),a("p",[t._v("Many\tof\tthese\ttechnologies\tare\tbinary\tin\tnature,\tlike\tJava\tRMI,\tThrift,\tor\tprotocol\tbuffers,\nwhile\tSOAP\tuses\tXML\tfor\tits\tmessage\tformats.\tSome\timplementations\tare\ttied\tto\ta\nspecific\tnetworking\tprotocol\t(like\tSOAP,\twhich\tmakes\tnominal\tuse\tof\tHTTP),\twhereas\nothers\tmight\tallow\tyou\tto\tuse\tdifferent\ttypes\tof\tnetworking\tprotocols,\twhich\tthemselves\ncan\tprovide\tadditional\tfeatures.\tFor\texample,\tTCP\toffers\tguarantees\tabout\tdelivery,\nwhereas\tUDP\tdoesn’t\tbut\thas\ta\tmuch\tlower\toverhead.\tThis\tcan\tallow\tyou\tto\tuse\tdifferent\nnetworking\ttechnology\tfor\tdifferent\tuse\tcases.")]),t._v(" "),a("p",[t._v("Those\tRPC\timplementations\tthat\tallow\tyou\tto\tgenerate\tclient\tand\tserver\tstubs\thelp\tyou\nget\tstarted\tvery,\tvery\tfast.\tI\tcan\tbe\tsending\tcontent\tover\ta\tnetwork\tboundary\tin\tno\ttime\tat\nall.\tThis\tis\toften\tone\tof\tthe\tmain\tselling\tpoints\tof\tRPC:\tits\tease\tof\tuse.\tThe\tfact\tthat\tI\tcan\njust\tmake\ta\tnormal\tmethod\tcall\tand\ttheoretically\tignore\tthe\trest\tis\ta\thuge\tboon.")]),t._v(" "),a("p",[t._v("Some\tRPC\timplementations,\tthough,\tdo\tcome\twith\tsome\tdownsides\tthat\tcan\tcause\tissues.\nThese\tissues\taren’t\talways\tapparent\tinitially,\tbut\tnonetheless\tthey\tcan\tbe\tsevere\tenough\tto\noutweigh\tthe\tbenefits\tof\tbeing\tso\teasy\tto\tget\tup\tand\trunning\tquickly.")]),t._v(" "),a("h2",{attrs:{id:"technologycoupling"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#technologycoupling"}},[t._v("#")]),t._v(" Technology\tCoupling")]),t._v(" "),a("p",[t._v("Some\tRPC\tmechanisms,\tlike\tJava\tRMI,\tare\theavily\ttied\tto\ta\tspecific\tplatform,\twhich\tcan\nlimit\twhich\ttechnology\tcan\tbe\tused\tin\tthe\tclient\tand\tserver.\tThrift\tand\tprotocol\tbuffers\nhave\tan\timpressive\tamount\tof\tsupport\tfor\talternative\tlanguages,\twhich\tcan\treduce\tthis\ndownside\tsomewhat,\tbut\tbe\taware\tthat\tsometimes\tRPC\ttechnology\tcomes\twith\nrestrictions\ton\tinteroperability.")]),t._v(" "),a("p",[t._v("In\ta\tway,\tthis\ttechnology\tcoupling\tcan\tbe\ta\tform\tof\texposing\tinternal\ttechnical\nimplementation\tdetails.\tFor\texample,\tthe\tuse\tof\tRMI\tties\tnot\tonly\tthe\tclient\tto\tthe\tJVM,\nbut\tthe\tserver\ttoo.")]),t._v(" "),a("h2",{attrs:{id:"localcallsarenotlikeremotecalls"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#localcallsarenotlikeremotecalls"}},[t._v("#")]),t._v(" Local\tCalls\tAre\tNot\tLike\tRemote\tCalls")]),t._v(" "),a("p",[t._v("The\tcore\tidea\tof\tRPC\tis\tto\thide\tthe\tcomplexity\tof\ta\tremote\tcall.\tMany\timplementations\tof\nRPC,\tthough,\thide\ttoo\tmuch.\tThe\tdrive\tin\tsome\tforms\tof\tRPC\tto\tmake\tremote\tmethod\ncalls\tlook\tlike\tlocal\tmethod\tcalls\thides\tthe\tfact\tthat\tthese\ttwo\tthings\tare\tvery\tdifferent.\tI\ncan\tmake\tlarge\tnumbers\tof\tlocal,\tin-process\tcalls\twithout\tworrying\toverly\tabout\tthe\nperformance.\tWith\tRPC,\tthough,\tthe\tcost\tof\tmarshalling\tand\tun-marshalling\tpayloads\tcan\nbe\tsignificant,\tnot\tto\tmention\tthe\ttime\ttaken\tto\tsend\tthings\tover\tthe\tnetwork.\tThis\tmeans\nyou\tneed\tto\tthink\tdifferently\tabout\tAPI\tdesign\tfor\tremote\tinterfaces\tversus\tlocal\ninterfaces.\tJust\ttaking\ta\tlocal\tAPI\tand\ttrying\tto\tmake\tit\ta\tservice\tboundary\twithout\tany\nmore\tthought\tis\tlikely\tto\tget\tyou\tin\ttrouble.\tIn\tsome\tof\tthe\tworst\texamples,\tdevelopers\nmay\tbe\tusing\tremote\tcalls\twithout\tknowing\tit\tif\tthe\tabstraction\tis\toverly\topaque.")]),t._v(" "),a("p",[t._v("You\tneed\tto\tthink\tabout\tthe\tnetwork\titself.\tFamously,\tthe\tfirst\tof\tthe\tfallacies\tof\ndistributed\tcomputing\tis\t“The\tnetwork\tis\treliable”.\tNetworks\taren’t\treliable.\tThey\tcan\tand\nwill\tfail,\teven\tif\tyour\tclient\tand\tthe\tserver\tyou\tare\tspeaking\tto\tare\tfine.\tThey\tcan\tfail\tfast,\nthey\tcan\tfail\tslow,\tand\tthey\tcan\teven\tmalform\tyour\tpackets.\tYou\tshould\tassume\tthat\tyour\nnetworks\tare\tplagued\twith\tmalevolent\tentities\tready\tto\tunleash\ttheir\tire\ton\ta\twhim.\nTherefore,\tthe\tfailure\tmodes\tyou\tcan\texpect\tare\tdifferent.\tA\tfailure\tcould\tbe\tcaused\tby\tthe\nremote\tserver\treturning\tan\terror,\tor\tby\tyou\tmaking\ta\tbad\tcall.\tCan\tyou\ttell\tthe\tdifference,\nand\tif\tso,\tcan\tyou\tdo\tanything\tabout\tit?\tAnd\twhat\tdo\tyou\tdo\twhen\tthe\tremote\tserver\tjust\nstarts\tresponding\tslowly?\tWe’ll\tcover\tthis\ttopic\twhen\twe\ttalk\tabout\tresiliency\tin\nChapter\t11.")]),t._v(" "),a("h2",{attrs:{id:"brittleness"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#brittleness"}},[t._v("#")]),t._v(" Brittleness")]),t._v(" "),a("p",[t._v("Some\tof\tthe\tmost\tpopular\timplementations\tof\tRPC\tcan\tlead\tto\tsome\tnasty\tforms\tof\nbrittleness,\tJava’s\tRMI\tbeing\ta\tvery\tgood\texample.\tLet’s\tconsider\ta\tvery\tsimple\tJava\ninterface\tthat\twe\thave\tdecided\tto\tmake\ta\tremote\tAPI\tfor\tour\tcustomer\tservice.\tExample\t4-\n1 \tdeclares\tthe\tmethods\twe\tare\tgoing\tto\texpose\tremotely.\tJava\tRMI\tthen\tgenerates\tthe\nclient\tand\tserver\tstubs\tfor\tour\tmethod.")]),t._v(" "),a("p",[a("em",[t._v("Example\t4-1.\tDefining\ta\tservice\tendpoint\tusing\tJava\tRMI")]),t._v(" "),a("strong",[t._v("import java.rmi.Remote")]),t._v(" ;\n"),a("strong",[t._v("import java.rmi.RemoteException")]),t._v(" ;")]),t._v(" "),a("p",[a("strong",[t._v("public interface CustomerRemote extends")]),t._v(" Remote {\n"),a("strong",[t._v("public")]),t._v(" Customer findCustomer(String id) "),a("strong",[t._v("throws")]),t._v(" RemoteException;")]),t._v(" "),a("p",[a("strong",[t._v("public")]),t._v(" Customer createCustomer(String firstname, String surname, String emailAddress)\n"),a("strong",[t._v("throws")]),t._v(" RemoteException;\n}")]),t._v(" "),a("p",[t._v("In\tthis\tinterface,\tfindCustomer\ttakes\tthe\tfirst\tname,\tsurname,\tand\temail\taddress.\tWhat\nhappens\tif\twe\tdecide\tto\tallow\tthe\tCustomer\tobject\tto\talso\tbe\tcreated\twith\tjust\tan\temail")]),t._v(" "),a("p",[t._v("address?\tWe\tcould\tadd\ta\tnew\tmethod\tat\tthis\tpoint\tpretty\teasily,\tlike\tso:")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("...\npublic Customer createCustomer(String emailAddress) throws RemoteException;\n...\n")])])]),a("p",[t._v("The\tproblem\tis\tthat\tnow\twe\tneed\tto\tregenerate\tthe\tclient\tstubs\ttoo.\tClients\tthat\twant\tto\nconsume\tthe\tnew\tmethod\tneed\tthe\tnew\tstubs,\tand\tdepending\ton\tthe\tnature\tof\tthe\tchanges\nto\tthe\tspecification,\tconsumers\tthat\tdon’t\tneed\tthe\tnew\tmethod\tmay\talso\tneed\tto\thave\ntheir\tstubs\tupgraded\ttoo.\tThis\tis\tmanageable,\tof\tcourse,\tbut\tto\ta\tpoint.\tThe\treality\tis\tthat\nchanges\tlike\tthis\tare\tfairly\tcommon.\tRPC\tendpoints\toften\tend\tup\thaving\ta\tlarge\tnumber\tof\nmethods\tfor\tdifferent\tways\tof\tcreating\tor\tinteracting\twith\tobjects.\tThis\tis\tdue\tin\tpart\tto\tthe\nfact\tthat\twe\tare\tstill\tthinking\tof\tthese\tremote\tcalls\tas\tlocal\tones.")]),t._v(" "),a("p",[t._v("There\tis\tanother\tsort\tof\tbrittleness,\tthough.\tLet’s\ttake\ta\tlook\tat\twhat\tour\tCustomer\tobject")]),t._v(" "),a("p",[t._v("looks\tlike:")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("public class Customer implements Serializable {\nprivate String firstName;\nprivate String surname;\nprivate String emailAddress;\nprivate String age;\n}\n")])])]),a("p",[t._v("Now,\twhat\tif\tit\tturns\tout\tthat\talthough\twe\texpose\tthe\tage\tfield\tin\tour\tCustomer\tobjects,\nnone\tof\tour\tconsumers\tever\tuse\tit?\tWe\tdecide\twe\twant\tto\tremove\tthis\tfield.\tBut\tif\tthe\nserver\timplementation\tremoves\tage\tfrom\tits\tdefinition\tof\tthis\ttype,\tand\twe\tdon’t\tdo\tthe")]),t._v(" "),a("p",[t._v("same\tto\tall\tthe\tconsumers,\tthen\teven\tthough\tthey\tnever\tused\tthe\tfield,\tthe\tcode\tassociated\nwith\tdeserializing\tthe\tCustomer\tobject\ton\tthe\tconsumer\tside\twill\tbreak.\tTo\troll\tout\tthis\nchange,\tI\twould\thave\tto\tdeploy\tboth\ta\tnew\tserver\tand\tclients\tat\tthe\tsame\ttime.\tThis\tis\ta")]),t._v(" "),a("p",[t._v("key\tchallenge\twith\tany\tRPC\tmechanism\tthat\tpromotes\tthe\tuse\tof\tbinary\tstub\tgeneration:\nyou\tdon’t\tget\tto\tseparate\tclient\tand\tserver\tdeployments.\tIf\tyou\tuse\tthis\ttechnology,\tlock-\nstep\treleases\tmay\tbe\tin\tyour\tfuture.")]),t._v(" "),a("p",[t._v("Similar\tproblems\toccur\tif\tI\twant\tto\trestructure\tthe\tCustomer\tobject\teven\tif\tI\tdidn’t\tremove")]),t._v(" "),a("p",[t._v("fields\t—\tfor\texample,\tif\tI\twanted\tto\tencapsulate\tfirstName\tand\tsurname\tinto\ta\tnew\nnaming\ttype\tto\tmake\tit\teasier\tto\tmanage.\tI\tcould,\tof\tcourse,\tfix\tthis\tby\tpassing\taround")]),t._v(" "),a("p",[t._v("dictionary\ttypes\tas\tthe\tparameters\tof\tmy\tcalls,\tbut\tat\tthat\tpoint,\tI\tlose\tmany\tof\tthe\tbenefits\nof\tthe\tgenerated\tstubs\tbecause\tI’ll\tstill\thave\tto\tmanually\tmatch\tand\textract\tthe\tfields\tI\nwant.")]),t._v(" "),a("p",[t._v("In\tpractice,\tobjects\tused\tas\tpart\tof\tbinary\tserialization\tacross\tthe\twire\tcan\tbe\tthought\tof\tas\n"),a("em",[t._v("expand-only")]),t._v(" \ttypes.\tThis\tbrittleness\tresults\tin\tthe\ttypes\tbeing\texposed\tover\tthe\twire\tand\nbecoming\ta\tmass\tof\tfields,\tsome\tof\twhich\tare\tno\tlonger\tused\tbut\tcan’t\tbe\tsafely\tremoved.")]),t._v(" "),a("h2",{attrs:{id:"isrpcterrible"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#isrpcterrible"}},[t._v("#")]),t._v(" Is\tRPC\tTerrible?")]),t._v(" "),a("p",[t._v("Despite\tits\tshortcomings,\tI\twouldn’t\tgo\tso\tfar\tas\tto\tcall\tRPC\tterrible.\tSome\tof\tthe\ncommon\timplementations\tthat\tI\thave\tencountered\tcan\tlead\tto\tthe\tsorts\tof\tproblems\tI\thave\noutlined\there.\tDue\tto\tthe\tchallenges\tof\tusing\tRMI,\tI\twould\tcertainly\tgive\tthat\ttechnology\na\twide\tberth.\tMany\toperations\tfall\tquite\tnicely\tinto\tthe\tRPC-based\tmodel,\tand\tmore\nmodern\tmechanisms\tlike\tprotocol\tbuffers\tor\tThrift\tmitigate\tsome\tof\tsins\tof\tthe\tpast\tby\navoiding\tthe\tneed\tfor\tlock-step\treleases\tof\tclient\tand\tserver\tcode.")]),t._v(" "),a("p",[t._v("Just\tbe\taware\tof\tsome\tof\tthe\tpotential\tpitfalls\tassociated\twith\tRPC\tif\tyou’re\tgoing\tto\tpick\nthis\tmodel.\tDon’t\tabstract\tyour\tremote\tcalls\tto\tthe\tpoint\twhere\tthe\tnetwork\tis\tcompletely\nhidden,\tand\tensure\tthat\tyou\tcan\tevolve\tthe\tserver\tinterface\twithout\thaving\tto\tinsist\ton\nlock-step\tupgrades\tfor\tclients.\tFinding\tthe\tright\tbalance\tfor\tyour\tclient\tcode\tis\timportant,\nfor\texample.\tMake\tsure\tyour\tclients\taren’t\toblivious\tto\tthe\tfact\tthat\ta\tnetwork\tcall\tis\tgoing\nto\tbe\tmade.\tClient\tlibraries\tare\toften\tused\tin\tthe\tcontext\tof\tRPC,\tand\tif\tnot\tstructured\tright\nthey\tcan\tbe\tproblematic.\tWe’ll\ttalk\tmore\tabout\tthem\tshortly.")]),t._v(" "),a("p",[t._v("Compared\tto\tdatabase\tintegration,\tRPC\tis\tcertainly\tan\timprovement\twhen\twe\tthink\tabout\noptions\tfor\trequest/response\tcollaboration.\tBut\tthere’s\tanother\toption\tto\tconsider.")]),t._v(" "),a("h2",{attrs:{id:"rest"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#rest"}},[t._v("#")]),t._v(" REST")]),t._v(" "),a("p",[t._v("REpresentational\tState\tTransfer\t(REST)\tis\tan\tarchitectural\tstyle\tinspired\tby\tthe\tWeb.\nThere\tare\tmany\tprinciples\tand\tconstraints\tbehind\tthe\tREST\tstyle,\tbut\twe\tare\tgoing\tto\nfocus\ton\tthose\tthat\treally\thelp\tus\twhen\twe\tface\tintegration\tchallenges\tin\ta\tmicroservices\nworld,\tand\twhen\twe’re\tlooking\tfor\tan\talternative\tstyle\tto\tRPC\tfor\tour\tservice\tinterfaces.")]),t._v(" "),a("p",[t._v("Most\timportant\tis\tthe\tconcept\tof\tresources.\tYou\tcan\tthink\tof\ta\tresource\tas\ta\tthing\tthat\tthe\nservice\titself\tknows\tabout,\tlike\ta\tCustomer.\tThe\tserver\tcreates\tdifferent\trepresentations\tof")]),t._v(" "),a("p",[t._v("this\tCustomer\ton\trequest.\tHow\ta\tresource\tis\tshown\texternally\tis\tcompletely\tdecoupled\nfrom\thow\tit\tis\tstored\tinternally.\tA\tclient\tmight\task\tfor\ta\tJSON\trepresentation\tof\ta\nCustomer,\tfor\texample,\teven\tif\tit\tis\tstored\tin\ta\tcompletely\tdifferent\tformat.\tOnce\ta\tclient\nhas\ta\trepresentation\tof\tthis\tCustomer,\tit\tcan\tthen\tmake\trequests\tto\tchange\tit,\tand\tthe")]),t._v(" "),a("p",[t._v("server\tmay\tor\tmay\tnot\tcomply\twith\tthem.")]),t._v(" "),a("p",[t._v("There\tare\tmany\tdifferent\tstyles\tof\tREST,\tand\tI\ttouch\tonly\tbriefly\ton\tthem\there.\tI\tstrongly\nrecommend\tyou\ttake\ta\tlook\tat\tthe\tRichardson\tMaturity\tModel,\twhere\tthe\tdifferent\tstyles\nof\tREST\tare\tcompared.")]),t._v(" "),a("p",[t._v("REST\titself\tdoesn’t\treally\ttalk\tabout\tunderlying\tprotocols,\talthough\tit\tis\tmost\tcommonly\nused\tover\tHTTP.\tI\thave\tseen\timplementations\tof\tREST\tusing\tvery\tdifferent\tprotocols\nbefore,\tsuch\tas\tserial\tor\tUSB,\talthough\tthis\tcan\trequire\ta\tlot\tof\twork.\tSome\tof\tthe\tfeatures\nthat\tHTTP\tgives\tus\tas\tpart\tof\tthe\tspecification,\tsuch\tas\tverbs,\tmake\timplementing\tREST\nover\tHTTP\teasier,\twhereas\twith\tother\tprotocols\tyou’ll\thave\tto\thandle\tthese\tfeatures\nyourself.")]),t._v(" "),a("h2",{attrs:{id:"restandhttp"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#restandhttp"}},[t._v("#")]),t._v(" REST\tand\tHTTP")]),t._v(" "),a("p",[t._v("HTTP\titself\tdefines\tsome\tuseful\tcapabilities\tthat\tplay\tvery\twell\twith\tthe\tREST\tstyle.\tFor\nexample,\tthe\tHTTP\tverbs\t(e.g.,\tGET,\tPOST,\tand\tPUT)\talready\thave\twell-understood\nmeanings\tin\tthe\tHTTP\tspecification\tas\tto\thow\tthey\tshould\twork\twith\tresources.\tThe\nREST\tarchitectural\tstyle\tactually\ttells\tus\tthat\tmethods\tshould\tbehave\tthe\tsame\tway\ton\tall\nresources,\tand\tthe\tHTTP\tspecification\thappens\tto\tdefine\ta\tbunch\tof\tmethods\twe\tcan\tuse.\nGET\tretrieves\ta\tresource\tin\tan\tidempotent\tway,\tand\tPOST\tcreates\ta\tnew\tresource.\tThis\nmeans\twe\tcan\tavoid\tlots\tof\tdifferent\tcreateCustomer\tor\teditCustomer\tmethods.\tInstead,\nwe\tcan\tsimply\tPOST\ta\tcustomer\trepresentation\tto\trequest\tthat\tthe\tserver\tcreate\ta\tnew\nresource,\tand\tinitiate\ta\tGET\trequest\tto\tretrieve\ta\trepresentation\tof\ta\tresource.\nConceptually,\tthere\tis\tone\t "),a("em",[t._v("endpoint")]),t._v(" \tin\tthe\tform\tof\ta\tCustomer\tresource\tin\tthese\tcases,\tand")]),t._v(" "),a("p",[t._v("the\toperations\twe\tcan\tcarry\tout\tupon\tit\tare\tbaked\tinto\tthe\tHTTP\tprotocol.")]),t._v(" "),a("p",[t._v("HTTP\talso\tbrings\ta\tlarge\tecosystem\tof\tsupporting\ttools\tand\ttechnology.\tWe\tget\tto\tuse\nHTTP\tcaching\tproxies\tlike\tVarnish\tand\tload\tbalancers\tlike\tmod_proxy,\tand\tmany\nmonitoring\ttools\talready\thave\tlots\tof\tsupport\tfor\tHTTP\tout\tof\tthe\tbox.\tThese\tbuilding\nblocks\tallow\tus\tto\thandle\tlarge\tvolumes\tof\tHTTP\ttraffic\tand\troute\tthem\tsmartly,\tin\ta\tfairly\ntransparent\tway.\tWe\talso\tget\tto\tuse\tall\tthe\tavailable\tsecurity\tcontrols\twith\tHTTP\tto\tsecure\nour\tcommunications.\tFrom\tbasic\tauth\tto\tclient\tcerts,\tthe\tHTTP\tecosystem\tgives\tus\tlots\tof\ntools\tto\tmake\tthe\tsecurity\tprocess\teasier,\tand\twe’ll\texplore\tthat\ttopic\tmore\tin\tChapter\t9.\nThat\tsaid,\tto\tget\tthese\tbenefits,\tyou\thave\tto\tuse\tHTTP\twell.\tUse\tit\tbadly,\tand\tit\tcan\tbe\tas\ninsecure\tand\thard\tto\tscale\tas\tany\tother\ttechnology\tout\tthere.\tUse\tit\tright,\tthough,\tand\tyou\nget\ta\tlot\tof\thelp.")]),t._v(" "),a("p",[t._v("Note\tthat\tHTTP\tcan\tbe\tused\tto\timplement\tRPC\ttoo.\tSOAP,\tfor\texample,\tgets\trouted\tover\nHTTP,\tbut\tunfortunately\tuses\tvery\tlittle\tof\tthe\tspecification.\tVerbs\tare\tignored,\tas\tare\nsimple\tthings\tlike\tHTTP\terror\tcodes.\tAll\ttoo\toften,\tit\tseems,\tthe\texisting,\twell-understood\nstandards\tand\ttechnology\tare\tignored\tin\tfavor\tof\tnew\tstandards\tthat\tcan\tonly\tbe\nimplemented\tusing\tbrand-new\ttechnology\t—\tconveniently\tprovided\tby\tthe\tsame\ncompanies\tthat\thelp\tdesign\tthe\tnew\tstandards\tin\tthe\tfirst\tplace!")]),t._v(" "),a("h2",{attrs:{id:"hypermediaastheengineofapplicationstate"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#hypermediaastheengineofapplicationstate"}},[t._v("#")]),t._v(" Hypermedia\tAs\tthe\tEngine\tof\tApplication\tState")]),t._v(" "),a("p",[t._v("Another\tprinciple\tintroduced\tin\tREST\tthat\tcan\thelp\tus\tavoid\tthe\tcoupling\tbetween\tclient\nand\tserver\tis\tthe\tconcept\tof\t "),a("em",[t._v("hypermedia\tas\tthe\tengine\tof\tapplication\tstate")]),t._v(" \t(often\nabbreviated\tas\tHATEOAS,\tand\tboy,\tdid\tit\tneed\tan\tabbreviation).\tThis\tis\tfairly\tdense\nwording\tand\ta\tfairly\tinteresting\tconcept,\tso\tlet’s\tbreak\tit\tdown\ta\tbit.")]),t._v(" "),a("p",[t._v("Hypermedia\tis\ta\tconcept\twhereby\ta\tpiece\tof\tcontent\tcontains\tlinks\tto\tvarious\tother\tpieces\nof\tcontent\tin\ta\tvariety\tof\tformats\t(e.g.,\ttext,\timages,\tsounds).\tThis\tshould\tbe\tpretty\nfamiliar\tto\tyou,\tas\tit’s\twhat\tthe\taverage\tweb\tpage\tdoes:\tyou\tfollow\tlinks,\twhich\tare\ta\tform\nof\thypermedia\tcontrols,\tto\tsee\trelated\tcontent.\tThe\tidea\tbehind\tHATEOAS\tis\tthat\tclients\nshould\tperform\tinteractions\t(potentially\tleading\tto\tstate\ttransitions)\twith\tthe\tserver\tvia\nthese\tlinks\tto\tother\tresources.\tIt\tdoesn’t\tneed\tto\tknow\twhere\texactly\tcustomers\tlive\ton\tthe\nserver\tby\tknowing\twhich\tURI\tto\thit;\tinstead,\tthe\tclient\tlooks\tfor\tand\tnavigates\tlinks\tto\nfind\twhat\tit\tneeds.")]),t._v(" "),a("p",[t._v("This\tis\ta\tbit\tof\tan\todd\tconcept,\tso\tlet’s\tfirst\tstep\tback\tand\tconsider\thow\tpeople\tinteract\nwith\ta\tweb\tpage,\twhich\twe’ve\talready\testablished\tis\trich\twith\thypermedia\tcontrols.")]),t._v(" "),a("p",[t._v("Think\tof\tthe\tAmazon.com\tshopping\tsite.\tThe\tlocation\tof\tthe\tshopping\tcart\thas\tchanged\nover\ttime.\tThe\tgraphic\thas\tchanged.\tThe\tlink\thas\tchanged.\tBut\tas\thumans\twe\tare\tsmart\nenough\tto\tstill\tsee\ta\tshopping\tcart,\tknow\twhat\tit\tis,\tand\tinteract\twith\tit.\tWe\thave\tan\nunderstanding\tof\twhat\ta\tshopping\tcart\tmeans,\teven\tif\tthe\texact\tform\tand\tunderlying\ncontrol\tused\tto\trepresent\tit\thas\tchanged.\tWe\tknow\tthat\tif\twe\twant\tto\tview\tthe\tcart,\tthis\tis\nthe\tcontrol\twe\twant\tto\tinteract\twith.\tThis\tis\twhy\tweb\tpages\tcan\tchange\tincrementally\tover\ntime.\tAs\tlong\tas\tthese\timplicit\tcontracts\tbetween\tthe\tcustomer\tand\tthe\twebsite\tare\tstill\nmet,\tchanges\tdon’t\tneed\tto\tbe\tbreaking\tchanges.")]),t._v(" "),a("p",[t._v("With\thypermedia\tcontrols,\twe\tare\ttrying\tto\tachieve\tthe\tsame\tlevel\tof\t "),a("em",[t._v("smarts")]),t._v(" \tfor\tour\nelectronic\tconsumers.\tLet’s\tlook\tat\ta\thypermedia\tcontrol\tthat\twe\tmight\thave\tfor\nMusicCorp.\tWe’ve\taccessed\ta\tresource\trepresenting\ta\tcatalog\tentry\tfor\ta\tgiven\talbum\tin\nExample\t4-2.\tAlong\twith\tinformation\tabout\tthe\talbum,\twe\tsee\ta\tnumber\tof\thypermedia\ncontrols.")]),t._v(" "),a("p",[a("em",[t._v("Example\t4-2.\tHypermedia\tcontrols\tused\ton\tan\talbum\tlisting")]),t._v(" "),a("strong",[a("album",[a("name")],1)],1),t._v(" Give\tBlood "),a("strong",[t._v("\n<link")]),t._v(' rel="/artist" href="/artist/theBrakes" '),a("strong",[t._v("/>\n"),a("description")],1),t._v("\nAwesome,\tshort,\tbrutish,\tfunny\tand\tloud.\tMust\tbuy!\n"),a("strong",[t._v("\n<link")]),t._v(' rel="/instantpurchase" href="/instantPurchase/1234" '),a("strong",[t._v("/>\n")])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("This\thypermedia\tcontrol\tshows\tus\twhere\tto\tfind\tinformation\tabout\tthe\tartist.\n")])])]),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("And\tif\twe\twant\tto\tpurchase\tthe\talbum,\twe\tnow\tknow\twhere\tto\tgo.\n")])])]),a("p",[t._v("In\tthis\tdocument,\twe\thave\ttwo\thypermedia\tcontrols.\tThe\tclient\treading\tsuch\ta\tdocument\nneeds\tto\tknow\tthat\ta\tcontrol\twith\ta\trelation\tof\tartist\tis\twhere\tit\tneeds\tto\tnavigate\tto\tget")]),t._v(" "),a("p",[t._v("information\tabout\tthe\tartist,\tand\tthat\tinstantpurchase\tis\tpart\tof\tthe\tprotocol\tused\tto\npurchase\tthe\talbum.\tThe\tclient\thas\tto\tunderstand\tthe\tsemantics\tof\tthe\tAPI\tin\tmuch\tthe\nsame\tway\tas\ta\thuman\tbeing\tneeds\tto\tunderstand\tthat\ton\ta\tshopping\twebsite\tthe\tcart\tis\nwhere\tthe\titems\tto\tbe\tpurchased\twill\tbe.")]),t._v(" "),a("p",[t._v("As\ta\tclient,\tI\tdon’t\tneed\tto\tknow\twhich\tURI\tscheme\tto\taccess\tto\t "),a("em",[t._v("buy")]),t._v(" \tthe\talbum,\tI\tjust\nneed\tto\taccess\tthe\tresource,\tfind\tthe\tbuy\tcontrol,\tand\tnavigate\tto\tthat.\tThe\tbuy\tcontrol\ncould\tchange\tlocation,\tthe\tURI\tcould\tchange,\tor\tthe\tsite\tcould\teven\tsend\tme\tto\tanother\nservice\taltogether,\tand\tas\ta\tclient\tI\twouldn’t\tcare.\tThis\tgives\tus\ta\thuge\tamount\tof\ndecoupling\tbetween\tthe\tclient\tand\tserver.")]),t._v(" "),a("p",[t._v("We\tare\tgreatly\tabstracted\tfrom\tthe\tunderlying\tdetail\there.\tWe\tcould\tcompletely\tchange\tthe\nimplementation\tof\thow\tthe\tcontrol\tis\tpresented\tas\tlong\tas\tthe\tclient\tcan\tstill\tfind\ta\tcontrol\nthat\tmatches\tits\tunderstanding\tof\tthe\tprotocol,\tin\tthe\tsame\tway\tthat\ta\tshopping\tcart\ncontrol\tmight\tgo\tfrom\tbeing\ta\tsimple\tlink\tto\ta\tmore\tcomplex\tJavaScript\tcontrol.\tWe\tare\nalso\tfree\tto\tadd\tnew\tcontrols\tto\tthe\tdocument,\tperhaps\trepresenting\tnew\tstate\ttransitions\nthat\twe\tcan\tperform\ton\tthe\tresource\tin\tquestion.\tWe\twould\tend\tup\tbreaking\tour\nconsumers\tonly\tif\twe\tfundamentally\tchanged\tthe\tsemantics\tof\tone\tof\tthe\tcontrols\tso\tit\nbehaved\tvery\tdifferently,\tor\tif\twe\tremoved\ta\tcontrol\taltogether.")]),t._v(" "),a("p",[t._v("Using\tthese\tcontrols\tto\tdecouple\tthe\tclient\tand\tserver\tyields\tsignificant\tbenefits\tover\ttime\nthat\tgreatly\toffset\tthe\tsmall\tincrease\tin\tthe\ttime\tit\ttakes\tto\tget\tthese\tprotocols\tup\tand\nrunning.\tBy\tfollowing\tthe\tlinks,\tthe\tclient\tgets\tto\tprogressively\tdiscover\tthe\tAPI,\twhich\ncan\tbe\ta\treally\thandy\tcapability\twhen\twe\tare\timplementing\tnew\tclients.")]),t._v(" "),a("p",[t._v("One\tof\tthe\tdownsides\tis\tthat\tthis\tnavigation\tof\tcontrols\tcan\tbe\tquite\tchatty,\tas\tthe\tclient\nneeds\tto\tfollow\tlinks\tto\tfind\tthe\toperation\tit\twants\tto\tperform.\tUltimately,\tthis\tis\ta\ttrade-\noff.\tI\twould\tsuggest\tyou\tstart\twith\thaving\tyour\tclients\tnavigate\tthese\tcontrols\tfirst,\tthen\noptimize\tlater\tif\tnecessary.\tRemember\tthat\twe\thave\ta\tlarge\tamount\tof\thelp\tout\tof\tthe\tbox\nby\tusing\tHTTP,\twhich\twe\tdiscussed\tearlier.\tThe\tevils\tof\tpremature\toptimization\thave\nbeen\twell\tdocumented\tbefore,\tso\tI\tdon’t\tneed\tto\texpand\tupon\tthem\there.\tAlso\tnote\tthat\ta\nlot\tof\tthese\tapproaches\twere\tdeveloped\tto\tcreate\tdistributed\thypertext\tsystems,\tand\tnot\tall\nof\tthem\tfit!\tSometimes\tyou’ll\tfind\tyourself\tjust\twanting\tgood\told-fashioned\tRPC.")]),t._v(" "),a("p",[t._v("Personally,\tI\tam\ta\tfan\tof\tusing\tlinks\tto\tallow\tconsumers\tto\tnavigate\tAPI\tendpoints.\tThe\nbenefits\tof\tprogressive\tdiscovery\tof\tthe\tAPI\tand\treduced\tcoupling\tcan\tbe\tsignificant.\nHowever,\tit\tis\tclear\tthat\tnot\teveryone\tis\tsold,\tas\tI\tdon’t\tsee\tit\tbeing\tused\tanywhere\tnear\tas\nmuch\tas\tI\twould\tlike.\tI\tthink\ta\tlarge\tpart\tof\tthis\tis\tthat\tthere\tis\tsome\tinitial\tupfront\twork\nrequired,\tbut\tthe\trewards\toften\tcome\tlater.")]),t._v(" "),a("h2",{attrs:{id:"json-xml-orsomethingelse"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#json-xml-orsomethingelse"}},[t._v("#")]),t._v(" JSON,\tXML,\tor\tSomething\tElse?")]),t._v(" "),a("p",[t._v("The\tuse\tof\tstandard\ttextual\tformats\tgives\tclients\ta\tlot\tof\tflexibility\tas\tto\thow\tthey\nconsume\tresources,\tand\tREST\tover\tHTTP\tlets\tus\tuse\ta\tvariety\tof\tformats.\tThe\texamples\tI\nhave\tgiven\tso\tfar\tused\tXML,\tbut\tat\tthis\tstage,\tJSON\tis\ta\tmuch\tmore\tpopular\tcontent\ttype\nfor\tservices\tthat\twork\tover\tHTTP.")]),t._v(" "),a("p",[t._v("The\tfact\tthat\tJSON\tis\ta\tmuch\tsimpler\tformat\tmeans\tthat\tconsumption\tis\talso\teasier.\tSome\nproponents\talso\tcite\tits\trelative\tcompactness\twhen\tcompared\tto\tXML\tas\tanother\twinning\nfactor,\talthough\tthis\tisn’t\toften\ta\treal-world\tissue.")]),t._v(" "),a("p",[t._v("JSON\tdoes\thave\tsome\tdownsides,\tthough.\tXML\tdefines\tthe\tlink\tcontrol\twe\tused\tearlier")]),t._v(" "),a("p",[t._v("as\ta\thypermedia\tcontrol.\tThe\tJSON\tstandard\tdoesn’t\tdefine\tanything\tsimilar,\tso\tin-house\nstyles\tare\tfrequently\tused\tto\tshoe-horn\tthis\tconcept\tin.\tThe\tHypertext\tApplication\nLanguage\t(HAL)\tattempts\tto\tfix\tthis\tby\tdefining\tsome\tcommon\tstandards\tfor\nhyperlinking\tfor\tJSON\t(and\tXML\ttoo,\talthough\targuably\tXML\tneeds\tless\thelp).\tIf\tyou\nfollow\tthe\tHAL\tstandard,\tyou\tcan\tuse\ttools\tlike\tthe\tweb-based\tHAL\tbrowser\tfor\nexploring\thypermedia\tcontrols,\twhich\tcan\tmake\tthe\ttask\tof\tcreating\ta\tclient\tmuch\teasier.")]),t._v(" "),a("p",[t._v("We\taren’t\tlimited\tto\tthese\ttwo\tformats,\tof\tcourse.\tWe\tcan\tsend\tpretty\tmuch\tanything\tover\nHTTP\tif\twe\twant,\teven\tbinary.\tI\tam\tseeing\tmore\tand\tmore\tpeople\tjust\tusing\tHTML\tas\ta\nformat\tinstead\tof\tXML.\tFor\tsome\tinterfaces,\tthe\tHTML\tcan\tdo\tdouble\tduty\tas\ta\tUI\tand\tan\nAPI,\talthough\tthere\tare\tpitfalls\tto\tbe\tavoided\there,\tas\tthe\tinteractions\tof\ta\thuman\tand\ta\ncomputer\tare\tquite\tdifferent!\tBut\tit\tis\tcertainly\tan\tattractive\tidea.\tThere\tare\tlots\tof\tHTML\nparsers\tout\tthere,\tafter\tall.")]),t._v(" "),a("p",[t._v("Personally,\tthough,\tI\tam\tstill\ta\tfan\tof\tXML.\tSome\tof\tthe\ttool\tsupport\tis\tbetter.\tFor\nexample,\tif\tI\twant\tto\textract\tonly\tcertain\tparts\tof\tthe\tpayload\t(a\ttechnique\twe’ll\tdiscuss\nmore\tin\t“Versioning”)\tI\tcan\tuse\tXPATH,\twhich\tis\ta\twell-understood\tstandard\twith\tlots\tof\ntool\tsupport,\tor\teven\tCSS\tselectors,\twhich\tmany\tfind\teven\teasier.\tWith\tJSON,\tI\thave\nJSONPATH,\tbut\tthis\tis\tnot\twidely\tsupported.\tI\tfind\tit\todd\tthat\tpeople\tpick\tJSON\tbecause\nit\tis\tnice\tand\tlightweight,\tthen\ttry\tand\tpush\tconcepts\tinto\tit\tlike\thypermedia\tcontrols\tthat\nalready\texist\tin\tXML.\tI\taccept,\tthough,\tthat\tI\tam\tprobably\tin\tthe\tminority\there\tand\tthat\nJSON\tis\tthe\tformat\tof\tchoice\tfor\tmost\tpeople!")]),t._v(" "),a("h2",{attrs:{id:"bewaretoomuchconvenience"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#bewaretoomuchconvenience"}},[t._v("#")]),t._v(" Beware\tToo\tMuch\tConvenience")]),t._v(" "),a("p",[t._v("As\tREST\thas\tbecome\tmore\tpopular,\tso\ttoo\thave\tthe\tframeworks\tthat\thelp\tus\tcreate\nRESTFul\tweb\tservices.\tHowever,\tsome\tof\tthese\ttools\ttrade\toff\ttoo\tmuch\tin\tterms\tof\tshort-\nterm\tgain\tfor\tlong-term\tpain;\tin\ttrying\tto\tget\tyou\tgoing\tfast,\tthey\tcan\tencourage\tsome\tbad\nbehaviors.\tFor\texample,\tsome\tframeworks\tactually\tmake\tit\tvery\teasy\tto\tsimply\ttake\ndatabase\trepresentations\tof\tobjects,\tdeserialize\tthem\tinto\tin-process\tobjects,\tand\tthen\ndirectly\texpose\tthese\texternally.\tI\tremember\tat\ta\tconference\tseeing\tthis\tdemonstrated\nusing\tSpring\tBoot\tand\tcited\tas\ta\tmajor\tadvantage.\tThe\tinherent\tcoupling\tthat\tthis\tsetup\npromotes\twill\tin\tmost\tcases\tcause\tfar\tmore\tpain\tthan\tthe\teffort\trequired\tto\tproperly\ndecouple\tthese\tconcepts.")]),t._v(" "),a("p",[t._v("There\tis\ta\tmore\tgeneral\tproblem\tat\tplay\there.\tHow\twe\tdecide\tto\tstore\tour\tdata,\tand\thow\nwe\texpose\tit\tto\tour\tconsumers,\tcan\teasily\tdominate\tour\tthinking.\tOne\tpattern\tI\tsaw\tused\neffectively\tby\tone\tof\tour\tteams\twas\tto\tdelay\tthe\timplementation\tof\tproper\tpersistence\tfor\nthe\tmicroservice,\tuntil\tthe\tinterface\thad\tstabilized\tenough.\tFor\tan\tinterim\tperiod,\tentities\nwere\tjust\tpersisted\tin\ta\tfile\ton\tlocal\tdisk,\twhich\tis\tobviously\tnot\ta\tsuitable\tlong-term\nsolution.\tThis\tensured\tthat\thow\tthe\tconsumers\twanted\tto\tuse\tthe\tservice\tdrove\tthe\tdesign\nand\timplementation\tdecisions.\tThe\trationale\tgiven,\twhich\twas\tborne\tout\tin\tthe\tresults,\nwas\tthat\tit\tis\ttoo\teasy\tfor\tthe\tway\twe\tstore\tdomain\tentities\tin\ta\tbacking\tstore\tto\tovertly\ninfluence\tthe\tmodels\twe\tsend\tover\tthe\twire\tto\tcollaborators.\tOne\tof\tthe\tdownsides\twith\nthis\tapproach\tis\tthat\twe\tare\tdeferring\tthe\twork\trequired\tto\twire\tup\tour\tdata\tstore.\tI\tthink\nfor\tnew\tservice\tboundaries,\thowever,\tthis\tis\tan\tacceptable\ttrade-off.")]),t._v(" "),a("h2",{attrs:{id:"downsidestorestoverhttp"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#downsidestorestoverhttp"}},[t._v("#")]),t._v(" Downsides\tto\tREST\tOver\tHTTP")]),t._v(" "),a("p",[t._v("In\tterms\tof\tease\tof\tconsumption,\tyou\tcannot\teasily\tgenerate\ta\tclient\tstub\tfor\tyour\tREST\nover\tHTTP\tapplication\tprotocol\tlike\tyou\tcan\twith\tRPC.\tSure,\tthe\tfact\tthat\tHTTP\tis\tbeing\nused\tmeans\tthat\tyou\tget\tto\ttake\tadvantage\tof\tall\tthe\texcellent\tHTTP\tclient\tlibraries\tout\nthere,\tbut\tif\tyou\twant\tto\timplement\tand\tuse\thypermedia\tcontrols\tas\ta\tclient\tyou\tare\tpretty\nmuch\ton\tyour\town.\tPersonally,\tI\tthink\tclient\tlibraries\tcould\tdo\tmuch\tbetter\tat\tthis\tthan\nthey\tdo,\tand\tthey\tare\tcertainly\tbetter\tnow\tthan\tin\tthe\tpast,\tbut\tI\thave\tseen\tthis\tapparent\nincreased\tcomplexity\tresult\tin\tpeople\tbacksliding\tinto\tsmuggling\tRPC\tover\tHTTP\tor\nbuilding\tshared\tclient\tlibraries.\tShared\tcode\tbetween\tclient\tand\tserver\tcan\tbe\tvery\ndangerous,\tas\twe’ll\tdiscuss\tin\t“DRY\tand\tthe\tPerils\tof\tCode\tReuse\tin\ta\tMicroservice\nWorld”.")]),t._v(" "),a("p",[t._v("A\tmore\tminor\tpoint\tis\tthat\tsome\tweb\tserver\tframeworks\tdon’t\tactually\tsupport\tall\tthe\nHTTP\tverbs\twell.\tThat\tmeans\tthat\tit\tmight\tbe\teasy\tfor\tyou\tto\tcreate\ta\thandler\tfor\tGET\tor\nPOST\trequests,\tbut\tyou\tmay\thave\tto\tjump\tthrough\thoops\tto\tget\tPUT\tor\tDELETE\trequests\nto\twork.\tProper\tREST\tframeworks\tlike\tJersey\tdon’t\thave\tthis\tproblem,\tand\tyou\tcan\nnormally\twork\taround\tthis,\tbut\tif\tyou\tare\tlocked\tinto\tcertain\tframework\tchoices\tthis\tmight\nlimit\twhat\tstyle\tof\tREST\tyou\tcan\tuse.")]),t._v(" "),a("p",[t._v("Performance\tmay\talso\tbe\tan\tissue.\tREST\tover\tHTTP\tpayloads\tcan\tactually\tbe\tmore\ncompact\tthan\tSOAP\tbecause\tit\tsupports\talternative\tformats\tlike\tJSON\tor\teven\tbinary,\tbut\nit\twill\tstill\tbe\tnowhere\tnear\tas\tlean\ta\tbinary\tprotocol\tas\tThrift\tmight\tbe.\tThe\toverhead\tof\nHTTP\tfor\teach\trequest\tmay\talso\tbe\ta\tconcern\tfor\tlow-latency\trequirements.")]),t._v(" "),a("p",[t._v("HTTP,\twhile\tit\tcan\tbe\tsuited\twell\tto\tlarge\tvolumes\tof\ttraffic,\tisn’t\tgreat\tfor\tlow-latency\ncommunications\twhen\tcompared\tto\talternative\tprotocols\tthat\tare\tbuilt\ton\ttop\tof\nTransmission\tControl\tProtocol\t(TCP)\tor\tother\tnetworking\ttechnology.\tDespite\tthe\tname,\nWebSockets,\tfor\texample,\thas\tvery\tlittle\tto\tdo\twith\tthe\tWeb.\tAfter\tthe\tinitial\tHTTP\nhandshake,\tit’s\tjust\ta\tTCP\tconnection\tbetween\tclient\tand\tserver,\tbut\tit\tcan\tbe\ta\tmuch\tmore\nefficient\tway\tfor\tyou\tto\tstream\tdata\tfor\ta\tbrowser.\tIf\tthis\tis\tsomething\tyou’re\tinterested\tin,\nnote\tthat\tyou\taren’t\treally\tusing\tmuch\tof\tHTTP,\tlet\talone\tanything\tto\tdo\twith\tREST.")]),t._v(" "),a("p",[t._v("For\tserver-to-server\tcommunications,\tif\textremely\tlow\tlatency\tor\tsmall\tmessage\tsize\tis\nimportant,\tHTTP\tcommunications\tin\tgeneral\tmay\tnot\tbe\ta\tgood\tidea.\tYou\tmay\tneed\tto\npick\tdifferent\tunderlying\tprotocols,\tlike\tUser\tDatagram\tProtocol\t(UDP),\tto\tachieve\tthe\nperformance\tyou\twant,\tand\tmany\tRPC\tframeworks\twill\tquite\thappily\trun\ton\ttop\tof\nnetworking\tprotocols\tother\tthan\tTCP.")]),t._v(" "),a("p",[t._v("Consumption\tof\tthe\tpayloads\tthemselves\trequires\tmore\twork\tthan\tis\tprovided\tby\tsome\nRPC\timplementations\tthat\tsupport\tadvanced\tserialization\tand\tdeserialization\tmechanisms.\nThese\tcan\tbecome\ta\tcoupling\tpoint\tin\ttheir\town\tright\tbetween\tclient\tand\tserver,\tas\nimplementing\ttolerant\treaders\tis\ta\tnontrivial\tactivity\t(we’ll\tdiscuss\tthis\tshortly),\tbut\tfrom\nthe\tpoint\tof\tview\tof\tgetting\tup\tand\trunning,\tthey\tcan\tbe\tvery\tattractive.")]),t._v(" "),a("p",[t._v("Despite\tthese\tdisadvantages,\tREST\tover\tHTTP\tis\ta\tsensible\tdefault\tchoice\tfor\tservice-to-\nservice\tinteractions.\tIf\tyou\twant\tto\tknow\tmore,\tI\trecommend\t "),a("em",[t._v("REST\tin\tPractice")]),t._v(" \t(O’Reilly),\nwhich\tcovers\tthe\ttopic\tof\tREST\tover\tHTTP\tin\tdepth.")]),t._v(" "),a("h2",{attrs:{id:"implementingasynchronousevent-basedcollaboration"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#implementingasynchronousevent-basedcollaboration"}},[t._v("#")]),t._v(" Implementing\tAsynchronous\tEvent-Based\tCollaboration")]),t._v(" "),a("p",[t._v("We’ve\ttalked\tfor\ta\tbit\tabout\tsome\ttechnologies\tthat\tcan\thelp\tus\timplement\nrequest/response\tpatterns.\tWhat\tabout\tevent-based,\tasynchronous\tcommunication?")]),t._v(" "),a("h2",{attrs:{id:"technologychoices"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#technologychoices"}},[t._v("#")]),t._v(" Technology\tChoices")]),t._v(" "),a("p",[t._v("There\tare\ttwo\tmain\tparts\twe\tneed\tto\tconsider\there:\ta\tway\tfor\tour\tmicroservices\tto\temit\nevents,\tand\ta\tway\tfor\tour\tconsumers\tto\tfind\tout\tthose\tevents\thave\thappened.")]),t._v(" "),a("p",[t._v("Traditionally,\tmessage\tbrokers\tlike\tRabbitMQ\ttry\tto\thandle\tboth\tproblems.\tProducers\tuse\nan\tAPI\tto\tpublish\tan\tevent\tto\tthe\tbroker.\tThe\tbroker\thandles\tsubscriptions,\tallowing\nconsumers\tto\tbe\tinformed\twhen\tan\tevent\tarrives.\tThese\tbrokers\tcan\teven\thandle\tthe\tstate\nof\tconsumers,\tfor\texample\tby\thelping\tkeep\ttrack\tof\twhat\tmessages\tthey\thave\tseen\tbefore.\nThese\tsystems\tare\tnormally\tdesigned\tto\tbe\tscalable\tand\tresilient,\tbut\tthat\tdoesn’t\tcome\tfor\nfree.\tIt\tcan\tadd\tcomplexity\tto\tthe\tdevelopment\tprocess,\tbecause\tit\tis\tanother\tsystem\tyou\nmay\tneed\tto\trun\tto\tdevelop\tand\ttest\tyour\tservices.\tAdditional\tmachines\tand\texpertise\tmay\nalso\tbe\trequired\tto\tkeep\tthis\tinfrastructure\tup\tand\trunning.\tBut\tonce\tit\tdoes,\tit\tcan\tbe\tan\nincredibly\teffective\tway\tto\timplement\tloosely\tcoupled,\tevent-driven\tarchitectures.\tIn\ngeneral,\tI’m\ta\tfan.")]),t._v(" "),a("p",[t._v("Do\tbe\twary,\tthough,\tabout\tthe\tworld\tof\tmiddleware,\tof\twhich\tthe\tmessage\tbroker\tis\tjust\ta\nsmall\tpart.\tQueues\tin\tand\tof\tthemselves\tare\tperfectly\tsensible,\tuseful\tthings.\tHowever,\nvendors\ttend\tto\twant\tto\tpackage\tlots\tof\tsoftware\twith\tthem,\twhich\tcan\tlead\tto\tmore\tand\nmore\tsmarts\tbeing\tpushed\tinto\tthe\tmiddleware,\tas\tevidenced\tby\tthings\tlike\tthe\tEnterprise\nService\tBus.\tMake\tsure\tyou\tknow\twhat\tyou’re\tgetting:\tkeep\tyour\tmiddleware\tdumb,\tand\nkeep\tthe\tsmarts\tin\tthe\tendpoints.")]),t._v(" "),a("p",[t._v("Another\tapproach\tis\tto\ttry\tto\tuse\tHTTP\tas\ta\tway\tof\tpropagating\tevents.\tATOM\tis\ta\tREST-\ncompliant\tspecification\tthat\tdefines\tsemantics\t(among\tother\tthings)\tfor\tpublishing\tfeeds\nof\tresources.\tMany\tclient\tlibraries\texist\tthat\tallow\tus\tto\tcreate\tand\tconsume\tthese\tfeeds.\nSo\tour\tcustomer\tservice\tcould\tjust\tpublish\tan\tevent\tto\tsuch\ta\tfeed\twhen\tour\tcustomer\nservice\tchanges.\tOur\tconsumers\tjust\tpoll\tthe\tfeed,\tlooking\tfor\tchanges.\tOn\tone\thand,\tthe\nfact\tthat\twe\tcan\treuse\tthe\texisting\tATOM\tspecification\tand\tany\tassociated\tlibraries\tis\nuseful,\tand\twe\tknow\tthat\tHTTP\thandles\tscale\tvery\twell.\tHowever,\tHTTP\tis\tnot\tgood\tat\nlow\tlatency\t(where\tsome\tmessage\tbrokers\texcel),\tand\twe\tstill\tneed\tto\tdeal\twith\tthe\tfact\nthat\tthe\tconsumers\tneed\tto\tkeep\ttrack\tof\twhat\tmessages\tthey\thave\tseen\tand\tmanage\ttheir\nown\tpolling\tschedule.")]),t._v(" "),a("p",[t._v("I\thave\tseen\tpeople\tspend\tan\tage\timplementing\tmore\tand\tmore\tof\tthe\tbehaviors\tthat\tyou\nget\tout\tof\tthe\tbox\twith\tan\tappropriate\tmessage\tbroker\tto\tmake\tATOM\twork\tfor\tsome\tuse\ncases.\tFor\texample,\tthe\tCompeting\tConsumer\tpattern\tdescribes\ta\tmethod\twhereby\tyou\nbring\tup\tmultiple\tworker\tinstances\tto\tcompete\tfor\tmessages,\twhich\tworks\twell\tfor\tscaling\nup\tthe\tnumber\tof\tworkers\tto\thandle\ta\tlist\tof\tindependent\tjobs.\tHowever,\twe\twant\tto\tavoid\nthe\tcase\twhere\ttwo\tor\tmore\tworkers\tsee\tthe\tsame\tmessage,\tas\twe’ll\tend\tup\tdoing\tthe\tsame\ntask\tmore\tthan\twe\tneed\tto.\tWith\ta\tmessage\tbroker,\ta\tstandard\tqueue\twill\thandle\tthis.\tWith\nATOM,\twe\tnow\tneed\tto\tmanage\tour\town\tshared\tstate\tamong\tall\tthe\tworkers\tto\ttry\tto\nreduce\tthe\tchances\tof\treproducing\teffort.")]),t._v(" "),a("p",[t._v("If\tyou\talready\thave\ta\tgood,\tresilient\tmessage\tbroker\tavailable\tto\tyou,\tconsider\tusing\tit\tto\nhandle\tpublishing\tand\tsubscribing\tto\tevents.\tBut\tif\tyou\tdon’t\talready\thave\tone,\tgive\nATOM\ta\tlook,\tbut\tbe\taware\tof\tthe\tsunk-cost\tfallacy.\tIf\tyou\tfind\tyourself\twanting\tmore\nand\tmore\tof\tthe\tsupport\tthat\ta\tmessage\tbroker\tgives\tyou,\tat\ta\tcertain\tpoint\tyou\tmight\twant\nto\tchange\tyour\tapproach.")]),t._v(" "),a("p",[t._v("In\tterms\tof\twhat\twe\tactually\tsend\tover\tthese\tasynchronous\tprotocols,\tthe\tsame\nconsiderations\tapply\tas\twith\tsynchronous\tcommunication.\tIf\tyou\tare\tcurrently\thappy\twith\nencoding\trequests\tand\tresponses\tusing\tJSON,\tstick\twith\tit.")]),t._v(" "),a("h2",{attrs:{id:"complexitiesofasynchronousarchitectures"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#complexitiesofasynchronousarchitectures"}},[t._v("#")]),t._v(" Complexities\tof\tAsynchronous\tArchitectures")]),t._v(" "),a("p",[t._v("Some\tof\tthis\tasynchronous\tstuff\tseems\tfun,\tright?\tEvent-driven\tarchitectures\tseem\tto\tlead\nto\tsignificantly\tmore\tdecoupled,\tscalable\tsystems.\tAnd\tthey\tcan.\tBut\tthese\tprogramming\nstyles\tdo\tlead\tto\tan\tincrease\tin\tcomplexity.\tThis\tisn’t\tjust\tthe\tcomplexity\trequired\tto\nmanage\tpublishing\tand\tsubscribing\tto\tmessages\tas\twe\tjust\tdiscussed,\tbut\talso\tin\tthe\tother\nproblems\twe\tmight\tface.\tFor\texample,\twhen\tconsidering\tlong-running\tasync\nrequest/response,\twe\thave\tto\tthink\tabout\twhat\tto\tdo\twhen\tthe\tresponse\tcomes\tback.\tDoes\nit\tcome\tback\tto\tthe\tsame\tnode\tthat\tinitiated\tthe\trequest?\tIf\tso,\twhat\tif\tthat\tnode\tis\tdown?\nIf\tnot,\tdo\tI\tneed\tto\tstore\tinformation\tsomewhere\tso\tI\tcan\treact\taccordingly?\tShort-lived\nasync\tcan\tbe\teasier\tto\tmanage\tif\tyou’ve\tgot\tthe\tright\tAPIs,\tbut\teven\tso,\tit\tis\ta\tdifferent\nway\tof\tthinking\tfor\tprogrammers\twho\tare\taccustomed\tto\tintra-process\tsynchronous\nmessage\tcalls.")]),t._v(" "),a("p",[t._v("Time\tfor\ta\tcautionary\ttale.\tBack\tin\t2006,\tI\twas\tworking\ton\tbuilding\ta\tpricing\tsystem\tfor\ta\nbank.\tWe\twould\tlook\tat\tmarket\tevents,\tand\twork\tout\twhich\titems\tin\ta\tportfolio\tneeded\tto\nbe\trepriced.\tOnce\twe\tdetermined\tthe\tlist\tof\tthings\tto\twork\tthrough,\twe\tput\tthese\tall\tonto\ta\nmessage\tqueue.\tWe\twere\tmaking\tuse\tof\ta\tgrid\tto\tcreate\ta\tpool\tof\tpricing\tworkers,\nallowing\tus\tto\tscale\tup\tand\tdown\tthe\tpricing\tfarm\ton\trequest.\tThese\tworkers\tused\tthe\ncompeting\tconsumer\tpattern,\teach\tone\tgobbling\tmessages\tas\tfast\tas\tpossible\tuntil\tthere\nwas\tnothing\tleft\tto\tprocess.")]),t._v(" "),a("p",[t._v("The\tsystem\twas\tup\tand\trunning,\tand\twe\twere\tfeeling\trather\tsmug.\tOne\tday,\tthough,\tjust\nafter\twe\tpushed\ta\trelease\tout,\twe\thit\ta\tnasty\tproblem.\tOur\tworkers\tkept\tdying.\tAnd\tdying.\nAnd\tdying.")]),t._v(" "),a("p",[t._v("Eventually,\twe\ttracked\tdown\tthe\tproblem.\tA\tbug\thad\tcrept\tin\twhereby\ta\tcertain\ttype\tof\npricing\trequest\twould\tcause\ta\tworker\tto\tcrash.\tWe\twere\tusing\ta\ttransacted\tqueue:\tas\tthe\nworker\tdied,\tits\tlock\ton\tthe\trequest\ttimed\tout,\tand\tthe\tpricing\trequest\twas\tput\tback\ton\tthe\nqueue\t—\tonly\tfor\tanother\tworker\tto\tpick\tit\tup\tand\tdie.\tThis\twas\ta\tclassic\texample\tof\twhat\nMartin\tFowler\tcalls\ta\tcatastrophic\tfailover.")]),t._v(" "),a("p",[t._v("Aside\tfrom\tthe\tbug\titself,\twe’d\tfailed\tto\tspecify\ta\tmaximum\tretry\tlimit\tfor\tthe\tjob\ton\tthe\nqueue.\tWe\tfixed\tthe\tbug\titself,\tand\talso\tconfigured\ta\tmaximum\tretry.\tBut\twe\talso\trealized\nwe\tneeded\ta\tway\tto\tview,\tand\tpotentially\treplay,\tthese\tbad\tmessages.\tWe\tended\tup\thaving\nto\timplement\ta\tmessage\thospital\t(or\tdead\tletter\tqueue),\twhere\tmessages\tgot\tsent\tif\tthey\nfailed.\tWe\talso\tcreated\ta\tUI\tto\tview\tthose\tmessages\tand\tretry\tthem\tif\tneeded.\tThese\tsorts\nof\tproblems\taren’t\timmediately\tobvious\tif\tyou\tare\tonly\tfamiliar\twith\tsynchronous\tpoint-\nto-point\tcommunication.")]),t._v(" "),a("p",[t._v("The\tassociated\tcomplexity\twith\tevent-driven\tarchitectures\tand\tasynchronous\nprogramming\tin\tgeneral\tleads\tme\tto\tbelieve\tthat\tyou\tshould\tbe\tcautious\tin\thow\teagerly\nyou\tstart\tadopting\tthese\tideas.\tEnsure\tyou\thave\tgood\tmonitoring\tin\tplace,\tand\tstrongly\nconsider\tthe\tuse\tof\tcorrelation\tIDs,\twhich\tallow\tyou\tto\ttrace\trequests\tacross\tprocess")]),t._v(" "),a("p",[t._v("boundaries,\tas\twe’ll\tcover\tin\tdepth\tin\tChapter\t8.")]),t._v(" "),a("p",[t._v("I\talso\tstrongly\trecommend\t "),a("em",[t._v("Enterprise\tIntegration\tPatterns")]),t._v(" \t(Addison-Wesley),\twhich\ncontains\ta\tlot\tmore\tdetail\ton\tthe\tdifferent\tprogramming\tpatterns\tthat\tyou\tmay\tneed\tto\nconsider\tin\tthis\tspace.")]),t._v(" "),a("h2",{attrs:{id:"servicesasstatemachines"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#servicesasstatemachines"}},[t._v("#")]),t._v(" Services\tas\tState\tMachines")]),t._v(" "),a("p",[t._v("Whether\tyou\tchoose\tto\tbecome\ta\tREST\tninja,\tor\tstick\twith\tan\tRPC-based\tmechanism\tlike\nSOAP,\tthe\tcore\tconcept\tof\tthe\tservice\tas\ta\tstate\tmachine\tis\tpowerful.\tWe’ve\tspoken\nbefore\t(probably\tad\tnauseum\tby\tthis\tpoint)\tabout\tour\tservices\tbeing\tfashioned\taround\nbounded\tcontexts.\tOur\tcustomer\tmicroservice\t "),a("em",[t._v("owns")]),t._v(" \tall\tlogic\tassociated\twith\tbehavior\tin\nthis\tcontext.")]),t._v(" "),a("p",[t._v("When\ta\tconsumer\twants\tto\tchange\ta\tcustomer,\tit\tsends\tan\tappropriate\trequest\tto\tthe\ncustomer\tservice.\tThe\tcustomer\tservice,\tbased\ton\tits\tlogic,\tgets\tto\tdecide\tif\tit\taccepts\tthat\nrequest\tor\tnot.\tOur\tcustomer\tservice\tcontrols\tall\tlifecycle\tevents\tassociated\twith\tthe\ncustomer\titself.\tWe\twant\tto\tavoid\tdumb,\tanemic\tservices\tthat\tare\tlittle\tmore\tthan\tCRUD\nwrappers.\tIf\tthe\tdecision\tabout\twhat\tchanges\tare\tallowed\tto\tbe\tmade\tto\ta\tcustomer\tleak\nout\tof\tthe\tcustomer\tservice\titself,\twe\tare\tlosing\tcohesion.")]),t._v(" "),a("p",[t._v("Having\tthe\tlifecycle\tof\tkey\tdomain\tconcepts\texplicitly\tmodeled\tlike\tthis\tis\tpretty\npowerful.\tNot\tonly\tdo\twe\thave\tone\tplace\tto\tdeal\twith\tcollisions\tof\tstate\t(e.g.,\tsomeone\ntrying\tto\tupdate\ta\tcustomer\tthat\thas\talready\tbeen\tremoved),\tbut\twe\talso\thave\ta\tplace\tto\nattach\tbehavior\tbased\ton\tthose\tstate\tchanges.")]),t._v(" "),a("p",[t._v("I\tstill\tthink\tthat\tREST\tover\tHTTP\tmakes\tfor\ta\tmuch\tmore\tsensible\tintegration\ttechnology\nthan\tmany\tothers,\tbut\twhatever\tyou\tpick,\tkeep\tthis\tidea\tin\tmind.")]),t._v(" "),a("h2",{attrs:{id:"reactiveextensions"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#reactiveextensions"}},[t._v("#")]),t._v(" Reactive\tExtensions")]),t._v(" "),a("p",[a("em",[t._v("Reactive\textensions")]),t._v(" ,\toften\tshortened\tto\tRx,\tare\ta\tmechanism\tto\tcompose\tthe\tresults\tof\nmultiple\tcalls\ttogether\tand\trun\toperations\ton\tthem.\tThe\tcalls\tthemselves\tcould\tbe\nblocking\tor\tnonblocking\tcalls.\tAt\tits\theart,\tRx\tinverts\ttraditional\tflows.\tRather\tthan\tasking\nfor\tsome\tdata,\tthen\tperforming\toperations\ton\tit,\tyou\tobserve\tthe\toutcome\tof\tan\toperation\n(or\tset\tof\toperations)\tand\treact\twhen\tsomething\tchanges.\tSome\timplementations\tof\tRx\nallow\tyou\tto\tperform\tfunctions\ton\tthese\tobservables,\tsuch\tas\tRxJava,\twhich\tallows\ntraditional\tfunctions\tlike\tmap\tor\tfilter\tto\tbe\tused.")]),t._v(" "),a("p",[t._v("The\tvarious\tRx\timplementations\thave\tfound\ta\tvery\thappy\thome\tin\tdistributed\tsystems.\nThey\tallow\tus\tto\tabstract\tout\tthe\tdetails\tof\thow\tcalls\tare\tmade,\tand\treason\tabout\tthings\nmore\teasily.\tI\tobserve\tthe\tresult\tof\ta\tcall\tto\ta\tdownstream\tservice.\tI\tdon’t\tcare\tif\tit\twas\ta\nblocking\tor\tnonblocking\tcall,\tI\tjust\twait\tfor\tthe\tresponse\tand\treact.\tThe\tbeauty\tis\tthat\tI\ncan\tcompose\tmultiple\tcalls\ttogether,\tmaking\thandling\tconcurrent\tcalls\tto\tdownstream\nservices\tmuch\teasier.")]),t._v(" "),a("p",[t._v("As\tyou\tfind\tyourself\tmaking\tmore\tservice\tcalls,\tespecailly\twhen\tmaking\tmultiple\tcalls\tto\nperform\ta\tsingle\toperation,\ttake\ta\tlook\tat\tthe\treactive\textensions\tfor\tyour\tchosen\ntechnology\tstack.\tYou\tmay\tbe\tsurprised\thow\tmuch\tsimpler\tyour\tlife\tcan\tbecome.")]),t._v(" "),a("h2",{attrs:{id:"dryandtheperilsofcodereuseinamicroserviceworld"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#dryandtheperilsofcodereuseinamicroserviceworld"}},[t._v("#")]),t._v(" DRY\tand\tthe\tPerils\tof\tCode\tReuse\tin\ta\tMicroservice\tWorld")]),t._v(" "),a("p",[t._v("One\tof\tthe\tacronyms\twe\tdevelopers\thear\ta\tlot\tis\tDRY:\tdon’t\trepeat\tyourself.\tThough\tits\ndefinition\tis\tsometimes\tsimplified\tas\ttrying\tto\tavoid\tduplicating\tcode,\tDRY\tmore\naccurately\tmeans\tthat\twe\twant\tto\tavoid\tduplicating\tour\tsystem\t "),a("em",[t._v("behavior\tand\tknowledge")]),t._v(".\nThis\tis\tvery\tsensible\tadvice\tin\tgeneral.\tHaving\tlots\tof\tlines\tof\tcode\tthat\tdo\tthe\tsame\tthing\nmakes\tyour\tcodebase\tlarger\tthan\tneeded,\tand\ttherefore\tharder\tto\treason\tabout.\tWhen\tyou\nwant\tto\tchange\tbehavior,\tand\tthat\tbehavior\tis\tduplicated\tin\tmany\tparts\tof\tyour\tsystem,\tit\nis\teasy\tto\tforget\teverywhere\tyou\tneed\tto\tmake\ta\tchange,\twhich\tcan\tlead\tto\tbugs.\tSo\tusing\nDRY\tas\ta\tmantra,\tin\tgeneral,\tmakes\tsense.")]),t._v(" "),a("p",[t._v("DRY\tis\twhat\tleads\tus\tto\tcreate\tcode\tthat\tcan\tbe\treused.\tWe\tpull\tduplicated\tcode\tinto\nabstractions\tthat\twe\tcan\tthen\tcall\tfrom\tmultiple\tplaces.\tPerhaps\twe\tgo\tas\tfar\tas\tmaking\ta\nshared\tlibrary\tthat\twe\tcan\tuse\teverywhere!\tThis\tapproach,\thowever,\tcan\tbe\tdeceptively\ndangerous\tin\ta\tmicroservice\tarchitecture.")]),t._v(" "),a("p",[t._v("One\tof\tthe\tthings\twe\twant\tto\tavoid\tat\tall\tcosts\tis\toverly\tcoupling\ta\tmicroservice\tand\nconsumers\tsuch\tthat\tany\tsmall\tchange\tto\tthe\tmicroservice\titself\tcan\tcause\tunnecessary\nchanges\tto\tthe\tconsumer.\tSometimes,\thowever,\tthe\tuse\tof\tshared\tcode\tcan\tcreate\tthis\tvery\ncoupling.\tFor\texample,\tat\tone\tclient\twe\thad\ta\tlibrary\tof\tcommon\tdomain\tobjects\tthat\nrepresented\tthe\tcore\tentities\tin\tuse\tin\tour\tsystem.\tThis\tlibrary\twas\tused\tby\tall\tthe\tservices\nwe\thad.\tBut\twhen\ta\tchange\twas\tmade\tto\tone\tof\tthem,\tall\tservices\thad\tto\tbe\tupdated.\tOur\nsystem\tcommunicated\tvia\tmessage\tqueues,\twhich\talso\thad\tto\tbe\tdrained\tof\ttheir\tnow\n"),a("em",[t._v("invalid")]),t._v(" \tcontents,\tand\twoe\tbetide\tyou\tif\tyou\tforgot.")]),t._v(" "),a("p",[t._v("If\tyour\tuse\tof\tshared\tcode\tever\tleaks\toutside\tyour\tservice\tboundary,\tyou\thave\tintroduced\ta\npotential\tform\tof\tcoupling.\tUsing\tcommon\tcode\tlike\tlogging\tlibraries\tis\tfine,\tas\tthey\tare\ninternal\tconcepts\tthat\tare\tinvisible\tto\tthe\toutside\tworld.\tRealEstate.com.au\tmakes\tuse\tof\ta\ntailored\tservice\ttemplate\tto\thelp\tbootstrap\tnew\tservice\tcreation.\tRather\tthan\tmake\tthis\ncode\tshared,\tthe\tcompany\tcopies\tit\tfor\tevery\tnew\tservice\tto\tensure\tthat\tcoupling\tdoesn’t\nleak\tin.")]),t._v(" "),a("p",[t._v("My\tgeneral\trule\tof\tthumb:\tdon’t\tviolate\tDRY\twithin\ta\tmicroservice,\tbut\tbe\trelaxed\tabout\nviolating\tDRY\tacross\tall\tservices.\tThe\tevils\tof\ttoo\tmuch\tcoupling\tbetween\tservices\tare\tfar\nworse\tthan\tthe\tproblems\tcaused\tby\tcode\tduplication.\tThere\tis\tone\tspecific\tuse\tcase\tworth\nexploring\tfurther,\tthough.")]),t._v(" "),a("h2",{attrs:{id:"clientlibraries"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#clientlibraries"}},[t._v("#")]),t._v(" Client\tLibraries")]),t._v(" "),a("p",[t._v("I’ve\tspoken\tto\tmore\tthan\tone\tteam\twho\thas\tinsisted\tthat\tcreating\tclient\tlibraries\tfor\tyour\nservices\tis\tan\tessential\tpart\tof\tcreating\tservices\tin\tthe\tfirst\tplace.\tThe\targument\tis\tthat\tthis\nmakes\tit\teasy\tto\tuse\tyour\tservice,\tand\tavoids\tthe\tduplication\tof\tcode\trequired\tto\tconsume\nthe\tservice\titself.")]),t._v(" "),a("p",[t._v("The\tproblem,\tof\tcourse,\tis\tthat\tif\tthe\tsame\tpeople\tcreate\tboth\tthe\tserver\tAPI\tand\tthe\tclient\nAPI,\tthere\tis\tthe\tdanger\tthat\tlogic\tthat\tshould\texist\ton\tthe\tserver\tstarts\tleaking\tinto\tthe\nclient.\tI\tshould\tknow:\tI’ve\tdone\tthis\tmyself.\tThe\tmore\tlogic\tthat\tcreeps\tinto\tthe\tclient\nlibrary,\tthe\tmore\tcohesion\tstarts\tto\tbreak\tdown,\tand\tyou\tfind\tyourself\thaving\tto\tchange\nmultiple\tclients\tto\troll\tout\tfixes\tto\tyour\tserver.\tYou\talso\tlimit\ttechnology\tchoices,\nespecially\tif\tyou\tmandate\tthat\tthe\tclient\tlibrary\thas\tto\tbe\tused.")]),t._v(" "),a("p",[t._v("A\tmodel\tfor\tclient\tlibraries\tI\tlike\tis\tthe\tone\tfor\tAmazon\tWeb\tServices\t(AWS).\tThe\nunderlying\tSOAP\tor\tREST\tweb\tservice\tcalls\tcan\tbe\tmade\tdirectly,\tbut\teveryone\tends\tup\nusing\tjust\tone\tof\tthe\tvarious\tsoftware\tdevelopment\tkits\t(SDKs)\tthat\texist,\twhich\tprovide\nabstractions\tover\tthe\tunderlying\tAPI.\tThese\tSDKs,\tthough,\tare\twritten\tby\tthe\tcommunity\nor\tAWS\tpeople\tother\tthan\tthose\twho\twork\ton\tthe\tAPI\titself.\tThis\tdegree\tof\tseparation\nseems\tto\twork,\tand\tavoids\tsome\tof\tthe\tpitfalls\tof\tclient\tlibraries.\tPart\tof\tthe\treason\tthis\nworks\tso\twell\tis\tthat\tthe\tclient\tis\tin\tcharge\tof\twhen\tthe\tupgrade\thappens.\tIf\tyou\tgo\tdown\nthe\tpath\tof\tclient\tlibraries\tyourself,\tmake\tsure\tthis\tis\tthe\tcase.")]),t._v(" "),a("p",[t._v("Netflix\tin\tparticular\tplaces\tspecial\temphasis\ton\tthe\tclient\tlibrary,\tbut\tI\tworry\tthat\tpeople\nview\tthat\tpurely\tthrough\tthe\tlens\tof\tavoiding\tcode\tduplication.\tIn\tfact,\tthe\tclient\tlibraries\nused\tby\tNetflix\tare\tas\tmuch\t(if\tnot\tmore)\tabout\tensuring\treliability\tand\tscalability\tof\ttheir\nsystems.\tThe\tNetflix\tclient\tlibraries\thandle\tservice\tdiscovery,\tfailure\tmodes,\tlogging,\tand\nother\taspects\tthat\taren’t\tactually\tabout\tthe\tnature\tof\tthe\tservice\titself.\tWithout\tthese\nshared\tclients,\tit\twould\tbe\thard\tto\tensure\tthat\teach\tpiece\tof\tclient/server\tcommunications\nbehaved\twell\tat\tthe\tmassive\tscale\tat\twhich\tNetflix\toperates.\tTheir\tuse\tat\tNetflix\thas\ncertainly\tmade\tit\teasy\tto\tget\tup\tand\trunning\tand\tincreased\tproductivity\twhile\talso\nensuring\tthe\tsystem\tbehaves\twell.\tHowever,\taccording\tto\tat\tleast\tone\tperson\tat\tNetflix,\nover\ttime\tthis\thas\tled\tto\ta\tdegree\tof\tcoupling\tbetween\tclient\tand\tserver\tthat\thas\tbeen\nproblematic.")]),t._v(" "),a("p",[t._v("If\tthe\tclient\tlibrary\tapproach\tis\tsomething\tyou’re\tthinking\tabout,\tit\tcan\tbe\timportant\tto\nseparate\tout\tclient\tcode\tto\thandle\tthe\tunderlying\ttransport\tprotocol,\twhich\tcan\tdeal\twith\nthings\tlike\tservice\tdiscovery\tand\tfailure,\tfrom\tthings\trelated\tto\tthe\tdestination\tservice\nitself.\tDecide\twhether\tor\tnot\tyou\tare\tgoing\tto\tinsist\ton\tthe\tclient\tlibrary\tbeing\tused,\tor\tif\nyou’ll\tallow\tpeople\tusing\tdifferent\ttechnology\tstacks\tto\tmake\tcalls\tto\tthe\tunderlying\tAPI.\nAnd\tfinally,\tmake\tsure\tthat\tthe\tclients\tare\tin\tcharge\tof\twhen\tto\tupgrade\ttheir\tclient\nlibraries:\twe\tneed\tto\tensure\twe\tmaintain\tthe\tability\tto\trelease\tour\tservices\tindependently\nof\teach\tother!")]),t._v(" "),a("h2",{attrs:{id:"accessbyreference"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#accessbyreference"}},[t._v("#")]),t._v(" Access\tby\tReference")]),t._v(" "),a("p",[t._v("One\tconsideration\tI\twant\tto\ttouch\ton\tis\thow\twe\tpass\taround\tinformation\tabout\tour\ndomain\tentities.\tWe\tneed\tto\tembrace\tthe\tidea\tthat\ta\tmicroservice\twill\tencompass\tthe\nlifecycle\tof\tour\tcore\tdomain\tentities,\tlike\tthe\tCustomer.\tWe’ve\talready\ttalked\tabout\tthe\nimportance\tof\tthe\tlogic\tassociated\twith\tchanging\tthis\tCustomer\tbeing\theld\tin\tthe\tcustomer")]),t._v(" "),a("p",[t._v("service,\tand\tthat\tif\twe\twant\tto\tchange\tit\twe\thave\tto\tissue\ta\trequest\tto\tthe\tcustomer\tservice.\nBut\tit\talso\tfollows\tthat\twe\tshould\tconsider\tthe\tcustomer\tservice\tas\tbeing\tthe\tsource\tof\ntruth\tfor\tCustomers.")]),t._v(" "),a("p",[t._v("When\twe\tretrieve\ta\tgiven\tCustomer\tresource\tfrom\tthe\tcustomer\tservice,\twe\tget\tto\tsee")]),t._v(" "),a("p",[t._v("what\tthat\tresource\tlooked\tlike\twhen\twe\tmade\tthe\trequest.\tIt\tis\tpossible\tthat\tafter\twe\nrequested\tthat\tCustomer\tresource,\tsomething\telse\thas\tchanged\tit.\tWhat\twe\thave\tin\teffect\nis\ta\tmemory\tof\twhat\tthe\tCustomer\tresource\tonce\tlooked\tlike.\tThe\tlonger\twe\thold\ton\tto")]),t._v(" "),a("p",[t._v("this\tmemory,\tthe\thigher\tthe\tchance\tthat\tthis\tmemory\twill\tbe\tfalse.\tOf\tcourse,\tif\twe\tavoid\nrequesting\tdata\tmore\tthan\twe\tneed\tto,\tour\tsystems\tcan\tbecome\tmuch\tmore\tefficient.")]),t._v(" "),a("p",[t._v("Sometimes\tthis\tmemory\tis\tgood\tenough.\tOther\ttimes\tyou\tneed\tto\tknow\tif\tit\thas\tchanged.\nSo\twhether\tyou\tdecide\tto\tpass\taround\ta\tmemory\tof\twhat\tan\tentity\tonce\tlooked\tlike,\tmake\nsure\tyou\talso\tinclude\ta\treference\tto\tthe\toriginal\tresource\tso\tthat\tthe\tnew\tstate\tcan\tbe\nretrieved.")]),t._v(" "),a("p",[t._v("Let’s\tconsider\tthe\texample\twhere\twe\task\tthe\temail\tservice\tto\tsend\tan\temail\twhen\tan\torder\nhas\tbeen\tshipped.\tNow\twe\tcould\tsend\tin\tthe\trequest\tto\tthe\temail\tservice\twith\tthe\ncustomer’s\temail\taddress,\tname,\tand\torder\tdetails.\tHowever,\tif\tthe\temail\tservice\tis\nactually\tqueuing\tup\tthese\trequests,\tor\tpulling\tthem\tfrom\ta\tqueue,\tthings\tcould\tchange\tin\nthe\tmeantime.\tIt\tmight\tmake\tmore\tsense\tto\tjust\tsend\ta\tURI\tfor\tthe\tCustomer\tand\tOrder")]),t._v(" "),a("p",[t._v("resources,\tand\tlet\tthe\temail\tserver\tgo\tlook\tthem\tup\twhen\tit\tis\ttime\tto\tsend\tthe\temail.")]),t._v(" "),a("p",[t._v("A\tgreat\tcounterpoint\tto\tthis\temerges\twhen\twe\tconsider\tevent-based\tcollaboration.\tWith\nevents,\twe’re\tsaying\t "),a("em",[t._v("this\thappened")]),t._v(" ,\tbut\twe\tneed\tto\tknow\t "),a("em",[t._v("what")]),t._v(" \thappened.\tIf\twe’re\nreceiving\tupdates\tdue\tto\ta\tCustomer\tresource\tchanging,\tfor\texample,\tit\tcould\tbe\tvaluable\nto\tus\tto\tknow\twhat\tthe\tCustomer\tlooked\tlike\twhen\tthe\tevent\toccurred.\tAs\tlong\tas\twe\talso")]),t._v(" "),a("p",[t._v("get\ta\treference\tto\tthe\tentity\titself\tso\twe\tcan\tlook\tup\tits\tcurrent\tstate,\tthen\twe\tcan\tget\tthe\nbest\tof\tboth\tworlds.")]),t._v(" "),a("p",[t._v("There\tare\tother\ttrade-offs\tto\tbe\tmade\there,\tof\tcourse,\twhen\twe’re\taccessing\tby\treference.\nIf\twe\talways\tgo\tto\tthe\tcustomer\tservice\tto\tlook\tat\tthe\tinformation\tassociated\twith\ta\tgiven\nCustomer,\tthe\tload\ton\tthe\tcustomer\tservice\tcan\tbe\ttoo\tgreat.\tIf\twe\tprovide\tadditional\ninformation\twhen\tthe\tresource\tis\tretrieved,\tletting\tus\tknow\tat\twhat\ttime\tthe\tresource\twas\nin\tthe\tgiven\tstate\tand\tperhaps\thow\tlong\twe\tcan\tconsider\tthis\tinformation\tto\tbe\t "),a("em",[t._v("fresh")]),t._v(" ,\tthen\nwe\tcan\tdo\ta\tlot\twith\tcaching\tto\treduce\tload.\tHTTP\tgives\tus\tmuch\tof\tthis\tsupport\tout\tof\nthe\tbox\twith\ta\twide\tvariety\tof\tcache\tcontrols,\tsome\tof\twhich\twe’ll\tdiscuss\tin\tmore\tdetail")]),t._v(" "),a("p",[t._v("in\tChapter\t11.")]),t._v(" "),a("p",[t._v("Another\tproblem\tis\tthat\tsome\tof\tour\tservices\tmight\tnot\tneed\tto\tknow\tabout\tthe\twhole\nCustomer\tresource,\tand\tby\tinsisting\tthat\tthey\tgo\tlook\tit\tup\twe\tare\tpotentially\tincreasing")]),t._v(" "),a("p",[t._v("coupling.\tIt\tcould\tbe\targued,\tfor\texample,\tthat\tour\temail\tservice\tshould\tbe\tmore\tdumb,\nand\tthat\twe\tshould\tjust\tsend\tit\tthe\temail\taddress\tand\tname\tof\tthe\tcustomer.\tThere\tisn’t\ta\nhard-and-fast\trule\there,\tbut\tbe\tvery\twary\tof\tpassing\taround\tdata\tin\trequests\twhen\tyou\ndon’t\tknow\tits\tfreshness.")]),t._v(" "),a("h2",{attrs:{id:"versioning"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#versioning"}},[t._v("#")]),t._v(" Versioning")]),t._v(" "),a("p",[t._v("In\tevery\tsingle\ttalk\tI\thave\tever\tdone\tabout\tmicroservices,\tI\tget\tasked\t "),a("em",[t._v("how\tdo\tyou\tdo\nversioning?")]),t._v(" \tPeople\thave\tthe\tlegitimate\tconcern\tthat\teventually\tthey\twill\thave\tto\tmake\ta\nchange\tto\tthe\tinterface\tof\ta\tservice,\tand\tthey\twant\tto\tunderstand\thow\tto\tmanage\tthat.\tLet’s\nbreak\tdown\tthe\tproblem\ta\tbit\tand\tlook\tat\tthe\tvarious\tsteps\twe\tcan\ttake\tto\thandle\tit.")]),t._v(" "),a("h2",{attrs:{id:"deferitforaslongaspossible"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#deferitforaslongaspossible"}},[t._v("#")]),t._v(" Defer\tIt\tfor\tas\tLong\tas\tPossible")]),t._v(" "),a("p",[t._v("The\tbest\tway\tto\treduce\tthe\timpact\tof\tmaking\tbreaking\tchanges\tis\tto\tavoid\tmaking\tthem\tin\nthe\tfirst\tplace.\tYou\tcan\tachieve\tmuch\tof\tthis\tby\tpicking\tthe\tright\tintegration\ttechnology,\nas\twe’ve\tdiscussed\tthroughout\tthis\tchapter.\tDatabase\tintegration\tis\ta\tgreat\texample\tof\ntechnology\tthat\tcan\tmake\tit\tvery\thard\tto\tavoid\tbreaking\tchanges.\tREST,\ton\tthe\tother\nhand,\thelps\tbecause\tchanges\tto\tinternal\timplementation\tdetail\tare\tless\tlikely\tto\tresult\tin\ta\nchange\tto\tthe\tservice\tinterface.")]),t._v(" "),a("p",[t._v("Another\tkey\tto\tdeferring\ta\tbreaking\tchange\tis\tto\tencourage\tgood\tbehavior\tin\tyour\tclients,\nand\tavoid\tthem\tbinding\ttoo\ttightly\tto\tyour\tservices\tin\tthe\tfirst\tplace.\tLet’s\tconsider\tour\nemail\tservice,\twhose\tjob\tit\tis\tto\tsend\tout\temails\tto\tour\tcustomers\tfrom\ttime\tto\ttime.\tIt\tgets\nasked\tto\tsend\tan\torder\tshipped\temail\tto\tcustomer\twith\tthe\tID\t1234.\tIt\tgoes\toff\tand\nretrieves\tthe\tcustomer\twith\tthat\tID,\tand\tgets\tback\tsomething\tlike\tthe\tresponse\tshown\tin\nExample\t4-3.")]),t._v(" "),a("p",[a("em",[t._v("Example\t4-3.\tSample\tresponse\tfrom\tthe\tcustomer\tservice")]),t._v(" "),a("strong",[a("customer",[a("firstname")],1)],1),t._v(" Sam "),a("strong",[a("lastname")],1),t._v(" Newman "),a("strong",[a("email")],1),t._v(" sam@magpiebrain.com "),a("strong",[a("telephoneNumber")],1),t._v(" 555-1234-5678 "),a("strong")]),t._v(" "),a("p",[t._v("Now\tto\tsend\tthe\temail,\twe\tneed\tonly\tthe\tfirstname,\tlastname,\tand\temail\tfields.\tWe\ndon’t\tneed\tto\tknow\tthe\ttelephoneNumber.\tWe\twant\tto\tsimply\tpull\tout\tthose\tfields\twe\tcare")]),t._v(" "),a("p",[t._v("about,\tand\tignore\tthe\trest.\tSome\tbinding\ttechnology,\tespecially\tthat\tused\tby\tstrongly\ntyped\tlanguages,\tcan\tattempt\tto\tbind\t "),a("em",[t._v("all")]),t._v(" \tfields\twhether\tthe\tconsumer\twants\tthem\tor\tnot.\nWhat\thappens\tif\twe\trealize\tthat\tno\tone\tis\tusing\tthe\ttelephoneNumber\tand\twe\tdecide\tto\nremove\tit?\tThis\tcould\tcause\tconsumers\tto\tbreak\tneedlessly.")]),t._v(" "),a("p",[t._v("Likewise,\twhat\tif\twe\twanted\tto\trestructure\tour\tCustomer\tobject\tto\tsupport\tmore\tdetails,")]),t._v(" "),a("p",[t._v("perhaps\tadding\tsome\tfurther\tstructure\tas\tin\tExample\t4-4?\tThe\tdata\tour\temail\tservice\nwants\tis\tstill\tthere,\tand\tstill\twith\tthe\tsame\tname,\tbut\tif\tour\tcode\tmakes\tvery\texplicit\nassumptions\tas\tto\twhere\tthe\tfirstname\tand\tlastname\tfields\twill\tbe\tstored,\tthen\tit\tcould\nbreak\tagain.\tIn\tthis\tinstance,\twe\tcould\tinstead\tuse\tXPath\tto\tpull\tout\tthe\tfields\twe\tcare\nabout,\tallowing\tus\tto\tbe\tambivalent\tabout\twhere\tthe\tfields\tare,\tas\tlong\tas\twe\tcan\tfind\nthem.\tThis\tpattern\t—\tof\timplementing\ta\treader\table\tto\tignore\tchanges\twe\tdon’t\tcare\tabout\n—\tis\twhat\tMartin\tFowler\tcalls\ta\tTolerant\tReader.")]),t._v(" "),a("p",[a("em",[t._v("Example\t4-4.\tA\trestructured\tCustomer\tresource:\tthe\tdata\tis\tall\tstill\tthere,\tbut\tcan\tour\nconsumers\tfind\tit?")]),t._v(" "),a("strong",[a("customer",[a("naming",[a("firstname")],1)],1)],1),t._v(" Sam "),a("strong",[a("lastname")],1),t._v(" Newman "),a("strong",[a("nickname")],1),t._v(" Magpiebrain "),a("strong",[a("fullname")],1),t._v(' Sam\t"Magpiebrain"\tNewman '),a("strong",[a("email")],1),t._v(" sam@magpiebrain.com "),a("strong")]),t._v(" "),a("p",[a("strong")]),t._v(" "),a("p",[t._v("The\texample\tof\ta\tclient\ttrying\tto\tbe\tas\tflexible\tas\tpossible\tin\tconsuming\ta\tservice\ndemonstrates\tPostel’s\tLaw\t(otherwise\tknown\tas\tthe\t "),a("em",[t._v("robustness\tprinciple")]),t._v(" ),\twhich\tstates:\n“Be\tconservative\tin\twhat\tyou\tdo,\tbe\tliberal\tin\twhat\tyou\taccept\tfrom\tothers.”\tThe\toriginal\ncontext\tfor\tthis\tpiece\tof\twisdom\twas\tthe\tinteraction\tof\tdevices\tover\tnetworks,\twhere\tyou\nshould\texpect\tall\tsorts\tof\todd\tthings\tto\thappen.\tIn\tthe\tcontext\tof\tour\trequest/response\ninteraction,\tit\tcan\tlead\tus\tto\ttry\tour\tbest\tto\tallow\tthe\tservice\tbeing\tconsumed\tto\tchange\nwithout\trequiring\tus\tto\tchange.")]),t._v(" "),a("h2",{attrs:{id:"catchbreakingchangesearly"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#catchbreakingchangesearly"}},[t._v("#")]),t._v(" Catch\tBreaking\tChanges\tEarly")]),t._v(" "),a("p",[t._v("It’s\tcrucial\tto\tmake\tsure\twe\tpick\tup\tchanges\tthat\twill\tbreak\tconsumers\tas\tsoon\tas\tpossible,\nbecause\teven\tif\twe\tchoose\tthe\tbest\tpossible\ttechnology,\tbreaks\tcan\tstill\thappen.\tI\tam\nstrongly\tin\tfavor\tof\tusing\tconsumer-driven\tcontracts,\twhich\twe’ll\tcover\tin\tChapter\t7,\tto\nhelp\tspot\tthese\tproblems\tearly\ton.\tIf\tyou’re\tsupporting\tmultiple\tdifferent\tclient\tlibraries,\nrunning\ttests\tusing\teach\tlibrary\tyou\tsupport\tagainst\tthe\tlatest\tservice\tis\tanother\ttechnique\nthat\tcan\thelp.\tOnce\tyou\trealize\tyou\tare\tgoing\tto\tbreak\ta\tconsumer,\tyou\thave\tthe\tchoice\tto\neither\ttry\tto\tavoid\tthe\tbreak\taltogether\tor\telse\tembrace\tit\tand\tstart\thaving\tthe\tright\nconversations\twith\tthe\tpeople\tlooking\tafter\tthe\tconsuming\tservices.")]),t._v(" "),a("h2",{attrs:{id:"usesemanticversioning"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#usesemanticversioning"}},[t._v("#")]),t._v(" Use\tSemantic\tVersioning")]),t._v(" "),a("p",[t._v("Wouldn’t\tit\tbe\tgreat\tif\tas\ta\tclient\tyou\tcould\tlook\tjust\tat\tthe\tversion\tnumber\tof\ta\tservice\nand\tknow\tif\tyou\tcan\tintegrate\twith\tit?\t "),a("em",[t._v("Semantic\tversioning")]),t._v(" \tis\ta\tspecification\tthat\tallows\njust\tthat.\tWith\tsemantic\tversioning,\teach\tversion\tnumber\tis\tin\tthe\tform\nMAJOR.MINOR.PATCH.\tWhen\tthe\tMAJOR\tnumber\tincrements,\tit\tmeans\tthat\tbackward\nincompatible\tchanges\thave\tbeen\tmade.\tWhen\tMINOR\tincrements,\tnew\tfunctionality\thas")]),t._v(" "),a("p",[t._v("been\tadded\tthat\tshould\tbe\tbackward\tcompatible.\tFinally,\ta\tchange\tto\tPATCH\tstates\tthat\tbug\nfixes\thave\tbeen\tmade\tto\texisting\tfunctionality.")]),t._v(" "),a("p",[t._v("To\tsee\thow\tuseful\tsemantic\tversioning\tcan\tbe,\tlet’s\tlook\tat\ta\tsimple\tuse\tcase.\tOur\nhelpdesk\tapplication\tis\tbuilt\tto\twork\tagainst\tversion\t1.2.0\tof\tthe\tcustomer\tservice.\tIf\ta\nnew\tfeature\tis\tadded,\tcausing\tthe\tcustomer\tservice\tto\tchange\tto\t1.3.0,\tour\thelpdesk\napplication\tshould\tsee\tno\tchange\tin\tbehavior\tand\tshouldn’t\tbe\texpected\tto\tmake\tany\nchanges.\tWe\tcouldn’t\tguarantee\tthat\twe\tcould\twork\tagainst\tversion\t1.1.0\tof\tthe\tcustomer\nservice,\tthough,\tas\twe\tmay\trely\ton\tfunctionality\tadded\tin\tthe\t1.2.0\trelease.\tWe\tcould\talso\nexpect\tto\thave\tto\tmake\tchanges\tto\tour\tapplication\tif\ta\tnew\t2.0.0\trelease\tof\tthe\tcustomer\nservice\tcomes\tout.")]),t._v(" "),a("p",[t._v("You\tmay\tdecide\tto\thave\ta\tsemantic\tversion\tfor\tthe\tservice,\tor\teven\tfor\tan\tindividual\nendpoint\ton\ta\tservice\tif\tyou\tare\tcoexisting\tthem\tas\tdetailed\tin\tthe\tnext\tsection.")]),t._v(" "),a("p",[t._v("This\tversioning\tscheme\tallows\tus\tto\tpack\ta\tlot\tof\tinformation\tand\texpectations\tinto\tjust\nthree\tfields.\tThe\tfull\tspecification\toutlines\tin\tvery\tsimple\tterms\tthe\texpectations\tclients\ncan\thave\tof\tchanges\tto\tthese\tnumbers,\tand\tcan\tsimplify\tthe\tprocess\tof\tcommunicating\nabout\twhether\tchanges\tshould\timpact\tconsumers.\tUnfortunately,\tI\thaven’t\tsee\tthis\napproach\tused\tenough\tin\tthe\tcontext\tof\tdistributed\tsystems.")]),t._v(" "),a("h2",{attrs:{id:"coexistdifferentendpoints"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#coexistdifferentendpoints"}},[t._v("#")]),t._v(" Coexist\tDifferent\tEndpoints")]),t._v(" "),a("p",[t._v("If\twe’ve\tdone\tall\twe\tcan\tto\tavoid\tintroducing\ta\tbreaking\tinterface\tchange,\tour\tnext\tjob\tis\nto\tlimit\tthe\timpact.\tThe\tthing\twe\twant\tto\tavoid\tis\tforcing\tconsumers\tto\tupgrade\tin\tlock-\nstep\twith\tus,\tas\twe\talways\twant\tto\tmaintain\tthe\tability\tto\trelease\tmicroservices\nindependently\tof\teach\tother.\tOne\tapproach\tI\thave\tused\tsuccessfully\tto\thandle\tthis\tis\tto\ncoexist\tboth\tthe\told\tand\tnew\tinterfaces\tin\tthe\tsame\trunning\tservice.\tSo\tif\twe\twant\tto\nrelease\ta\tbreaking\tchange,\twe\tdeploy\ta\tnew\tversion\tof\tthe\tservice\tthat\texposes\tboth\tthe\nold\tand\tnew\tversions\tof\tthe\tendpoint.")]),t._v(" "),a("p",[t._v("This\tallows\tus\tto\tget\tthe\tnew\tmicroservice\tout\tas\tsoon\tas\tpossible,\talong\twith\tthe\tnew\ninterface,\tbut\tgive\ttime\tfor\tconsumers\tto\tmove\tover.\tOnce\tall\tof\tthe\tconsumers\tare\tno\nlonger\tusing\tthe\told\tendpoint,\tyou\tcan\tremove\tit\talong\twith\tany\tassociated\tcode,\tas\tshown\nin\tFigure\t4-5.")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("Figure\t4-5.\tCoexisting\tdifferent\tendpoint\tversions\tallows\tconsumers\tto\tmigrate\tgradually\n")])])]),a("p",[t._v("When\tI\tlast\tused\tthis\tapproach,\twe\thad\tgotten\tourselves\tinto\ta\tbit\tof\ta\tmess\twith\tthe\nnumber\tof\tconsumers\twe\thad\tand\tthe\tnumber\tof\tbreaking\tchanges\twe\thad\tmade.\tThis\nmeant\tthat\twe\twere\tactually\tcoexisting\tthree\tdifferent\tversions\tof\tthe\tendpoint.\tThis\tis\tnot\nsomething\tI’d\trecommend!\tKeeping\tall\tthe\tcode\taround\tand\tthe\tassociated\ttesting\nrequired\tto\tensure\tthey\tall\tworked\twas\tabsolutely\tan\tadditional\tburden.\tTo\tmake\tthis\tmore\nmanageable,\twe\tinternally\ttransformed\tall\trequests\tto\tthe\tV1\tendpoint\tto\ta\tV2\trequest,\nand\tthen\tV2\trequests\tto\tthe\tV3\tendpoint.\tThis\tmeant\twe\tcould\tclearly\tdelineate\twhat\tcode\nwas\tgoing\tto\tbe\tretired\twhen\tthe\told\tendpoint(s)\tdied.")]),t._v(" "),a("p",[t._v("This\tis\tin\teffect\tan\texample\tof\tthe\texpand\tand\tcontract\tpattern,\twhich\tallows\tus\tto\tphase\nbreaking\tchanges\tin.\tWe\t "),a("em",[t._v("expand")]),t._v(" \tthe\tcapabilities\twe\toffer,\tsupporting\tboth\told\tand\tnew")]),t._v(" "),a("p",[t._v("ways\tof\tdoing\tsomething.\tOnce\tthe\told\tconsumers\tdo\tthings\tin\tthe\tnew\tway,\twe\t "),a("em",[t._v("contract")]),t._v("\nour\tAPI,\tremoving\tthe\told\tfunctionality.")]),t._v(" "),a("p",[t._v("If\tyou\tare\tgoing\tto\tcoexist\tendpoints,\tyou\tneed\ta\tway\tfor\tcallers\tto\troute\ttheir\trequests\naccordingly.\tFor\tsystems\tmaking\tuse\tof\tHTTP,\tI\thave\tseen\tthis\tdone\twith\tboth\tversion\nnumbers\tin\trequest\theaders\tand\talso\tin\tthe\tURI\titself\t—\tfor\texample,\t "),a("em",[t._v("/v1/customer/")]),t._v(" \tor\n"),a("em",[t._v("/v2/customer/")]),t._v(" .\tI’m\ttorn\tas\tto\twhich\tapproach\tmakes\tthe\tmost\tsense.\tOn\tthe\tone\thand,\tI\nlike\tURIs\tbeing\topaque\tto\tdiscourage\tclients\tfrom\thardcoding\tURI\ttemplates,\tbut\ton\tthe\nother\thand,\tthis\tapproach\tdoes\tmake\tthings\tvery\tobvious\tand\tcan\tsimplify\trequest\trouting.")]),t._v(" "),a("p",[t._v("For\tRPC,\tthings\tcan\tbe\ta\tlittle\ttrickier.\tI\thave\thandled\tthis\twith\tprotocol\tbuffers\tby\tputting\nmy\tmethods\tin\tdifferent\tnamespaces\t—\tfor\texample,\tv1.createCustomer\tand\nv2.createCustomer\t—\tbut\twhen\tyou\tare\ttrying\tto\tsupport\tdifferent\tversions\tof\tthe\tsame\ntypes\tbeing\tsent\tover\tthe\tnetwork,\tthis\tcan\tbecome\treally\tpainful.")]),t._v(" "),a("h2",{attrs:{id:"usemultipleconcurrentserviceversions"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#usemultipleconcurrentserviceversions"}},[t._v("#")]),t._v(" Use\tMultiple\tConcurrent\tService\tVersions")]),t._v(" "),a("p",[t._v("Another\tversioning\tsolution\toften\tcited\tis\tto\thave\tdifferent\tversions\tof\tthe\tservice\tlive\tat\nonce,\tand\tfor\tolder\tconsumers\tto\troute\ttheir\ttraffic\tto\tthe\tolder\tversion,\twith\tnewer\nversions\tseeing\tthe\tnew\tone,\tas\tshown\tin\tFigure\t4-6.\tThis\tis\tthe\tapproach\tused\tsparingly\nby\tNetflix\tin\tsituations\twhere\tthe\tcost\tof\tchanging\tolder\tconsumers\tis\ttoo\thigh,\tespecially\nin\trare\tcases\twhere\tlegacy\tdevices\tare\tstill\ttied\tto\tolder\tversions\tof\tthe\tAPI.\tPersonally,\tI\nam\tnot\ta\tfan\tof\tthis\tidea,\tand\tunderstand\twhy\tNetflix\tuses\tit\trarely.\tFirst,\tif\tI\tneed\tto\tfix\tan\ninternal\tbug\tin\tmy\tservice,\tI\tnow\thave\tto\tfix\tand\tdeploy\ttwo\tdifferent\tsets\tof\tservices.\nThis\twould\tprobably\tmean\tI\thave\tto\tbranch\tthe\tcodebase\tfor\tmy\tservice,\tand\tthis\tis\nalways\tproblematic.\tSecond,\tit\tmeans\tI\tneed\tsmarts\tto\thandle\tdirecting\tconsumers\tto\tthe\nright\tmicroservice.\tThis\tbehavior\tinevitably\tends\tup\tsitting\tin\tmiddleware\tsomewhere\tor\ta\nbunch\tof\tnginx\tscripts,\tmaking\tit\tharder\tto\treason\tabout\tthe\tbehavior\tof\tthe\tsystem.\nFinally,\tconsider\tany\tpersistent\tstate\tour\tservice\tmight\tmanage.\tCustomers\tcreated\tby\neither\tversion\tof\tthe\tservice\tneed\tto\tbe\tstored\tand\tmade\tvisible\tto\tall\tservices,\tno\tmatter\nwhich\tversion\twas\tused\tto\tcreate\tthe\tdata\tin\tthe\tfirst\tplace.\tThis\tcan\tbe\tan\tadditional\nsource\tof\tcomplexity.")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("Figure\t4-6.\tRunning\tmultiple\tversions\tof\tthe\tsame\tservice\tto\tsupport\told\tendpoints\n")])])]),a("p",[t._v("Coexisting\tconcurrent\tservice\tversions\tfor\ta\tshort\tperiod\tof\ttime\tcan\tmake\tperfect\tsense,\nespecially\twhen\tyou’re\tdoing\tthings\tlike\tblue/green\tdeployments\tor\tcanary\treleases\t(we’ll\nbe\tdiscussing\tthese\tpatterns\tmore\tin\tChapter\t7).\tIn\tthese\tsituations,\twe\tmay\tbe\tcoexisting\nversions\tonly\tfor\ta\tfew\tminutes\tor\tperhaps\thours,\tand\tnormally\twill\thave\tonly\ttwo\ndifferent\tversions\tof\tthe\tservice\tpresent\tat\tthe\tsame\ttime.\tThe\tlonger\tit\ttakes\tfor\tyou\tto\tget\nconsumers\tupgraded\tto\tthe\tnewer\tversion\tand\treleased,\tthe\tmore\tyou\tshould\tlook\tto\ncoexist\tdifferent\tendpoints\tin\tthe\tsame\tmicroservice\trather\tthan\tcoexist\tentirely\tdifferent\nversions.\tI\tremain\tunconvinced\tthat\tthis\twork\tis\tworthwhile\tfor\tthe\taverage\tproject.")]),t._v(" "),a("h2",{attrs:{id:"userinterfaces"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#userinterfaces"}},[t._v("#")]),t._v(" User\tInterfaces")]),t._v(" "),a("p",[t._v("So\tfar,\twe\thaven’t\treally\ttouched\ton\tthe\tworld\tof\tthe\tuser\tinterface.\tA\tfew\tof\tyou\tout\tthere\nmight\tjust\tbe\tproviding\ta\tcold,\thard,\tclinical\tAPI\tto\tyour\tcustomers,\tbut\tmany\tof\tus\tfind\nourselves\twanting\tto\tcreate\tbeautiful,\tfunctional\tuser\tinterfaces\tthat\twill\tdelight\tour\ncustomers.\tBut\twe\treally\tdo\tneed\tto\tthink\tabout\tthem\tin\tthe\tcontext\tof\tintegration.\tThe\nuser\tinterface,\tafter\tall,\tis\twhere\twe’ll\tbe\tpulling\tall\tthese\tmicroservices\ttogether\tinto\nsomething\tthat\tmakes\tsense\tto\tour\tcustomers.")]),t._v(" "),a("p",[t._v("In\tthe\tpast,\twhen\tI\tfirst\tstarted\tcomputing,\twe\twere\tmostly\ttalking\tabout\tbig,\tfat\tclients\nthat\tran\ton\tour\tdesktops.\tI\tspent\tmany\thours\twith\tMotif\tand\tthen\tSwing\ttrying\tto\tmake\nmy\tsoftware\tas\tnice\tto\tuse\tas\tpossible.\tOften\tthese\tsystems\twere\tjust\tfor\tthe\tcreation\tand\nmanipulation\tof\tlocal\tfiles,\tbut\tmany\tof\tthem\thad\ta\tserver-side\tcomponent.\tMy\tfirst\tjob\tat\nThoughtWorks\tinvolved\tcreating\ta\tSwing-based\telectronic\tpoint-of-sale\tsystem\tthat\twas\njust\tpart\tof\ta\tlarge\tnumber\tof\tmoving\tparts,\tmost\tof\twhich\twere\ton\tthe\tserver.")]),t._v(" "),a("p",[t._v("Then\tcame\tthe\tWeb.\tWe\tstarted\tthinking\tof\tour\tUIs\tas\tbeing\t "),a("em",[t._v("thin")]),t._v(" \tinstead,\twith\tmore\tlogic\non\tthe\tserver\tside.\tIn\tthe\tbeginning,\tour\tserver-side\tprograms\trendered\tthe\tentire\tpage\tand\nsent\tit\tto\tthe\tclient\tbrowser,\twhich\tdid\tvery\tlittle.\tAny\tinteractions\twere\thandled\ton\tthe\nserver\tside,\tvia\tGETs\tand\tPOSTs\ttriggered\tby\tthe\tuser\tclicking\ton\tlinks\tor\tfilling\tin\tforms.\nOver\ttime,\tJavaScript\tbecame\ta\tmore\tpopular\toption\tto\tadd\tdynamic\tbehavior\tto\tthe\nbrowser-based\tUI,\tand\tsome\tapplications\tcould\tnow\tbe\targued\tto\tbe\tas\t "),a("em",[t._v("fat")]),t._v(" \tas\tthe\told\ndesktop\tclients.")]),t._v(" "),a("h2",{attrs:{id:"towarddigital"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#towarddigital"}},[t._v("#")]),t._v(" Toward\tDigital")]),t._v(" "),a("p",[t._v("Over\tthe\tlast\tcouple\tof\tyears,\torganizations\thave\tstarted\tto\tmove\taway\tfrom\tthinking\tthat\nweb\tor\tmobile\tshould\tbe\ttreated\tdifferently;\tthey\tare\tinstead\tthinking\tabout\tdigital\tmore\nholistically.\tWhat\tis\tthe\tbest\tway\tfor\tour\tcustomers\tto\tuse\tthe\tservices\twe\toffer?\tAnd\twhat\ndoes\tthat\tdo\tto\tour\tsystem\tarchitecture?\tThe\tunderstanding\tthat\twe\tcannot\tpredict\texactly\nhow\ta\tcustomer\tmight\tend\tup\tinteracting\twith\tour\tcompany\thas\tdriven\tadoption\tof\tmore\ngranular\tAPIs,\tlike\tthose\tdelivered\tby\tmicroservices.\tBy\tcombining\tthe\tcapabilities\tour\nservices\texpose\tin\tdifferent\tways,\twe\tcan\tcurate\tdifferent\texperiences\tfor\tour\tcustomers\non\ttheir\tdesktop\tapplication,\tmobile\tdevice,\twearable\tdevice,\tor\teven\tin\tphysical\tform\tif\nthey\tvisit\tour\tbrick-and-mortar\tstore.")]),t._v(" "),a("p",[t._v("So\tthink\tof\tuser\tinterfaces\tas\tcompositional\tlayers\t—\tplaces\twhere\twe\tweave\ttogether\tthe\nvarious\tstrands\tof\tthe\tcapabilities\twe\toffer.\tSo\twith\tthat\tin\tmind,\thow\tdo\twe\tpull\tall\tthese\nstrands\ttogether?")]),t._v(" "),a("h2",{attrs:{id:"constraints"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#constraints"}},[t._v("#")]),t._v(" Constraints")]),t._v(" "),a("p",[t._v("Constraints\tare\tthe\tdifferent\tforms\tin\twhich\tour\tusers\tinteract\twith\tour\tsystem.\tOn\ta\ndesktop\tweb\tapplication,\tfor\texample,\twe\tconsider\tconstraints\tsuch\tas\twhat\tbrowser\nvisitors\tare\tusing,\tor\ttheir\tresolution.\tBut\tmobile\thas\tbrought\ta\twhole\thost\tof\tnew\nconstraints.\tThe\tway\tour\tmobile\tapplications\tcommunicate\twith\tthe\tserver\tcan\thave\tan\nimpact.\tIt\tisn’t\tjust\tabout\tpure\tbandwidth\tconcerns,\twhere\tthe\tlimitations\tof\tmobile\nnetworks\tcan\tplay\ta\tpart.\tDifferent\tsorts\tof\tinteractions\tcan\tdrain\tbattery\tlife,\tleading\tto\nsome\tcross\tcustomers.")]),t._v(" "),a("p",[t._v("The\tnature\tof\tinteractions\tchanges,\ttoo.\tI\tcan’t\teasily\tright-click\ton\ta\ttablet.\tOn\ta\tmobile\nphone,\tI\tmay\twant\tto\tdesign\tmy\tinterface\tto\tbe\tused\tmostly\tone-handed,\twith\tmost\noperations\tbeing\tcontrolled\tby\ta\tthumb.\tElsewhere,\tI\tmight\tallow\tpeople\tto\tinteract\twith\nservices\tvia\tSMS\tin\tplaces\twhere\tbandwidth\tis\tat\ta\tpremium\t—\tthe\tuse\tof\tSMS\tas\tan\ninterface\tis\thuge\tin\tthe\tglobal\tsouth,\tfor\texample.")]),t._v(" "),a("p",[t._v("So,\talthough\tour\tcore\tservices\t—\tour\tcore\toffering\t—\tmight\tbe\tthe\tsame,\twe\tneed\ta\tway\nto\tadapt\tthem\tfor\tthe\tdifferent\tconstraints\tthat\texist\tfor\teach\ttype\tof\tinterface.\tWhen\twe\nlook\tat\tdifferent\tstyles\tof\tuser\tinterface\tcomposition,\twe\tneed\tto\tensure\tthat\tthey\taddress\nthis\tchallenge.\tLet’s\tlook\tat\ta\tfew\tmodels\tof\tuser\tinterfaces\tto\tsee\thow\tthis\tmight\tbe\nachieved.")]),t._v(" "),a("h2",{attrs:{id:"apicomposition"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#apicomposition"}},[t._v("#")]),t._v(" API\tComposition")]),t._v(" "),a("p",[t._v("Assuming\tthat\tour\tservices\talready\tspeak\tXML\tor\tJSON\tto\teach\tother\tvia\tHTTP,\tan\nobvious\toption\tavailable\tto\tus\tis\tto\thave\tour\tuser\tinterface\tinteract\tdirectly\twith\tthese\nAPIs,\tas\tin\tFigure\t4-7.\tA\tweb-based\tUI\tcould\tuse\tJavaScript\tGET\trequests\tto\tretrieve\ndata,\tor\tPOST\trequests\tto\tchange\tit.\tEven\tfor\tnative\tmobile\tapplications,\tinitiating\tHTTP\ncommunications\tis\tfairly\tstraightforward.\tThe\tUI\twould\tthen\tneed\tto\tcreate\tthe\tvarious\ncomponents\tthat\tmake\tup\tthe\tinterface,\thandling\tsynchronization\tof\tstate\tand\tthe\tlike\twith\nthe\tserver.\tIf\twe\twere\tusing\ta\tbinary\tprotocol\tfor\tservice-to-service\tcommunication,\tthis\nwould\tbe\tmore\tdifficult\tfor\tweb-based\tclients,\tbut\tcould\tbe\tfine\tfor\tnative\tmobile\tdevices.")]),t._v(" "),a("p",[t._v("There\tare\ta\tcouple\tof\tdownsides\twith\tthis\tapproach.\tFirst,\twe\thave\tlittle\tability\tto\ttailor\nthe\tresponses\tfor\tdifferent\tsorts\tof\tdevices.\tFor\texample,\twhen\tI\tretrieve\ta\tcustomer\nrecord,\tdo\tI\tneed\tto\tpull\tback\tall\tthe\tsame\tdata\tfor\ta\tmobile\tshop\tas\tI\tdo\tfor\ta\thelpdesk\napplication?\tOne\tsolution\tto\tthis\tapproach\tis\tto\tallow\tconsumers\tto\tspecify\twhat\tfields\tto\npull\tback\twhen\tthey\tmake\ta\trequest,\tbut\tthis\tassumes\tthat\teach\tservice\tsupports\tthis\tform\nof\tinteraction.")]),t._v(" "),a("p",[t._v("Another\tkey\tquestion:\twho\tcreates\tthe\tuser\tinterface?\tThe\tpeople\twho\tlook\tafter\tthe\nservices\tare\tremoved\tfrom\thow\ttheir\tservices\tare\tsurfaced\tto\tthe\tusers\t—\tfor\texample,\tif\nanother\tteam\tis\tcreating\tthe\tUI,\twe\tcould\tbe\tdrifting\tback\tinto\tthe\tbad\told\tdays\tof\tlayered\narchitecture\twhere\tmaking\teven\tsmall\tchanges\trequires\tchange\trequests\tto\tmultiple\tteams.")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("Figure\t4-7.\tUsing\tmultiple\tAPIs\tto\tpresent\ta\tuser\tinterface\n")])])]),a("p",[t._v("This\tcommunication\tcould\talso\tbe\tfairly\tchatty.\tOpening\tlots\tof\tcalls\tdirectly\tto\tservices\ncan\tbe\tquite\tintensive\tfor\tmobile\tdevices,\tand\tcould\tbe\ta\tvery\tinefficient\tuse\tof\ta\ncustomer’s\tmobile\tplan!\tHaving\tan\tAPI\tgateway\tcan\thelp\there,\tas\tyou\tcould\texpose\tcalls\nthat\taggregate\tmultiple\tunderlying\tcalls,\talthough\tthat\titself\tcan\thave\tsome\tdownsides\tthat\nwe’ll\texplore\tshortly.")]),t._v(" "),a("h2",{attrs:{id:"uifragmentcomposition"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#uifragmentcomposition"}},[t._v("#")]),t._v(" UI\tFragment\tComposition")]),t._v(" "),a("p",[t._v("Rather\tthan\thaving\tour\tUI\tmake\tAPI\tcalls\tand\tmap\teverything\tback\tto\tUI\tcontrols,\twe\ncould\thave\tour\tservices\tprovide\tparts\tof\tthe\tUI\tdirectly,\tand\tthen\tjust\tpull\tthese\tfragments\nin\tto\tcreate\ta\tUI,\tas\tin\tFigure\t4-8.\tImagine,\tfor\texample,\tthat\tthe\trecommendation\tservice\nprovides\ta\trecommendation\twidget\tthat\tis\tcombined\twith\tother\tcontrols\tor\tUI\tfragments\nto\tcreate\tan\toverall\tUI.\tIt\tmight\tget\trendered\tas\ta\tbox\ton\ta\tweb\tpage\talong\twith\tother\ncontent.")]),t._v(" "),a("p",[t._v("A\tvariation\tof\tthis\tapproach\tthat\tcan\twork\twell\tis\tto\tassemble\ta\tseries\tof\tcoarser-grained\nparts\tof\ta\tUI.\tSo\trather\tthan\tcreating\tsmall\twidgets,\tyou\tare\tassembling\tentire\tpanes\tof\ta\nthick\tclient\tapplication,\tor\tperhaps\ta\tset\tof\tpages\tfor\ta\twebsite.")]),t._v(" "),a("p",[t._v("These\tcoarser-grained\tfragments\tare\tserved\tup\tfrom\tserver-side\tapps\tthat\tare\tin\tturn\nmaking\tthe\tappropriate\tAPI\tcalls.\tThis\tmodel\tworks\tbest\twhen\tthe\tfragments\talign\twell\tto\nteam\townership.\tFor\texample,\tperhaps\tthe\tteam\tthat\tlooks\tafter\torder\tmanagement\tin\tthe\nmusic\tshop\tserves\tup\tall\tthe\tpages\tassociated\twith\torder\tmanagement.")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("Figure\t4-8.\tServices\tdirectly\tserving\tup\tUI\tcomponents\tfor\tassembly\n")])])]),a("p",[t._v("You\tstill\tneed\tsome\tsort\tof\tassembly\tlayer\tto\tpull\tthese\tparts\ttogether.\tThis\tcould\tbe\tas\nsimple\tas\tsome\tserver-side\ttemplating,\tor,\twhere\teach\tset\tof\tpages\tcomes\tfrom\ta\tdifferent\napp,\tperhaps\tyou’ll\tneed\tsome\tsmart\tURI\trouting.")]),t._v(" "),a("p",[t._v("One\tof\tthe\tkey\tadvantages\tof\tthis\tapproach\tis\tthat\tthe\tsame\tteam\tthat\tmakes\tchanges\tto\nthe\tservices\tcan\talso\tbe\tin\tcharge\tof\tmaking\tchanges\tto\tthose\tparts\tof\tthe\tUI.\tIt\tallows\tus\nto\tget\tchanges\tout\tfaster.\tBut\tthere\tare\tsome\tproblems\twith\tthis\tapproach.")]),t._v(" "),a("p",[t._v("First,\tensuring\tconsistency\tof\tthe\tuser\texperience\tis\tsomething\twe\tneed\tto\taddress.\tUsers")]),t._v(" "),a("p",[t._v("want\tto\thave\ta\tseamless\texperience,\tnot\tto\tfeel\tthat\tdifferent\tparts\tof\tthe\tinterface\twork\tin\ndifferent\tways,\tor\tpresent\ta\tdifferent\tdesign\tlanguage.\tThere\tare\ttechniques\tto\tavoid\tthis\nproblem,\tthough,\tsuch\tas\tliving\tstyle\tguides,\twhere\tassets\tlike\tHTML\tcomponents,\tCSS,\nand\timages\tcan\tbe\tshared\tto\thelp\tgive\tsome\tlevel\tof\tconsistency.")]),t._v(" "),a("p",[t._v("Another\tprobem\tis\tharder\tto\tdeal\twith.\tWhat\thappens\twith\tnative\tapplications\tor\tthick\nclients?\tWe\tcan’t\tserve\tup\tUI\tcomponents.\tWe\tcould\tuse\ta\thybrid\tapproach\tand\tuse\tnative\napplications\tto\tserve\tup\tHTML\tcomponents,\tbut\tthis\tapproach\thas\tbeen\tshown\ttime\tand\nagain\tto\thave\tdownsides.\tSo\tif\tyou\tneed\ta\tnative\texperience,\twe\twill\thave\tto\tfall\tback\tto\nan\tapproach\twhere\tthe\tfrontend\tapplication\tmakes\tAPI\tcalls\tand\thandles\tthe\tUI\titself.\tBut\neven\tif\twe\tconsider\tweb-only\tUIs,\twe\tstill\tmay\twant\tvery\tdifferent\ttreatments\tfor\tdifferent\ntypes\tof\tdevices.\tBuilding\tresponsive\tcomponents\tcan\thelp,\tof\tcourse.")]),t._v(" "),a("p",[t._v("There\tis\tone\tkey\tproblem\twith\tthis\tapproach\tthat\tI’m\tnot\tsure\tcan\tbe\tsolved.\tSometimes\nthe\tcapabilities\toffered\tby\ta\tservice\tdo\tnot\tfit\tneatly\tinto\ta\twidget\tor\ta\tpage.\tSure,\tI\tmight\nwant\tto\tsurface\trecommendations\tin\ta\tbox\ton\ta\tpage\ton\tour\twebsite,\tbut\twhat\tif\tI\twant\tto\nweave\tin\tdynamic\trecommendations\telsewhere?\tWhen\tI\tsearch,\tI\twant\tthe\ttype\tahead\tto\nautomatically\ttrigger\tfresh\trecommendations,\tfor\texample.\tThe\tmore\tcross-cutting\ta\tform\nof\tinteraction\tis,\tthe\tless\tlikely\tthis\tmodel\twill\tfit\tand\tthe\tmore\tlikely\tit\tis\tthat\twe’ll\tfall\nback\tto\tjust\tmaking\tAPI\tcalls.")]),t._v(" "),a("h2",{attrs:{id:"backendsforfrontends"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#backendsforfrontends"}},[t._v("#")]),t._v(" Backends\tfor\tFrontends")]),t._v(" "),a("p",[t._v("A\tcommon\tsolution\tto\tthe\tproblem\tof\tchatty\tinterfaces\twith\tbackend\tservices,\tor\tthe\tneed\nto\tvary\tcontent\tfor\tdifferent\ttypes\tof\tdevices,\tis\tto\thave\ta\tserver-side\taggregation\nendpoint,\tor\tAPI\tgateway.\tThis\tcan\tmarshal\tmultiple\tbackend\tcalls,\tvary\tand\taggregate\ncontent\tif\tneeded\tfor\tdifferent\tdevices,\tand\tserve\tit\tup,\tas\twe\tsee\tin\tFigure\t4-9.\tI’ve\tseen\nthis\tapproach\tlead\tto\tdisaster\twhen\tthese\tserver-side\tendpoints\tbecome\tthick\tlayers\twith\ntoo\tmuch\tbehavior.\tThey\tend\tup\tgetting\tmanaged\tby\tseparate\tteams,\tand\tbeing\tanother\nplace\twhere\tlogic\thas\tto\tchange\twhenever\tsome\tfunctionality\tchanges.")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("Figure\t4-9.\tUsing\ta\tsingle\tmonolithic\tgateway\tto\thandle\tcalls\tto/from\tUIs\n")])])]),a("p",[t._v("The\tproblem\tthat\tcan\toccur\tis\tthat\tnormally\twe’ll\thave\tone\tgiant\tlayer\tfor\tall\tour\tservices.\nThis\tleads\tto\teverything\tbeing\tthrown\tin\ttogether,\tand\tsuddenly\twe\tstart\tto\tlose\tisolation\nof\tour\tvarious\tuser\tinterfaces,\tlimiting\tour\tability\tto\trelease\tthem\tindependently.\tA\tmodel\nI\tprefer\tand\tthat\tI’ve\tseen\twork\twell\tis\tto\trestrict\tthe\tuse\tof\tthese\tbackends\tto\tone\tspecific\nuser\tinterface\tor\tapplication,\tas\twe\tsee\tin\tFigure\t4-10.")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("Figure\t4-10.\tUsing\tdedicated\tbackends\tfor\tfrontends\n")])])]),a("p",[t._v("This\tpattern\tis\tsometimes\treferred\tto\tas\t "),a("em",[t._v("backends\tfor\tfrontends\t(BFFs)")]),t._v(" .\tIt\tallows\tthe\tteam\nfocusing\ton\tany\tgiven\tUI\tto\talso\thandle\tits\town\tserver-side\tcomponents.\tYou\tcan\tsee\nthese\tbackends\tas\tparts\tof\tthe\tuser\tinterface\tthat\thappen\tto\tbe\tembedded\tin\tthe\tserver.\nSome\ttypes\tof\tUI\tmay\tneed\ta\tminimal\tserver-side\tfootprint,\twhile\tothers\tmay\tneed\ta\tlot\nmore.\tIf\tyou\tneed\tan\tAPI\tauthentication\tand\tauthorization\tlayer,\tthis\tcan\tsit\tbetween\tour\nBFFs\tand\tour\tUIs.\tWe’ll\texplore\tthis\tmore\tin\tChapter\t9.")]),t._v(" "),a("p",[t._v("The\tdanger\twith\tthis\tapproach\tis\tthe\tsame\tas\twith\tany\taggregating\tlayer;\tit\tcan\ttake\ton\nlogic\tit\tshouldn’t.\tThe\tbusiness\tlogic\tfor\tthe\tvarious\tcapabilities\tthese\tbackends\tuse\nshould\tstay\tin\tthe\tservices\tthemselves.\tThese\tBFFs\tshould\tonly\tcontain\tbehavior\tspecific\nto\tdelivering\ta\tparticular\tuser\texperience.")]),t._v(" "),a("h2",{attrs:{id:"ahybridapproach"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ahybridapproach"}},[t._v("#")]),t._v(" A\tHybrid\tApproach")]),t._v(" "),a("p",[t._v("Many\tof\tthe\taforementioned\toptions\tdon’t\tneed\tto\tbe\tone-size-fits-all.\tI\tcould\tsee\tan\norganization\tadopting\tthe\tapproach\tof\tfragment-based\tassembly\tto\tcreate\ta\twebsite,\tbut\nusing\ta\tbackends-for-frontends\tapproach\twhen\tit\tcomes\tto\tits\tmobile\tapplication.\tThe\tkey\npoint\tis\tthat\twe\tneed\tto\tretain\tcohesion\tof\tthe\tunderlying\tcapabilities\tthat\twe\toffer\tour\nusers.\tWe\tneed\tto\tensure\tthat\tlogic\tassociated\twith\tordering\tmusic\tor\tchanging\tcustomer\ndetails\tlives\tinside\tthose\tservices\tthat\thandle\tthose\toperations,\tand\tdoesn’t\tget\tsmeared\tall\nover\tour\tsystem.\tAvoiding\tthe\ttrap\tof\tputting\ttoo\tmuch\tbehavior\tinto\tany\tintermediate\nlayers\tis\ta\ttricky\tbalancing\tact.")]),t._v(" "),a("h2",{attrs:{id:"integratingwiththird-partysoftware"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#integratingwiththird-partysoftware"}},[t._v("#")]),t._v(" Integrating\twith\tThird-Party\tSoftware")]),t._v(" "),a("p",[t._v("We’ve\tlooked\tat\tapproaches\tto\tbreaking\tapart\texisting\tsystems\tthat\tare\tunder\tour\tcontrol,\nbut\twhat\tabout\twhen\twe\tcan’t\tchange\tthe\tthings\twe\ttalk\tto?\tFor\tmany\tvalid\treasons,\tthe\norganizations\twe\twork\tfor\tbuy\tcommercial\toff-the-shelf\tsoftware\t(COTS)\tor\tmake\tuse\tof\nsoftware\tas\ta\tservice\t(SaaS)\tofferings\tover\twhich\twe\thave\tlittle\tcontrol.\tSo\thow\tdo\twe\nintegrate\twith\tthem\tsensibly?")]),t._v(" "),a("p",[t._v("If\tyou’re\treading\tthis\tbook,\tyou\tprobably\twork\tat\tan\torganization\tthat\twrites\tcode.\tYou\nmight\twrite\tsoftware\tfor\tyour\town\tinternal\tpurposes\tor\tfor\tan\texternal\tclient,\tor\tboth.\nNonetheless,\teven\tif\tyou\tare\tan\torganization\twith\tthe\tability\tto\tcreate\ta\tsignificant\tamount\nof\tcustom\tsoftware,\tyou’ll\tstill\tuse\tsoftware\tproducts\tprovided\tby\texternal\tparties,\tbe\tthey\ncommercial\tor\topen\tsource.\tWhy\tis\tthis?")]),t._v(" "),a("p",[t._v("First,\tyour\torganization\talmost\tcertainly\thas\ta\tgreater\tdemand\tfor\tsoftware\tthan\tcan\tbe\nsatisfied\tinternally.\tThink\tof\tall\tthe\tproducts\tyou\tuse,\tfrom\toffice\tproductivity\ttools\tlike\nExcel\tto\toperating\tsystems\tto\tpayroll\tsystems.\tCreating\tall\tof\tthose\tfor\tyour\town\tuse\nwould\tbe\ta\tmammoth\tundertaking.\tSecond,\tand\tmost\timportant,\tit\twouldn’t\tbe\tcost\neffective!\tThe\tcost\tfor\tyou\tto\tbuild\tyour\town\temail\tsystem,\tfor\texample,\tis\tlikely\tto\tdwarf\nthe\tcost\tof\tusing\tan\texisting\tcombination\tof\tmail\tserver\tand\tclient,\teven\tif\tyou\tgo\tfor\ncommercial\toptions.")]),t._v(" "),a("p",[t._v("My\tclients\toften\tstruggle\twith\tthe\tquestion\t“Should\tI\tbuild,\tor\tshould\tI\tbuy?”\tIn\tgeneral,\nthe\tadvice\tI\tand\tmy\tcolleagues\tgive\twhen\thaving\tthis\tconversation\twith\tthe\taverage\nenterprise\torganization\tboils\tdown\tto\t“Build\tif\tit\tis\tunique\tto\twhat\tyou\tdo,\tand\tcan\tbe\nconsidered\ta\tstrategic\tasset;\tbuy\tif\tyour\tuse\tof\tthe\ttool\tisn’t\tthat\tspecial.”")]),t._v(" "),a("p",[t._v("For\texample,\tthe\taverage\torganization\twould\tnot\tconsider\tits\tpayroll\tsystem\tto\tbe\ta\nstrategic\tasset.\tPeople\ton\tthe\twhole\tget\tpaid\tthe\tsame\tthe\tworld\tover.\tLikewise,\tmost\norganizations\ttend\tto\tbuy\tcontent\tmanagement\tsystems\t(CMSes)\toff\tthe\tshelf,\tas\ttheir\tuse\nof\tsuch\ta\ttool\tisn’t\tconsidered\tsomething\tthat\tis\tkey\tto\ttheir\tbusiness.\tOn\tthe\tother\thand,\tI\nwas\tinvolved\tearly\ton\tin\trebuilding\tthe\t "),a("em",[t._v("Guardian’s")]),t._v(" \twebsite,\tand\tthere\tthe\tdecision\twas\nmade\tto\tbuild\ta\tbespoke\tcontent\tmanagement\tsystem,\tas\tit\twas\tcore\tto\tthe\tnewspaper’s\nbusiness.")]),t._v(" "),a("p",[t._v("So\tthe\tnotion\tthat\twe\twill\toccasionally\tencounter\tcommercial,\tthird-party\tsoftware\tis\nsensible,\tand\tto\tbe\twelcomed.\tHowever,\tmany\tof\tus\tend\tup\tcursing\tsome\tof\tthese\nsystems.\tWhy\tis\tthat?")]),t._v(" "),a("h2",{attrs:{id:"lackofcontrol"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#lackofcontrol"}},[t._v("#")]),t._v(" Lack\tof\tControl")]),t._v(" "),a("p",[t._v("One\tchallenge\tassociated\twith\tintegrating\twith\tand\textending\tthe\tcapabilities\tof\tCOTS\nproducts\tlike\tCMS\tor\tSaaS\ttools\tis\tthat\ttypically\tmany\tof\tthe\ttechnical\tdecisions\thave\nbeen\tmade\tfor\tyou.\tHow\tdo\tyou\tintegrate\twith\tthe\ttool?\tThat’s\ta\tvendor\tdecision.\tWhich\nprogramming\tlanguage\tcan\tyou\tuse\tto\textend\tthe\ttool?\tUp\tto\tthe\tvendor.\tCan\tyou\tstore\nthe\tconfiguration\tfor\tthe\ttool\tin\tversion\tcontrol,\tand\trebuild\tfrom\tscratch,\tso\tas\tto\tenable\ncontinuous\tintegration\tof\tcustomizations?\tIt\tdepends\ton\tchoices\tthe\tvendor\tmakes.")]),t._v(" "),a("p",[t._v("If\tyou\tare\tlucky,\thow\teasy\t—\tor\thard\t—\tit\tis\tto\twork\twith\tthe\ttool\tfrom\ta\tdevelopment\npoint\tof\tview\thas\tbeen\tconsidered\tas\tpart\tof\tthe\ttool\tselection\tprocess.\tBut\teven\tthen,\tyou\nare\teffectively\tceding\tsome\tlevel\tof\tcontrol\tto\tan\toutside\tparty.\tThe\ttrick\tis\tto\tbring\tthe\nintegration\tand\tcustomization\twork\tback\ton\tto\tyour\tterms.")]),t._v(" "),a("h2",{attrs:{id:"customization"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#customization"}},[t._v("#")]),t._v(" Customization")]),t._v(" "),a("p",[t._v("Many\ttools\tthat\tenterprise\torganizations\tpurchase\tsell\tthemselves\ton\ttheir\tability\tto\tbe\nheavily\tcustomized\t "),a("em",[t._v("just\tfor\tyou")]),t._v(" .\tBeware!\tOften,\tdue\tto\tthe\tnature\tof\tthe\ttool\tchain\tyou\nhave\taccess\tto,\tthe\tcost\tof\tcustomization\tcan\tbe\tmore\texpensive\tthan\tbuilding\tsomething\nbespoke\tfrom\tscratch!\tIf\tyou’ve\tdecided\tto\tbuy\ta\tproduct\tbut\tthe\tparticular\tcapabilities\tit\nprovides\taren’t\tthat\tspecial\tto\tyou,\tit\tmight\tmake\tmore\tsense\tto\tchange\thow\tyour\norganization\tworks\trather\tthan\tembark\ton\tcomplex\tcustomization.")]),t._v(" "),a("p",[t._v("Content\tmanagement\tsystems\tare\ta\tgreat\texample\tof\tthis\tdanger.\tI\thave\tworked\twith\nmultiple\tCMSes\tthat\tby\tdesign\tdo\tnot\tsupport\tcontinuous\tintegration,\tthat\thave\tterrible\nAPIs,\tand\tfor\twhich\teven\ta\tminor-point\tupgrade\tin\tthe\tunderlying\ttool\tcan\tbreak\tany\ncustomizations\tyou\thave\tmade.")]),t._v(" "),a("p",[t._v("Salesforce\tis\tespecially\ttroublesome\tin\tthis\tregard.\tFor\tmany\tyears\tit\thas\tpushed\tits\nForce.com\tplatform,\twhich\trequires\tthe\tuse\tof\ta\tprogramming\tlanguage,\tApex,\tthat\texists\nonly\twithin\tthe\tForce.com\tecosystem!")]),t._v(" "),a("h2",{attrs:{id:"integrationspaghetti"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#integrationspaghetti"}},[t._v("#")]),t._v(" Integration\tSpaghetti")]),t._v(" "),a("p",[t._v("Another\tchallenge\tis\thow\tyou\tintegrate\twith\tthe\ttool.\tAs\twe\tdiscussed\tearlier,\tthinking\ncarefully\tabout\thow\tyou\tintegrate\tbetween\tservices\tis\timportant,\tand\tideally\tyou\twant\tto\nstandardize\ton\ta\tsmall\tnumber\tof\ttypes\tof\tintegration.\tBut\tif\tone\tproduct\tdecides\tto\tuse\ta\nproprietary\tbinary\tprotocol,\tanother\tsome\tflavor\tof\tSOAP,\tand\tanother\tXML-RPC,\twhat\nare\tyou\tleft\twith?\tEven\tworse\tare\tthe\ttools\tthat\tallow\tyou\tto\treach\tright\tinside\ttheir\nunderlying\tdata\tstores,\tleading\tto\tall\tthe\tsame\tcoupling\tissues\twe\tdiscussed\tearlier.")]),t._v(" "),a("h2",{attrs:{id:"onyourownterms"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#onyourownterms"}},[t._v("#")]),t._v(" On\tYour\tOwn\tTerms")]),t._v(" "),a("p",[t._v("COTS\tand\tSAAS\tproducts\tabsolutely\thave\ttheir\tplace,\tand\tit\tisn’t\tfeasible\t(or\tsensible)\nfor\tmost\tof\tus\tto\tbuild\teverything\tfrom\tscratch.\tSo\thow\tdo\twe\tresolve\tthese\tchallenges?\nThe\tkey\tis\tto\tmove\tthings\tback\ton\tto\tyour\town\tterms.")]),t._v(" "),a("p",[t._v("The\tcore\tidea\there\tis\tto\tdo\tany\tcustomizations\ton\ta\tplatform\tyou\tcontrol,\tand\tto\tlimit\tthe\nnumber\tof\tdifferent\tconsumers\tof\tthe\ttool\titself.\tTo\texplore\tthis\tidea\tin\tdetail,\tlet’s\tlook\tat\na\tcouple\tof\texamples.")]),t._v(" "),a("p",[a("strong",[t._v("Example:\tCMS\tas\ta\tservice")])]),t._v(" "),a("p",[t._v("In\tmy\texperience,\tthe\tCMS\tis\tone\tof\tthe\tmost\tcommonly\tused\tproduct\tthat\tneeds\tto\tbe\ncustomized\tor\tintegrated\twith.\tThe\treason\tfor\tthis\tis\tthat\tunless\tyou\twant\ta\tbasic\tstatic\nsite,\tthe\taverage\tenterprise\torganization\twants\tto\tenrich\tthe\tfunctionality\tof\tits\twebsite\nwith\tdynamic\tcontent\tlike\tcustomer\trecords\tor\tthe\tlatest\tproduct\tofferings.\tThe\tsource\tof\nthis\tdynamic\tcontent\tis\ttypically\tother\tservices\tinside\tthe\torganization,\twhich\tyou\tmay\nhave\tactually\tbuilt\tyourself.")]),t._v(" "),a("p",[t._v("The\ttemptation\t—\tand\toften\tthe\tselling\tpoint\tof\tthe\tCMS\t—\tis\tthat\tyou\tcan\tcustomize\tthe\nCMS\tto\tpull\tin\tall\tthis\tspecial\tcontent\tand\tdisplay\tit\tto\tthe\toutside\tworld.\tHowever,\tthe\ndevelopment\tenvironment\tfor\tthe\taverage\tCMS\tis\t "),a("em",[t._v("terrible")]),t._v(".")]),t._v(" "),a("p",[t._v("Let’s\tlook\tat\twhat\tthe\taverage\tCMS\tspecializes\tin,\tand\twhat\twe\tprobably\tbought\tit\tfor:\ncontent\tcreation\tand\tcontent\tmanagement.\tMost\tCMSes\tare\tpretty\tbad\teven\tat\tdoing\tpage\nlayout,\ttypically\tproviding\tdrag-and-drop\ttools\tthat\tdon’t\tcut\tthe\tmustard.\tAnd\teven\tthen,\nyou\tend\tup\tneeding\tto\thave\tsomeone\twho\tunderstands\tHTML\tand\tCSS\tto\tfine-tune\tthe\nCMS\ttemplates.\tThey\ttend\tto\tbe\tterrible\tplatforms\ton\twhich\tto\tbuild\tcustom\tcode.")]),t._v(" "),a("p",[t._v("The\tanswer?\tFront\tthe\tCMS\twith\tyour\town\tservice\tthat\tprovides\tthe\twebsite\tto\tthe\toutside\nworld,\tas\tshown\tin\tFigure\t4-11.\tTreat\tthe\tCMS\tas\ta\tservice\twhose\trole\tis\tto\tallow\tfor\tthe\ncreation\tand\tretrieval\tof\tcontent.\tIn\tyour\town\tservice,\tyou\twrite\tthe\tcode\tand\tintegrate\nwith\tservices\thow\tyou\twant.\tYou\thave\tcontrol\tover\tscaling\tthe\twebsite\t(many\tcommercial\nCMSes\tprovide\ttheir\town\tproprietary\tadd-ons\tto\thandle\tload),\tand\tyou\tcan\tpick\tthe\ntemplating\tsystem\tthat\tmakes\tsense.")]),t._v(" "),a("p",[t._v("Most\tCMSes\talso\tprovide\tAPIs\tto\tallow\tfor\tcontent\tcreation,\tso\tyou\talso\thave\tthe\tability\nto\tfront\tthat\twith\tyour\town\tservice\tfaçade.\tFor\tsome\tsituations,\twe’ve\teven\tused\tsuch\ta\nfaçade\tto\tabstract\tout\tthe\tAPIs\tfor\tretrieving\tcontent.")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("Figure\t4-11.\tHiding\ta\tCMS\tusing\tyour\town\tservice\n")])])]),a("p",[t._v("We’ve\tused\tthis\tpattern\tmultiple\ttimes\tacross\tThoughtWorks\tin\tthe\tlast\tfew\tyears,\tand\nI’ve\tdone\tthis\tmore\tthan\tonce\tmyself.\tOne\tnotable\texample\twas\ta\tclient\tthat\twas\tlooking\nto\tpush\tout\ta\tnew\twebsite\tfor\tits\tproducts.\tInitially,\tit\twanted\tto\tbuild\tthe\tentire\tsolution\non\tthe\tCMS,\tbut\tit\thad\tyet\tto\tpick\tone.\tWe\tinstead\tsuggested\tthis\tapproach,\tand\tstarted\ndevelopment\tof\tthe\tfronting\twebsite.\tWhile\twaiting\tfor\tthe\tCMS\ttool\tto\tbe\tselected,\twe\n"),a("em",[t._v("faked")]),t._v(" \tit\tby\thaving\ta\tweb\tservice\tthat\tjust\tsurfaced\tstatic\tcontent.\tWe\tended\tup\tgoing\tlive\nwith\tthe\tsite\twell\tbefore\tthe\tCMS\twas\tselected\tby\tusing\tour\tfake\tcontent\tservice\tin\nproduction\tto\tsurface\tcontent\tto\tthe\tlive\tsite.\tLater\ton,\twe\twere\table\tto\tjust\tdrop\tin\tthe\neventually\tselected\ttool\twithout\tany\tchange\tto\tthe\tfronting\tapplication.")]),t._v(" "),a("p",[t._v("Using\tthis\tapproach,\twe\tkeep\tthe\tscope\tof\twhat\tthe\tCMS\tdoes\tdown\tto\ta\tminimum\tand\nmove\tcustomizations\tonto\tour\town\ttechnology\tstack.")]),t._v(" "),a("p",[a("strong",[t._v("Example:\tThe\tmultirole\tCRM\tsystem")])]),t._v(" "),a("p",[t._v("The\tCRM\t—\tor\tCustomer\tRelationship\tManagement\t—\ttool\tis\tan\toften-encountered\tbeast\nthat\tcan\tinstill\tfear\tin\tthe\theart\tof\teven\tthe\thardiest\tarchitect.\tThis\tsector,\tas\ttypified\tby\nvendors\tlike\tSalesforce\tor\tSAP,\tis\trife\twith\texamples\tof\ttools\tthat\ttry\tto\tdo\teverything\tfor\nyou.\tThis\tcan\tlead\tto\tthe\ttool\titself\tbecoming\ta\tsingle\tpoint\tof\tfailure,\tand\ta\ttangled\tknot\nof\tdependencies.\tMany\timplementations\tof\tCRM\ttools\tI\thave\tseen\tare\tamong\tthe\tbest\nexamples\tof\t "),a("em",[t._v("adhesive")]),t._v(" \t(as\topposed\tto\tcohesive)\tservices.")]),t._v(" "),a("p",[t._v("The\tscope\tof\tsuch\ta\ttool\ttypically\tstarts\tsmall,\tbut\tover\ttime\tit\tbecomes\tan\tincreasingly\nimportant\tpart\tof\thow\tyour\torganization\tworks.\tThe\tproblem\tis\tthat\tthe\tdirection\tand\nchoices\tmade\taround\tthis\tnow-vital\tsystem\tare\toften\tmade\tby\tthe\ttool\tvendor\titself,\tnot\tby\nyou.")]),t._v(" "),a("p",[t._v("I\twas\tinvolved\trecently\tin\tan\texercise\tto\ttry\tto\twrest\tsome\tcontrol\tback.\tThe\torganization\nI\twas\tworking\twith\trealized\tthat\talthough\tit\twas\tusing\tthe\tCRM\ttool\tfor\ta\tlot\tof\tthings,\tit")]),t._v(" "),a("p",[t._v("wasn’t\tgetting\tthe\tvalue\tof\tthe\tincreasing\tcosts\tassociated\twith\tthe\tplatform.\tAt\tthe\tsame\ntime,\tmultiple\tinternal\tsystems\twere\tusing\tthe\tless-than-ideal\tCRM\tAPIs\tfor\tintegration.\nWe\twanted\tto\tmove\tthe\tsystem\tarchitecture\ttoward\ta\tplace\twhere\twe\thad\tservices\tthat\nmodeled\tour\tbusinesses\tdomain,\tand\talso\tlay\tthe\tgroundwork\tfor\ta\tpotential\tmigration.")]),t._v(" "),a("p",[t._v("The\tfirst\tthing\twe\tdid\twas\tidentify\tthe\tcore\tconcepts\tto\tour\tdomain\tthat\tthe\tCRM\tsystem\ncurrently\towned.\tOne\tof\tthese\twas\tthe\tconcept\tof\ta\t "),a("em",[t._v("project")]),t._v(" \t—\tthat\tis,\tsomething\tto\twhich\na\tmember\tof\tstaff\tcould\tbe\tassigned.\tMultiple\tother\tsystems\tneeded\tproject\tinformation.\nWhat\twe\tdid\twas\tinstead\tcreate\ta\tproject\tservice.\tThis\tservice\texposed\tprojects\tas\nRESTful\tresources,\tand\tthe\texternal\tsystems\tcould\tmove\ttheir\tintegration\tpoints\tover\tto\nthe\tnew,\teasier-to-work-with\tservice.\tInternally,\tthe\tproject\tservice\twas\tjust\ta\tfaçade,\nhiding\tthe\tdetail\tof\tthe\tunderlying\tintegration.\tYou\tcan\tsee\tthis\tin\tFigure\t4-12.")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("Figure\t4-12.\tUsing\tfaçade\tservices\tto\tmask\tthe\tunderlying\tCRM\n")])])]),a("p",[t._v("The\twork,\twhich\tat\tthe\ttime\tof\tthis\twriting\twas\tstill\tunder\tway,\twas\tto\tidentify\tother\ndomain\tconcepts\tthat\tthe\tCRM\twas\thandling,\tand\tcreate\tmore\tfaçades\tfor\tthem.\tWhen\tthe\ntime\tcomes\tfor\tmigration\taway\tfrom\tthe\tunderlying\tCRM,\twe\tcould\tthen\tlook\tat\teach\nfaçade\tin\tturn\tto\tdecide\tif\tan\tinternal\tsoftware\tsolution\tor\tsomething\toff\tthe\tshelf\tcould\tfit\nthe\tbill.")]),t._v(" "),a("h2",{attrs:{id:"thestranglerpattern"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#thestranglerpattern"}},[t._v("#")]),t._v(" The\tStrangler\tPattern")]),t._v(" "),a("p",[t._v("When\tit\tcomes\tto\tlegacy\tor\teven\tCOTS\tplatforms\tthat\taren’t\ttotally\tunder\tour\tcontrol,\twe\nalso\thave\tto\tdeal\twith\twhat\thappens\twhen\twe\twant\tto\tremove\tthem\tor\tat\tleast\tmove\taway\nfrom\tthem.\tA\tuseful\tpattern\there\tis\tthe\tStrangler\tApplication\tPattern.\tMuch\tlike\twith\tour\nexample\tof\tfronting\tthe\tCMS\tsystem\twith\tour\town\tcode,\twith\ta\tstrangler\tyou\tcapture\tand\nintercept\tcalls\tto\tthe\told\tsystem.\tThis\tallows\tyou\tto\tdecide\tif\tyou\troute\tthese\tcalls\tto\nexisting,\tlegacy\tcode,\tor\tdirect\tthem\tto\tnew\tcode\tyou\tmay\thave\twritten.\tThis\tallows\tyou\nto\treplace\tfunctionality\tover\ttime\twithout\trequiring\ta\tbig\tbang\trewrite.")]),t._v(" "),a("p",[t._v("When\tit\tcomes\tto\tmicroservices,\trather\tthan\thaving\ta\tsingle\tmonolithic\tapplication\nintercepting\tall\tcalls\tto\tthe\texisting\tlegacy\tsystem,\tyou\tmay\tinstead\tuse\ta\tseries\tof\nmicroservices\tto\tperform\tthis\tinterception.\tCapturing\tand\tredirecting\tthe\toriginal\tcalls\tcan\nbecome\tmore\tcomplex\tin\tthis\tsituation,\tand\tyou\tmay\trequire\tthe\tuse\tof\ta\tproxy\tto\tdo\tthis\nfor\tyou.")]),t._v(" "),a("h2",{attrs:{id:"summary-4"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#summary-4"}},[t._v("#")]),t._v(" Summary")]),t._v(" "),a("p",[t._v("We’ve\tlooked\tat\ta\tnumber\tof\tdifferent\toptions\taround\tintegration,\tand\tI’ve\tshared\tmy\nthoughts\ton\twhat\tchoices\tare\tmost\tlikely\tto\tensure\tour\tmicroservices\tremain\tas\tdecoupled\nas\tpossible\tfrom\ttheir\tother\tcollaborators:")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("Avoid\tdatabase\tintegration\tat\tall\tcosts.\n")])])]),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("Understand\tthe\ttrade-offs\tbetween\tREST\tand\tRPC,\tbut\tstrongly\tconsider\tREST\tas\ta\ngood\tstarting\tpoint\tfor\trequest/response\tintegration.\n")])])]),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("Prefer\tchoreography\tover\torchestration.\n")])])]),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("Avoid\tbreaking\tchanges\tand\tthe\tneed\tto\tversion\tby\tunderstanding\tPostel’s\tLaw\tand\nusing\ttolerant\treaders.\n")])])]),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("Think\tof\tuser\tinterfaces\tas\tcompositional\tlayers.\n")])])]),a("p",[t._v("We\tcovered\tquite\ta\tlot\there,\tand\tweren’t\table\tto\tgo\tinto\tdepth\ton\tall\tof\tthese\ttopics.\nNonetheless,\tthis\tshould\tbe\ta\tgood\tfoundation\tto\tget\tyou\tgoing\tand\tpoint\tyou\tin\tthe\tright\ndirection\tif\tyou\twant\tto\tlearn\tmore.")]),t._v(" "),a("p",[t._v("We\talso\tspent\tsome\ttime\tlooking\tat\thow\tto\twork\twith\tsystems\tthat\taren’t\tcompletely\nunder\tour\tcontrol\tin\tthe\tform\tof\tCOTS\tproducts.\tIt\tturns\tout\tthat\tthis\tdescription\tcan\tjust\nas\teasily\tapply\tto\tsoftware\twe\twrote!")]),t._v(" "),a("p",[t._v("Some\tof\tthe\tapproaches\toutlined\there\tapply\tequally\twell\tto\t "),a("em",[t._v("legacy")]),t._v(" \tsoftware,\tbut\twhat\tif\nwe\twant\tto\ttackle\tthe\toften-monumental\ttask\tof\tbringing\tthese\tolder\tsystems\tto\theel\tand\ndecomposing\tthem\tinto\tmore\tusable\tparts?\tWe’ll\tdiscuss\tthat\tin\tdetail\tin\tthe\tnext\tchapter.")]),t._v(" "),a("h1",{attrs:{id:"chapter5-splittingthemonolith"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#chapter5-splittingthemonolith"}},[t._v("#")]),t._v(" Chapter\t5.\tSplitting\tthe\tMonolith")]),t._v(" "),a("p",[t._v("We’ve\tdiscussed\twhat\ta\tgood\tservice\tlooks\tlike,\tand\twhy\tsmaller\tservers\tmay\tbe\tbetter\tfor\nus.\tWe\talso\tpreviously\tdiscussed\tthe\timportance\tof\tbeing\table\tto\tevolve\tthe\tdesign\tof\tour\nsystems.\tBut\thow\tdo\twe\thandle\tthe\tfact\tthat\twe\tmay\talready\thave\ta\tlarge\tnumber\tof\ncodebases\tlying\tabout\tthat\tdon’t\tfollow\tthese\tpatterns?\tHow\tdo\twe\tgo\tabout\tdecomposing\nthese\tmonolithic\tapplications\twithout\thaving\tto\tembark\ton\ta\tbig-bang\trewrite?")]),t._v(" "),a("p",[t._v("The\tmonolith\tgrows\tover\ttime.\tIt\tacquires\tnew\tfunctionality\tand\tlines\tof\tcode\tat\tan\nalarming\trate.\tBefore\tlong\tit\tbecomes\ta\tbig,\tscary\tgiant\tpresence\tin\tour\torganization\tthat\npeople\tare\tscared\tto\ttouch\tor\tchange.\tBut\tall\tis\tnot\tlost!\tWith\tthe\tright\ttools\tat\tour\ndisposal,\twe\tcan\tslay\tthis\tbeast.")]),t._v(" "),a("h2",{attrs:{id:"it-sallaboutseams"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#it-sallaboutseams"}},[t._v("#")]),t._v(" It’s\tAll\tAbout\tSeams")]),t._v(" "),a("p",[t._v("We\tdiscussed\tin\tChapter\t3\tthat\twe\twant\tour\tservices\tto\tbe\thighly\tcohesive\tand\tloosely\ncoupled.\tThe\tproblem\twith\tthe\tmonolith\tis\tthat\tall\ttoo\toften\tit\tis\tthe\topposite\tof\tboth.\nRather\tthan\ttend\ttoward\tcohesion,\tand\tkeep\tthings\ttogether\tthat\ttend\tto\tchange\ttogether,\nwe\tacquire\tand\tstick\ttogether\tall\tsorts\tof\tunrelated\tcode.\tLikewise,\tloose\tcoupling\tdoesn’t\nreally\texist:\tif\tI\twant\tto\tmake\ta\tchange\tto\ta\tline\tof\tcode,\tI\tmay\tbe\table\tto\tdo\tthat\teasily\nenough,\tbut\tI\tcannot\tdeploy\tthat\tchange\twithout\tpotentially\timpacting\tmuch\tof\tthe\trest\tof\nthe\tmonolith,\tand\tI’ll\tcertainly\thave\tto\tredeploy\tthe\tentire\tsystem.")]),t._v(" "),a("p",[t._v("In\this\tbook\t "),a("em",[t._v("Working\tEffectively\twith\tLegacy\tCode")]),t._v(" \t(Prentice-Hall),\tMichael\tFeathers\ndefines\tthe\tconcept\tof\ta\t "),a("em",[t._v("seam")]),t._v(" \t—\tthat\tis,\ta\tportion\tof\tthe\tcode\tthat\tcan\tbe\ttreated\tin\nisolation\tand\tworked\ton\twithout\timpacting\tthe\trest\tof\tthe\tcodebase.\tWe\talso\twant\tto\nidentify\tseams.\tBut\trather\tthan\tfinding\tthem\tfor\tthe\tpurpose\tof\tcleaning\tup\tour\tcodebase,\nwe\twant\tto\tidentify\tseams\tthat\tcan\tbecome\tservice\tboundaries.")]),t._v(" "),a("p",[t._v("So\twhat\tmakes\ta\tgood\tseam?\tWell,\tas\twe\tdiscussed\tpreviously,\tbounded\tcontexts\tmake\nexcellent\tseams,\tbecause\tby\tdefinition\tthey\trepresent\tcohesive\tand\tyet\tloosely\tcoupled\nboundaries\tin\tan\torganization.\tSo\tthe\tfirst\tstep\tis\tto\tstart\tidentifying\tthese\tboundaries\tin\nour\tcode.")]),t._v(" "),a("p",[t._v("Most\tprogramming\tlanguages\tprovide\tnamespace\tconcepts\tthat\tallow\tus\tto\tgroup\tsimilar\ncode\ttogether.\tJava’s\tpackage\tconcept\tis\ta\tfairly\tweak\texample,\tbut\tgives\tus\tmuch\tof\twhat\nwe\tneed.\tAll\tother\tmainstream\tprogramming\tlanguages\thave\tsimilar\tconcepts\tbuilt\tin,\nwith\tJavaScript\tvery\targuably\tbeing\tan\texception.")]),t._v(" "),a("h2",{attrs:{id:"breakingapartmusiccorp"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#breakingapartmusiccorp"}},[t._v("#")]),t._v(" Breaking\tApart\tMusicCorp")]),t._v(" "),a("p",[t._v("Imagine\twe\thave\ta\tlarge\tbackend\tmonolithic\tservice\tthat\trepresents\ta\tsubstantial\tamount\nof\tthe\tbehavior\tof\tMusicCorp’s\tonline\tsystems.\tTo\tstart,\twe\tshould\tidentify\tthe\thigh-level\nbounded\tcontexts\tthat\twe\tthink\texist\tin\tour\torganization,\tas\twe\tdiscussed\tin\tChapter\t3.\nThen\twe\twant\tto\ttry\tto\tunderstand\twhat\tbounded\tcontexts\tthe\tmonolith\tmaps\tto.\tLet’s\nimagine\tthat\tinitially\twe\tidentify\tfour\tcontexts\twe\tthink\tour\tmonolithic\tbackend\tcovers:")]),t._v(" "),a("p",[a("em",[t._v("Catalog")])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("Everything\tto\tdo\twith\tmetadata\tabout\tthe\titems\twe\toffer\tfor\tsale\n")])])]),a("p",[a("em",[t._v("Finance")])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("Reporting\tfor\taccounts,\tpayments,\trefunds,\tetc.\n")])])]),a("p",[a("em",[t._v("Warehouse")])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("Dispatching\tand\treturning\tof\tcustomer\torders,\tmanaging\tinventory\tlevels,\tetc.\n")])])]),a("p",[a("em",[t._v("Recommendation")])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("Our\tpatent-pending,\trevolutionary\trecommendation\tsystem,\twhich\tis\thighly\tcomplex\ncode\twritten\tby\ta\tteam\twith\tmore\tPhDs\tthan\tthe\taverage\tscience\tlab\n")])])]),a("p",[t._v("The\tfirst\tthing\tto\tdo\tis\tto\tcreate\tpackages\trepresenting\tthese\tcontexts,\tand\tthen\tmove\tthe\nexisting\tcode\tinto\tthem.\tWith\tmodern\tIDEs,\tcode\tmovement\tcan\tbe\tdone\tautomatically\nvia\trefactorings,\tand\tcan\tbe\tdone\tincrementally\twhile\twe\tare\tdoing\tother\tthings.\tYou’ll\nstill\tneed\ttests\tto\tcatch\tany\tbreakages\tmade\tby\tmoving\tcode,\thowever,\tespecially\tif\tyou’re\nusing\ta\tdynamically\ttyped\tlanguage\twhere\tthe\tIDEs\thave\ta\tharder\ttime\tof\tperforming\nrefactoring.\tOver\ttime,\twe\tstart\tto\tsee\twhat\tcode\tfits\twell,\tand\twhat\tcode\tis\t "),a("em",[t._v("left\tover")]),t._v(" \tand\ndoesn’t\treally\tfit\tanywhere.\tThis\tremaining\tcode\twill\toften\tidentify\tbounded\tcontexts\twe\nmight\thave\tmissed!")]),t._v(" "),a("p",[t._v("During\tthis\tprocess\twe\tcan\tuse\tcode\tto\tanalyze\tthe\tdependencies\tbetween\tthese\tpackages\ntoo.\tOur\tcode\tshould\trepresent\tour\torganization,\tso\tour\tpackages\trepresenting\tthe\nbounded\tcontexts\tin\tour\torganization\tshould\tinteract\tin\tthe\tsame\tway\tthe\treal-life\norganizational\tgroups\tin\tour\tdomain\tinteract.\tFor\texample,\ttools\tlike\tStructure\t101\tallow\nus\tto\tsee\tthe\tdependencies\tbetween\tpackages\tgraphically.\tIf\twe\tspot\tthings\tthat\tlook\nwrong\t—\tfor\texample,\tthe\twarehouse\tpackage\tdepends\ton\tcode\tin\tthe\tfinance\tpackage\nwhen\tno\tsuch\tdependency\texists\tin\tthe\treal\torganization\t—\tthen\twe\tcan\tinvestigate\tthis\nproblem\tand\ttry\tto\tresolve\tit.")]),t._v(" "),a("p",[t._v("This\tprocess\tcould\ttake\tan\tafternoon\ton\ta\tsmall\tcodebase,\tor\tseveral\tweeks\tor\tmonths\nwhen\tyou’re\tdealing\twith\tmillions\tof\tlines\tof\tcode.\tYou\tmay\tnot\tneed\tto\tsort\tall\tcode\tinto\ndomain-oriented\tpackages\tbefore\tsplitting\tout\tyour\tfirst\tservice,\tand\tindeed\tit\tcan\tbe\tmore\nvaluable\tto\tconcentrate\tyour\teffort\tin\tone\tplace.\tThere\tis\tno\tneed\tfor\tthis\tto\tbe\ta\tbig-bang\napproach.\tIt\tis\tsomething\tthat\tcan\tbe\tdone\tbit\tby\tbit,\tday\tby\tday,\tand\twe\thave\ta\tlot\tof\ttools")]),t._v(" "),a("p",[t._v("at\tour\tdisposal\tto\ttrack\tour\tprogress.")]),t._v(" "),a("p",[t._v("So\tnow\tthat\twe\thave\tour\tcodebase\torganized\taround\tthese\tseams,\twhat\tnext?")]),t._v(" "),a("h2",{attrs:{id:"thereasonstosplitthemonolith"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#thereasonstosplitthemonolith"}},[t._v("#")]),t._v(" The\tReasons\tto\tSplit\tthe\tMonolith")]),t._v(" "),a("p",[t._v("Deciding\tthat\tyou’d\tlike\ta\tmonolithic\tservice\tor\tapplication\tto\tbe\tsmaller\tis\ta\tgood\tstart.\nBut\tI\twould\tstrongly\tadvise\tyou\tto\tchip\taway\tat\tthese\tsystems.\tAn\tincremental\tapproach\nwill\thelp\tyou\tlearn\tabout\tmicroservices\tas\tyou\tgo,\tand\twill\talso\tlimit\tthe\timpact\tof\tgetting\nsomething\twrong\t(and\tyou\twill\tget\tthings\twrong!).\tThink\tof\tour\tmonolith\tas\ta\tblock\tof\nmarble.\tWe\tcould\tblow\tthe\twhole\tthing\tup,\tbut\tthat\trarely\tends\twell.\tIt\tmakes\tmuch\tmore\nsense\tto\tjust\tchip\taway\tat\tit\tincrementally.")]),t._v(" "),a("p",[t._v("So\tif\twe\tare\tgoing\tto\tbreak\tapart\tthe\tmonolith\ta\tpiece\tat\ta\ttime,\twhere\tshould\twe\tstart?\nWe\thave\tour\tseams\tnow,\tbut\twhich\tone\tshould\twe\tpull\tout\tfirst?\tIt’s\tbest\tto\tthink\tabout\nwhere\tyou\tare\tgoing\tto\tget\tthe\tmost\tbenefit\tfrom\tsome\tpart\tof\tyour\tcodebase\tbeing\nseparated,\trather\tthan\tjust\tsplitting\tthings\tfor\tthe\tsake\tof\tit.\tLet’s\tconsider\tsome\tdrivers\nthat\tmight\thelp\tguide\tour\tchisel.")]),t._v(" "),a("h2",{attrs:{id:"paceofchange"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#paceofchange"}},[t._v("#")]),t._v(" Pace\tof\tChange")]),t._v(" "),a("p",[t._v("Perhaps\twe\tknow\tthat\twe\thave\ta\tload\tof\tchanges\tcoming\tup\tsoon\tin\thow\twe\tmanage\ninventory.\tIf\twe\tsplit\tout\tthe\twarehouse\tseam\tas\ta\tservice\tnow,\twe\tcould\tchange\tthat\nservice\tfaster,\tas\tit\tis\ta\tseparate\tautonomous\tunit.")]),t._v(" "),a("h2",{attrs:{id:"teamstructure"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#teamstructure"}},[t._v("#")]),t._v(" Team\tStructure")]),t._v(" "),a("p",[t._v("MusicCorp’s\tdelivery\tteam\tis\tactually\tsplit\tacross\ttwo\tgeographical\tregions.\tOne\tteam\tis\nin\tLondon,\tthe\tother\tin\tHawaii\t(some\tpeople\thave\tit\teasy!).\tIt\twould\tbe\tgreat\tif\twe\tcould\nsplit\tout\tthe\tcode\tthat\tthe\tHawaii\tteam\tworks\ton\tthe\tmost,\tso\tit\tcan\ttake\tfull\townership.\nWe’ll\texplore\tthis\tidea\tfurther\tin\tChapter\t10.")]),t._v(" "),a("h2",{attrs:{id:"security"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#security"}},[t._v("#")]),t._v(" Security")]),t._v(" "),a("p",[t._v("MusicCorp\thas\thad\ta\tsecurity\taudit,\tand\thas\tdecided\tto\ttighten\tup\tits\tprotection\tof\nsensitive\tinformation.\tCurrently,\tall\tof\tthis\tis\thandled\tby\tthe\tfinance-related\tcode.\tIf\twe\nsplit\tthis\tservice\tout,\twe\tcan\tprovide\tadditional\tprotections\tto\tthis\tindividual\tservice\tin\nterms\tof\tmonitoring,\tprotection\tof\tdata\tat\ttransit,\tand\tprotection\tof\tdata\tat\trest\t—\tideas\nwe’ll\tlook\tat\tin\tmore\tdetail\tin\tChapter\t9.")]),t._v(" "),a("h2",{attrs:{id:"technology"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#technology"}},[t._v("#")]),t._v(" Technology")]),t._v(" "),a("p",[t._v("The\tteam\tlooking\tafter\tour\trecommendation\tsystem\thas\tbeen\tspiking\tout\tsome\tnew\nalgorithms\tusing\ta\tlogic\tprogramming\tlibrary\tin\tthe\tlanguage\tClojure.\tThe\tteam\tthinks\nthis\tcould\tbenefit\tour\tcustomers\tby\timproving\twhat\twe\toffer\tthem.\tIf\twe\tcould\tsplit\tout\nthe\trecommendation\tcode\tinto\ta\tseparate\tservice,\tit\twould\tbe\teasy\tto\tconsider\tbuilding\tan\nalternative\timplementation\tthat\twe\tcould\ttest\tagainst.")]),t._v(" "),a("h2",{attrs:{id:"tangleddependencies"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#tangleddependencies"}},[t._v("#")]),t._v(" Tangled\tDependencies")]),t._v(" "),a("p",[t._v("The\tother\tpoint\tto\tconsider\twhen\tyou’ve\tidentified\ta\tcouple\tof\tseams\tto\tseparate\tis\thow\nentangled\tthat\tcode\tis\twith\tthe\trest\tof\tthe\tsystem.\tWe\twant\tto\tpull\tout\tthe\tseam\tthat\tis\tleast\ndepended\ton\tif\twe\tcan.\tIf\tyou\tcan\tview\tthe\tvarious\tseams\tyou\thave\tfound\tas\ta\tdirected\nacyclical\tgraph\tof\tdependencies\t(something\tthe\tpackage\tmodeling\ttools\tI\tmentioned\nearlier\tare\tvery\tgood\tat),\tthis\tcan\thelp\tyou\tspot\tthe\tseams\tthat\tare\tlikely\tgoing\tto\tbe\tharder\nto\tdisentangle.")]),t._v(" "),a("p",[t._v("This\tbrings\tus\tto\twhat\tis\toften\tthe\tmother\tof\tall\ttangled\tdependencies:\tthe\tdatabase.")]),t._v(" "),a("h2",{attrs:{id:"thedatabase"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#thedatabase"}},[t._v("#")]),t._v(" The\tDatabase")]),t._v(" "),a("p",[t._v("We’ve\talready\tdiscussed\tat\tlength\tthe\tchallenges\tof\tusing\tdatabases\tas\ta\tmethod\tof\nintegrating\tmultiple\tservices.\tAs\tI\tmade\tit\tpretty\tclear\tearlier,\tI\tam\tnot\ta\tfan!\tThis\tmeans\nwe\tneed\tto\tfind\tseams\tin\tour\tdatabases\ttoo\tso\twe\tcan\tsplit\tthem\tout\tcleanly.\tDatabases,\nhowever,\tare\ttricky\tbeasts.")]),t._v(" "),a("h2",{attrs:{id:"gettingtogripswiththeproblem"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#gettingtogripswiththeproblem"}},[t._v("#")]),t._v(" Getting\tto\tGrips\twith\tthe\tProblem")]),t._v(" "),a("p",[t._v("The\tfirst\tstep\tis\tto\ttake\ta\tlook\tat\tthe\tcode\titself\tand\tsee\twhich\tparts\tof\tit\tread\tto\tand\twrite\nfrom\tthe\tdatabase.\tA\tcommon\tpractice\tis\tto\thave\ta\trepository\tlayer,\tbacked\tby\tsome\tsort\nof\tframework\tlike\tHibernate,\tto\tbind\tyour\tcode\tto\tthe\tdatabase,\tmaking\tit\teasy\tto\tmap\nobjects\tor\tdata\tstructures\tto\tand\tfrom\tthe\tdatabase.\tIf\tyou\thave\tbeen\tfollowing\talong\tso\nfar,\tyou’ll\thave\tgrouped\tour\tcode\tinto\tpackages\trepresenting\tour\tbounded\tcontexts;\twe\nwant\tto\tdo\tthe\tsame\tfor\tour\tdatabase\taccess\tcode.\tThis\tmay\trequire\tsplitting\tup\tthe\nrepository\tlayer\tinto\tseveral\tparts,\tas\tshown\tin\tFigure\t5-1.")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("Figure\t5-1.\tSplitting\tout\tour\trepository\tlayers\n")])])]),a("p",[t._v("Having\tthe\tdatabase\tmapping\tcode\tcolocated\tinside\tthe\tcode\tfor\ta\tgiven\tcontext\tcan\thelp\nus\tunderstand\twhat\tparts\tof\tthe\tdatabase\tare\tused\tby\twhat\tbits\tof\tcode.\tHibernate,\tfor\nexample,\tcan\tmake\tthis\tvery\tclear\tif\tyou\tare\tusing\tsomething\tlike\ta\tmapping\tfile\tper\nbounded\tcontext.")]),t._v(" "),a("p",[t._v("This\tdoesn’t\tgive\tus\tthe\twhole\tstory,\thowever.\tFor\texample,\twe\tmay\tbe\table\tto\ttell\tthat\tthe\nfinance\tcode\tuses\tthe\tledger\ttable,\tand\tthat\tthe\tcatalog\tcode\tuses\tthe\tline\titem\ttable,\tbut\tit\nmight\tnot\tbe\tclear\tthat\tthe\tdatabase\tenforces\ta\tforeign\tkey\trelationship\tfrom\tthe\tledger\ntable\tto\tthe\tline\titem\ttable.\tTo\tsee\tthese\tdatabase-level\tconstraints,\twhich\tmay\tbe\ta\nstumbling\tblock,\twe\tneed\tto\tuse\tanother\ttool\tto\tvisualize\tthe\tdata.\tA\tgreat\tplace\tto\tstart\tis\nto\tuse\ta\ttool\tlike\tthe\tfreely\tavailable\tSchemaSpy,\twhich\tcan\tgenerate\tgraphical\nrepresentations\tof\tthe\trelationships\tbetween\ttables.")]),t._v(" "),a("p",[t._v("All\tthis\thelps\tyou\tunderstand\tthe\tcoupling\tbetween\ttables\tthat\tmay\tspan\twhat\twill\neventually\tbecome\tservice\tboundaries.\tBut\thow\tdo\tyou\tcut\tthose\tties?\tAnd\twhat\tabout\ncases\twhere\tthe\tsame\ttables\tare\tused\tfrom\tmultiple\tdifferent\tbounded\tcontexts?\tHandling\nproblems\tlike\tthese\tis\tnot\teasy,\tand\tthere\tare\tmany\tanswers,\tbut\tit\tis\tdoable.")]),t._v(" "),a("p",[t._v("Coming\tback\tto\tsome\tconcrete\texamples,\tlet’s\tconsider\tour\tmusic\tshop\tagain.\tWe\thave\nidentified\tfour\tbounded\tcontexts,\tand\twant\tto\tmove\tforward\twith\tmaking\tthem\tfour\ndistinct,\tcollaborating\tservices.\tWe’re\tgoing\tto\tlook\tat\ta\tfew\tconcrete\texamples\tof\nproblems\twe\tmight\tface,\tand\ttheir\tpotential\tsolutions.\tAnd\twhile\tsome\tof\tthese\texamples\ntalk\tspecifically\tabout\tchallenges\tencountered\tin\tstandard\trelational\tdatabases,\tyou\twill\nfind\tsimilar\tproblems\tin\tother\talternative\tNOSQL\tstores.")]),t._v(" "),a("h2",{attrs:{id:"example-breakingforeignkeyrelationships"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#example-breakingforeignkeyrelationships"}},[t._v("#")]),t._v(" Example:\tBreaking\tForeign\tKey\tRelationships")]),t._v(" "),a("p",[t._v("In\tthis\texample,\tour\tcatalog\tcode\tuses\ta\tgeneric\tline\titem\ttable\tto\tstore\tinformation\tabout\nan\talbum.\tOur\tfinance\tcode\tuses\ta\tledger\ttable\tto\ttrack\tfinancial\ttransactions.\tAt\tthe\tend\nof\teach\tmonth\twe\tneed\tto\tgenerate\treports\tfor\tvarious\tpeople\tin\tthe\torganization\tso\tthey\ncan\tsee\thow\twe’re\tdoing.\tWe\twant\tto\tmake\tthe\treports\tnice\tand\teasy\tto\tread,\tso\trather\nthan\tsaying,\t“We\tsold\t400\tcopies\tof\tSKU\t12345\tand\tmade\t$1,300,”\twe’d\tlike\tto\tadd\tmore\ninformation\tabout\twhat\twas\tsold\t(i.e.,\t“We\tsold\t400\tcopies\tof\tBruce\tSpringsteen’s\n"),a("em",[t._v("Greatest\tHits")]),t._v(" \tand\tmade\t$1,300”).\tTo\tdo\tthis,\tour\treporting\tcode\tin\tthe\tfinance\tpackage\nwill\treach\tinto\tthe\tline\titem\ttable\tto\tpull\tout\tthe\ttitle\tfor\tthe\tSKU.\tIt\tmay\talso\thave\ta\nforeign\tkey\tconstraint\tfrom\tthe\tledger\tto\tthe\tline\titem\ttable,\tas\twe\tsee\tin\tFigure\t5-2.")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("Figure\t5-2.\tForeign\tkey\trelationship\n")])])]),a("p",[t._v("So\thow\tdo\twe\tfix\tthings\there?\tWell,\twe\tneed\tto\tmake\ta\tchange\tin\ttwo\tplaces.\tFirst,\twe\nneed\tto\tstop\tthe\tfinance\tcode\tfrom\treaching\tinto\tthe\tline\titem\ttable,\tas\tthis\ttable\treally\nbelongs\tto\tthe\tcatalog\tcode,\tand\twe\tdon’t\twant\tdatabase\tintegration\thappening\tonce\ncatalog\tand\tfinance\tare\tservices\tin\ttheir\town\trights.\tThe\tquickest\tway\tto\taddress\tthis\tis\nrather\tthan\thaving\tthe\tcode\tin\tfinance\treach\tinto\tthe\tline\titem\ttable,\twe’ll\texpose\tthe\tdata\nvia\tan\tAPI\tcall\tin\tthe\tcatalog\tpackage\tthat\tthe\tfinance\tcode\tcan\tcall.\tThis\tAPI\tcall\twill\tbe\nthe\tforerunner\tof\ta\tcall\twe\twill\tmake\tover\tthe\twire,\tas\twe\tsee\tin\tFigure\t5-3.")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("Figure\t5-3.\tPost\tremoval\tof\tthe\tforeign\tkey\trelationship\n")])])]),a("p",[t._v("At\tthis\tpoint\tit\tbecomes\tclear\tthat\twe\tmay\twell\tend\tup\thaving\tto\tmake\ttwo\tdatabase\tcalls\nto\tgenerate\tthe\treport.\tThis\tis\tcorrect.\tAnd\tthe\tsame\tthing\twill\thappen\tif\tthese\tare\ttwo\nseparate\tservices.\tTypically\tconcerns\taround\tperformance\tare\tnow\traised.\tI\thave\ta\tfairly\neasy\tanswer\tto\tthose:\thow\tfast\tdoes\tyour\tsystem\tneed\tto\tbe?\tAnd\thow\tfast\tis\tit\tnow?\tIf\nyou\tcan\ttest\tits\tcurrent\tperformance\tand\tknow\twhat\tgood\tperformance\tlooks\tlike,\tthen\nyou\tshould\tfeel\tconfident\tin\tmaking\ta\tchange.\tSometimes\tmaking\tone\tthing\tslower\tin\nexchange\tfor\tother\tthings\tis\tthe\tright\tthing\tto\tdo,\tespecially\tif\t "),a("em",[t._v("slower")]),t._v(" \tis\tstill\tperfectly\nacceptable.")]),t._v(" "),a("p",[t._v("But\twhat\tabout\tthe\tforeign\tkey\trelationship?\tWell,\twe\tlose\tthis\taltogether.\tThis\tbecomes\ta\nconstraint\twe\tneed\tto\tnow\tmanage\tin\tour\tresulting\tservices\trather\tthan\tin\tthe\tdatabase\nlevel.\tThis\tmay\tmean\tthat\twe\tneed\tto\timplement\tour\town\tconsistency\tcheck\tacross\nservices,\tor\telse\ttrigger\tactions\tto\tclean\tup\trelated\tdata.\tWhether\tor\tnot\tthis\tis\tneeded\tis\noften\tnot\ta\ttechnologist’s\tchoice\tto\tmake.\tFor\texample,\tif\tour\torder\tservice\tcontains\ta\tlist\nof\tIDs\tfor\tcatalog\titems,\twhat\thappens\tif\ta\tcatalog\titem\tis\tremoved\tand\tan\torder\tnow\nrefers\tto\tan\tinvalid\tcatalog\tID?\tShould\twe\tallow\tit?\tIf\twe\tdo,\tthen\thow\tis\tthis\trepresented\nin\tthe\torder\twhen\tit\tis\tdisplayed?\tIf\twe\tdon’t,\tthen\thow\tcan\twe\tcheck\tthat\tthis\tisn’t\nviolated?\tThese\tare\tquestions\tyou’ll\tneed\tto\tget\tanswered\tby\tthe\tpeople\twho\tdefine\thow\nyour\tsystem\tshould\tbehave\tfor\tits\tusers.")]),t._v(" "),a("h2",{attrs:{id:"example-sharedstaticdata"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#example-sharedstaticdata"}},[t._v("#")]),t._v(" Example:\tShared\tStatic\tData")]),t._v(" "),a("p",[t._v("I\thave\tseen\tperhaps\tas\tmany\tcountry\tcodes\tstored\tin\tdatabases\t(shown\tin\tFigure\t5-4)\tas\tI\nhave\twritten\tStringUtils\tclasses\tfor\tin-house\tJava\tprojects.\tThis\tseems\tto\timply\tthat\twe\nplan\tto\tchange\tthe\tcountries\tour\tsystem\tsupports\tway\tmore\tfrequently\tthan\twe’ll\tdeploy\nnew\tcode,\tbut\twhatever\tthe\treal\treason,\tthese\texamples\tof\tshared\tstatic\tdata\tbeing\tstored\nin\tdatabases\tcome\tup\ta\tlot.\tSo\twhat\tdo\twe\tdo\tin\tour\tmusic\tshop\tif\tall\tour\tpotential\nservices\tread\tfrom\tthe\tsame\ttable\tlike\tthis?")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("Figure\t5-4.\tCountry\tcodes\tin\tthe\tdatabase\n")])])]),a("p",[t._v("Well,\twe\thave\ta\tfew\toptions.\tOne\tis\tto\tduplicate\tthis\ttable\tfor\teach\tof\tour\tpackages,\twith\nthe\tlong-term\tview\tthat\tit\twill\tbe\tduplicated\twithin\teach\tservice\talso.\tThis\tleads\tto\ta\npotential\tconsistency\tchallenge,\tof\tcourse:\twhat\thappens\tif\tI\tupdate\tone\ttable\tto\treflect\tthe\ncreation\tof\tNewmantopia\toff\tthe\teast\tcoast\tof\tAustralia,\tbut\tnot\tanother?")]),t._v(" "),a("p",[t._v("A\tsecond\toption\tis\tto\tinstead\ttreat\tthis\tshared,\tstatic\tdata\tas\tcode.\tPerhaps\tit\tcould\tbe\tin\ta\nproperty\tfile\tdeployed\tas\tpart\tof\tthe\tservice,\tor\tperhaps\tjust\tas\tan\tenumeration.\tThe\nproblems\taround\tthe\tconsistency\tof\tdata\tremain,\talthough\texperience\thas\tshown\tthat\tit\tis\nfar\teasier\tto\tpush\tout\tchanges\tto\tconfiguration\tfiles\tthan\talter\tlive\tdatabase\ttables.\tThis\tis\noften\ta\tvery\tsensible\tapproach.")]),t._v(" "),a("p",[t._v("A\tthird\toption,\twhich\tmay\twell\tbe\textreme,\tis\tto\tpush\tthis\tstatic\tdata\tinto\ta\tservice\tof\tits\nown\tright.\tIn\ta\tcouple\tof\tsituations\tI\thave\tencountered,\tthe\tvolume,\tcomplexity,\tand\trules\nassociated\twith\tthe\tstatic\treference\tdata\twere\tsufficient\tthat\tthis\tapproach\twas\twarranted,\nbut\tit’s\tprobably\toverkill\tif\twe\tare\tjust\ttalking\tabout\tcountry\tcodes!")]),t._v(" "),a("p",[t._v("Personally,\tin\tmost\tsituations\tI’d\ttry\tto\tpush\tfor\tkeeping\tthis\tdata\tin\tconfiguration\tfiles\tor\ndirectly\tin\tcode,\tas\tit\tis\tthe\tsimple\toption\tfor\tmost\tcases.")]),t._v(" "),a("h2",{attrs:{id:"example-shareddata"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#example-shareddata"}},[t._v("#")]),t._v(" Example:\tShared\tData")]),t._v(" "),a("p",[t._v("Now\tlet’s\tdive\tinto\ta\tmore\tcomplex\texample,\tbut\tone\tthat\tcan\tbe\ta\tcommon\tproblem\nwhen\tyou’re\ttrying\tto\ttease\tapart\tsystems:\tshared\tmutable\tdata.\tOur\tfinance\tcode\ttracks\npayments\tmade\tby\tcustomers\tfor\ttheir\torders,\tand\talso\ttracks\trefunds\tgiven\tto\tthem\twhen\nthey\treturn\titems.\tMeanwhile,\tthe\twarehouse\tcode\tupdates\trecords\tto\tshow\tthat\torders\tfor\ncustomers\thave\tbeen\tdispatched\tor\treceived.\tAll\tof\tthis\tdata\tis\tdisplayed\tin\tone\nconvenient\tplace\ton\tthe\twebsite\tso\tthat\tcustomers\tcan\tsee\twhat\tis\tgoing\ton\twith\ttheir\naccount.\tTo\tkeep\tthings\tsimple,\twe\thave\tstored\tall\tthis\tinformation\tin\ta\tfairly\tgeneric\ncustomer\trecord\ttable,\tas\tshown\tin\tFigure\t5-5.")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("Figure\t5-5.\tAccessing\tcustomer\tdata:\tare\twe\tmissing\tsomething?\n")])])]),a("p",[t._v("So\tboth\tthe\tfinance\tand\tthe\twarehouse\tcode\tare\twriting\tto,\tand\tprobably\toccasionally\nreading\tfrom,\tthe\tsame\ttable.\tHow\tcan\twe\ttease\tthis\tapart?\tWhat\twe\tactually\thave\there\tis\nsomething\tyou’ll\tsee\toften\t—\ta\tdomain\tconcept\tthat\tisn’t\tmodeled\tin\tthe\tcode,\tand\tis\tin\nfact\timplicitly\tmodeled\tin\tthe\tdatabase.\tHere,\tthe\tdomain\tconcept\tthat\tis\tmissing\tis\tthat\tof\nCustomer.")]),t._v(" "),a("p",[t._v("We\tneed\tto\tmake\tthe\tcurrent\tabstract\tconcept\tof\tthe\tcustomer\tconcrete.\tAs\ta\ttransient\nstep,\twe\tcreate\ta\tnew\tpackage\tcalled\tCustomer.\tWe\tcan\tthen\tuse\tan\tAPI\tto\texpose")]),t._v(" "),a("p",[t._v("Customer\tcode\tto\tother\tpackages,\tsuch\tas\tfinance\tor\twarehouse.\tRolling\tthis\tall\tthe\tway\nforward,\twe\tmay\tnow\tend\tup\twith\ta\tdistinct\tcustomer\tservice\t(Figure\t5-6).")]),t._v(" "),a("p",[a("em",[t._v("Figure\t5-6.\tRecognizing\tthe\tbounded\tcontext\tof\tthe\tcustomer")])]),t._v(" "),a("h2",{attrs:{id:"example-sharedtables"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#example-sharedtables"}},[t._v("#")]),t._v(" Example:\tShared\tTables")]),t._v(" "),a("p",[t._v("Figure\t5-7\tshows\tour\tlast\texample.\tOur\tcatalog\tneeds\tto\tstore\tthe\tname\tand\tprice\tof\tthe\nrecords\twe\tsell,\tand\tthe\twarehouse\tneeds\tto\tkeep\tan\telectronic\trecord\tof\tinventory.\tWe\ndecide\tto\tkeep\tthese\ttwo\tthings\tin\tthe\tsame\tplace\tin\ta\tgeneric\tline\titem\ttable.\tBefore,\twith\nall\tthe\tcode\tmerged\tin\ttogether,\tit\twasn’t\tclear\tthat\twe\tare\tactually\tconflating\tconcerns,\nbut\tnow\twe\tcan\tsee\tthat\tin\tfact\twe\thave\ttwo\tseparate\tconcepts\tthat\tcould\tbe\tstored\ndifferently.")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("Figure\t5-7.\tTables\tbeing\tshared\tbetween\tdifferent\tcontexts\n")])])]),a("p",[t._v("The\tanswer\there\tis\tto\tsplit\tthe\ttable\tin\ttwo\tas\twe\thave\tin\tFigure\t5-8,\tperhaps\tcreating\ta\nstock\tlist\ttable\tfor\tthe\twarehouse,\tand\ta\tcatalog\tentry\ttable\tfor\tthe\tcatalog\tdetails.")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("Figure\t5-8.\tPulling\tapart\tthe\tshared\ttable\n")])])]),a("h2",{attrs:{id:"refactoringdatabases"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#refactoringdatabases"}},[t._v("#")]),t._v(" Refactoring\tDatabases")]),t._v(" "),a("p",[t._v("What\twe\thave\tcovered\tin\tthe\tpreceding\texamples\tare\ta\tfew\tdatabase\trefactorings\tthat\tcan\nhelp\tyou\tseparate\tyour\tschemas.\tFor\ta\tmore\tdetailed\tdiscussion\tof\tthe\tsubject,\tyou\tmay\nwant\tto\ttake\ta\tlook\tat\t "),a("em",[t._v("Refactoring\tDatabases")]),t._v(" \tby\tScott\tJ.\tAmbler\tand\tPramod\tJ.\tSadalage\n(Addison-Wesley).")]),t._v(" "),a("h2",{attrs:{id:"stagingthebreak"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#stagingthebreak"}},[t._v("#")]),t._v(" Staging\tthe\tBreak")]),t._v(" "),a("p",[t._v("So\twe’ve\tfound\tseams\tin\tour\tapplication\tcode,\tgrouping\tit\taround\tbounded\tcontexts.\nWe’ve\tused\tthis\tto\tidentify\tseams\tin\tthe\tdatabase,\tand\twe’ve\tdone\tour\tbest\tto\tsplit\tthose\nout.\tWhat\tnext?\tDo\tyou\tdo\ta\tbig-bang\trelease,\tgoing\tfrom\tone\tmonolithic\tservice\twith\ta\nsingle\tschema\tto\ttwo\tservices,\teach\twith\tits\town\tschema?\tI\twould\tactually\trecommend\nthat\tyou\tsplit\tout\tthe\tschema\tbut\tkeep\tthe\tservice\ttogether\tbefore\tsplitting\tthe\tapplication\ncode\tout\tinto\tseparate\tmicroservices,\tas\tshown\tin\tFigure\t5-9.")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("Figure\t5-9.\tStaging\ta\tservice\tseparation\n")])])]),a("p",[t._v("With\ta\tseparate\tschema,\twe’ll\tbe\tpotentially\tincreasing\tthe\tnumber\tof\tdatabase\tcalls\tto\nperform\ta\tsingle\taction.\tWhere\tbefore\twe\tmight\thave\tbeen\table\tto\thave\tall\tthe\tdata\twe\nwanted\tin\ta\tsingle\tSELECT\tstatement,\tnow\twe\tmay\tneed\tto\tpull\tthe\tdata\tback\tfrom\ttwo\nlocations\tand\tjoin\tin\tmemory.\tAlso,\twe\tend\tup\tbreaking\ttransactional\tintegrity\twhen\twe\nmove\tto\ttwo\tschemas,\twhich\tcould\thave\tsignificant\timpact\ton\tour\tapplications;\twe’ll\tbe\ndiscussing\tthis\tnext.\tBy\tsplitting\tthe\tschemas\tout\tbut\tkeeping\tthe\tapplication\tcode\ntogether,\twe\tgive\tourselves\tthe\tability\tto\trevert\tour\tchanges\tor\tcontinue\tto\ttweak\tthings\nwithout\timpacting\tany\tconsumers\tof\tour\tservice.\tOnce\twe\tare\tsatisfied\tthat\tthe\tDB\nseparation\tmakes\tsense,\twe\tcan\tthen\tthink\tabout\tsplitting\tout\tthe\tapplication\tcode\tinto\ttwo\nservices.")]),t._v(" "),a("h2",{attrs:{id:"transactionalboundaries"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#transactionalboundaries"}},[t._v("#")]),t._v(" Transactional\tBoundaries")]),t._v(" "),a("p",[t._v("Transactions\tare\tuseful\tthings.\tThey\tallow\tus\tto\tsay\t "),a("em",[t._v("these\tevents\teither\tall\thappen\ntogether,\tor\tnone\tof\tthem\thappen")]),t._v(" .\tThey\tare\tvery\tuseful\twhen\twe’re\tinserting\tdata\tinto\ta\ndatabase;\tthey\tlet\tus\tupdate\tmultiple\ttables\tat\tonce,\tknowing\tthat\tif\tanything\tfails,\neverything\tgets\trolled\tback,\tensuring\tour\tdata\tdoesn’t\tget\tinto\tan\tinconsistent\tstate.\nSimply\tput,\ta\ttransaction\tallows\tus\tto\tgroup\ttogether\tmultiple\tdifferent\tactivities\tthat\ttake\nour\tsystem\tfrom\tone\tconsistent\tstate\tto\tanother\t—\teverything\tworks,\tor\tnothing\tchanges.")]),t._v(" "),a("p",[t._v("Transactions\tdon’t\tjust\tapply\tto\tdatabases,\talthough\twe\tmost\toften\tuse\tthem\tin\tthat\ncontext.\tMessage\tbrokers,\tfor\texample,\thave\tlong\tallowed\tyou\tto\tpost\tand\treceive\nmessages\twithin\ttransactions\ttoo.")]),t._v(" "),a("p",[t._v("With\ta\tmonolithic\tschema,\tall\tour\tcreate\tor\tupdates\twill\tprobably\tbe\tdone\twithin\ta\tsingle\ntransactional\tboundary.\tWhen\twe\tsplit\tapart\tour\tdatabases,\twe\tlose\tthe\tsafety\tafforded\tto\nus\tby\thaving\ta\tsingle\ttransaction.\tConsider\ta\tsimple\texample\tin\tthe\tMusicCorp\tcontext.\nWhen\tcreating\tan\torder,\tI\twant\tto\tupdate\tthe\torder\ttable\tstating\tthat\ta\tcustomer\torder\thas\nbeen\tcreated,\tand\talso\tput\tan\tentry\tinto\ta\ttable\tfor\tthe\twarehouse\tteam\tso\tit\tknows\tthere\tis\nan\torder\tthat\tneeds\tto\tbe\tpicked\tfor\tdispatch.\tWe’ve\tgotten\tas\tfar\tas\tgrouping\tour\napplication\tcode\tinto\tseparate\tpackages,\tand\thave\talso\tseparated\tthe\tcustomer\tand\nwarehouse\tparts\tof\tthe\tschema\twell\tenough\tthat\twe\tare\tready\tto\tput\tthem\tinto\ttheir\town\nschemas\tprior\tto\tseparating\tthe\tapplication\tcode.")]),t._v(" "),a("p",[t._v("Within\ta\tsingle\ttransaction\tin\tour\texisting\tmonolithic\tschema,\tcreating\tthe\torder\tand\ninserting\tthe\trecord\tfor\tthe\twarehouse\tteam\ttakes\tplace\twithin\ta\tsingle\ttransaction,\tas\nshown\tin\tFigure\t5-10.")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("Figure\t5-10.\tUpdating\ttwo\ttables\tin\ta\tsingle\ttransaction\n")])])]),a("p",[t._v("But\tif\twe\thave\tpulled\tapart\tthe\tschema\tinto\ttwo\tseparate\tschemas,\tone\tfor\tcustomer-\nrelated\tdata\tincluding\tour\torder\ttable,\tand\tanother\tfor\tthe\twarehouse,\twe\thave\tlost\tthis\ntransactional\tsafety.\tThe\torder\tplacing\tprocess\tnow\tspans\ttwo\tseparate\ttransactional\nboundaries,\tas\twe\tsee\tin\tFigure\t5-11.\tIf\tour\tinsert\tinto\tthe\torder\ttable\tfails,\twe\tcan\tclearly\nstop\teverything,\tleaving\tus\tin\ta\tconsistent\tstate.\tBut\twhat\thappens\twhen\tthe\tinsert\tinto\tthe\norder\ttable\tworks,\tbut\tthe\tinsert\tinto\tthe\tpicking\ttable\tfails?")]),t._v(" "),a("p",[a("em",[t._v("Figure\t5-11.\tSpanning\ttransactional\tboundaries\tfor\ta\tsingle\toperation")])]),t._v(" "),a("h2",{attrs:{id:"tryagainlater"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#tryagainlater"}},[t._v("#")]),t._v(" Try\tAgain\tLater")]),t._v(" "),a("p",[t._v("The\tfact\tthat\tthe\torder\twas\tcaptured\tand\tplaced\tmight\tbe\tenough\tfor\tus,\tand\twe\tmay\ndecide\tto\tretry\tthe\tinsertion\tinto\tthe\twarehouse’s\tpicking\ttable\tat\ta\tlater\tdate.\tWe\tcould\nqueue\tup\tthis\tpart\tof\tthe\toperation\tin\ta\tqueue\tor\tlogfile,\tand\ttry\tagain\tlater.\tFor\tsome\tsorts\nof\toperations\tthis\tmakes\tsense,\tbut\twe\thave\tto\tassume\tthat\ta\tretry\twould\tfix\tit.")]),t._v(" "),a("p",[t._v("In\tmany\tways,\tthis\tis\tanother\tform\tof\twhat\tis\tcalled\t "),a("em",[t._v("eventual\tconsistency")]),t._v(" .\tRather\tthan\nusing\ta\ttransactional\tboundary\tto\tensure\tthat\tthe\tsystem\tis\tin\ta\tconsistent\tstate\twhen\tthe\ntransaction\tcompletes,\tinstead\twe\taccept\tthat\tthe\tsystem\twill\tget\titself\tinto\ta\tconsistent\nstate\tat\tsome\tpoint\tin\tthe\tfuture.\tThis\tapproach\tis\tespecially\tuseful\twith\tbusiness\noperations\tthat\tmight\tbe\tlong-lived.\tWe’ll\tdiscuss\tthis\tidea\tin\tmore\tdepth\tin\tChapter\t11\nwhen\twe\tcover\tscaling\tpatterns.")]),t._v(" "),a("h2",{attrs:{id:"aborttheentireoperation"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#aborttheentireoperation"}},[t._v("#")]),t._v(" Abort\tthe\tEntire\tOperation")]),t._v(" "),a("p",[t._v("Another\toption\tis\tto\treject\tthe\tentire\toperation.\tIn\tthis\tcase,\twe\thave\tto\tput\tthe\tsystem\nback\tinto\ta\tconsistent\tstate.\tThe\tpicking\ttable\tis\teasy,\tas\tthat\tinsert\tfailed,\tbut\twe\thave\ta\ncommitted\ttransaction\tin\tthe\torder\ttable.\tWe\tneed\tto\tunwind\tthis.\tWhat\twe\thave\tto\tdo\tis\nissue\ta\t "),a("em",[t._v("compensating\ttransaction")]),t._v(" ,\tkicking\toff\ta\tnew\ttransaction\tto\twind\tback\twhat\tjust\nhappened.\tFor\tus,\tthat\tcould\tbe\tsomething\tas\tsimple\tas\tissuing\ta\tDELETE\tstatement\tto\nremove\tthe\torder\tfrom\tthe\tdatabase.\tThen\twe’d\talso\tneed\tto\treport\tback\tvia\tthe\tUI\tthat\tthe\noperation\tfailed.\tOur\tapplication\tcould\thandle\tboth\taspects\twithin\ta\tmonolithic\tsystem,\nbut\twe’d\thave\tto\tconsider\twhat\twe\tcould\tdo\twhen\twe\tsplit\tup\tthe\tapplication\tcode.\tDoes\nthe\tlogic\tto\thandle\tthe\tcompensating\ttransaction\tlive\tin\tthe\tcustomer\tservice,\tthe\torder\nservice,\tor\tsomewhere\telse?")]),t._v(" "),a("p",[t._v("But\twhat\thappens\tif\tour\tcompensating\ttransaction\tfails?\tIt’s\tcertainly\tpossible.\tThen\twe’d\nhave\tan\torder\tin\tthe\torder\ttable\twith\tno\tmatching\tpick\tinstruction.\tIn\tthis\tsituation,\tyou’d\neither\tneed\tto\tretry\tthe\tcompensating\ttransaction,\tor\tallow\tsome\tbackend\tprocess\tto\tclean\nup\tthe\tinconsistency\tlater\ton.\tThis\tcould\tbe\tsomething\tas\tsimple\tas\ta\tmaintenance\tscreen\nthat\tadmin\tstaff\thad\taccess\tto,\tor\tan\tautomated\tprocess.")]),t._v(" "),a("p",[t._v("Now\tthink\tabout\twhat\thappens\tif\twe\thave\tnot\tone\tor\ttwo\toperations\twe\twant\tto\tbe\nconsistent,\tbut\tthree,\tfour,\tor\tfive.\tHandling\tcompensating\ttransactions\tfor\teach\tfailure\nmode\tbecomes\tquite\tchallenging\tto\tcomprehend,\tlet\talone\timplement.")]),t._v(" "),a("h2",{attrs:{id:"distributedtransactions"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#distributedtransactions"}},[t._v("#")]),t._v(" Distributed\tTransactions")]),t._v(" "),a("p",[t._v("An\talternative\tto\tmanually\torchestrating\tcompensating\ttransactions\tis\tto\tuse\ta\t "),a("em",[t._v("distributed\ntransaction")]),t._v(" .\tDistributed\ttransactions\ttry\tto\tspan\tmultiple\ttransactions\twithin\tthem,\tusing\nsome\toverall\tgoverning\tprocess\tcalled\ta\t "),a("em",[t._v("transaction\tmanager")]),t._v(" \tto\torchestrate\tthe\tvarious\ntransactions\tbeing\tdone\tby\tunderlying\tsystems.\tJust\tas\twith\ta\tnormal\ttransaction,\ta\ndistributed\ttransaction\ttries\tto\tensure\tthat\teverything\tremains\tin\ta\tconsistent\tstate,\tonly\tin\nthis\tcase\tit\ttries\tto\tdo\tso\tacross\tmultiple\tdifferent\tsystems\trunning\tin\tdifferent\tprocesses,\noften\tcommunicating\tacross\tnetwork\tboundaries.")]),t._v(" "),a("p",[t._v("The\tmost\tcommon\talgorithm\tfor\thandling\tdistributed\ttransactions\t—\tespecially\tshort-\nlived\ttransactions,\tas\tin\tthe\tcase\tof\thandling\tour\tcustomer\torder\t—\tis\tto\tuse\ta\t "),a("em",[t._v("two-phase\ncommit")]),t._v(" .\tWith\ta\ttwo-phase\tcommit,\tfirst\tcomes\tthe\tvoting\tphase.\tThis\tis\twhere\teach\nparticipant\t(also\tcalled\ta\t "),a("em",[t._v("cohort")]),t._v(" \tin\tthis\tcontext)\tin\tthe\tdistributed\ttransaction\ttells\tthe\ntransaction\tmanager\twhether\tit\tthinks\tits\tlocal\ttransaction\tcan\tgo\tahead.\tIf\tthe\ttransaction\nmanager\tgets\ta\t "),a("em",[t._v("yes")]),t._v(" \tvote\tfrom\tall\tparticipants,\tthen\tit\ttells\tthem\tall\tto\tgo\tahead\tand\tperform\ntheir\tcommits.\tA\tsingle\t "),a("em",[t._v("no")]),t._v(" \tvote\tis\tenough\tfor\tthe\ttransaction\tmanager\tto\tsend\tout\ta\nrollback\tto\tall\tparties.")]),t._v(" "),a("p",[t._v("This\tapproach\trelies\ton\tall\tparties\thalting\tuntil\tthe\tcentral\tcoordinating\tprocess\ttells\tthem\nto\tproceed.\tThis\tmeans\twe\tare\tvulnerable\tto\toutages.\tIf\tthe\ttransaction\tmanager\tgoes\ndown,\tthe\tpending\ttransactions\tnever\tcomplete.\tIf\ta\tcohort\tfails\tto\trespond\tduring\tvoting,\neverything\tblocks.\tAnd\tthere\tis\talso\tthe\tcase\tof\twhat\thappens\tif\ta\tcommit\tfails\tafter\nvoting.\tThere\tis\tan\tassumption\timplicit\tin\tthis\talgorithm\tthat\tthis\tcannot\thappen:\tif\ta\ncohort\tsays\t "),a("em",[t._v("yes")]),t._v(" \tduring\tthe\tvoting\tperiod,\tthen\twe\thave\tto\tassume\tit\t "),a("em",[t._v("will")]),t._v(" \tcommit.\tCohorts\nneed\ta\tway\tof\tmaking\tthis\tcommit\twork\tat\tsome\tpoint.\tThis\tmeans\tthis\talgorithm\tisn’t\nfoolproof\t—\trather,\tit\tjust\ttries\tto\tcatch\tmost\tfailure\tcases.")]),t._v(" "),a("p",[t._v("This\tcoordination\tprocess\talso\tmean\tlocks;\tthat\tis,\tpending\ttransactions\tcan\thold\tlocks\ton\nresources.\tLocks\ton\tresources\tcan\tlead\tto\tcontention,\tmaking\tscaling\tsystems\tmuch\tmore\ndifficult,\tespecially\tin\tthe\tcontext\tof\tdistributed\tsystems.")]),t._v(" "),a("p",[t._v("Distributed\ttransactions\thave\tbeen\timplemented\tfor\tspecific\ttechnology\tstacks,\tsuch\tas\nJava’s\tTransaction\tAPI,\tallowing\tfor\tdisparate\tresources\tlike\ta\tdatabase\tand\ta\tmessage\nqueue\tto\tall\tparticipate\tin\tthe\tsame,\toverarching\ttransaction.\tThe\tvarious\talgorithms\tare\nhard\tto\tget\tright,\tso\tI’d\tsuggest\tyou\tavoid\ttrying\tto\tcreate\tyour\town.\tInstead,\tdo\tlots\tof\nresearch\ton\tthis\ttopic\tif\tthis\tseems\tlike\tthe\troute\tyou\twant\tto\ttake,\tand\tsee\tif\tyou\tcan\tuse\nan\texisting\timplementation.")]),t._v(" "),a("h2",{attrs:{id:"sowhattodo"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#sowhattodo"}},[t._v("#")]),t._v(" So\tWhat\tto\tDo?")]),t._v(" "),a("p",[t._v("All\tof\tthese\tsolutions\tadd\tcomplexity.\tAs\tyou\tcan\tsee,\tdistributed\ttransactions\tare\thard\tto\nget\tright\tand\tcan\tactually\tinhibit\tscaling.\tSystems\tthat\teventually\tconverge\tthrough\ncompensating\tretry\tlogic\tcan\tbe\tharder\tto\treason\tabout,\tand\tmay\tneed\tother\tcompensating\nbehavior\tto\tfix\tup\tinconsistencies\tin\tdata.")]),t._v(" "),a("p",[t._v("When\tyou\tencounter\tbusiness\toperations\tthat\tcurrently\toccur\twithin\ta\tsingle\ttransaction,\nask\tyourself\tif\tthey\treally\tneed\tto.\tCan\tthey\thappen\tin\tdifferent,\tlocal\ttransactions,\tand\nrely\ton\tthe\tconcept\tof\teventual\tconsistency?\tThese\tsystems\tare\tmuch\teasier\tto\tbuild\tand\nscale\t(we’ll\tdiscuss\tthis\tmore\tin\tChapter\t11).")]),t._v(" "),a("p",[t._v("If\tyou\tdo\tencounter\tstate\tthat\treally,\treally\twants\tto\tbe\tkept\tconsistent,\tdo\teverything\tyou\ncan\tto\tavoid\tsplitting\tit\tup\tin\tthe\tfirst\tplace.\tTry\t "),a("em",[t._v("really")]),t._v(" \thard.\tIf\tyou\treally\tneed\tto\tgo\tahead\nwith\tthe\tsplit,\tthink\tabout\tmoving\tfrom\ta\tpurely\ttechnical\tview\tof\tthe\tprocess\t(e.g.,\ta\ndatabase\ttransaction)\tand\tactually\tcreate\ta\tconcrete\tconcept\tto\trepresent\tthe\ttransaction\nitself.\tThis\tgives\tyou\ta\thandle,\tor\ta\thook,\ton\twhich\tto\trun\tother\toperations\tlike\ncompensating\ttransactions,\tand\ta\tway\tto\tmonitor\tand\tmanage\tthese\tmore\tcomplex\nconcepts\tin\tyour\tsystem.\tFor\texample,\tyou\tmight\tcreate\tthe\tidea\tof\tan\t“in-process-order”\nthat\tgives\tyou\ta\tnatural\tplace\tto\tfocus\tall\tlogic\taround\tprocessing\tthe\torder\tend\tto\tend\n(and\tdealing\twith\texceptions).")]),t._v(" "),a("h2",{attrs:{id:"reporting"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#reporting"}},[t._v("#")]),t._v(" Reporting")]),t._v(" "),a("p",[t._v("As\twe’ve\talready\tseen,\tin\tsplitting\ta\tservice\tinto\tsmaller\tparts,\twe\tneed\tto\talso\tpotentially\nsplit\tup\thow\tand\twhere\tdata\tis\tstored.\tThis\tcreates\ta\tproblem,\thowever,\twhen\tit\tcomes\tto\none\tvital\tand\tcommon\tuse\tcase:\treporting.")]),t._v(" "),a("p",[t._v("A\tchange\tin\tarchitecture\tas\tfundamental\tas\tmoving\tto\ta\tmicroservices\tarchitecture\twill\ncause\ta\tlot\tof\tdisruption,\tbut\tit\tdoesn’t\tmean\twe\thave\tto\tabandon\teverything\twe\tdo.\tThe\naudience\tof\tour\treporting\tsystems\tare\tusers\tlike\tany\tother,\tand\twe\tneed\tto\tconsider\ttheir\nneeds.\tIt\twould\tbe\tarrogant\tto\tfundamentally\tchange\tour\tarchitecture\tand\tjust\task\tthem\tto\nadapt.\tWhile\tI’m\tnot\tsuggesting\tthat\tthe\tspace\tof\treporting\tisn’t\tripe\tfor\tdisruption\t—\tit\ncertainly\tis\t—\tthere\tis\tvalue\tin\tdetermining\thow\tto\twork\twith\texisting\tprocesses\tfirst.\nSometimes\twe\thave\tto\tpick\tour\tbattles.")]),t._v(" "),a("h2",{attrs:{id:"thereportingdatabase"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#thereportingdatabase"}},[t._v("#")]),t._v(" The\tReporting\tDatabase")]),t._v(" "),a("p",[t._v("Reporting\ttypically\tneeds\tto\tgroup\ttogether\tdata\tfrom\tacross\tmultiple\tparts\tof\tour\norganization\tin\torder\tto\tgenerate\tuseful\toutput.\tFor\texample,\twe\tmight\twant\tto\tenrich\tthe\ndata\tfrom\tour\tgeneral\tledger\twith\tdescriptions\tof\twhat\twas\tsold,\twhich\twe\tget\tfrom\ta\ncatalog.\tOr\twe\tmight\twant\tto\tlook\tat\tthe\tshopping\tbehavior\tof\tspecific,\thigh-value\ncustomers,\twhich\tcould\trequire\tinformation\tfrom\ttheir\tpurchase\thistory\tand\ttheir\tcustomer\nprofile.")]),t._v(" "),a("p",[t._v("In\ta\tstandard,\tmonolithic\tservice\tarchitecture,\tall\tour\tdata\tis\tstored\tin\tone\tbig\tdatabase.\nThis\tmeans\tall\tthe\tdata\tis\tin\tone\tplace,\tso\treporting\tacross\tall\tthe\tinformation\tis\tactually\npretty\teasy,\tas\twe\tcan\tsimply\tjoin\tacross\tthe\tdata\tvia\tSQL\tqueries\tor\tthe\tlike.\tTypically\twe\nwon’t\trun\tthese\treports\ton\tthe\tmain\tdatabase\tfor\tfear\tof\tthe\tload\tgenerated\tby\tour\tqueries\nimpacting\tthe\tperformance\tof\tthe\tmain\tsystem,\tso\toften\tthese\treporting\tsystems\thang\ton\ta\nread\treplica\tas\tshown\tin\tFigure\t5-12.")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("Figure\t5-12.\tStandard\tread\treplication\n")])])]),a("p",[t._v("With\tthis\tapproach\twe\thave\tone\tsizeable\tupside\t—\tthat\tall\tthe\tdata\tis\talready\tin\tone\tplace,\nso\twe\tcan\tuse\tfairly\tstraightforward\ttools\tto\tquery\tit.\tBut\tthere\tare\talso\ta\tcouple\tof\ndownsides\twith\tthis\tapproach.\tFirst,\tthe\tschema\tof\tthe\tdatabase\tis\tnow\teffectively\ta\tshared\nAPI\tbetween\tthe\trunning\tmonolithic\tservices\tand\tany\treporting\tsystem.\tSo\ta\tchange\tin\nschema\thas\tto\tbe\tcarefully\tmanaged.\tIn\treality,\tthis\tis\tanother\timpediment\tthat\treduces\tthe\nchances\tof\tanyone\twanting\tto\ttake\ton\tthe\ttask\tof\tmaking\tand\tcoordinating\tsuch\ta\tchange.")]),t._v(" "),a("p",[t._v("Second,\twe\thave\tlimited\toptions\tas\tto\thow\tthe\tdatabase\tcan\tbe\toptimized\tfor\teither\tuse\ncase\t—\tbacking\tthe\tlive\tsystem\tor\tthe\treporting\tsystem.\tSome\tdatabases\tlet\tus\tmake")]),t._v(" "),a("p",[t._v("optimizations\ton\tread\treplicas\tto\tenable\tfaster,\tmore\tefficient\treporting;\tfor\texample,\nMySQL\twould\tallow\tus\tto\trun\ta\tdifferent\tbackend\tthat\tdoesn’t\thave\tthe\toverhead\tof\nmanaging\ttransactions.\tHowever,\twe\tcannot\tstructure\tthe\tdata\tdifferently\tto\tmake\nreporting\tfaster\tif\tthat\tchange\tin\tdata\tstructure\thas\ta\tbad\timpact\ton\tthe\trunning\tsystem.\nWhat\toften\thappens\tis\tthat\tthe\tschema\teither\tends\tup\tbeing\tgreat\tfor\tone\tuse\tcase\tand\nlousy\tfor\tthe\tother,\tor\telse\tbecomes\tthe\tlowest\tcommon\tdenominator,\tgreat\tfor\tneither\npurpose.")]),t._v(" "),a("p",[t._v("Finally,\tthe\tdatabase\toptions\tavailable\tto\tus\thave\texploded\trecently.\tWhile\tstandard\nrelational\tdatabases\texpose\tSQL\tquery\tinterfaces\tthat\twork\twith\tmany\treporting\ttools,\nthey\taren’t\talways\tthe\tbest\toption\tfor\tstoring\tdata\tfor\tour\trunning\tservices.\tWhat\tif\tour\napplication\tdata\tis\tbetter\tmodeled\tas\ta\tgraph,\tas\tin\tNeo4j?\tOr\twhat\tif\twe’d\trather\tuse\ta\ndocument\tstore\tlike\tMongoDB?\tLikewise,\twhat\tif\twe\twanted\tto\texplore\tusing\ta\tcolumn-\noriented\tdatabase\tlike\tCassandra\tfor\tour\treporting\tsystem,\twhich\tmakes\tit\tmuch\teasier\tto\nscale\tfor\tlarger\tvolumes?\tBeing\tconstrained\tin\thaving\tto\thave\tone\tdatabase\tfor\tboth\npurposes\tresults\tin\tus\toften\tnot\tbeing\table\tto\tmake\tthese\tchoices\tand\texplore\tnew\toptions.")]),t._v(" "),a("p",[t._v("So\tit’s\tnot\tperfect,\tbut\tit\tworks\t(mostly).\tNow\tif\tour\tinformation\tis\tstored\tin\tmultiple\ndifferent\tsystems,\twhat\tdo\twe\tdo?\tIs\tthere\ta\tway\tfor\tus\tto\tbring\tall\tthe\tdata\ttogether\tto\trun\nour\treports?\tAnd\tcould\twe\talso\tpotentially\tfind\ta\tway\tto\teliminate\tsome\tof\tthe\tdownsides\nassociated\twith\tthe\tstandard\treporting\tdatabase\tmodel?")]),t._v(" "),a("p",[t._v("It\tturns\tout\twe\thave\ta\tnumber\tof\tviable\talternatives\tto\tthis\tapproach.\tWhich\tsolution\nmakes\tthe\tmost\tsense\tto\tyou\twill\tdepend\ton\ta\tnumber\tof\tfactors,\tbut\twe’ll\texplore\ta\tfew\ndifferent\toptions\tthat\tI\thave\tseen\tin\tpractice.")]),t._v(" "),a("h2",{attrs:{id:"dataretrievalviaservicecalls"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#dataretrievalviaservicecalls"}},[t._v("#")]),t._v(" Data\tRetrieval\tvia\tService\tCalls")]),t._v(" "),a("p",[t._v("There\tare\tmany\tvariants\tof\tthis\tmodel,\tbut\tthey\tall\trely\ton\tpulling\tthe\trequired\tdata\tfrom\nthe\tsource\tsystems\tvia\tAPI\tcalls.\tFor\ta\tvery\tsimple\treporting\tsystem,\tlike\ta\tdashboard\tthat\nmight\tjust\twant\tto\tshow\tthe\tnumber\tof\torders\tplaced\tin\tthe\tlast\t15\tminutes,\tthis\tmight\tbe\nfine.\tTo\treport\tacross\tdata\tfrom\ttwo\tor\tmore\tsystems,\tyou\tneed\tto\tmake\tmultiple\tcalls\tto\nassemble\tthis\tdata.")]),t._v(" "),a("p",[t._v("This\tapproach\tbreaks\tdown\trapidly\twith\tuse\tcases\tthat\trequire\tlarger\tvolumes\tof\tdata,\nhowever.\tImagine\ta\tuse\tcase\twhere\twe\twant\tto\treport\ton\tcustomer\tpurchasing\tbehavior\tfor\nour\tmusic\tshop\tover\tthe\tlast\t24\tmonths,\tlooking\tat\tvarious\ttrends\tin\tcustomer\tbehavior\nand\thow\tthis\thas\timpacted\ton\trevenue.\tWe\tneed\tto\tpull\tlarge\tvolumes\tof\tdata\tfrom\tat\tleast\nthe\tcustomer\tand\tfinance\tsystems.\tKeeping\ta\tlocal\tcopy\tof\tthis\tdata\tin\tthe\treporting\nsystem\tis\tdangerous,\tas\twe\tmay\tnot\tknow\tif\tit\thas\tchanged\t(even\thistoric\tdata\tmay\tbe\nchanged\tafter\tthe\tfact),\tso\tto\tgenerate\tan\taccurate\treport\twe\tneed\tall\tof\tthe\tfinance\tand\ncustomer\trecords\tfor\tthe\tlast\ttwo\tyears.\tWith\teven\tmodest\tnumbers\tof\tcustomers,\tyou\tcan\nsee\tthat\tthis\tquickly\twill\tbecome\ta\tvery\tslow\toperation.")]),t._v(" "),a("p",[t._v("Reporting\tsystems\talso\toften\trely\ton\tthird-party\ttools\tthat\texpect\tto\tretrieve\tdata\tin\ta\ncertain\tway,\tand\there\tproviding\ta\tSQL\tinterface\tis\tthe\tfastest\tway\tto\tensure\tyour\treporting\ntool\tchain\tis\tas\teasy\tto\tintegrate\twith\tas\tpossible.\tWe\tcould\tstill\tuse\tthis\tapproach\tto\tpull\ndata\tperiodically\tinto\ta\tSQL\tdatabase,\tof\tcourse,\tbut\tthis\tstill\tpresents\tus\twith\tsome\nchallenges.")]),t._v(" "),a("p",[t._v("One\tof\tthe\tkey\tchallenges\tis\tthat\tthe\tAPIs\texposed\tby\tthe\tvarious\tmicroservices\tmay\twell\nnot\tbe\tdesigned\tfor\treporting\tuse\tcases.\tFor\texample,\ta\tcustomer\tservice\tmay\tallow\tus\tto\nfind\ta\tcustomer\tby\tan\tID,\tor\tsearch\tfor\ta\tcustomer\tby\tvarious\tfields,\tbut\twouldn’t\nnecessarily\texpose\tan\tAPI\tto\tretrieve\tall\tcustomers.\tThis\tcould\tlead\tto\tmany\tcalls\tbeing\nmade\tto\tretrieve\tall\tthe\tdata\t—\tfor\texample,\thaving\tto\titerate\tthrough\ta\tlist\tof\tall\tthe\ncustomers,\tmaking\ta\tseparate\tcall\tfor\teach\tone.\tNot\tonly\tcould\tthis\tbe\tinefficient\tfor\tthe\nreporting\tsystem,\tit\tcould\tgenerate\tload\tfor\tthe\tservice\tin\tquestion\ttoo.")]),t._v(" "),a("p",[t._v("While\twe\tcould\tspeed\tup\tsome\tof\tthe\tdata\tretrieval\tby\tadding\tcache\theaders\tto\tthe\nresources\texposed\tby\tour\tservice,\tand\thave\tthis\tdata\tcached\tin\tsomething\tlike\ta\treverse\nproxy,\tthe\tnature\tof\treporting\tis\toften\tthat\twe\taccess\tthe\t "),a("em",[t._v("long\ttail")]),t._v(" \tof\tdata.\tThis\tmeans\tthat\nwe\tmay\twell\trequest\tresources\tthat\tno\tone\telse\thas\trequested\tbefore\t(or\tat\tleast\tnot\tfor\ta\nsufficiently\tlong\ttime),\tresulting\tin\ta\tpotentially\texpensive\t "),a("em",[t._v("cache\tmiss")]),t._v(".")]),t._v(" "),a("p",[t._v("You\tcould\tresolve\tthis\tby\texposing\tbatch\tAPIs\tto\tmake\treporting\teasier.\tFor\texample,\tour\ncustomer\tservice\tcould\tallow\tyou\tto\tpass\ta\tlist\tof\tcustomer\tIDs\tto\tit\tto\tretrieve\tthem\tin\nbatches,\tor\tmay\teven\texpose\tan\tinterface\tthat\tlets\tyou\tpage\tthrough\tall\tthe\tcustomers.\tA\nmore\textreme\tversion\tof\tthis\tis\tto\tmodel\tthe\tbatch\trequest\tas\ta\tresource\tin\tits\town\tright.\nFor\texample,\tthe\tcustomer\tservice\tmight\texpose\tsomething\tlike\ta\tBatchCustomerExport\nresource\tendpoint.\tThe\tcalling\tsystem\twould\tPOST\ta\tBatchRequest,\tperhaps\tpassing\tin\ta")]),t._v(" "),a("p",[t._v("location\twhere\ta\tfile\tcan\tbe\tplaced\twith\tall\tthe\tdata.\tThe\tcustomer\tservice\twould\treturn\tan\nHTTP\t202\tresponse\tcode,\tindicating\tthat\tthe\trequest\twas\taccepted\tbut\thas\tnot\tyet\tbeen\nprocessed.\tThe\tcalling\tsystem\tcould\tthen\tpoll\tthe\tresource\twaiting\tuntil\tit\tretrieves\ta\t201\nCreated\tstatus,\tindicating\tthat\tthe\trequest\thas\tbeen\tfulfilled,\tand\tthen\tthe\tcalling\tsystem\ncould\tgo\tand\tfetch\tthe\tdata.\tThis\twould\tallow\tpotentially\tlarge\tdata\tfiles\tto\tbe\texported\nwithout\tthe\toverhead\tof\tbeing\tsent\tover\tHTTP;\tinstead,\tthe\tsystem\tcould\tsimply\tsave\ta\nCSV\tfile\tto\ta\tshared\tlocation.")]),t._v(" "),a("p",[t._v("I\thave\tseen\tthe\tpreceding\tapproach\tused\tfor\tbatch\tinsertion\tof\tdata,\twhere\tit\tworked\twell.\nI\tam\tless\tin\tfavor\tof\tit\tfor\treporting\tsystems,\thowever,\tas\tI\tfeel\tthat\tthere\tare\tother,\npotentially\tsimpler\tsolutions\tthat\tcan\tscale\tmore\teffectively\twhen\tyou’re\tdealing\twith\ntraditional\treporting\tneeds.")]),t._v(" "),a("h2",{attrs:{id:"datapumps"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#datapumps"}},[t._v("#")]),t._v(" Data\tPumps")]),t._v(" "),a("p",[t._v("Rather\tthan\thave\tthe\treporting\tsystem\tpull\tthe\tdata,\twe\tcould\tinstead\thave\tthe\tdata\tpushed\nto\tthe\treporting\tsystem.\tOne\tof\tthe\tdownsides\tof\tretrieving\tthe\tdata\tby\tstandard\tHTTP\ncalls\tis\tthe\toverhead\tof\tHTTP\twhen\twe’re\tmaking\ta\tlarge\tnumber\tof\tcalls,\ttogether\twith\nthe\toverhead\tof\thaving\tto\tcreate\tAPIs\tthat\tmay\texist\tonly\tfor\treporting\tpurposes.\tAn\nalternative\toption\tis\tto\thave\ta\tstandalone\tprogram\tthat\tdirectly\taccesses\tthe\tdatabase\tof\nthe\tservice\tthat\tis\tthe\tsource\tof\tdata,\tand\tpumps\tit\tinto\ta\treporting\tdatabase,\tas\tshown\tin\nFigure\t5-13.")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("Figure\t5-13.\tUsing\ta\tdata\tpump\tto\tperiodically\tpush\tdata\tto\ta\tcentral\treporting\tdatabase\n")])])]),a("p",[t._v("At\tthis\tpoint\tyou’ll\tbe\tsaying,\t“But\tSam,\tyou\tsaid\thaving\tlots\tof\tprograms\tintegrating\ton\nthe\tsame\tdatabase\tis\ta\tbad\tidea!”\tAt\tleast\tI\t "),a("em",[t._v("hope")]),t._v(" \tyou’ll\tbe\tsaying\tthat,\tgiven\thow\tfirmly\tI\nmade\tthe\tpoint\tearlier!\tThis\tapproach,\tif\timplemented\tproperly,\tis\ta\tnotable\texception,\nwhere\tthe\tdownsides\tof\tthe\tcoupling\tare\tmore\tthan\tmitigated\tby\tmaking\tthe\treporting\neasier.")]),t._v(" "),a("p",[t._v("To\tstart\twith,\tthe\tdata\tpump\tshould\tbe\tbuilt\tand\tmanaged\tby\tthe\tsame\tteam\tthat\tmanages\nthe\tservice.\tThis\tcan\tbe\tsomething\tas\tsimple\tas\ta\tcommand-line\tprogram\ttriggered\tvia\nCron.\tThis\tprogram\tneeds\tto\thave\tintimate\tknowledge\tof\tboth\tthe\tinternal\tdatabase\tfor\tthe\nservice,\tand\talso\tthe\treporting\tschema.\tThe\tpump’s\tjob\tis\tto\tmap\tone\tfrom\tthe\tother.\tWe\ntry\tto\treduce\tthe\tproblems\twith\tcoupling\tto\tthe\tservice’s\tschema\tby\thaving\tthe\tsame\tteam\nthat\tmanages\tthe\tservice\talso\tmanage\tthe\tpump.\tI\twould\tsuggest,\tin\tfact,\tthat\tyou\tversion-\ncontrol\tthese\ttogether,\tand\thave\tbuilds\tof\tthe\tdata\tpump\tcreated\tas\tan\tadditional\tartifact\tas\npart\tof\tthe\tbuild\tof\tthe\tservice\titself,\twith\tthe\tassumption\tthat\twhenever\tyou\tdeploy\tone\tof\nthem,\tyou\tdeploy\tthem\tboth.\tAs\twe\texplicitly\tstate\tthat\twe\tdeploy\tthese\ttogether,\tand\ndon’t\topen\tup\taccess\tto\tthe\tschema\tto\tanyone\toutside\tof\tthe\tservice\tteam,\tmany\tof\tthe\ntraditional\tDB\tintegration\tchallenges\tare\tlargely\tmitigated.")]),t._v(" "),a("p",[t._v("The\tcoupling\ton\tthe\treporting\tschema\titself\tremains,\tbut\twe\thave\tto\ttreat\tit\tas\ta\tpublished\nAPI\tthat\tis\thard\tto\tchange.\tSome\tdatabases\tgive\tus\ttechniques\twhere\twe\tcould\tfurther\nmitigate\tthis\tcost.\tFigure\t5-14\tshows\tan\texample\tof\tthis\tfor\trelational\tdatabases,\twhere\twe\ncould\thave\tone\tschema\tin\tthe\treporting\tdatabase\tfor\teach\tservice,\tusing\tthings\tlike")]),t._v(" "),a("p",[t._v("materialized\tviews\tto\tcreate\tthe\taggregated\tview.\tThat\tway,\twe\texpose\tonly\tthe\treporting\nschema\tfor\tthe\tcustomer\tdata\tto\tthe\tcustomer\tdata\tpump.\tWhether\tthis\tis\tsomething\tthat\nyou\tcan\tdo\tin\ta\tperformant\tmanner,\thowever,\twill\tdepend\ton\tthe\tcapabilities\tof\tthe\ndatabase\tyou\tpicked\tfor\treporting.")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("Figure\t5-14.\tUtilizing\tmaterialized\tviews\tto\tform\ta\tsingle\tmonolithic\treporting\tschema\n")])])]),a("p",[t._v("Here,\tof\tcourse,\tthe\tcomplexity\tof\tintegration\tis\tpushed\tdeeper\tinto\tthe\tschema,\tand\twill\nrely\ton\tcapabilities\tin\tthe\tdatabase\tto\tmake\tsuch\ta\tsetup\tperformant.\tWhile\tI\tthink\tdata\npumps\tin\tgeneral\tare\ta\tsensible\tand\tworkable\tsuggestion,\tI\tam\tless\tconvinced\tthat\tthe\ncomplexity\tof\ta\tsegmented\tschema\tis\tworthwhile,\tespecially\tgiven\tthe\tchallenges\tin\nmanaging\tchange\tin\tthe\tdatabase.")]),t._v(" "),a("h2",{attrs:{id:"alternativedestinations"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#alternativedestinations"}},[t._v("#")]),t._v(" Alternative\tDestinations")]),t._v(" "),a("p",[t._v("On\tone\tproject\tI\twas\tinvolved\twith,\twe\tused\ta\tseries\tof\tdata\tpumps\tto\tpopulate\tJSON\tfiles\nin\tAWS\tS3,\teffectively\tusing\tS3\tto\tmasquerade\tas\ta\tgiant\tdata\tmart!\tThis\tapproach\nworked\tvery\twell\tuntil\twe\tneeded\tto\tscale\tour\tsolution,\tand\tat\tthe\ttime\tof\twriting\twe\tare\nlooking\tto\tchange\tthese\tpumps\tto\tinstead\tpopulate\ta\tcube\tthat\tcan\tbe\tintegrated\twith\nstandard\treporting\ttools\tlike\tExcel\tand\tTableau.")]),t._v(" "),a("h2",{attrs:{id:"eventdatapump"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#eventdatapump"}},[t._v("#")]),t._v(" Event\tData\tPump")]),t._v(" "),a("p",[t._v("In\tChapter\t4,\twe\ttouched\ton\tthe\tidea\tof\tmicroservices\temitting\tevents\tbased\ton\tthe\tstate\nchange\tof\tentities\tthat\tthey\tmanage.\tFor\texample,\tour\tcustomer\tservice\tmay\temit\tan\tevent\nwhen\ta\tgiven\tcustomer\tis\tcreated,\tor\tupdated,\tor\tdeleted.\tFor\tthose\tmicroservices\tthat\nexpose\tsuch\tevent\tfeeds,\twe\thave\tthe\toption\tof\twriting\tour\town\tevent\tsubscriber\tthat\npumps\tdata\tinto\tthe\treporting\tdatabase,\tas\tshown\tin\tFigure\t5-15.")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("Figure\t5-15.\tAn\tevent\tdata\tpump\tusing\tstate\tchange\tevents\tto\tpopulate\ta\treporting\tdatabase\n")])])]),a("p",[t._v("The\tcoupling\ton\tthe\tunderlying\tdatabase\tof\tthe\tsource\tmicroservice\tis\tnow\tavoided.\nInstead,\twe\tare\tjust\tbinding\tto\tthe\tevents\temitted\tby\tthe\tservice,\twhich\tare\tdesigned\tto\tbe\nexposed\tto\texternal\tconsumers.\tGiven\tthat\tevents\tare\ttemporal\tin\tnature,\tit\talso\tmakes\tit\neasier\tfor\tus\tto\tbe\tsmarter\tin\twhat\tdata\twe\tsent\tto\tour\tcentral\treporting\tstore;\twe\tcan\tsend\ndata\tto\tthe\treporting\tsystem\tas\twe\tsee\tan\tevent,\tallowing\tdata\tto\tflow\tfaster\tto\tour\nreporting\tsystem,\trather\tthan\trelying\ton\ta\tregular\tschedule\tas\twith\tthe\tdata\tpump.")]),t._v(" "),a("p",[t._v("Also,\tif\twe\tstore\twhich\tevents\thave\talready\tbeen\tprocessed,\twe\tcan\tjust\tprocess\tthe\tnew\nevents\tas\tthey\tarrive,\tassuming\tthe\told\tevents\thave\talready\tbeen\tmapped\tinto\tthe\treporting\nsystem.\tThis\tmeans\tour\tinsertion\twill\tbe\tmore\tefficient,\tas\twe\tonly\tneed\tto\tsend\tdeltas.\nWe\tcan\tdo\tsimilar\tthings\twith\ta\tdata\tpump,\tbut\twe\thave\tto\tmanage\tthis\tourselves,\twhereas\nthe\tfundamentally\ttemporal\tnature\tof\tthe\tstream\tof\tevents\t( "),a("em",[t._v("x")]),t._v(" \thappens\tat\ttimestamp\t "),a("em",[t._v("y")]),t._v(" )\nhelps\tus\tgreatly.")]),t._v(" "),a("p",[t._v("As\tour\tevent\tdata\tpump\tis\tless\tcoupled\tto\tthe\tinternals\tof\tthe\tservice,\tit\tis\talso\teasier\tto\nconsider\tthis\tbeing\tmanaged\tby\ta\tseparate\tgroup\tfrom\tthe\tteam\tlooking\tafter\tthe\nmicroservice\titself.\tAs\tlong\tas\tthe\tnature\tof\tour\tevent\tstream\tdoesn’t\toverly\tcouple\nsubscribers\tto\tchanges\tin\tthe\tservice,\tthis\tevent\tmapper\tcan\tevolve\tindependently\tof\tthe\nservice\tit\tsubscribes\tto.")]),t._v(" "),a("p",[t._v("The\tmain\tdownsides\tto\tthis\tapproach\tare\tthat\tall\tthe\trequired\tinformation\tmust\tbe\nbroadcast\tas\tevents,\tand\tit\tmay\tnot\tscale\tas\twell\tas\ta\tdata\tpump\tfor\tlarger\tvolumes\tof\tdata\nthat\thas\tthe\tbenefit\tof\toperating\tdirectly\tat\tthe\tdatabase\tlevel.\tNonetheless,\tthe\tlooser\ncoupling\tand\tfresher\tdata\tavailable\tvia\tsuch\tan\tapproach\tmakes\tit\tstrongly\tworth\nconsidering\tif\tyou\tare\talready\texposing\tthe\tappropriate\tevents.")]),t._v(" "),a("h2",{attrs:{id:"backupdatapump"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#backupdatapump"}},[t._v("#")]),t._v(" Backup\tData\tPump")]),t._v(" "),a("p",[t._v("This\toption\tis\tbased\ton\tan\tapproach\tused\tat\tNetflix,\twhich\ttakes\tadvantage\tof\texisting\nbackup\tsolutions\tand\talso\tresolves\tsome\tscale\tissues\tthat\tNetflix\thas\tto\tdeal\twith.\tIn\tsome\nways,\tyou\tcan\tconsider\tthis\ta\tspecial\tcase\tof\ta\tdata\tpump,\tbut\tit\tseemed\tlike\tsuch\tan\ninteresting\tsolution\tthat\tit\tdeserves\tinclusion.")]),t._v(" "),a("p",[t._v("Netflix\thas\tdecided\tto\tstandardize\ton\tCassandra\tas\tthe\tbacking\tstore\tfor\tits\tservices,\tof\nwhich\tthere\tare\tmany.\tNetflix\thas\tinvested\tsignificant\ttime\tin\tbuilding\ttools\tto\tmake\nCassandra\teasy\tto\twork\twith,\tmuch\tof\twhich\tthe\tcompany\thas\tshared\twith\tthe\trest\tof\tthe\nworld\tvia\tnumerous\topen\tsource\tprojects.\tObviously\tit\tis\tvery\timportant\tthat\tthe\tdata\nNetflix\tstores\tis\tproperly\tbacked\tup.\tTo\tback\tup\tCassandra\tdata,\tthe\tstandard\tapproach\tis\nto\tmake\ta\tcopy\tof\tthe\tdata\tfiles\tthat\tback\tit\tand\tstore\tthem\tsomewhere\tsafe.\tNetflix\tstores\nthese\tfiles,\tknown\tas\tSSTables,\tin\tAmazon’s\tS3\tobject\tstore,\twhich\tprovides\tsignificant\ndata\tdurability\tguarantees.")]),t._v(" "),a("p",[t._v("Netflix\tneeds\tto\treport\tacross\tall\tthis\tdata,\tbut\tgiven\tthe\tscale\tinvolved\tthis\tis\ta\tnontrivial\nchallenge.\tIts\tapproach\tis\tto\tuse\tHadoop\tthat\tuses\tSSTable\tbackup\tas\tthe\tsource\tof\tits\njobs.\tIn\tthe\tend,\tNetflix\tended\tup\timplementing\ta\tpipeline\tcapable\tof\tprocessing\tlarge\namounts\tof\tdata\tusing\tthis\tapproach,\twhich\tit\tthen\topen\tsourced\tas\tthe\tAegisthus\tproject.\nLike\tdata\tpumps,\tthough,\twith\tthis\tpattern\twe\tstill\thave\ta\tcoupling\tto\tthe\tdestination\nreporting\tschema\t(or\ttarget\tsystem).")]),t._v(" "),a("p",[t._v("It\tis\tconceivable\tthat\tusing\ta\tsimilar\tapproach\t—\tthat\tis,\tusing\tmappers\tthat\twork\toff\nbackups\t—\twould\twork\tin\tother\tcontexts\tas\twell.\tAnd\tif\tyou’re\talready\tusing\tCassandra,\nNetflix\thas\talready\tdone\tmuch\tof\tthe\twork\tfor\tyou!")]),t._v(" "),a("h2",{attrs:{id:"towardrealtime"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#towardrealtime"}},[t._v("#")]),t._v(" Toward\tReal\tTime")]),t._v(" "),a("p",[t._v("Many\tof\tthe\tpatterns\tpreviously\toutlined\tare\tdifferent\tways\tof\tgetting\ta\tlot\tof\tdata\tfrom\nmany\tdifferent\tplaces\tto\tone\tplace.\tBut\tdoes\tthe\tidea\tthat\tall\tour\treporting\twill\tbe\tdone\nfrom\tone\tlocation\treally\tstack\tup\tanymore?\tWe\thave\tdashboards,\talerting,\tfinancial\nreports,\tuser\tanalytics\t—\tall\tof\tthese\tuse\tcases\thave\tdifferent\ttolerances\tfor\taccuracy\tand\ntimeliness,\twhich\tmay\tresult\tin\tdifferent\ttechnical\toptions\tcoming\tto\tbear.\tAs\tI\twill\tdetail\nin\tChapter\t8,\twe\tare\tmoving\tmore\tand\tmore\ttoward\tgeneric\teventing\tsystems\tcapable\tof\nrouting\tour\tdata\tto\tmultiple\tdifferent\tplaces\tdepending\ton\tneed.")]),t._v(" "),a("h2",{attrs:{id:"costofchange"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#costofchange"}},[t._v("#")]),t._v(" Cost\tof\tChange")]),t._v(" "),a("p",[t._v("There\tare\tmany\treasons\twhy,\tthroughout\tthe\tbook,\tI\tpromote\tthe\tneed\tto\tmake\tsmall,\nincremental\tchanges,\tbut\tone\tof\tthe\tkey\tdrivers\tis\tto\tunderstand\tthe\timpact\tof\teach\nalteration\twe\tmake\tand\tchange\tcourse\tif\trequired.\tThis\tallows\tus\tto\tbetter\tmitigate\tthe\ncost\tof\tmistakes,\tbut\tdoesn’t\tremove\tthe\tchance\tof\tmistakes\tentirely.\tWe\tcan\t—\tand\twill\n—\tmake\tmistakes,\tand\twe\tshould\tembrace\tthat.\tWhat\twe\tshould\talso\tdo,\tthough,\tis\nunderstand\thow\tbest\tto\tmitigate\tthe\tcosts\tof\tthose\tmistakes.")]),t._v(" "),a("p",[t._v("As\twe\thave\tseen,\tthe\tcost\tinvolved\tin\tmoving\tcode\taround\twithin\ta\tcodebase\tis\tpretty\nsmall.\tWe\thave\tlots\tof\ttools\tthat\tsupport\tus,\tand\tif\twe\tcause\ta\tproblem,\tthe\tfix\tis\tgenerally\nquick.\tSplitting\tapart\ta\tdatabase,\thowever,\tis\tmuch\tmore\twork,\tand\trolling\tback\ta\tdatabase\nchange\tis\tjust\tas\tcomplex.\tLikewise,\tuntangling\tan\toverly\tcoupled\tintegration\tbetween\nservices,\tor\thaving\tto\tcompletely\trewrite\tan\tAPI\tthat\tis\tused\tby\tmultiple\tconsumers,\tcan\nbe\ta\tsizeable\tundertaking.\tThe\tlarge\tcost\tof\tchange\tmeans\tthat\tthese\toperations\tare\nincreasingly\trisky.\tHow\tcan\twe\tmanage\tthis\trisk?\tMy\tapproach\tis\tto\ttry\tto\tmake\tmistakes\nwhere\tthe\timpact\twill\tbe\tlowest.")]),t._v(" "),a("p",[t._v("I\ttend\tto\tdo\tmuch\tof\tmy\tthinking\tin\tthe\tplace\twhere\tthe\tcost\tof\tchange\tand\tthe\tcost\tof\nmistakes\tis\tas\tlow\tas\tit\tcan\tbe:\tthe\twhiteboard.\tSketch\tout\tyour\tproposed\tdesign.\tSee\twhat\nhappens\twhen\tyou\trun\tuse\tcases\tacross\twhat\tyou\tthink\tyour\tservice\tboundaries\twill\tbe.\nFor\tour\tmusic\tshop,\tfor\texample,\timagine\twhat\thappens\twhen\ta\tcustomer\tsearches\tfor\ta\nrecord,\tregisters\twith\tthe\twebsite,\tor\tpurchases\tan\talbum.\tWhat\tcalls\tget\tmade?\tDo\tyou\nstart\tseeing\todd\tcircular\treferences?\tDo\tyou\tsee\ttwo\tservices\tthat\tare\toverly\tchatty,\twhich\nmight\tindicate\tthey\tshould\tbe\tone\tthing?")]),t._v(" "),a("p",[t._v("A\tgreat\ttechnique\there\tis\tto\tadapt\tan\tapproach\tmore\ttypically\ttaught\tfor\tthe\tdesign\tof\nobject-oriented\tsystems:\tclass-responsibility-collaboration\t(CRC)\tcards.\tWith\tCRC\tcards,\nyou\twrite\ton\tone\tindex\tcard\tthe\tname\tof\tthe\tclass,\twhat\tits\tresponsibilities\tare,\tand\twho\tit\ncollaborates\twith.\tWhen\tworking\tthrough\ta\tproposed\tdesign,\tfor\teach\tservice\tI\tlist\tits\nresponsibilities\tin\tterms\tof\tthe\tcapabilities\tit\tprovides,\twith\tthe\tcollaborators\tspecified\tin\nthe\tdiagram.\tAs\tyou\twork\tthrough\tmore\tuse\tcases,\tyou\tstart\tto\tget\ta\tsense\tas\tto\twhether\nall\tof\tthis\thangs\ttogether\tproperly.")]),t._v(" "),a("h2",{attrs:{id:"understandingrootcauses"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#understandingrootcauses"}},[t._v("#")]),t._v(" Understanding\tRoot\tCauses")]),t._v(" "),a("p",[t._v("We\thave\tdiscussed\thow\tto\tsplit\tapart\tlarger\tservices\tinto\tsmaller\tones,\tbut\twhy\tdid\tthese\nservices\tgrow\tso\tlarge\tin\tthe\tfirst\tplace?\tThe\tfirst\tthing\tto\tunderstand\tis\tthat\tgrowing\ta\nservice\tto\tthe\tpoint\tthat\tit\tneeds\tto\tbe\tsplit\tis\tcompletely\tOK.\tWe\t "),a("em",[t._v("want")]),t._v(" \tthe\tarchitecture\tof\nour\tsystem\tto\tchange\tover\ttime\tin\tan\tincremental\tfashion.\tThe\tkey\tis\tknowing\tit\tneeds\tto\nbe\tsplit\tbefore\tthe\tsplit\tbecomes\ttoo\texpensive.")]),t._v(" "),a("p",[t._v("But\tin\tpractice\tmany\tof\tus\twill\thave\tseen\tservices\tgrow\twell\tbeyond\tthe\tpoint\tof\tsanity.\nDespite\tknowing\tthat\ta\tsmaller\tset\tof\tservices\twould\tbe\teasier\tto\tdeal\twith\tthan\tthe\thuge\nmonstrosity\twe\tcurrently\thave,\twe\tstill\tplow\ton\twith\tgrowing\tthe\tbeast.\tWhy?")]),t._v(" "),a("p",[t._v("Part\tof\tthe\tproblem\tis\tknowing\twhere\tto\tstart,\tand\tI’m\thoping\tthis\tchapter\thas\thelped.\tBut\nanother\tchallenge\tis\tthe\tcost\tassociated\twith\tsplitting\tout\tservices.\tFinding\tsomewhere\tto\nrun\tthe\tservice,\tspinning\tup\ta\tnew\tservice\tstack,\tand\tso\ton,\tare\tnontrivial\ttasks.\tSo\thow\tdo\nwe\taddress\tthis?\tWell,\tif\tdoing\tsomething\tis\tright\tbut\tdifficult,\twe\tshould\tstrive\tto\tmake\nthings\teasier.\tInvestment\tin\tlibraries\tand\tlightweight\tservice\tframeworks\tcan\treduce\tthe\ncost\tassociated\twith\tcreating\tthe\tnew\tservice.\tGiving\tpeople\taccess\tto\tself-service\nprovision\tvirtual\tmachines\tor\teven\tmaking\ta\tplatform\tas\ta\tservice\t(PaaS)\tavailable\twill\nmake\tit\teasier\tto\tprovision\tsystems\tand\ttest\tthem.\tThroughout\tthe\trest\tof\tthe\tbook,\twe’ll\nbe\tdiscussing\ta\tnumber\tof\tways\tto\thelp\tyou\tkeep\tthis\tcost\tdown.")]),t._v(" "),a("h2",{attrs:{id:"summary-5"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#summary-5"}},[t._v("#")]),t._v(" Summary")]),t._v(" "),a("p",[t._v("We\tdecompose\tour\tsystem\tby\tfinding\tseams\talong\twhich\tservice\tboundaries\tcan\temerge,\nand\tthis\tcan\tbe\tan\tincremental\tapproach.\tBy\tgetting\tgood\tat\tfinding\tthese\tseams\tand\nworking\tto\treduce\tthe\tcost\tof\tsplitting\tout\tservices\tin\tthe\tfirst\tplace,\twe\tcan\tcontinue\tto\ngrow\tand\tevolve\tour\tsystems\tto\tmeet\twhatever\trequirements\tcome\tdown\tthe\troad.\tAs\tyou\ncan\tsee,\tsome\tof\tthis\twork\tcan\tbe\tpainstaking.\tBut\tthe\tvery\tfact\tthat\tit\tcan\tbe\tdone\nincrementally\tmeans\tthere\tis\tno\tneed\tto\tfear\tthis\twork.")]),t._v(" "),a("p",[t._v("So\tnow\twe\tcan\tsplit\tour\tservices\tout,\tbut\twe’ve\tintroduced\tsome\tnew\tproblems\ttoo.\tWe\nhave\tmany\tmore\tmoving\tparts\tto\tget\tinto\tproduction\tnow!\tSo\tnext\tup\twe’ll\tdive\tinto\tthe\nworld\tof\tdeployment.")]),t._v(" "),a("h1",{attrs:{id:"chapter6-deployment"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#chapter6-deployment"}},[t._v("#")]),t._v(" Chapter\t6.\tDeployment")]),t._v(" "),a("p",[t._v("Deploying\ta\tmonolithic\tapplication\tis\ta\tfairly\tstraightforward\tprocess.\tMicroservices,\twith\ntheir\tinterdependence,\tare\ta\tdifferent\tkettle\tof\tfish\taltogether.\tIf\tyou\tdon’t\tapproach\ndeployment\tright,\tit’s\tone\tof\tthose\tareas\twhere\tthe\tcomplexity\tcan\tmake\tyour\tlife\ta\nmisery.\tIn\tthis\tchapter,\twe’re\tgoing\tto\tlook\tat\tsome\ttechniques\tand\ttechnology\tthat\tcan\nhelp\tus\twhen\tdeploying\tmicroservices\tinto\tfine-grained\tarchitectures.")]),t._v(" "),a("p",[t._v("We’re\tgoing\tto\tstart\toff,\tthough,\tby\ttaking\ta\tlook\tat\tcontinuous\tintegration\tand\tcontinuous\ndelivery.\tThese\trelated\tbut\tdifferent\tconcepts\twill\thelp\tshape\tthe\tother\tdecisions\twe’ll\nmake\twhen\tthinking\tabout\twhat\tto\tbuild,\thow\tto\tbuild\tit,\tand\thow\tto\tdeploy\tit.")]),t._v(" "),a("h2",{attrs:{id:"abriefintroductiontocontinuousintegration"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#abriefintroductiontocontinuousintegration"}},[t._v("#")]),t._v(" A\tBrief\tIntroduction\tto\tContinuous\tIntegration")]),t._v(" "),a("p",[a("em",[t._v("Continuous\tintegration\t(CI)")]),t._v(" \thas\tbeen\taround\tfor\ta\tnumber\tof\tyears\tat\tthis\tpoint.\tIt’s\tworth\nspending\ta\tbit\tof\ttime\tgoing\tover\tthe\tbasics,\thowever,\tas\tespecially\twhen\twe\tthink\tabout\nthe\tmapping\tbetween\tmicroservices,\tbuilds,\tand\tversion\tcontrol\trepositories,\tthere\tare\nsome\tdifferent\toptions\tto\tconsider.")]),t._v(" "),a("p",[t._v("With\tCI,\tthe\tcore\tgoal\tis\tto\tkeep\teveryone\tin\tsync\twith\teach\tother,\twhich\twe\tachieve\tby\nmaking\tsure\tthat\tnewly\tchecked-in\tcode\tproperly\tintegrates\twith\texisting\tcode.\tTo\tdo\tthis,\na\tCI\tserver\tdetects\tthat\tthe\tcode\thas\tbeen\tcommitted,\tchecks\tit\tout,\tand\tcarries\tout\tsome\nverification\tlike\tmaking\tsure\tthe\tcode\tcompiles\tand\tthat\ttests\tpass.")]),t._v(" "),a("p",[t._v("As\tpart\tof\tthis\tprocess,\twe\toften\tcreate\tartifact(s)\tthat\tare\tused\tfor\tfurther\tvalidation,\tsuch\nas\tdeploying\ta\trunning\tservice\tto\trun\ttests\tagainst\tit.\tIdeally,\twe\twant\tto\tbuild\tthese\nartifacts\tonce\tand\tonce\tonly,\tand\tuse\tthem\tfor\tall\tdeployments\tof\tthat\tversion\tof\tthe\tcode.\nThis\tis\tin\torder\tto\tavoid\tdoing\tthe\tsame\tthing\tover\tand\tover\tagain,\tand\tso\tthat\twe\tcan\nconfirm\tthat\tthe\tartifact\twe\tdeployed\tis\tthe\tone\twe\ttested.\tTo\tenable\tthese\tartifacts\tto\tbe\nreused,\twe\tplace\tthem\tin\ta\trepository\tof\tsome\tsort,\teither\tprovided\tby\tthe\tCI\ttool\titself\tor\non\ta\tseparate\tsystem.")]),t._v(" "),a("p",[t._v("We’ll\tbe\tlooking\tat\twhat\tsorts\tof\tartifacts\twe\tcan\tuse\tfor\tmicroservices\tshortly,\tand\twe’ll\nlook\tin\tdepth\tat\ttesting\tin\tChapter\t7.")]),t._v(" "),a("p",[t._v("CI\thas\ta\tnumber\tof\tbenefits.\tWe\tget\tsome\tlevel\tof\tfast\tfeedback\tas\tto\tthe\tquality\tof\tour\ncode.\tIt\tallows\tus\tto\tautomate\tthe\tcreation\tof\tour\tbinary\tartifacts.\tAll\tthe\tcode\trequired\tto\nbuild\tthe\tartifact\tis\titself\tversion\tcontrolled,\tso\twe\tcan\tre-create\tthe\tartifact\tif\tneeded.\tWe\nalso\tget\tsome\tlevel\tof\ttraceability\tfrom\ta\tdeployed\tartifact\tback\tto\tthe\tcode,\tand\ndepending\ton\tthe\tcapabilities\tof\tthe\tCI\ttool\titself,\tcan\tsee\twhat\ttests\twere\trun\ton\tthe\tcode\nand\tartifact\ttoo.\tIt’s\tfor\tthese\treasons\tthat\tCI\thas\tbeen\tso\tsuccessful.")]),t._v(" "),a("h2",{attrs:{id:"areyoureallydoingit"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#areyoureallydoingit"}},[t._v("#")]),t._v(" Are\tYou\tReally\tDoing\tIt?")]),t._v(" "),a("p",[t._v("I\tsuspect\tyou\tare\tprobably\tusing\tcontinuous\tintegration\tin\tyour\town\torganization.\tIf\tnot,\nyou\tshould\tstart.\tIt\tis\ta\tkey\tpractice\tthat\tallows\tus\tto\tmake\tchanges\tquickly\tand\teasily,\tand\nwithout\twhich\tthe\tjourney\tinto\tmicroservices\twill\tbe\tpainful.\tThat\tsaid,\tI\thave\tworked\nwith\tmany\tteams\twho,\tdespite\tsaying\tthat\tthey\tdo\tCI,\taren’t\tactually\tdoing\tit\tat\tall.\tThey\nconfuse\tthe\tuse\tof\ta\tCI\ttool\twith\tadopting\tthe\tpractice\tof\tCI.\tThe\ttool\tis\tjust\tsomething\nthat\tenables\tthe\tapproach.")]),t._v(" "),a("p",[t._v("I\treally\tlike\tJez\tHumble’s\tthree\tquestions\the\tasks\tpeople\tto\ttest\tif\tthey\treally\tunderstand\nwhat\tCI\tis\tabout:")]),t._v(" "),a("p",[a("em",[t._v("Do\tyou\tcheck\tin\tto\tmainline\tonce\tper\tday?")])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("You\tneed\tto\tmake\tsure\tyour\tcode\tintegrates.\tIf\tyou\tdon’t\tcheck\tyour\tcode\ttogether\nwith\teveryone\telse’s\tchanges\tfrequently,\tyou\tend\tup\tmaking\tfuture\tintegration\tharder.\nEven\tif\tyou\tare\tusing\tshort-lived\tbranches\tto\tmanage\tchanges,\tintegrate\tas\tfrequently\nas\tyou\tcan\tinto\ta\tsingle\tmainline\tbranch.\n")])])]),a("p",[a("em",[t._v("Do\tyou\thave\ta\tsuite\tof\ttests\tto\tvalidate\tyour\tchanges?")])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("Without\ttests,\twe\tjust\tknow\tthat\tsyntactically\tour\tintegration\thas\tworked,\tbut\twe\ndon’t\tknow\tif\twe\thave\tbroken\tthe\tbehavior\tof\tthe\tsystem.\tCI\twithout\tsome\nverification\tthat\tour\tcode\tbehaves\tas\texpected\tisn’t\tCI.\n")])])]),a("p",[a("em",[t._v("When\tthe\tbuild\tis\tbroken,\tis\tit\tthe\t#1\tpriority\tof\tthe\tteam\tto\tfix\tit?")])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("A\tpassing\tgreen\tbuild\tmeans\tour\tchanges\thave\tsafely\tbeen\tintegrated.\tA\tred\tbuild\nmeans\tthe\tlast\tchange\tpossibly\tdid\tnot\tintegrate.\tYou\tneed\tto\tstop\tall\tfurther\tcheck-\nins\tthat\taren’t\tinvolved\tin\tfixing\tthe\tbuilds\tto\tget\tit\tpassing\tagain.\tIf\tyou\tlet\tmore\nchanges\tpile\tup,\tthe\ttime\tit\ttakes\tto\tfix\tthe\tbuild\twill\tincrease\tdrastically.\tI’ve\tworked\nwith\tteams\twhere\tthe\tbuild\thas\tbeen\tbroken\tfor\tdays,\tresulting\tin\tsubstantial\tefforts\nto\teventually\tget\ta\tpassing\tbuild.\n")])])]),a("h2",{attrs:{id:"mappingcontinuousintegrationtomicroservices"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#mappingcontinuousintegrationtomicroservices"}},[t._v("#")]),t._v(" Mapping\tContinuous\tIntegration\tto\tMicroservices")]),t._v(" "),a("p",[t._v("When\tthinking\tabout\tmicroservices\tand\tcontinuous\tintegration,\twe\tneed\tto\tthink\tabout\nhow\tour\tCI\tbuilds\tmap\tto\tindividual\tmicroservices.\tAs\tI\thave\tsaid\tmany\ttimes,\twe\twant\tto\nensure\tthat\twe\tcan\tmake\ta\tchange\tto\ta\tsingle\tservice\tand\tdeploy\tit\tindependently\tof\tthe\nrest.\tWith\tthis\tin\tmind,\thow\tshould\twe\tmap\tindividual\tmicroservices\tto\tCI\tbuilds\tand\nsource\tcode?")]),t._v(" "),a("p",[t._v("If\twe\tstart\twith\tthe\tsimplest\toption,\twe\tcould\tlump\teverything\tin\ttogether.\tWe\thave\ta\nsingle,\tgiant\trepository\tstoring\tall\tour\tcode,\tand\thave\tone\tsingle\tbuild,\tas\twe\tsee\tin\nFigure\t6-1.\tAny\tcheck-in\tto\tthis\tsource\tcode\trepository\twill\tcause\tour\tbuild\tto\ttrigger,\nwhere\twe\twill\trun\tall\tthe\tverification\tsteps\tassociated\twith\tall\tour\tmicroservices,\tand\nproduce\tmultiple\tartifacts,\tall\ttied\tback\tto\tthe\tsame\tbuild.")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("Figure\t6-1.\tUsing\ta\tsingle\tsource\tcode\trepository\tand\tCI\tbuild\tfor\tall\tmicroservices\n")])])]),a("p",[t._v("This\tseems\tmuch\tsimpler\ton\tthe\tsurface\tthan\tother\tapproaches:\tfewer\trepositories\tto\nworry\tabout,\tand\ta\tconceptually\tsimpler\tbuild.\tFrom\ta\tdeveloper\tpoint\tof\tview,\tthings\tare\npretty\tstraightforward\ttoo.\tI\tjust\tcheck\tcode\tin.\tIf\tI\thave\tto\twork\ton\tmultiple\tservices\tat\nonce,\tI\tjust\thave\tto\tworry\tabout\tone\tcommit.")]),t._v(" "),a("p",[t._v("This\tmodel\tcan\twork\tperfectly\twell\tif\tyou\tbuy\tinto\tthe\tidea\tof\tlock-step\treleases,\twhere\nyou\tdon’t\tmind\tdeploying\tmultiple\tservices\tat\tonce.\tIn\tgeneral,\tthis\tis\tabsolutely\ta\tpattern\nto\tavoid,\tbut\tvery\tearly\ton\tin\ta\tproject,\tespecially\tif\tonly\tone\tteam\tis\tworking\ton\neverything,\tthis\tmight\tmake\tsense\tfor\tshort\tperiods\tof\ttime.")]),t._v(" "),a("p",[t._v("However,\tthere\tare\tsome\tsignificant\tdownsides.\tIf\tI\tmake\ta\tone-line\tchange\tto\ta\tsingle\nservice\t—\tfor\texample,\tchanging\tthe\tbehavior\tin\tthe\tuser\tservice\tin\tFigure\t6-1\t—\t "),a("em",[t._v("all")]),t._v(" \tthe\nother\tservices\tget\tverified\tand\tbuilt.\tThis\tcould\ttake\tmore\ttime\tthan\tneeded\t—\tI’m\nwaiting\tfor\tthings\tthat\tprobably\tdon’t\tneed\tto\tbe\ttested.\tThis\timpacts\tour\tcycle\ttime,\tthe\nspeed\tat\twhich\twe\tcan\tmove\ta\tsingle\tchange\tfrom\tdevelopment\tto\tlive.\tMore\ttroubling,\nthough,\tis\tknowing\twhat\tartifacts\tshould\tor\tshouldn’t\tbe\tdeployed.\tDo\tI\tnow\tneed\tto\ndeploy\tall\tthe\tbuild\tservices\tto\tpush\tmy\tsmall\tchange\tinto\tproduction?\tIt\tcan\tbe\thard\tto\ntell;\ttrying\tto\tguess\twhich\tservices\t "),a("em",[t._v("really")]),t._v(" \tchanged\tjust\tby\treading\tthe\tcommit\tmessages\tis")]),t._v(" "),a("p",[t._v("difficult.\tOrganizations\tusing\tthis\tapproach\toften\tfall\tback\tto\tjust\tdeploying\teverything\ntogether,\twhich\twe\treally\twant\tto\tavoid.")]),t._v(" "),a("p",[t._v("Furthermore,\tif\tmy\tone-line\tchange\tto\tthe\tuser\tservice\tbreaks\tthe\tbuild,\tno\tother\tchanges\ncan\tbe\tmade\tto\tthe\tother\tservices\tuntil\tthat\tbreak\tis\tfixed.\tAnd\tthink\tabout\ta\tscenario\nwhere\tyou\thave\tmultiple\tteams\tall\tsharing\tthis\tgiant\tbuild.\tWho\tis\tin\tcharge?")]),t._v(" "),a("p",[t._v("A\tvariation\tof\tthis\tapproach\tis\tto\thave\tone\tsingle\tsource\ttree\twith\tall\tof\tthe\tcode\tin\tit,\twith\nmultiple\tCI\tbuilds\tmapping\tto\tparts\tof\tthis\tsource\ttree,\tas\twe\tsee\tin\tFigure\t6-2.\tWith\twell-\ndefined\tstructure,\tyou\tcan\teasily\tmap\tthe\tbuilds\tto\tcertain\tparts\tof\tthe\tsource\ttree.\tIn\ngeneral,\tI\tam\tnot\ta\tfan\tof\tthis\tapproach,\tas\tthis\tmodel\tcan\tbe\ta\tmixed\tblessing.\tOn\tthe\tone\nhand,\tmy\tcheck-in/check-out\tprocess\tcan\tbe\tsimpler\tas\tI\thave\tonly\tone\trepository\tto\nworry\tabout.\tOn\tthe\tother\thand,\tit\tbecomes\tvery\teasy\tto\tget\tinto\tthe\thabit\tof\tchecking\tin\nsource\tcode\tfor\tmultiple\tservices\tat\tonce,\twhich\tcan\tmake\tit\tequally\teasy\tto\tslip\tinto\nmaking\tchanges\tthat\tcouple\tservices\ttogether.\tI\twould\tgreatly\tprefer\tthis\tapproach,\nhowever,\tover\thaving\ta\tsingle\tbuild\tfor\tmultiple\tservices.")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("Figure\t6-2.\tA\tsingle\tsource\trepo\twith\tsubdirectories\tmapped\tto\tindependent\tbuilds\n")])])]),a("p",[t._v("So\tis\tthere\tanother\talternative?\tThe\tapproach\tI\tprefer\tis\tto\thave\ta\tsingle\tCI\tbuild\tper\nmicroservice,\tto\tallow\tus\tto\tquickly\tmake\tand\tvalidate\ta\tchange\tprior\tto\tdeployment\tinto\nproduction,\tas\tshown\tin\tFigure\t6-3.\tHere\teach\tmicroservice\thas\tits\town\tsource\tcode\nrepository,\tmapped\tto\tits\town\tCI\tbuild.\tWhen\tmaking\ta\tchange,\tI\trun\tonly\tthe\tbuild\tand\ntests\tI\tneed\tto.\tI\tget\ta\tsingle\tartifact\tto\tdeploy.\tAlignment\tto\tteam\townership\tis\tmore\tclear\ntoo.\tIf\tyou\town\tthe\tservice,\tyou\town\tthe\trepository\tand\tthe\tbuild.\tMaking\tchanges\tacross\nrepositories\tcan\tbe\tmore\tdifficult\tin\tthis\tworld,\tbut\tI’d\tmaintain\tthis\tis\teasier\tto\tresolve\n(e.g.,\tby\tusing\tcommand-line\tscripts)\tthan\tthe\tdownside\tof\tthe\tmonolithic\tsource\tcontrol\nand\tbuild\tprocess.")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("Figure\t6-3.\tUsing\tone\tsource\tcode\trepository\tand\tCI\tbuild\tper\tmicroservice\n")])])]),a("p",[t._v("The\ttests\tfor\ta\tgiven\tmicroservice\tshould\tlive\tin\tsource\tcontrol\twith\tthe\tmicroservice’s\nsource\tcode\ttoo,\tto\tensure\twe\talways\tknow\twhat\ttests\tshould\tbe\trun\tagainst\ta\tgiven\nservice.")]),t._v(" "),a("p",[t._v("So,\teach\tmicroservice\twill\tlive\tin\tits\town\tsource\tcode\trepository,\tand\tits\town\tCI\tbuild\nprocess.\tWe’ll\tuse\tthe\tCI\tbuild\tprocess\tto\tcreate\tour\tdeployable\tartifacts\ttoo\tin\ta\tfully\nautomated\tfashion.\tNow\tlets\tlook\tbeyond\tCI\tto\tsee\thow\tcontinuous\tdelivery\tfits\tin.")]),t._v(" "),a("h2",{attrs:{id:"buildpipelinesandcontinuousdelivery"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#buildpipelinesandcontinuousdelivery"}},[t._v("#")]),t._v(" Build\tPipelines\tand\tContinuous\tDelivery")]),t._v(" "),a("p",[t._v("Very\tearly\ton\tin\tusing\tcontinuous\tintegration,\twe\trealized\tthe\tvalue\tin\tsometimes\thaving\nmultiple\tstages\tinside\ta\tbuild.\tTests\tare\ta\tvery\tcommon\tcase\twhere\tthis\tcomes\tinto\tplay.\tI\nmay\thave\ta\tlot\tof\tfast,\tsmall-scoped\ttests,\tand\ta\tsmall\tnumber\tof\tlarge-scoped,\tslow\ttests.\nIf\twe\trun\tall\tthe\ttests\ttogether,\twe\tmay\tnot\tbe\table\tto\tget\tfast\tfeedback\twhen\tour\tfast\ttests\nfail\tif\twe’re\twaiting\tfor\tour\tlong-scoped\tslow\ttests\tto\tfinally\tfinish.\tAnd\tif\tthe\tfast\ttests\nfail,\tthere\tprobably\tisn’t\tmuch\tsense\tin\trunning\tthe\tslower\ttests\tanyway!\tA\tsolution\tto\tthis\nproblem\tis\tto\thave\tdifferent\tstages\tin\tour\tbuild,\tcreating\twhat\tis\tknown\tas\ta\t "),a("em",[t._v("build\tpipeline")]),t._v(".\nOne\tstage\tfor\tthe\tfaster\ttests,\tone\tfor\tthe\tslower\ttests.")]),t._v(" "),a("p",[t._v("This\tbuild\tpipeline\tconcept\tgives\tus\ta\tnice\tway\tof\ttracking\tthe\tprogress\tof\tour\tsoftware\tas\nit\tclears\teach\tstage,\thelping\tgive\tus\tinsight\tinto\tthe\tquality\tof\tour\tsoftware.\tWe\tbuild\tour\nartifact,\tand\tthat\tartifact\tis\tused\tthroughout\tthe\tpipeline.\tAs\tour\tartifact\tmoves\tthrough\nthese\tstages,\twe\tfeel\tmore\tand\tmore\tconfident\tthat\tthe\tsoftware\twill\twork\tin\tproduction.")]),t._v(" "),a("p",[a("em",[t._v("Continuous\tdelivery\t(CD)")]),t._v(" \tbuilds\ton\tthis\tconcept,\tand\tthen\tsome.\tAs\toutlined\tin\tJez\nHumble\tand\tDave\tFarley’s\tbook\tof\tthe\tsame\tname,\tcontinuous\tdelivery\tis\tthe\tapproach\nwhereby\twe\tget\tconstant\tfeedback\ton\tthe\tproduction\treadiness\tof\teach\tand\tevery\tcheck-in,\nand\tfurthermore\ttreat\teach\tand\tevery\tcheck-in\tas\ta\trelease\tcandidate.")]),t._v(" "),a("p",[t._v("To\tfully\tembrace\tthis\tconcept,\twe\tneed\tto\tmodel\tall\tthe\tprocesses\tinvolved\tin\tgetting\tour\nsoftware\tfrom\tcheck-in\tto\tproduction,\tand\tknow\twhere\tany\tgiven\tversion\tof\tthe\tsoftware\nis\tin\tterms\tof\tbeing\tcleared\tfor\trelease.\tIn\tCD,\twe\tdo\tthis\tby\textending\tthe\tidea\tof\tthe\nmultistage\tbuild\tpipeline\tto\tmodel\teach\tand\tevery\tstage\tour\tsoftware\thas\tto\tgo\tthrough,\nboth\tmanual\tand\tautomated.\tIn\tFigure\t6-4,\twe\tsee\ta\tsample\tpipeline\tthat\tmay\tbe\tfamiliar.")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("Figure\t6-4.\tA\tstandard\trelease\tprocess\tmodeled\tas\ta\tbuild\tpipeline\n")])])]),a("p",[t._v("Here\twe\treally\twant\ta\ttool\tthat\tembraces\tCD\tas\ta\tfirst-class\tconcept.\tI\thave\tseen\tmany\npeople\ttry\tto\thack\tand\textend\tCI\ttools\tto\tmake\tthem\tdo\tCD,\toften\tresulting\tin\tcomplex\nsystems\tthat\tare\tnowhere\tas\teasy\tto\tuse\tas\ttools\tthat\tbuild\tin\tCD\tfrom\tthe\tbeginning.\nTools\tthat\tfully\tsupport\tCD\tallow\tyou\tto\tdefine\tand\tvisualize\tthese\tpipelines,\tmodeling\nthe\tentire\tpath\tto\tproduction\tfor\tyour\tsoftware.\tAs\ta\tversion\tof\tour\tcode\tmoves\tthrough\nthe\tpipeline,\tif\tit\tpasses\tone\tof\tthese\tautomated\tverification\tsteps\tit\tmoves\tto\tthe\tnext\nstage.\tOther\tstages\tmay\tbe\tmanual.\tFor\texample,\tif\twe\thave\ta\tmanual\tuser\tacceptance\ntesting\t(UAT)\tprocess\tI\tshould\tbe\table\tto\tuse\ta\tCD\ttool\tto\tmodel\tit.\tI\tcan\tsee\tthe\tnext\navailable\tbuild\tready\tto\tbe\tdeployed\tinto\tour\tUAT\tenvironment,\tdeploy\tit,\tand\tif\tit\tpasses\nour\tmanual\tchecks,\tmark\tthat\tstage\tas\tbeing\tsuccessful\tso\tit\tcan\tmove\tto\tthe\tnext.")]),t._v(" "),a("p",[t._v("By\tmodeling\tthe\tentire\tpath\tto\tproduction\tfor\tour\tsoftware,\twe\tgreatly\timprove\tvisibility\nof\tthe\tquality\tof\tour\tsoftware,\tand\tcan\talso\tgreatly\treduce\tthe\ttime\ttaken\tbetween\treleases,")]),t._v(" "),a("p",[t._v("as\twe\thave\tone\tplace\tto\tobserve\tour\tbuild\tand\trelease\tprocess,\tand\tan\tobvious\tfocal\tpoint\nfor\tintroducing\timprovements.")]),t._v(" "),a("p",[t._v("In\ta\tmicroservices\tworld,\twhere\twe\twant\tto\tensure\twe\tcan\trelease\tour\tservices\nindependently\tof\teach\tother,\tit\tfollows\tthat\tas\twith\tCI,\twe’ll\twant\tone\tpipeline\tper\tservice.\nIn\tour\tpipelines,\tit\tis\tan\tartifact\tthat\twe\twant\tto\tcreate\tand\tmove\tthrough\tour\tpath\tto\nproduction.\tAs\talways,\tit\tturns\tout\tour\tartifacts\tcan\tcome\tin\tlots\tof\tsizes\tand\tshapes.\tWe’ll\nlook\tat\tsome\tof\tthe\tmost\tcommon\toptions\tavailable\tto\tus\tin\ta\tmoment.")]),t._v(" "),a("h2",{attrs:{id:"andtheinevitableexceptions"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#andtheinevitableexceptions"}},[t._v("#")]),t._v(" And\tthe\tInevitable\tExceptions")]),t._v(" "),a("p",[t._v("As\twith\tall\tgood\trules,\tthere\tare\texceptions\twe\tneed\tto\tconsider\ttoo.\tThe\t“one\nmicroservice\tper\tbuild”\tapproach\tis\tabsolutely\tsomething\tyou\tshould\taim\tfor,\tbut\tare\tthere\ntimes\twhen\tsomething\telse\tmakes\tsense?\tWhen\ta\tteam\tis\tstarting\tout\twith\ta\tnew\tproject,\nespecially\ta\tgreenfield\tone\twhere\tthey\tare\tworking\twith\ta\tblank\tsheet\tof\tpaper,\tit\tis\tquite\nlikely\tthat\tthere\twill\tbe\ta\tlarge\tamount\tof\tchurn\tin\tterms\tof\tworking\tout\twhere\tthe\tservice\nboundaries\tlie.\tThis\tis\ta\tgood\treason,\tin\tfact,\tfor\tkeeping\tyour\tinitial\tservices\ton\tthe\tlarger\nside\tuntil\tyour\tunderstanding\tof\tthe\tdomain\tstabilizes.")]),t._v(" "),a("p",[t._v("During\tthis\ttime\tof\tchurn,\tchanges\tacross\tservice\tboundaries\tare\tmore\tlikely,\tand\twhat\tis\nin\tor\tnot\tin\ta\tgiven\tservice\tis\tlikely\tto\tchange\tfrequently.\tDuring\tthis\tperiod,\thaving\tall\nservices\tin\ta\tsingle\tbuild\tto\treduce\tthe\tcost\tof\tcross-service\tchanges\tmay\tmake\tsense.")]),t._v(" "),a("p",[t._v("It\tdoes\tfollow,\tthough,\tthat\tin\tthis\tcase\tyou\tneed\tto\tbuy\tinto\treleasing\tall\tthe\tservices\tas\ta\nbundle.\tIt\talso\tabsolutely\tneeds\tto\tbe\ta\ttransitionary\tstep.\tAs\tservice\tAPIs\tstabilize,\tstart\nmoving\tthem\tout\tinto\ttheir\town\tbuilds.\tIf\tafter\ta\tfew\tweeks\t(or\ta\tvery\tsmall\tnumber\tof\nmonths)\tyou\tare\tunable\tto\tget\tstability\tin\tservice\tboundaries\tin\torder\tto\tproperly\tseparate\nthem,\tmerge\tthem\tback\tinto\ta\tmore\tmonolithic\tservice\t(albeit\tretaining\tmodular\nseparation\twithin\tthe\tboundary)\tand\tgive\tyourself\ttime\tto\tget\tto\tgrips\twith\tthe\tdomain.\nThis\treflects\tthe\texperiences\tof\tour\town\tSnapCI\tteam,\tas\twe\tdiscussed\tin\tChapter\t3.")]),t._v(" "),a("h2",{attrs:{id:"platform-specificartifacts"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#platform-specificartifacts"}},[t._v("#")]),t._v(" Platform-Specific\tArtifacts")]),t._v(" "),a("p",[t._v("Most\ttechnology\tstacks\thave\tsome\tsort\tof\tfirst-class\tartifact,\talong\twith\ttools\tto\tsupport\ncreating\tand\tinstalling\tthem.\tRuby\thas\tgems,\tJava\thas\tJAR\tfiles\tand\tWAR\tfiles,\tand\nPython\thas\teggs.\tDevelopers\twith\texperience\tin\tone\tof\tthese\tstacks\twill\tbe\twell\tversed\tin\nworking\twith\t(and\thopefully\tcreating)\tthese\tartifacts.")]),t._v(" "),a("p",[t._v("From\tthe\tpoint\tof\tview\tof\ta\tmicroservice,\tthough,\tdepending\ton\tyour\ttechnology\tstack,\nthis\tartifact\tmay\tnot\tbe\tenough\tby\titself.\tWhile\ta\tJava\tJAR\tfile\tcan\tbe\tmade\tto\tbe\nexecutable\tand\trun\tan\tembedded\tHTTP\tprocess,\tfor\tthings\tlike\tRuby\tand\tPython\napplications,\tyou’ll\texpect\tto\tuse\ta\tprocess\tmanager\trunning\tinside\tApache\tor\tNginx.\tSo\nwe\tmay\tneed\tsome\tway\tof\tinstalling\tand\tconfiguring\tother\tsoftware\tthat\twe\tneed\tin\torder\nto\tdeploy\tand\tlaunch\tour\tartifacts.\tThis\tis\twhere\tautomated\tconfiguration\tmanagement\ntools\tlike\tPuppet\tand\tChef\tcan\thelp.")]),t._v(" "),a("p",[t._v("Another\tdownfall\there\tis\tthat\tthese\tartifacts\tare\tspecific\tto\ta\tcertain\ttechnology\tstack,\nwhich\tmay\tmake\tdeployment\tmore\tdifficult\twhen\twe\thave\ta\tmix\tof\ttechnologies\tin\tplay.\nThink\tof\tit\tfrom\tthe\tpoint\tof\tview\tof\tsomeone\ttrying\tto\tdeploy\tmultiple\tservices\ttogether.\nThey\tcould\tbe\ta\tdeveloper\tor\ttester\twanting\tto\ttest\tsome\tfunctionality,\tor\tit\tcould\tbe\nsomeone\tmanaging\ta\tproduction\tdeployment.\tNow\timagine\tthat\tthose\tservices\tuse\tthree\ncompletely\tdifferent\tdeployment\tmechanisms.\tPerhaps\twe\thave\ta\tRuby\tGem,\ta\tJAR\tfile,\nand\ta\tnodeJS\tNPM\tpackage.\tWould\tthey\tthank\tyou?")]),t._v(" "),a("p",[t._v("Automation\tcan\tgo\ta\tlong\tway\ttoward\thiding\tthe\tdifferences\tin\tthe\tdeployment\nmechanisms\tof\tthe\tunderlying\tartifacts.\tChef,\tPuppet,\tand\tAnsible\tall\tsupport\tmultiple\ndifferent\tcommon\ttechnology-specific\tbuild\tartifacts\ttoo.\tBut\tthere\tare\tdifferent\ttypes\tof\nartifacts\tthat\tmight\tbe\teven\teasier\tto\twork\twith.")]),t._v(" "),a("h2",{attrs:{id:"operatingsystemartifacts"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#operatingsystemartifacts"}},[t._v("#")]),t._v(" Operating\tSystem\tArtifacts")]),t._v(" "),a("p",[t._v("One\tway\tto\tavoid\tthe\tproblems\tassociated\twith\ttechnology-specific\tartifacts\tis\tto\tcreate\nartifacts\tthat\tare\tnative\tto\tthe\tunderlying\toperating\tsystem.\tFor\texample,\tfor\ta\tRedHat–\tor\nCentOS-based\tsystem,\tI\tmight\tbuild\tRPMs;\tfor\tUbuntu,\tI\tmight\tbuild\ta\tdeb\tpackage;\tor\nfor\tWindows,\tan\tMSI.")]),t._v(" "),a("p",[t._v("The\tadvantage\tof\tusing\tOS-specific\tartifacts\tis\tthat\tfrom\ta\tdeployment\tpoint\tof\tview\twe\ndon’t\tcare\twhat\tthe\tunderlying\ttechnology\tis.\tWe\tjust\tuse\tthe\ttools\tnative\tto\tthe\tOS\tto\ninstall\tthe\tpackage.\tThe\tOS\ttools\tcan\talso\thelp\tus\tuninstall\tand\tget\tinformation\tabout\tthe\npackages\ttoo,\tand\tmay\teven\tprovide\tpackage\trepositories\tthat\tour\tCI\ttools\tcan\tpush\tto.\nMuch\tof\tthe\twork\tdone\tby\tthe\tOS\tpackage\tmanager\tcan\talso\toffset\twork\tthat\tyou\tmight\notherwise\tdo\tin\ta\ttool\tlike\tPuppet\tor\tChef.\tOn\tall\tLinux\tplatforms\tI\thave\tused,\tfor\nexample,\tyou\tcan\tdefine\tdependencies\tfrom\tyour\tpackages\tto\tother\tpackages\tyou\trely\ton,\nand\tthe\tOS\ttools\twill\tautomatically\tinstall\tthem\tfor\tyou\ttoo.")]),t._v(" "),a("p",[t._v("The\tdownside\tcan\tbe\tthe\tdifficulty\tin\tcreating\tthe\tpackages\tin\tthe\tfirst\tplace.\tFor\tLinux,\nthe\tFPM\tpackage\tmanager\ttool\tgives\ta\tnicer\tabstraction\tfor\tcreating\tLinux\tOS\tpackages,\nand\tconverting\tfrom\ta\ttarball-based\tdeployment\tto\tan\tOS-based\tdeployment\tcan\tbe\tfairly\nstraightforward.\tThe\tWindows\tspace\tis\tsomewhat\ttrickier.\tThe\tnative\tpackaging\tsystem\tin\nthe\tform\tof\tMSI\tinstallers\tand\tthe\tlike\tleave\ta\tlot\tto\tbe\tdesired\twhen\tcompared\tto\tthe\ncapabilities\tin\tthe\tLinux\tspace.\tThe\tNuGet\tpackage\tsystem\thas\tstarted\tto\thelp\taddress\nthis,\tat\tleast\tin\tterms\tof\thelping\tmanage\tdevelopment\tlibraries.\tMore\trecently,\tChocolatey\nNuGet\thas\textended\tthese\tideas,\tproviding\ta\tpackage\tmanager\tfor\tWindows\tdesigned\tfor\ndeploying\ttools\tand\tservices,\twhich\tis\tmuch\tmore\tlike\tthe\tpackage\tmanagers\tin\tthe\tLinux\nspace.\tThis\tis\tcertainly\ta\tstep\tin\tthe\tright\tdirection,\talthough\tthe\tfact\tthat\tthe\tidiomatic\nstyle\tin\tWindows\tis\tstill\t "),a("em",[t._v("deploy\tsomething\tin\tIIS")]),t._v(" \tmeans\tthat\tthis\tapproach\tmay\tbe\nunappealing\tfor\tsome\tWindows\tteams.")]),t._v(" "),a("p",[t._v("Another\tdownside,\tof\tcourse,\tcould\tbe\tif\tyou\tare\tdeploying\tonto\tmultiple\tdifferent\noperating\tsystems.\tThe\toverhead\tof\tmanaging\tartifacts\tfor\tdifferent\tOSes\tcould\tbe\tpretty\nsteep.\tIf\tyou’re\tcreating\tsoftware\tfor\tother\tpeople\tto\tinstall,\tyou\tmay\tnot\thave\ta\tchoice.\tIf\nyou\tare\tinstalling\tsoftware\tonto\tmachines\tyou\tcontrol,\thowever,\tI\twould\tsuggest\tyou\tlook\nat\tunifying\tor\tat\tleast\treducing\tthe\tnumber\tof\tdifferent\toperating\tsystems\tyou\tuse.\tIt\tcan\ngreatly\treduce\tvariations\tin\tbehavior\tfrom\tone\tmachine\tto\tthe\tnext,\tand\tsimplify\ndeployment\tand\tmaintenance\ttasks.")]),t._v(" "),a("p",[t._v("In\tgeneral,\tthose\tteams\tI’ve\tseen\tthat\thave\tmoved\tto\tOS-based\tpackage\tmanagement\thave\nsimplified\ttheir\tdeployment\tapproach,\tand\ttend\tto\tavoid\tthe\ttrap\tof\tbig,\tcomplex\ndeployment\tscripts.\tEspecially\tif\tyou’re\ton\tLinux,\tthis\tcan\tbe\ta\tgood\tway\tto\tsimplify\ndeployment\tof\tmicroservices\tusing\tdisparate\ttechnology\tstacks.")]),t._v(" "),a("h2",{attrs:{id:"customimages"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#customimages"}},[t._v("#")]),t._v(" Custom\tImages")]),t._v(" "),a("p",[t._v("One\tof\tthe\tchallenges\twith\tautomated\tconfiguration\tmanagement\tsystems\tlike\tPuppet,\nChef,\tand\tAnsible\tcan\tbe\tthe\ttime\ttaken\tto\trun\tthe\tscripts\ton\ta\tmachine.\tLet’s\ttake\ta\nsimple\texample\tof\ta\tserver\tbeing\tprovisioned\tand\tconfigured\tto\tallow\tfor\tthe\tdeployment\nof\ta\tJava\tapplication.\tLet’s\tassume\tI’m\tusing\tAWS\tto\tprovision\tthe\tserver,\tusing\tthe\nstandard\tUbuntu\timage.\tThe\tfirst\tthing\tI\tneed\tto\tdo\tis\tinstall\tthe\tOracle\tJVM\tto\trun\tmy\nJava\tapplication.\tI’ve\tseen\tthis\tsimple\tprocess\ttake\taround\tfive\tminutes,\twith\ta\tcouple\tof\nminutes\ttaken\tup\tby\tthe\tmachine\tbeing\tprovisioned,\tand\ta\tfew\tmore\tto\tinstall\tthe\tJVM.\nThen\twe\tcan\tthink\tabout\tactually\tputting\tour\tsoftware\ton\tit.")]),t._v(" "),a("p",[t._v("This\tis\tactually\ta\tfairly\ttrivial\texample.\tWe\twill\toften\twant\tto\tinstall\tother\tcommon\tbits\tof\nsoftware.\tFor\texample,\twe\tmight\twant\tto\tuse\tcollectd\tfor\tgathering\tOS\tstats,\tuse\tlogstash\nfor\tlog\taggregation,\tand\tperhaps\tinstall\tthe\tappropriate\tbits\tof\tnagios\tfor\tmonitoring\t(we’ll\ntalk\tmore\tabout\tthis\tsoftware\tin\tChapter\t8).\tOver\ttime,\tmore\tthings\tmight\tget\tadded,\nleading\tto\tlonger\tand\tlonger\tamounts\tof\ttime\tneeded\tfor\tprovisioning\tof\tthese\ndependencies.")]),t._v(" "),a("p",[t._v("Puppet,\tChef,\tAnsible,\tand\ttheir\tilk\tcan\tbe\tsmart\tand\twill\tavoid\tinstalling\tsoftware\tthat\tis\nalready\tpresent.\tThis\tdoes\tnot\tmean\tthat\trunning\tthe\tscripts\ton\texisting\tmachines\twill\nalways\tbe\tfast,\tunfortunately,\tas\trunning\tall\tthe\tchecks\ttakes\ttime.\tWe\talso\twant\tto\tavoid\nkeeping\tour\tmachines\taround\tfor\ttoo\tlong,\tas\twe\tdon’t\twant\tto\tallow\tfor\ttoo\tmuch\nconfiguration\tdrift\t(which\twe’ll\texplore\tin\tmore\tdepth\tshortly).\tAnd\tif\twe’re\tusing\tan\ton-\ndemand\tcompute\tplatform\twe\tmight\tbe\tconstantly\tshutting\tdown\tand\tspinning\tup\tnew\ninstances\ton\ta\tdaily\tbasis\t(if\tnot\tmore\tfrequently),\tso\tthe\tdeclarative\tnature\tof\tthese\nconfiguration\tmanagement\ttools\tmay\tbe\tof\tlimited\tuse.")]),t._v(" "),a("p",[t._v("Over\ttime,\twatching\tthe\tsame\ttools\tget\tinstalled\tover\tand\tover\tagain\tcan\tbecome\ta\treal\ndrag.\tIf\tyou\tare\ttrying\tto\tdo\tthis\tmultiple\ttimes\tper\tday\t—\tperhaps\tas\tpart\tof\tdevelopment\nor\tCI\t—\tthis\tbecomes\ta\treal\tproblem\tin\tterms\tof\tproviding\tfast\tfeedback.\tIt\tcan\talso\tlead\nto\tincreased\tdowntime\twhen\tdeploying\tin\tproduction\tif\tyour\tsystems\tdon’t\tallow\tfor\tzero-\ndowntime\tdeployment,\tas\tyou’re\twaiting\tto\tinstall\tall\tthe\tpre-requisites\ton\tyour\tmachines\neven\tbefore\tyou\tget\tto\tinstalling\tyour\tsoftware.\tModels\tlike\tblue/green\tdeployment\n(which\twe’ll\tdiscuss\tin\tChapter\t7)\tcan\thelp\tmitigate\tthis,\tas\tthey\tallow\tus\tto\tdeploy\ta\tnew\nversion\tof\tour\tservice\twithout\ttaking\tthe\told\tone\toffline.")]),t._v(" "),a("p",[t._v("One\tapproach\tto\treducing\tthis\tspin-up\ttime\tis\tto\tcreate\ta\tvirtual\tmachine\timage\tthat\tbakes\nin\tsome\tof\tthe\tcommon\tdependencies\twe\tuse,\tas\tshown\tin\tFigure\t6-5.\tAll\tvirtualization\nplatforms\tI’ve\tused\tallow\tyou\tto\tbuild\tyour\town\timages,\tand\tthe\ttools\tto\tdo\tso\tare\tmuch\nmore\tadvanced\tthan\tthey\twere\teven\ta\tfew\tyears\tago.\tThis\tshifts\tthings\tsomewhat.\tNow\nwe\tcould\tbake\tthe\tcommon\ttools\tinto\tour\town\timage.\tWhen\twe\twant\tto\tdeploy\tour\nsoftware,\twe\tspin\tup\tan\tinstance\tof\tthis\tcustom\timage,\tand\tall\twe\thave\tto\tdo\tis\tinstall\tthe\nlatest\tversion\tof\tour\tservice.")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("Figure\t6-5.\tCreating\ta\tcustom\tVM\timage\n")])])]),a("p",[t._v("Of\tcourse,\tbecause\tyou\tbuild\tthe\timage\tonly\tonce,\twhen\tyou\tsubsequently\tlaunch\tcopies\nof\tthis\timage\tyou\tdon’t\tneed\tto\tspend\ttime\tinstalling\tyour\tdependencies,\tas\tthey\tare\nalready\tthere.\tThis\tcan\tresult\tin\ta\tsignificant\ttime\tsavings.\tIf\tyour\tcore\tdependencies\tdon’t\nchange,\tnew\tversions\tof\tyour\tservice\tcan\tcontinue\tto\tuse\tthe\tsame\tbase\timage.")]),t._v(" "),a("p",[t._v("There\tare\tsome\tdrawbacks\twith\tthis\tapproach,\tthough.\tBuilding\timages\tcan\ttake\ta\tlong\ntime.\tThis\tmeans\tthat\tfor\tdevelopers\tyou\tmay\twant\tto\tsupport\tother\tways\tof\tdeploying\nservices\tto\tensure\tthey\tdon’t\thave\tto\twait\thalf\tan\thour\tjust\tto\tcreate\ta\tbinary\tdeployment.\nSecond,\tsome\tof\tthe\tresulting\timages\tcan\tbe\tlarge.\tThis\tcould\tbe\ta\treal\tproblem\tif\tyou’re\ncreating\tyour\town\tVMWare\timages,\tfor\texample,\tas\tmoving\ta\t20GB\timage\taround\ta\nnetwork\tisn’t\talways\ta\tsimple\tactivity.\tWe’ll\tbe\tlooking\tat\tcontainer\ttechnology\tshortly,\nand\tspecifically\tDocker,\twhich\tcan\tavoid\tsome\tof\tthese\tdrawbacks.")]),t._v(" "),a("p",[t._v("Historically,\tone\tof\tthe\tchallenges\tis\tthat\tthe\ttool\tchain\trequired\tto\tbuild\tsuch\tan\timage\nvaried\tfrom\tplatform\tto\tplatform.\tBuilding\ta\tVMWare\timage\tis\tdifferent\tfrom\tbuilding\tan\nAWS\tAMI,\ta\tVagrant\timage,\tor\ta\tRackspace\timage.\tThis\tmay\tnot\thave\tbeen\ta\tproblem\tif\nyou\thad\tthe\tsame\tplatform\teverywhere,\tbut\tnot\tall\torganizations\twere\tthis\tlucky.\tAnd\neven\tif\tthey\twere,\tthe\ttools\tin\tthis\tspace\twere\toften\tdifficult\tto\twork\twith,\tand\tthey\tdidn’t\nplay\tnicely\twith\tother\ttools\tyou\tmight\tbe\tusing\tfor\tmachine\tconfiguration.")]),t._v(" "),a("p",[t._v("Packer\tis\ta\ttool\tdesigned\tto\tmake\tcreation\tof\timages\tmuch\teasier.\tUsing\tconfiguration\nscripts\tof\tyour\tchoice\t(Chef,\tAnsible,\tPuppet,\tand\tmore\tare\tsupported),\tit\tallows\tus\tto\ncreate\timages\tfor\tdifferent\tplatforms\tfrom\tthe\tsame\tconfiguration.\tAt\tthe\ttime\tof\twriting,\nit\thas\tsupport\tfor\tVMWare,\tAWS,\tRackspace\tCloud,\tDigital\tOcean,\tand\tVagrant,\tand\tI’ve\nseen\tteams\tuse\tit\tsuccessfully\tfor\tbuilding\tLinux\tand\tWindows\timages.\tThis\tmeans\tyou\ncould\tcreate\tan\timage\tfor\tdeployment\ton\tyour\tproduction\tAWS\tenvironment\tand\ta\nmatching\tVagrant\timage\tfor\tlocal\tdevelopment\tand\ttest,\tall\tfrom\tthe\tsame\tconfiguration.")]),t._v(" "),a("h2",{attrs:{id:"imagesasartifacts"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#imagesasartifacts"}},[t._v("#")]),t._v(" Images\tas\tArtifacts")]),t._v(" "),a("p",[t._v("So\twe\tcan\tcreate\tvirtual\tmachine\timages\tthat\tbake\tin\tdependencies\tto\tspeed\tup\tfeedback,\nbut\twhy\tstop\tthere?\tWe\tcould\tgo\tfurther,\tbake\tour\tservice\tinto\tthe\timage\titself,\tand\tadopt\nthe\tmodel\tof\tour\tservice\tartifact\tbeing\tan\timage.\tNow,\twhen\twe\tlaunch\tour\timage,\tour\nservice\tis\tthere\tready\tto\tgo.\tThis\treally\tfast\tspin-up\ttime\tis\tthe\treason\tthat\tNetflix\thas\nadopted\tthe\tmodel\tof\tbaking\tits\town\tservices\tas\tAWS\tAMIs.")]),t._v(" "),a("p",[t._v("Just\tas\twith\tOS-specific\tpackages,\tthese\tVM\timages\tbecome\ta\tnice\tway\tof\tabstracting\tout\nthe\tdifferences\tin\tthe\ttechnology\tstacks\tused\tto\tcreate\tthe\tservices.\tDo\twe\tcare\tif\tthe\nservice\trunning\ton\tthe\timage\tis\twritten\tin\tRuby\tor\tJava,\tand\tuses\ta\tgem\tor\tJAR\tfile?\tAll\nwe\tcare\tabout\tis\tthat\tit\tworks.\tWe\tcan\tfocus\tour\tefforts,\tthen,\ton\tautomating\tthe\tcreation\nand\tdeployment\tof\tthese\timages.\tThis\talso\tbecomes\ta\treally\tneat\tway\tto\timplement\nanother\tdeployment\tconcept,\tthe\t "),a("em",[t._v("immutable\tserver")]),t._v(".")]),t._v(" "),a("h2",{attrs:{id:"immutableservers"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#immutableservers"}},[t._v("#")]),t._v(" Immutable\tServers")]),t._v(" "),a("p",[t._v("By\tstoring\tall\tour\tconfiguration\tin\tsource\tcontrol,\twe\tare\ttrying\tto\tensure\tthat\twe\tcan\nautomatically\treproduce\tservices\tand\thopefully\tentire\tenvironments\tat\twill.\tBut\tonce\twe\nrun\tour\tdeployment\tprocess,\twhat\thappens\tif\tsomeone\tcomes\talong,\tlogs\tinto\tthe\tbox,\tand\nchanges\tthings\tindependently\tof\twhat\tis\tin\tsource\tcontrol?\tThis\tproblem\tis\toften\tcalled\n"),a("em",[t._v("configuration\tdrift")]),t._v(" \t—\tthe\tcode\tin\tsource\tcontrol\tno\tlonger\treflects\tthe\tconfiguration\tof\tthe\nrunning\thost.")]),t._v(" "),a("p",[t._v("To\tavoid\tthis,\twe\tcan\tensure\tthat\tno\tchanges\tare\tever\tmade\tto\ta\trunning\tserver.\tInstead,\nany\tchange,\tno\tmatter\thow\tsmall,\thas\tto\tgo\tthrough\ta\tbuild\tpipeline\tin\torder\tto\tcreate\ta\nnew\tmachine.\tYou\tcan\timplement\tthis\tpattern\twithout\tusing\timage-based\tdeployments,\nbut\tit\tis\talso\ta\tlogical\textension\tof\tusing\timages\tas\tartifacts.\tDuring\tour\timage\tcreation,\nfor\texample,\twe\tcould\tactually\tdisable\tSSH,\tensuring\tthat\tno\tone\tcould\teven\tlog\tonto\tthe\nbox\tto\tmake\ta\tchange!")]),t._v(" "),a("p",[t._v("The\tsame\tcaveats\twe\tdiscussed\tearlier\tabout\tcycle\ttime\tstill\tapply,\tof\tcourse.\tAnd\twe\talso\nneed\tto\tensure\tthat\tany\tdata\twe\tcare\tabout\tthat\tis\tstored\ton\tthe\tbox\tis\tstored\telsewhere.\nThese\tcomplexities\taside,\tI’ve\tseen\tadopting\tthis\tpattern\tlead\tto\tmuch\tmore\nstraightforward\tdeployments,\tand\teasier-to-reason-about\tenvironments.\tAnd\tas\tI’ve\nalready\tsaid,\tanything\twe\tcan\tdo\tto\tsimplify\tthings\tshould\tbe\tpursued!")]),t._v(" "),a("h2",{attrs:{id:"environments"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#environments"}},[t._v("#")]),t._v(" Environments")]),t._v(" "),a("p",[t._v("As\tour\tsoftware\tmoves\tthrough\tour\tCD\tpipeline\tstages,\tit\twill\talso\tbe\tdeployed\tinto\ndifferent\ttypes\tof\tenvironments.\tIf\twe\tthink\tof\tthe\texample\tbuild\tpipeline\tin\tFigure\t6-4,\nwe\tprobably\thave\tto\tconsider\tat\tleast\tfour\tdistinct\tenvironments:\tone\tenvironment\twhere\nwe\trun\tour\tslow\ttests,\tanother\tfor\tUAT,\tanother\tfor\tperformance,\tand\ta\tfinal\tone\tfor\nproduction.\tOur\tmicroservice\tshould\tbe\tthe\tsame\tthroughout,\tbut\tthe\tenvironment\twill\tbe\ndifferent.\tAt\tthe\tvery\tleast,\tthey’ll\tbe\tseparate,\tdistinct\tcollections\tof\tconfiguration\tand\nhosts.\tBut\toften\tthey\tcan\tvary\tmuch\tmore\tthan\tthat.\tFor\texample,\tour\tproduction\nenvironment\tfor\tour\tservice\tmight\tconsist\tof\tmultiple\tload-balanced\thosts\tspread\tacross\ntwo\tdata\tcenters,\twhereas\tour\ttest\tenvironment\tmight\tjust\thave\teverything\trunning\ton\ta\nsingle\thost.\tThese\tdifferences\tin\tenvironments\tcan\tintroduce\ta\tfew\tproblems.")]),t._v(" "),a("p",[t._v("I\twas\tbitten\tby\tthis\tpersonally\tmany\tyears\tago.\tWe\twere\tdeploying\ta\tJava\tweb\tservice\tinto\na\tclustered\tWebLogic\tapplication\tcontainer\tin\tproduction.\tThis\tWebLogic\tcluster\nreplicated\tsession\tstate\tbetween\tmultiple\tnodes,\tgiving\tus\tsome\tlevel\tof\tresilience\tif\ta\nsingle\tnode\tfailed.\tHowever,\tthe\tWebLogic\tlicenses\twere\texpensive,\tas\twere\tthe\tmachines\nour\tsoftware\twas\tdeployed\tonto.\tThis\tmeant\tthat\tin\tour\ttest\tenvironment,\tour\tsoftware\nwas\tdeployed\ton\ta\tsingle\tmachine,\tin\ta\tnonclustered\tconfiguration.")]),t._v(" "),a("p",[t._v("This\thurt\tus\tbadly\tduring\tone\trelease.\tFor\tWebLogic\tto\tbe\table\tto\tcopy\tsession\tstate\nbetween\tnodes,\tthe\tsession\tdata\tneeds\tto\tbe\tproperly\tserializable.\tUnfortunately,\tone\tof\nour\tcommits\tbroke\tthis,\tso\twhen\twe\tdeployed\tinto\tproduction\tour\tsession\treplication\nfailed.\tWe\tended\tup\tresolving\tthis\tby\tpushing\thard\tto\treplicate\ta\tclustered\tsetup\tin\tour\ttest\nenvironment.")]),t._v(" "),a("p",[t._v("The\tservice\twe\twant\tto\tdeploy\tis\tthe\tsame\tin\tall\tthese\tdifferent\tenvironments,\tbut\teach\tof\nthe\tenvironments\tserves\ta\tdifferent\tpurpose.\tOn\tmy\tdeveloper\tlaptop\tI\twant\tto\tquickly\ndeploy\tthe\tservice,\tpotentially\tagainst\tstubbed\tcollaborators,\tto\trun\ttests\tor\tcarry\tout\tsome\nmanual\tvalidation\tof\tbehavior,\twhereas\twhen\tI\tdeploy\tinto\ta\tproduction\tenvironment\tI\nmay\twant\tto\tdeploy\tmultiple\tcopies\tof\tmy\tservice\tin\ta\tload-balanced\tfashion,\tperhaps\tsplit\nacross\tone\tor\tmore\tdata\tcenters\tfor\tdurability\treasons.")]),t._v(" "),a("p",[t._v("As\tyou\tmove\tfrom\tyour\tlaptop\tto\tbuild\tserver\tto\tUAT\tenvironment\tall\tthe\tway\tto\nproduction,\tyou’ll\twant\tto\tensure\tthat\tyour\tenvironments\tare\tmore\tand\tmore\tproduction-\nlike\tto\tcatch\tany\tproblems\tassociated\twith\tthese\tenvironmental\tdifferences\tsooner.\tThis\nwill\tbe\ta\tconstant\tbalance.\tSometimes\tthe\ttime\tand\tcost\tto\treproduce\tproduction-like\nenvironments\tcan\tbe\tprohibitive,\tso\tyou\thave\tto\tmake\tcompromises.\tAdditionally,\nsometimes\tusing\ta\tproduction-like\tenvironment\tcan\tslow\tdown\tfeedback\tloops;\twaiting\nfor\t25\tmachines\tto\tinstall\tyour\tsoftware\tin\tAWS\tmight\tbe\tmuch\tslower\tthan\tsimply\ndeploying\tyour\tservice\tinto\ta\tlocal\tVagrant\tinstance,\tfor\texample.")]),t._v(" "),a("p",[t._v("This\tbalance,\tbetween\tproduction-like\tenvironments\tand\tfast\tfeedback,\twon’t\tbe\tstatic.\nKeep\tan\teye\ton\tthe\tbugs\tyou\tfind\tfurther\tdownstream\tand\tyour\tfeedback\ttimes,\tand\tadjust")]),t._v(" "),a("p",[t._v("this\tbalance\tas\trequired.")]),t._v(" "),a("p",[t._v("Managing\tenvironments\tfor\tsingle-artfact\tmonolithic\tsystems\tcan\tbe\tchallenging,\nespecially\tif\tyou\tdon’t\thave\taccess\tto\tsystems\tthat\tare\teasily\tautomatable.\tWhen\tyou\tthink\nabout\tmultiple\tenvironments\tper\tmicroservice,\tthis\tcan\tbe\teven\tmore\tdaunting.\tWe’ll\tlook\nshortly\tat\tsome\tdifferent\tdeployment\tplatforms\tthat\tcan\tmake\tthis\tmuch\teasier\tfor\tus.")]),t._v(" "),a("h2",{attrs:{id:"serviceconfiguration"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#serviceconfiguration"}},[t._v("#")]),t._v(" Service\tConfiguration")]),t._v(" "),a("p",[t._v("Our\tservices\tneed\tsome\tconfiguration.\tIdeally,\tthis\tshould\tbe\ta\tsmall\tamount,\tand\tlimited\nto\tthose\tfeatures\tthat\tchange\tfrom\tone\tenvironment\tto\tanother,\tsuch\tas\t "),a("em",[t._v("what\tusername\tand\npassword\tshould\tI\tuse\tto\tconnect\tto\tmy\tdatabase?")]),t._v(" \tConfiguration\tthat\tchanges\tfrom\tone\nenvironment\tto\tanother\tshould\tbe\tkept\tto\tan\tabsolute\tminimum.\tThe\tmore\tyour\nconfiguration\tchanges\tfundamental\tservice\tbehavior,\tand\tthe\tmore\tthat\tconfiguration\nvaries\tfrom\tone\tenvironment\tto\tanother,\tthe\tmore\tyou\twill\tfind\tproblems\tonly\tin\tcertain\nenvironments,\twhich\tis\tpainful\tin\tthe\textreme.")]),t._v(" "),a("p",[t._v("So\tif\twe\thave\tsome\tconfiguration\tfor\tour\tservice\tthat\tdoes\tchange\tfrom\tone\tenvironment\nto\tanother,\thow\tshould\twe\thandle\tthis\tas\tpart\tof\tour\tdeployment\tprocess?\tOne\toption\tis\tto\nbuild\tone\tartifact\tper\tenvironment,\twith\tconfiguration\tinside\tthe\tartifact\titself.\tInitially\nthis\tseems\tsensible.\tThe\tconfiguration\tis\tbuilt\tright\tin;\tjust\tdeploy\tit\tand\teverything\tshould\nwork\tfine,\tright?\tThis\tis\tproblematic.\tRemember\tthe\tconcept\tof\tcontinuous\tdelivery.\tWe\nwant\tto\tcreate\tan\tartifact\tthat\trepresents\tour\trelease\tcandidate,\tand\tmove\tit\tthrough\tour\npipeline,\tconfirming\tthat\tit\tis\tgood\tenough\tto\tgo\tinto\tproduction.\tLet’s\timagine\tI\tbuild\ta\nCustomer-Service-Test\tand\tCustomer-Service-Prod\tartifacts.\tIf\tmy\tCustomer-Service-Test\nartifact\tpasses\tthe\ttests,\tbut\tit’s\tthe\tCustomer-Service-Prod\tartifact\tthat\tI\tactually\tdeploy,\ncan\tI\tbe\tsure\tthat\tI\thave\tverified\tthe\tsoftware\tthat\tactually\tends\tup\tin\tproduction?")]),t._v(" "),a("p",[t._v("There\tare\tother\tchallenges\tas\twell.\tFirst,\tthere\tis\tthe\tadditional\ttime\ttaken\tto\tbuild\tthese\nartifacts.\tNext,\tthe\tfact\tthat\tyou\tneed\tto\tknow\tat\tbuild\ttime\twhat\tenvironments\texist.\tAnd\nhow\tdo\tyou\thandle\tsensitive\tconfiguration\tdata?\tI\tdon’t\twant\tinformation\tabout\nproduction\tpasswords\tchecked\tin\twith\tmy\tsource\tcode,\tbut\tif\tit\tis\tneeded\tat\tbuild\ttime\tto\ncreate\tall\tthose\tartifacts,\tthis\tis\toften\tdifficult\tto\tavoid.")]),t._v(" "),a("p",[t._v("A\tbetter\tapproach\tis\tto\tcreate\tone\tsingle\tartifact,\tand\tmanage\tconfiguration\tseparately.\nThis\tcould\tbe\ta\tproperties\tfile\tthat\texists\tfor\teach\tenvironment,\tor\tdifferent\tparameters\npassed\tin\tto\tan\tinstall\tprocess.\tAnother\tpopular\toption,\tespecially\twhen\tdealing\twith\ta\nlarger\tnumber\tof\tmicroservices,\tis\tto\tuse\ta\tdedicated\tsystem\tfor\tproviding\tconfiguration,\nwhich\twe’ll\texplore\tmore\tin\tChapter\t11.")]),t._v(" "),a("h2",{attrs:{id:"service-to-hostmapping"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#service-to-hostmapping"}},[t._v("#")]),t._v(" Service-to-Host\tMapping")]),t._v(" "),a("p",[t._v("One\tof\tthe\tquestions\tthat\tcomes\tup\tquite\tearly\ton\tin\tthe\tdiscussion\taround\tmicroservices\nis\t“How\tmany\tservices\tper\tmachine?”\tBefore\twe\tgo\ton,\twe\tshould\tpick\ta\tbetter\tterm\tthan\n"),a("em",[t._v("machine")]),t._v(" ,\tor\teven\tthe\tmore\tgeneric\t "),a("em",[t._v("box")]),t._v(" \tthat\tI\tused\tearlier.\tIn\tthis\tera\tof\tvirtualization,\tthe\nmapping\tbetween\ta\tsingle\thost\trunning\tan\toperating\tsystem\tand\tthe\tunderlying\tphysical\ninfrastructure\tcan\tvary\tto\ta\tgreat\textent.\tThus,\tI\ttend\tto\ttalk\tabout\t "),a("em",[t._v("hosts")]),t._v(" ,\tusing\tthem\tas\ta\ngeneric\tunit\tof\tisolation\t—\tnamely,\tan\toperating\tsystem\tonto\twhich\tI\tcan\tinstall\tand\trun\nmy\tservices.\tIf\tyou\tare\tdeploying\tdirectly\ton\tto\tphysical\tmachines,\tthen\tone\tphysical\nserver\tmaps\tto\tone\t "),a("em",[t._v("host")]),t._v(" \t(which\tis\tperhaps\tnot\tcompletely\tcorrect\tterminology\tin\tthis\ncontext,\tbut\tin\tthe\tabsence\tof\tbetter\tterms\tmay\thave\tto\tsuffice).\tIf\tyou’re\tusing\nvirtualization,\ta\tsingle\tphysical\tmachine\tcan\tmap\tto\tmultiple\tindependent\thosts,\teach\tof\nwhich\tcould\thold\tone\tor\tmore\tservices.")]),t._v(" "),a("p",[t._v("So\twhen\tthinking\tof\tdifferent\tdeployment\tmodels,\twe’ll\ttalk\tabout\thosts.\tSo,\tthen,\thow\nmany\tservices\tper\thost\tshould\twe\thave?")]),t._v(" "),a("p",[t._v("I\thave\ta\tdefinite\tview\tas\tto\twhich\tmodel\tis\tpreferable,\tbut\tthere\tare\ta\tnumber\tof\tfactors\tto\nconsider\twhen\tworking\tout\twhich\tmodel\twill\tbe\tright\tfor\tyou.\tIt’s\talso\timportant\tto\nunderstand\tthat\tsome\tchoices\twe\tmake\tin\tthis\tregard\twill\tlimit\tsome\tof\tthe\tdeployment\noptions\tavailable\tto\tus.")]),t._v(" "),a("h2",{attrs:{id:"multipleservicesperhost"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#multipleservicesperhost"}},[t._v("#")]),t._v(" Multiple\tServices\tPer\tHost")]),t._v(" "),a("p",[t._v("Having\tmultiple\tservices\tper\thost,\tas\tshown\tin\tFigure\t6-6,\tis\tattractive\tfor\ta\tnumber\tof\nreasons.\tFirst,\tpurely\tfrom\ta\thost\tmanagement\tpoint\tof\tview,\tit\tis\tsimpler.\tIn\ta\tworld\nwhere\tone\tteam\tmanages\tthe\tinfrastructure\tand\tanother\tteam\tmanages\tthe\tsoftware,\tthe\ninfrastructure\tteam’s\tworkload\tis\toften\ta\tfunction\tof\tthe\tnumber\tof\thosts\tit\thas\tto\tmanage.\nIf\tmore\tservices\tare\tpacked\ton\tto\ta\tsingle\thost,\tthe\thost\tmanagement\tworkload\tdoesn’t\nincrease\tas\tthe\tnumber\tof\tservices\tincreases.\tSecond\tis\tcost.\tEven\tif\tyou\thave\taccess\tto\ta\nvirtualization\tplatform\tthat\tallows\tyou\tto\tprovision\tand\tresize\tvirtual\thosts,\tthe\nvirtualization\tcan\tadd\tan\toverhead\tthat\treduces\tthe\tunderlying\tresources\tavailable\tto\tyour\nservices.\tIn\tmy\topinion,\tboth\tthese\tproblems\tcan\tbe\taddressed\twith\tnew\tworking\tpractices\nand\ttechnology,\tand\twe’ll\texplore\tthat\tshortly.")]),t._v(" "),a("p",[t._v("This\tmodel\tis\talso\tfamiliar\tto\tthose\twho\tdeploy\tinto\tsome\tform\tof\tan\tapplication\ncontainer.\tIn\tsome\tways,\tthe\tuse\tof\tan\tapplication\tcontainer\tis\ta\tspecial\tcase\tof\tthe\nmultiple-services-per-host\tmodel,\tso\twe’ll\tlook\tinto\tthat\tseparately.\tThis\tmodel\tcan\talso\nsimplify\tthe\tlife\tof\tthe\tdeveloper.\tDeploying\tmultiple\tservices\tto\ta\tsingle\thost\tin\nproduction\tis\tsynonymous\twith\tdeploying\tmultiple\tservices\tto\ta\tlocal\tdev\tworkstation\tor\nlaptop.\tIf\twe\twant\tto\tlook\tat\tan\talternative\tmodel,\twe\twant\tto\tfind\ta\tway\tto\tkeep\tthis\nconceptually\tsimple\tfor\tdevelopers.")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("Figure\t6-6.\tMultiple\tmicroservices\tper\thost\n")])])]),a("p",[t._v("There\tare\tsome\tchallenges\twith\tthis\tmodel,\tthough.\tFirst,\tit\tcan\tmake\tmonitoring\tmore\ndifficult.\tFor\texample,\twhen\ttracking\tCPU,\tdo\tI\tneed\tto\ttrack\tthe\tCPU\tof\tone\tservice\nindependent\tof\tthe\tothers?\tOr\tdo\tI\tcare\tabout\tthe\tCPU\tof\tthe\tbox\tas\ta\twhole?\tSide\teffects")]),t._v(" "),a("p",[t._v("can\talso\tbe\thard\tto\tavoid.\tIf\tone\tservice\tis\tunder\tsignificant\tload,\tit\tcan\tend\tup\treducing\nthe\tresources\tavailable\tto\tother\tparts\tof\tthe\tsystem.\tGilt,\twhen\tscaling\tout\tthe\tnumber\tof\nservices\tit\tran,\thit\tthis\tproblem.\tInitially\tit\tcoexisted\tmany\tservices\ton\ta\tsingle\tbox,\tbut\nuneven\tload\ton\tone\tof\tthe\tservices\twould\thave\tan\tadverse\timpact\ton\teverything\telse\nrunning\ton\tthat\thost.\tThis\tmakes\timpact\tanalysis\tof\thost\tfailures\tmore\tcomplex\tas\twell\t—\ntaking\ta\tsingle\thost\tout\tof\tcommission\tcan\thave\ta\tlarge\tripple\teffect.")]),t._v(" "),a("p",[t._v("Deployment\tof\tservices\tcan\tbe\tsomewhat\tmore\tcomplex\ttoo,\tas\tensuring\tone\tdeployment\ndoesn’t\taffect\tanother\tleads\tto\tadditional\theadaches.\tFor\texample,\tif\tI\tuse\tPuppet\tto\nprepare\ta\thost,\tbut\teach\tservice\thas\tdifferent\t(and\tpotentially\tcontradictory)\tdependencies,\nhow\tcan\tI\tmake\tthat\twork?\tIn\tthe\tworst-case\tscenario,\tI\thave\tseen\tpeople\ttie\tmultiple\nservice\tdeployments\ttogether,\tdeploying\tmultiple\tdifferent\tservices\tto\ta\tsingle\thost\tin\tone\nstep,\tto\ttry\tto\tsimplify\tthe\tdeployment\tof\tmultiple\tservices\tto\tone\thost.\tIn\tmy\topinion,\tthe\nsmall\tupside\tin\timproving\tsimplicity\tis\tmore\tthan\toutweighed\tby\tthe\tfact\tthat\twe\thave\ngiven\tup\tone\tof\tthe\tkey\tbenefits\tof\tmicroservices:\tstriving\tfor\tindependent\trelease\tof\tour\nsoftware.\tIf\tyou\tdo\tadopt\tthe\tmultiple-services-per-host\tmodel,\tmake\tsure\tyou\tkeep\thold\nof\tthe\tidea\tthat\teach\tservice\tshould\tbe\tdeployed\tindependently.")]),t._v(" "),a("p",[t._v("This\tmodel\tcan\talso\tinhibit\tautonomy\tof\tteams.\tIf\tservices\tfor\tdifferent\tteams\tare\tinstalled\non\tthe\tsame\thost,\twho\tgets\tto\tconfigure\tthe\thost\tfor\ttheir\tservices?\tIn\tall\tlikelihood,\tthis\nends\tup\tgetting\thandled\tby\ta\tcentralized\tteam,\tmeaning\tit\ttakes\tmore\tcoordination\tto\tget\nservices\tdeployed.")]),t._v(" "),a("p",[t._v("Another\tissue\tis\tthat\tthis\toption\tcan\tlimit\tour\tdeployment\tartifact\toptions.\tImage-based\ndeployments\tare\tout,\tas\tare\timmutable\tservers\tunless\tyou\ttie\tmultiple\tdifferent\tservices\ntogether\tin\ta\tsingle\tartifact,\twhich\twe\treally\twant\tto\tavoid.")]),t._v(" "),a("p",[t._v("The\tfact\tthat\twe\thave\tmultiple\tservices\ton\ta\tsingle\thost\tmeans\tthat\tefforts\tto\ttarget\tscaling\nto\tthe\tservice\tmost\tin\tneed\tof\tit\tcan\tbe\tcomplicated.\tLikewise,\tif\tone\tmicroservice\thandles\ndata\tand\toperations\tthat\tare\tespecially\tsensitive,\twe\tmight\twant\tto\tset\tup\tthe\tunderlying\nhost\tdifferently,\tor\tperhaps\teven\tplace\tthe\thost\titself\tin\ta\tseparate\tnetwork\tsegment.\nHaving\teverything\ton\tone\thost\tmeans\twe\tmight\tend\tup\thaving\tto\ttreat\tall\tservices\tthe\nsame\tway\teven\tif\ttheir\tneeds\tare\tdifferent.")]),t._v(" "),a("p",[t._v("As\tmy\tcolleague\tNeal\tFord\tputs\tit,\tmany\tof\tour\tworking\tpractices\taround\tdeployment\tand\nhost\tmanagement\tare\tan\tattempt\tto\toptimize\tfor\tscarcity\tof\tresources.\tIn\tthe\tpast,\tthe\tonly\noption\tif\twe\twanted\tanother\thost\twas\tto\tbuy\tor\trent\tanother\tphysical\tmachine.\tThis\toften\nhad\ta\tlarge\tlead\ttime\tto\tit\tand\tresulted\tin\ta\tlong-term\tfinancial\tcommitment.\tIt\twasn’t\nuncommon\tfor\tclients\tI\thave\tworked\twith\tto\tprovision\tnew\tservers\tonly\tevery\ttwo\tto\tthree\nyears,\tand\ttrying\tto\tget\tadditional\tmachines\toutside\tof\tthese\ttimelines\twas\tdifficult.\tBut\non-demand\tcomputing\tplatforms\thave\tdrastically\treduced\tthe\tcosts\tof\tcomputing\nresources,\tand\timprovements\tin\tvirtualization\ttechnology\tmean\teven\tfor\tin-house\thosted\ninfrastructure\tthere\tis\tmore\tflexibility.")]),t._v(" "),a("h2",{attrs:{id:"applicationcontainers"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#applicationcontainers"}},[t._v("#")]),t._v(" Application\tContainers")]),t._v(" "),a("p",[t._v("If\tyou’re\tfamiliar\twith\tdeploying\t.NET\tapplications\tbehind\tIIS\tor\tJava\tapplications\tinto\ta\nservlet\tcontainer,\tyou\twill\tbe\twell\tacquainted\twith\tthe\tmodel\twhere\tmultiple\tdistinct\nservices\tor\tapplications\tsit\tinside\ta\tsingle\tapplication\tcontainer,\twhich\tin\tturn\tsits\ton\ta\nsingle\thost,\tas\twe\tsee\tin\tFigure\t6-7.\tThe\tidea\tis\tthat\tthe\tapplication\tcontainer\tyour\nservices\tlive\tin\tgives\tyou\tbenefits\tin\tterms\tof\timproved\tmanageability,\tsuch\tas\tclustering\nsupport\tto\thandle\tgrouping\tmultiple\tinstances\ttogether,\tmonitoring\ttools,\tand\tthe\tlike.")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("Figure\t6-7.\tMultiple\tmicroservices\tper\thost\n")])])]),a("p",[t._v("This\tsetup\tcan\talso\tyield\tbenefits\tin\tterms\tof\treducing\toverhead\tof\tlanguage\truntimes.\nConsider\trunning\tfive\tJava\tservices\tin\ta\tsingle\tJava\tservlet\tcontainer.\tI\tonly\thave\tthe\noverhead\tof\tone\tsingle\tJVM.\tCompare\tthis\twith\trunning\tfive\tindependent\tJVMs\ton\tthe\nsame\thost\twhen\tusing\tembedded\tcontainers.\tThat\tsaid,\tI\tstill\tfeel\tthat\tthese\tapplication\ncontainers\thave\tenough\tdownsides\tthat\tyou\tshould\tchallenge\tyourself\tto\tsee\tif\tthey\tare\nreally\trequired.")]),t._v(" "),a("p",[t._v("First\tamong\tthe\tdownsides\tis\tthat\tthey\tinevitably\tconstrain\ttechnology\tchoice.\tYou\thave\nto\tbuy\tinto\ta\ttechnology\tstack.\tThis\tcan\tlimit\tnot\tonly\tthe\ttechnology\tchoices\tfor\tthe\nimplementation\tof\tthe\tservice\titself,\tbut\talso\tthe\toptions\tyou\thave\tin\tterms\tof\tautomation\nand\tmanagement\tof\tyour\tsystems.\tAs\twe’ll\tdiscuss\tshortly,\tone\tof\tthe\tways\twe\tcan\naddress\tthe\toverhead\tof\tmanaging\tmultiple\thosts\tis\taround\tautomation,\tand\tso")]),t._v(" "),a("p",[t._v("constraining\tour\toptions\tfor\tresolving\tthis\tmay\twell\tbe\tdoubly\tdamaging.")]),t._v(" "),a("p",[t._v("I\twould\talso\tquestion\tsome\tof\tthe\tvalue\tof\tthe\tcontainer\tfeatures.\tMany\tof\tthem\ttout\tthe\nability\tto\tmanage\tclusters\tto\tsupport\tshared\tin-memory\tsession\tstate,\tsomething\twe\nabsolutely\twant\tto\tavoid\tin\tany\tcase\tdue\tto\tthe\tchallenges\tthis\tcreates\twhen\tscaling\tour\nservices.\tAnd\tthe\tmonitoring\tcapabilities\tthey\tprovide\twon’t\tbe\tsufficient\twhen\twe\nconsider\tthe\tsorts\tof\tjoined-up\tmonitoring\twe\twant\tto\tdo\tin\ta\tmicroservices\tworld,\tas\nwe’ll\tsee\tin\tChapter\t8.\tMany\tof\tthem\talso\thave\tquite\tslow\tspin-up\ttimes,\timpacting\ndeveloper\tfeedback\tcycles.")]),t._v(" "),a("p",[t._v("There\tare\tother\tsets\tof\tproblems\ttoo.\tAttempting\tto\tdo\tproper\tlifecycle\tmanagement\tof\napplications\ton\ttop\tof\tplatforms\tlike\tthe\tJVM\tcan\tbe\tproblematic,\tand\tmore\tcomplex\tthan\nsimply\trestarting\ta\tJVM.\tAnalyzing\tresource\tuse\tand\tthreads\tis\talso\tmuch\tmore\tcomplex,\nas\tyou\thave\tmultiple\tapplications\tsharing\tthe\tsame\tprocess.\tAnd\tremember,\teven\tif\tyou\tdo\nget\tvalue\tfrom\ta\ttechnology-specific\tcontainer,\tthey\taren’t\tfree.\tAside\tfrom\tthe\tfact\tthat\nmany\tof\tthem\tare\tcommercial\tand\tso\thave\ta\tcost\timplication,\tthey\tadd\ta\tresource\noverhead\tin\tand\tof\tthemselves.")]),t._v(" "),a("p",[t._v("Ultimately,\tthis\tapproach\tis\tagain\tan\tattempt\tto\toptimize\tfor\tscarcity\tof\tresources\tthat\nsimply\tmay\tnot\thold\tup\tanymore.\tWhether\tyou\tdecide\tto\thave\tmultiple\tservices\tper\thost\nas\ta\tdeployment\tmodel,\tI\twould\tstrongly\tsuggest\tlooking\tat\tself-contained\tdeployable\nmicroservices\tas\tartifacts.\tFor\t.NET,\tthis\tis\tpossible\twith\tthings\tlike\tNancy,\tand\tJava\thas\nsupported\tthis\tmodel\tfor\tyears.\tFor\texample,\tthe\tvenerable\tJetty\tembedded\tcontainer\nmakes\tfor\ta\tvery\tlightweight\tself-contained\tHTTP\tserver,\twhich\tis\tthe\tcore\tof\tthe\nDropwizard\tstack.\tGoogle\thas\tbeen\tknown\tto\tquite\thappily\tuse\tembedded\tJetty\tcontainers\nfor\tserving\tstatic\tcontent\tdirectly,\tso\twe\tknow\tthese\tthings\tcan\toperate\tat\tscale.")]),t._v(" "),a("h2",{attrs:{id:"singleserviceperhost"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#singleserviceperhost"}},[t._v("#")]),t._v(" Single\tService\tPer\tHost")]),t._v(" "),a("p",[t._v("With\ta\tsingle-service-per-host\tmodel\tshown\tin\tFigure\t6-8,\twe\tavoid\tside\teffects\tof\nmultiple\thosts\tliving\ton\ta\tsingle\thost,\tmaking\tmonitoring\tand\tremediation\tmuch\tsimpler.\nWe\thave\tpotentially\treduced\tour\tsingle\tpoints\tof\tfailure.\tAn\toutage\tto\tone\thost\tshould\nimpact\tonly\ta\tsingle\tservice,\talthough\tthat\tisn’t\talways\tclear\twhen\tyou’re\tusing\ta\nvirtualized\tplatform.\tWe’ll\tcover\tdesigning\tfor\tscale\tand\tfailure\tmore\tin\tChapter\t11.\tWe\nalso\tcan\tmore\teasily\tscale\tone\tservice\tindependent\tfrom\tothers,\tand\tdeal\twith\tsecurity\nconcerns\tmore\teasily\tby\tfocusing\tour\tattention\tonly\ton\tthe\tservice\tand\thost\tthat\trequires\nit.")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("Figure\t6-8.\tA\tsingle\tmicroservice\tper\thost\n")])])]),a("p",[t._v("Just\tas\timportant\tis\tthat\twe\thave\topened\tup\tthe\tpotential\tto\tuse\talternative\tdeployment\ntechniques\tsuch\tas\timage-based\tdeployments\tor\tthe\timmutable\tserver\tpattern,\twhich\twe\ndiscussed\tearlier.")]),t._v(" "),a("p",[t._v("We’ve\tadded\ta\tlot\tof\tcomplexity\tin\tadopting\ta\tmicroservice\tarchitecture.\tThe\tlast\tthing\twe\nwant\tto\tdo\tis\tgo\tlooking\tfor\tmore\tsources\tof\tcomplexity.\tIn\tmy\topinion,\tif\tyou\tdon’t\thave\na\tviable\tPaaS\tavailable,\tthen\tthis\tmodel\tdoes\ta\tvery\tgood\tjob\tof\treducing\ta\tsystem’s\noverall\tcomplexity.\tHaving\ta\tsingle-service-per-host\tmodel\tis\tsignificantly\teasier\tto")]),t._v(" "),a("p",[t._v("reason\tabout\tand\tcan\thelp\treduce\tcomplexity.\tIf\tyou\tcan’t\tembrace\tthis\tmodel\tyet,\tI\twon’t\nsay\tmicroservices\taren’t\tfor\tyou.\tBut\tI\twould\tsuggest\tthat\tyou\tlook\tto\tmove\ttoward\tthis\nmodel\tover\ttime\tas\ta\tway\tof\treducing\tthe\tcomplexity\tthat\ta\tmicroservice\tarchitecture\tcan\nbring.")]),t._v(" "),a("p",[t._v("Having\tan\tincreased\tnumber\tof\thosts\thas\tpotential\tdownsides,\tthough.\tWe\thave\tmore\nservers\tto\tmanage,\tand\tthere\tmight\talso\tbe\ta\tcost\timplication\tof\trunning\tmore\tdistinct\nhosts.\tDespite\tthese\tproblems,\tthis\tis\tstill\tthe\tmodel\tI\tprefer\tfor\tmicroservice\narchitectures.\tAnd\twe’ll\ttalk\tabout\ta\tfew\tthings\twe\tcan\tdo\tto\treduce\tthe\toverhead\tof\nhandling\tlarge\tnumbers\tof\thosts\tshortly.")]),t._v(" "),a("h2",{attrs:{id:"platformasaservice"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#platformasaservice"}},[t._v("#")]),t._v(" Platform\tas\ta\tService")]),t._v(" "),a("p",[t._v("When\tusing\ta\tplatform\tas\ta\tservice\t(PaaS),\tyou\tare\tworking\tat\ta\thigher-level\tabstraction\nthan\tat\ta\tsingle\thost.\tMost\tof\tthese\tplatforms\trely\ton\ttaking\ta\ttechnology-specific\tartifact,\nsuch\tas\ta\tJava\tWAR\tfile\tor\tRuby\tgem,\tand\tautomatically\tprovisioning\tand\trunning\tit\tfor\nyou.\tSome\tof\tthese\tplatforms\twill\ttransparently\tattempt\tto\thandle\tscaling\tthe\tsystem\tup\nand\tdown\tfor\tyou,\talthough\ta\tmore\tcommon\t(and\tin\tmy\texperience\tless\terror-prone)\tway\nwill\tallow\tyou\tsome\tcontrol\tover\thow\tmany\tnodes\tyour\tservice\tmight\trun\ton,\tbut\tit\nhandles\tthe\trest.")]),t._v(" "),a("p",[t._v("At\tthe\ttime\tof\twriting,\tmost\tof\tthe\tbest,\tmost\tpolished\tPaaS\tsolutions\tare\thosted.\tHeroku\ncomes\tto\tmind\tas\tbeing\tprobably\tthe\tgold\tclass\tof\tPaaS.\tIt\tdoesn’t\tjust\thandle\trunning\nyour\tservice,\tit\talso\tsupports\tservices\tlike\tdatabases\tin\ta\tvery\tsimple\tfashion.\tSelf-hosted\nsolutions\tdo\texist\tin\tthis\tspace,\talthough\tthey\tare\tmore\timmature\tthan\tthe\thosted\nsolutions.")]),t._v(" "),a("p",[t._v("When\tPaaS\tsolutions\twork\twell,\tthey\twork\tvery\twell\tindeed.\tHowever,\twhen\tthey\tdon’t\nquite\twork\tfor\tyou,\tyou\toften\tdon’t\thave\tmuch\tcontrol\tin\tterms\tof\tgetting\tunder\tthe\thood\nto\tfix\tthings.\tThis\tis\tpart\tof\tthe\ttrade-off\tyou\tmake.\tI\twould\tsay\tthat\tin\tmy\texperience\tthe\nsmarter\tthe\tPaaS\tsolutions\ttry\tto\tbe,\tthe\tmore\tthey\tgo\twrong.\tI’ve\tused\tmore\tthan\tone\nPaaS\tthat\tattempts\tto\tautoscale\tbased\ton\tapplication\tuse,\tbut\tdoes\tit\tbadly.\tInvariably\tthe\nheuristics\tthat\tdrive\tthese\tsmarts\ttend\tto\tbe\ttailored\tfor\tthe\taverage\tapplication\trather\tthan\nyour\tspecific\tuse\tcase.\tThe\tmore\tnonstandard\tyour\tapplication,\tthe\tmore\tlikely\tit\tis\tthat\tit\nmight\tnot\tplay\tnicely\twith\ta\tPaaS.")]),t._v(" "),a("p",[t._v("As\tthe\tgood\tPaaS\tsolutions\thandle\tso\tmuch\tfor\tyou,\tthey\tcan\tbe\tan\texcellent\tway\tof\nhandling\tthe\tincreased\toverhead\twe\tget\twith\thaving\tmany\tmore\tmoving\tparts.\tThat\tsaid,\nI’m\tstill\tnot\tsure\tthat\twe\thave\tall\tthe\tmodels\tright\tin\tthis\tspace\tyet,\tand\tthe\tlimited\tself-\nhosted\toptions\tmean\tthat\tthis\tapproach\tmight\tnot\twork\tfor\tyou.\tIn\tthe\tcoming\tdecade\nthough\tI\texpect\twe’ll\tbe\ttargeting\tPaaS\tfor\tdeployment\tmore\tthan\thaving\tto\tself-manage\nhosts\tand\tdeployments\tof\tindividual\tservices.")]),t._v(" "),a("h2",{attrs:{id:"automation"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#automation"}},[t._v("#")]),t._v(" Automation")]),t._v(" "),a("p",[t._v("The\tanswer\tto\tso\tmany\tproblems\twe\thave\traised\tso\tfar\tcomes\tdown\tto\tautomation.\tWith\ta\nsmall\tnumber\tof\tmachines,\tit\tis\tpossible\tto\tmanage\teverything\tmanually.\tI\tused\tto\tdo\tthis.\nI\tremember\trunning\ta\tsmall\tset\tof\tproduction\tmachines,\tand\tI\twould\tcollect\tlogs,\tdeploy\nsoftware,\tand\tcheck\tprocesses\tby\tmanually\tlogging\tin\tto\tthe\tbox.\tMy\tproductivity\tseemed\nto\tbe\tconstrained\tby\tthe\tnumber\tof\tterminal\twindows\tI\tcould\thave\topen\tat\tonce\t—\ta\nsecond\tmonitor\twas\ta\thuge\tstep\tup.\tThis\tbreaks\tdown\treally\tfast,\tthough.")]),t._v(" "),a("p",[t._v("One\tof\tthe\tpushbacks\tagainst\tthe\tsingle-service-per-host\tsetup\tis\tthe\tperception\tthat\tthe\namount\tof\toverhead\tto\tmanage\tthese\thosts\twill\tincrease.\tThis\tis\tcertainly\ttrue\tif\tyou\tare\ndoing\teverything\tmanually.\tDouble\tthe\tservers,\tdouble\tthe\twork!\tBut\tif\twe\tautomate\ncontrol\tof\tour\thosts,\tand\tdeployment\tof\tthe\tservices,\tthen\tthere\tis\tno\treason\twhy\tadding\nmore\thosts\tshould\tincrease\tour\tworkload\tin\ta\tlinear\tfashion.")]),t._v(" "),a("p",[t._v("But\teven\tif\twe\tkeep\tthe\tnumber\tof\thosts\tsmall,\twe\tstill\tare\tgoing\tto\thave\tlots\tof\tservices.\nThat\tmeans\tmultiple\tdeployments\tto\thandle,\tservices\tto\tmonitor,\tlogs\tto\tcollect.\nAutomation\tis\tessential.")]),t._v(" "),a("p",[t._v("Automation\tis\talso\thow\twe\tcan\tmake\tsure\tthat\tour\tdevelopers\tstill\tremain\tproductive.\nGiving\tthem\tthe\tability\tto\tself-service-provision\tindividual\tservices\tor\tgroups\tof\tservices\nis\tkey\tto\tmaking\tdevelopers’\tlives\teasier.\tIdeally,\tdevelopers\tshould\thave\taccess\tto\texactly\nthe\tsame\ttool\tchain\tas\tis\tused\tfor\tdeployment\tof\tour\tproduction\tservices\tso\tas\tto\tensure\nthat\twe\tcan\tspot\tproblems\tearly\ton.\tWe’ll\tbe\tlooking\tat\ta\tlot\tof\ttechnology\tin\tthis\tchapter\nthat\tembraces\tthis\tview.")]),t._v(" "),a("p",[t._v("Picking\ttechnology\tthat\tenables\tautomation\tis\thighly\timportant.\tThis\tstarts\twith\tthe\ttools\nused\tto\tmanage\thosts.\tCan\tyou\twrite\ta\tline\tof\tcode\tto\tlaunch\ta\tvirtual\tmachine,\tor\tshut\none\tdown?\tCan\tyou\tdeploy\tthe\tsoftware\tyou\thave\twritten\tautomatically?\tCan\tyou\tdeploy\ndatabase\tchanges\twithout\tmanual\tintervention?\tEmbracing\ta\tculture\tof\tautomation\tis\tkey\nif\tyou\twant\tto\tkeep\tthe\tcomplexities\tof\tmicroservice\tarchitectures\tin\tcheck.")]),t._v(" "),a("h2",{attrs:{id:"twocasestudiesonthepowerofautomation"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#twocasestudiesonthepowerofautomation"}},[t._v("#")]),t._v(" Two\tCase\tStudies\ton\tthe\tPower\tof\tAutomation")]),t._v(" "),a("p",[t._v("It\tis\tprobably\thelpful\tto\tgive\tyou\ta\tcouple\tof\tconcrete\texamples\tthat\texplain\tthe\tpower\tof\ngood\tautomation.\tOne\tof\tour\tclients\tin\tAustralia\tis\tRealEstate.com.au\t(REA).\tAmong\nother\tthings,\tthe\tcompany\tprovides\treal\testate\tlistings\tfor\tretail\tand\tcommercial\tcustomers\nin\tAustralia\tand\telsewhere\tin\tthe\tAsia-Pacific\tregion.\tOver\ta\tnumber\tof\tyears,\tit\thas\tbeen\nmoving\tits\tplatform\ttoward\ta\tdistributed,\tmicroservices\tdesign.\tWhen\tit\tstarted\ton\tthis\njourney\tit\thad\tto\tspend\ta\tlot\tof\ttime\tgetting\tthe\ttooling\taround\tthe\tservices\tjust\tright\t—\nmaking\tit\teasy\tfor\tdevelopers\tto\tprovision\tmachines,\tto\tdeploy\ttheir\tcode,\tor\tmonitor\nthem.\tThis\tcaused\ta\tfront-loading\tof\twork\tto\tget\tthings\tstarted.")]),t._v(" "),a("p",[t._v("In\tthe\tfirst\tthree\tmonths\tof\tthis\texercise,\tREA\twas\table\tto\tmove\tjust\ttwo\tnew\nmicroservices\tinto\tproduction,\twith\tthe\tdevelopment\tteam\ttaking\tfull\tresponsibility\tfor\tthe\nentire\tbuild,\tdeployment,\tand\tsupport\tof\tthe\tservices.\tIn\tthe\tnext\tthree\tmonths,\tbetween\n10–15\tservices\twent\tlive\tin\ta\tsimilar\tmanner.\tBy\tthe\tend\tof\tthe\t18-month\tperiod,\tREA\thad\nover\t60–70\tservices.")]),t._v(" "),a("p",[t._v("This\tsort\tof\tpattern\tis\talso\tborne\tout\tby\tthe\texperiences\tof\tGilt,\tan\tonline\tfashion\tretailer\nthat\tstarted\tin\t2007.\tGilt’s\tmonolithic\tRails\tapplication\twas\tstarting\tto\tbecome\tdifficult\tto\nscale,\tand\tthe\tcompany\tdecided\tin\t2009\tto\tstart\tdecomposing\tthe\tsystem\tinto\nmicroservices.\tAgain\tautomation,\tespecially\ttooling\tto\thelp\tdevelopers,\twas\tgiven\tas\ta\nkey\treason\tto\tdrive\tGilt’s\texplosion\tin\tthe\tuse\tof\tmicroservices.\tA\tyear\tlater,\tGilt\thad\naround\t10\tmicroservices\tlive;\tby\t2012,\tover\t100;\tand\tin\t2014,\tover\t450\tmicroservices\tby\nGilt’s\town\tcount\t—\tin\tother\twords,\taround\tthree\tservices\tfor\tevery\tdeveloper\tin\tGilt.")]),t._v(" "),a("h2",{attrs:{id:"fromphysicaltovirtual"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#fromphysicaltovirtual"}},[t._v("#")]),t._v(" From\tPhysical\tto\tVirtual")]),t._v(" "),a("p",[t._v("One\tof\tthe\tkey\ttools\tavailable\tto\tus\tin\tmanaging\ta\tlarge\tnumber\tof\thosts\tis\tfinding\tways\nof\tchunking\tup\texisting\tphysical\tmachines\tinto\tsmaller\tparts.\tTraditional\tvirtualization\nlike\tVMWare\tor\tthat\tused\tby\tAWS\thas\tyielded\thuge\tbenefits\tin\treducing\tthe\toverhead\tof\nhost\tmanagement.\tHowever,\tthere\thave\tbeen\tsome\tnew\tadvances\tin\tthis\tspace\tthat\tare\nwell\tworth\texploring,\tas\tthey\tcan\topen\tup\teven\tmore\tinteresting\tpossibilities\tfor\tdealing\nwith\tour\tmicroservice\tarchitecture.")]),t._v(" "),a("h2",{attrs:{id:"traditionalvirtualization"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#traditionalvirtualization"}},[t._v("#")]),t._v(" Traditional\tVirtualization")]),t._v(" "),a("p",[t._v("Why\tis\thaving\tlots\tof\thosts\texpensive?\tWell,\tif\tyou\tneed\ta\tphysical\tserver\tper\thost,\tthe\nanswer\tis\tfairly\tobvious.\tIf\tthis\tis\tthe\tworld\tyou\tare\toperating\tin,\tthen\tthe\tmultiple-\nservice-per-host\tmodel\tis\tprobably\tright\tfor\tyou,\talthough\tdon’t\tbe\tsurprised\tif\tthis\nbecomes\tan\tever\tmore\tchallenging\tconstraint.\tI\tsuspect,\thowever,\tthat\tmost\tof\tyou\tare\nusing\tvirtualization\tof\tsome\tsort.\tVirtualization\tallows\tus\tto\tslice\tup\ta\tphysical\tserver\tinto\nseparate\thosts,\teach\tof\twhich\tcan\trun\tdifferent\tthings.\tSo\tif\twe\twant\tone\tservice\tper\thost,\ncan’t\twe\tjust\tslice\tup\tour\tphysical\tinfrastructure\tinto\tsmaller\tand\tsmaller\tpieces?")]),t._v(" "),a("p",[t._v("Well,\tfor\tsome\tpeople,\tyou\tcan.\tHowever,\tslicing\tup\tthe\tmachine\tinto\tever\tincreasing\nVMs\tisn’t\tfree.\tThink\tof\tour\tphysical\tmachine\tas\ta\tsock\tdrawer.\tIf\twe\tput\tlots\tof\twooden\ndividers\tinto\tour\tdrawer,\tcan\twe\tstore\tmore\tsocks\tor\tfewer?\tThe\tanswer\tis\tfewer:\tthe\ndividers\tthemselves\ttake\tup\troom\ttoo!\tOur\tdrawer\tmight\tbe\teasier\tto\tdeal\twith\tand\norganize,\tand\tperhaps\twe\tcould\tdecide\tto\tput\tT-shirts\tin\tone\tof\tthe\tspaces\tnow\trather\tthan\njust\tsocks,\tbut\tmore\tdividers\tmeans\tless\toverall\tspace.")]),t._v(" "),a("p",[t._v("In\tthe\tworld\tof\tvirtualization,\twe\thave\ta\tsimilar\toverhead\tas\tour\tsock\tdrawer\tdividers.\tTo\nunderstand\twhere\tthis\toverhead\tcomes\tfrom,\tlet’s\tlook\tat\thow\tmost\tvirtualization\tis\tdone.\nFigure\t6-9\tshows\ta\tcomparison\tof\ttwo\ttypes\tof\tvirtualization.\tOn\tthe\tleft,\twe\tsee\tthe\nvarious\tlayers\tinvolved\tin\twhat\tis\tcalled\t "),a("em",[t._v("type\t2\tvirtualization")]),t._v(" ,\twhich\tis\tthe\tsort\nimplemented\tby\tAWS,\tVMWare,\tVSphere,\tXen,\tand\tKVM.\t(Type\t1\tvirtualization\trefers\nto\ttechnology\twhere\tthe\tVMs\trun\tdirectly\ton\thardware,\tnot\ton\ttop\tof\tanother\toperating\nsystem.)\tOn\tour\tphysical\tinfrastructure\twe\thave\ta\thost\toperating\tsystem.\tOn\tthis\tOS\twe\nrun\tsomething\tcalled\ta\t "),a("em",[t._v("hypervisor")]),t._v(" ,\twhich\thas\ttwo\tkey\tjobs.\tFirst,\tit\tmaps\tresources\tlike\nCPU\tand\tmemory\tfrom\tthe\tvirtual\thost\tto\tthe\tphysical\thost.\tSecond,\tit\tacts\tas\ta\tcontrol\nlayer,\tallowing\tus\tto\tmanipulate\tthe\tvirtual\tmachines\tthemselves.")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("Figure\t6-9.\tA\tcomparison\tof\tstandard\tType\t2\tvirtualization,\tand\tlightweight\tcontainers\n")])])]),a("p",[t._v("Inside\tthe\tVMs,\twe\tget\twhat\tlooks\tlike\tcompletely\tdifferent\thosts.\tThey\tcan\trun\ttheir\town")]),t._v(" "),a("p",[t._v("operating\tsystems,\twith\ttheir\town\tkernels.\tThey\tcan\tbe\tconsidered\talmost\thermetically\nsealed\tmachines,\tkept\tisolated\tfrom\tthe\tunderlying\tphysical\thost\tand\tthe\tother\tvirtual\nmachines\tby\tthe\thypervisor.")]),t._v(" "),a("p",[t._v("The\tproblem\tis\tthat\tthe\thypervisor\there\tneeds\tto\tset\taside\tresources\tto\tdo\tits\tjob.\tThis\ntakes\taway\tCPU,\tI/O,\tand\tmemory\tthat\tcould\tbe\tused\telsewhere.\tThe\tmore\thosts\tthe\nhypervisor\tmanages,\tthe\tmore\tresources\tit\tneeds.\tAt\ta\tcertain\tpoint,\tthis\toverhead\nbecomes\ta\tconstraint\tin\tslicing\tup\tyour\tphysical\tinfrastructure\tany\tfurther.\tIn\tpractice,\tthis\nmeans\tthat\tthere\tare\toften\tdiminishing\treturns\tin\tslicing\tup\ta\tphysical\tbox\tinto\tsmaller\tand\nsmaller\tparts,\tas\tproportionally\tmore\tand\tmore\tresources\tgo\tinto\tthe\toverhead\tof\tthe\nhypervisor.")]),t._v(" "),a("h2",{attrs:{id:"vagrant"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#vagrant"}},[t._v("#")]),t._v(" Vagrant")]),t._v(" "),a("p",[t._v("Vagrant\tis\ta\tvery\tuseful\tdeployment\tplatform,\twhich\tis\tnormally\tused\tfor\tdev\tand\ttest\nrather\tthan\tproduction.\tVagrant\tprovides\tyou\twith\ta\tvirtual\tcloud\ton\tyour\tlaptop.\nUnderneath,\tit\tuses\ta\tstandard\tvirtualization\tsystem\t(typically\tVirtualBox,\talthough\tit\tcan\nuse\tother\tplatforms).\tIt\tallows\tyou\tto\tdefine\ta\tset\tof\tVMs\tin\ta\ttext\tfile,\talong\twith\thow\tthe\nVMs\tare\tnetworked\ttogether\tand\twhich\timages\tthe\tVMs\tshould\tbe\tbased\ton.\tThis\ttext\tfile\ncan\tbe\tchecked\tin\tand\tshared\tbetween\tteam\tmembers.")]),t._v(" "),a("p",[t._v("This\tmakes\tit\teasier\tfor\tyou\tto\tcreate\tproduction-like\tenvironments\ton\tyour\tlocal\tmachine.\nYou\tcan\tspin\tup\tmultiple\tVMs\tat\ta\ttime,\tshut\tindividual\tones\tto\ttest\tfailure\tmodes,\tand\nhave\tthe\tVMs\tmapped\tthrough\tto\tlocal\tdirectories\tso\tyou\tcan\tmake\tchanges\tand\tsee\tthem\nreflected\timmediately.\tEven\tfor\tteams\tusing\ton-demand\tcloud\tplatforms\tlike\tAWS,\tthe\nfaster\tturnaround\tof\tusing\tVagrant\tcan\tbe\ta\thuge\tboon\tfor\tdevelopment\tteams.")]),t._v(" "),a("p",[t._v("One\tof\tthe\tdownsides,\tthough,\tis\tthat\trunning\tlots\tof\tVMs\tcan\ttax\tthe\taverage\ndevelopment\tmachine.\tIf\twe\thave\tone\tservice\tto\tone\tVM,\tyou\tmay\tnot\tbe\table\tto\tbring\tup\nyour\tentire\tsystem\ton\tyour\tlocal\tmachine.\tThis\tcan\tresult\tin\tthe\tneed\tto\tstub\tout\tsome\ndependencies\tto\tmake\tthings\tmanageable,\twhich\tis\tone\tmore\tthing\tyou’ll\thave\tto\thandle\nto\tensure\tthat\tthe\tdevelopment\tand\ttest\texperience\tis\ta\tgood\tone.")]),t._v(" "),a("h2",{attrs:{id:"linuxcontainers"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#linuxcontainers"}},[t._v("#")]),t._v(" Linux\tContainers")]),t._v(" "),a("p",[t._v("For\tLinux\tusers,\tthere\tis\tan\talternative\tto\tvirtualization.\tRather\tthan\thaving\ta\thypervisor\nto\tsegment\tand\tcontrol\tseparate\tvirtual\thosts,\tLinux\tcontainers\tinstead\tcreate\ta\tseparate\nprocess\tspace\tin\twhich\tother\tprocesses\tlive.")]),t._v(" "),a("p",[t._v("On\tLinux,\tprocess\tare\trun\tby\ta\tgiven\tuser,\tand\thave\tcertain\tcapabilities\tbased\ton\thow\tthe\npermissions\tare\tset.\tProcesses\tcan\tspawn\tother\tprocesses.\tFor\texample,\tif\tI\tlaunch\ta\nprocess\tin\ta\tterminal,\tthat\tchild\tprocess\tis\tgenerally\tconsidered\ta\tchild\tof\tthe\tterminal\nprocess.\tThe\tLinux\tkernel’s\tjob\tis\tmaintaining\tthis\ttree\tof\tprocesses.")]),t._v(" "),a("p",[t._v("Linux\tcontainers\textend\tthis\tidea.\tEach\tcontainer\tis\teffectively\ta\tsubtree\tof\tthe\toverall\nsystem\tprocess\ttree.\tThese\tcontainers\tcan\thave\tphysical\tresources\tallocated\tto\tthem,\nsomething\tthe\tkernel\thandles\tfor\tus.\tThis\tgeneral\tapproach\thas\tbeen\taround\tin\tmany\nforms,\tsuch\tas\tSolaris\tZones\tand\tOpenVZ,\tbut\tit\tis\tLXC\tthat\thas\tbecome\tmost\tpopular.\nLXC\tis\tnow\tavailable\tout\tof\tthe\tbox\tin\tany\tmodern\tLinux\tkernel.")]),t._v(" "),a("p",[t._v("If\twe\tlook\tat\ta\tstack\tdiagram\tfor\ta\thost\trunning\tLXC\tin\tFigure\t6-9,\twe\tsee\ta\tfew\ndifferences.\tFirst,\twe\tdon’t\tneed\ta\thypervisor.\tSecond,\talthough\teach\tcontainer\tcan\trun\tits\nown\toperating\tsystem\tdistribution,\tit\thas\tto\tshare\tthe\tsame\tkernel\t(because\tthe\tkernel\tis\nwhere\tthe\tprocess\ttree\tlives).\tThis\tmeans\tthat\tour\thost\toperating\tsystem\tcould\trun\tUbuntu,\nand\tour\tcontainers\tCentOS,\tas\tlong\tas\tthey\tcould\tboth\tshare\tthe\tsame\tkernel.")]),t._v(" "),a("p",[t._v("We\tdon’t\tjust\tbenefit\tfrom\tthe\tresources\tsaved\tby\tnot\tneeding\ta\thypervisor.\tWe\talso\tgain\nin\tterms\tof\tfeedback.\tLinux\tcontainers\tare\t "),a("em",[t._v("much")]),t._v(" \tfaster\tto\tprovision\tthan\tfull-fat\tvirtual\nmachines.\tIt\tisn’t\tuncommon\tfor\ta\tVM\tto\ttake\tmany\tminutes\tto\tstart\t—\tbut\twith\tLinux\ncontainers,\tstartup\tcan\ttake\ta\tfew\tseconds.\tYou\talso\thave\tfiner-grained\tcontrol\tover\tthe\ncontainers\tthemselves\tin\tterms\tof\tassigning\tresources\tto\tthem,\twhich\tmakes\tit\tmuch\teasier\nto\ttweak\tthe\tsettings\tto\tget\tthe\tmost\tout\tof\tthe\tunderlying\thardware.")]),t._v(" "),a("p",[t._v("Due\tto\tthe\tlighter-weight\tnature\tof\tcontainers,\twe\tcan\thave\tmany\tmore\tof\tthem\trunning\non\tthe\tsame\thardware\tthan\twould\tbe\tpossible\twith\tVMs.\tBy\tdeploying\tone\tservice\tper\ncontainer,\tas\tin\tFigure\t6-10,\twe\tget\ta\tdegree\tof\tisolation\tfrom\tother\tcontainers\t(although\nthis\tisn’t\tperfect),\tand\tcan\tdo\tso\tmuch\tmore\tcost\teffectively\tthan\twould\tbe\tpossible\tif\twe\nwanted\tto\trun\teach\tservice\tin\tits\town\tVM.")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("Figure\t6-10.\tRunning\tservices\tin\tseparate\tcontainers\n")])])]),a("p",[t._v("Containers\tcan\tbe\tused\twell\twith\tfull-fat\tvirtualization\ttoo.\tI’ve\tseen\tmore\tthan\tone\nproject\tprovision\ta\tlarge\tAWS\tEC2\tinstance\tand\trun\tLXC\tcontainers\ton\tit\tto\tget\tthe\tbest\nof\tboth\tworlds:\tan\ton-demand\tephemeral\tcompute\tplatform\tin\tthe\tform\tof\tEC2,\tcoupled\nwith\thighly\tflexible\tand\tfast\tcontainers\trunning\ton\ttop\tof\tit.")]),t._v(" "),a("p",[t._v("Linux\tcontainers\taren’t\twithout\tsome\tproblems,\thowever.\tImagine\tI\thave\tlots\tof\nmicroservices\trunning\tin\ttheir\town\tcontainers\ton\ta\thost.\tHow\tdoes\tthe\toutside\tworld\tsee\nthem?\tYou\tneed\tsome\tway\tto\troute\tthe\toutside\tworld\tthrough\tto\tthe\tunderlying\tcontainers,\nsomething\tmany\tof\tthe\thypervisors\tdo\tfor\tyou\twith\tnormal\tvirtualization.\tI’ve\tseen\tmany\na\tperson\tsink\tinordinate\tamounts\tof\ttime\tinto\tconfiguring\tport\tforwarding\tusing\tIPTables\nto\texpose\tcontainers\tdirectly.\tAnother\tpoint\tto\tbear\tin\tmind\tis\tthat\tthese\tcontainers\tcannot\nbe\tconsidered\tcompletely\tsealed\tfrom\teach\tother.\tThere\tare\tmany\tdocumented\tand\tknown\nways\tin\twhich\ta\tprocess\tfrom\tone\tcontainer\tcan\tbust\tout\tand\tinteract\twith\tother\tcontainers\nor\tthe\tunderlying\thost.\tSome\tof\tthese\tproblems\tare\tby\tdesign\tand\tsome\tare\tbugs\tthat\tare")]),t._v(" "),a("p",[t._v("being\taddressed,\tbut\teither\tway\tif\tyou\tdon’t\ttrust\tthe\tcode\tyou\tare\trunning,\tdon’t\texpect\nthat\tyou\tcan\trun\tit\tin\ta\tcontainer\tand\tbe\tsafe.\tIf\tyou\tneed\tthat\tsort\tof\tisolation,\tyou’ll\tneed\nto\tconsider\tusing\tvirtual\tmachines\tinstead.")]),t._v(" "),a("h2",{attrs:{id:"docker"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#docker"}},[t._v("#")]),t._v(" Docker")]),t._v(" "),a("p",[t._v("Docker\tis\ta\tplatform\tbuilt\ton\ttop\tof\tlightweight\tcontainers.\tIt\thandles\tmuch\tof\tthe\twork\naround\thandling\tcontainers\tfor\tyou.\tIn\tDocker,\tyou\tcreate\tand\tdeploy\t "),a("em",[t._v("apps")]),t._v(" ,\twhich\tare\nsynonymous\twith\timages\tin\tthe\tVM\tworld,\talbeit\tfor\ta\tcontainer-based\tplatform.\tDocker\nmanages\tthe\tcontainer\tprovisioning,\thandles\tsome\tof\tthe\tnetworking\tproblems\tfor\tyou,\nand\teven\tprovides\tits\town\tregistry\tconcept\tthat\tallows\tyou\tto\tstore\tand\tversion\tDocker\napplications.")]),t._v(" "),a("p",[t._v("The\tDocker\tapp\tabstraction\tis\ta\tuseful\tone\tfor\tus,\tbecause\tjust\tas\twith\tVM\timages\tthe\nunderlying\ttechnology\tused\tto\timplement\tthe\tservice\tis\thidden\tfrom\tus.\tWe\thave\tour\nbuilds\tfor\tour\tservices\tcreate\tDocker\tapplications,\tand\tstore\tthem\tin\tthe\tDocker\tregistry,\nand\taway\twe\tgo.")]),t._v(" "),a("p",[t._v("Docker\tcan\talso\talleviate\tsome\tof\tthe\tdownsides\tof\trunning\tlots\tof\tservices\tlocally\tfor\tdev\nand\ttest\tpurposes.\tRather\tthan\tusing\tVagrant\tto\thost\tmultiple\tindependent\tVMs,\teach\tone\ncontaining\tits\town\tservice,\twe\tcan\thost\ta\tsingle\tVM\tin\tVagrant\tthat\truns\ta\tDocker\ninstance.\tWe\tthen\tuse\tVagrant\tto\tset\tup\tand\ttear\tdown\tthe\tDocker\tplatform\titself,\tand\tuse\nDocker\tfor\tfast\tprovisioning\tof\tindividual\tservices.")]),t._v(" "),a("p",[t._v("A\tnumber\tof\tdifferent\ttechnologies\tare\tbeing\tdeveloped\tto\ttake\tadvantage\tof\tDocker.\nCoreOS\tis\ta\tvery\tinteresting\toperating\tsystem\tdesigned\twith\tDocker\tin\tmind.\tIt\tis\ta\nstripped-down\tLinux\tOS\tthat\tprovides\tonly\tthe\tessential\tservices\tto\tallow\tDocker\tto\trun.\nThis\tmeans\tit\tconsumes\tfewer\tresources\tthan\tother\toperating\tsystems,\tmaking\tit\tpossible\nto\tdedicate\teven\tmore\tresources\tof\tthe\tunderlying\tmachine\tto\tour\tcontainers.\tRather\tthan\nusing\ta\tpackage\tmanager\tlike\tdebs\tor\tRPMs,\tall\tsoftware\tis\tinstalled\tas\tindependent\nDocker\tapps,\teach\trunning\tin\tits\town\tcontainer.")]),t._v(" "),a("p",[t._v("Docker\titself\tdoesn’t\tsolve\tall\tproblems\tfor\tus.\tThink\tof\tit\tas\ta\tsimple\tPaaS\tthat\tworks\ton\na\tsingle\tmachine.\tIf\tyou\twant\ttools\tto\thelp\tyou\tmanage\tservices\tacross\tmultiple\tDocker\ninstances\tacross\tmultiple\tmachines,\tyou’ll\tneed\tto\tlook\tat\tother\tsoftware\tthat\tadds\tthese\ncapabilities.\tThere\tis\ta\tkey\tneed\tfor\ta\tscheduling\tlayer\tthat\tlets\tyou\trequest\ta\tcontainer\nand\tthen\tfinds\ta\tDocker\tcontainer\tthat\tcan\trun\tit\tfor\tyou.\tIn\tthis\tspace,\tGoogle’s\trecently\nopen\tsourced\tKubernetes\tand\tCoreOS’s\tcluster\ttechnology\tcan\thelp,\tand\tit\tseems\tevery\nmonth\tthere\tis\ta\tnew\tentrant\tin\tthis\tspace.\tDeis\tis\tanother\tinteresting\ttool\tbased\ton\nDocker,\twhich\tis\tattempting\tto\tprovide\ta\tHeroku-like\tPaaS\ton\ttop\tof\tDocker.")]),t._v(" "),a("p",[t._v("I\ttalked\tearlier\tabout\tPaaS\tsolutions.\tMy\tstruggle\twith\tthem\thas\talways\tbeen\tthat\tthey\noften\tget\tthe\tabstraction\tlevel\twrong,\tand\tthat\tself-hosted\tsolutions\tlag\tsignificantly\nbehind\thosted\tsolutions\tlike\tHeroku.\tDocker\tgets\tmuch\tmore\tof\tthis\tright,\tand\tthe\nexplosion\tof\tinterest\tin\tthis\tspace\tmeans\tI\tsuspect\tit\twill\tbecome\ta\tmuch\tmore\tviable\nplatform\tfor\tall\tsorts\tof\tdeployments\tover\tthe\tnext\tfew\tyears\tfor\tall\tsorts\tof\tdifferent\tuse\ncases.\tIn\tmany\tways,\tDocker\twith\tan\tappropriate\tscheduling\tlayer\tsits\tbetween\tIaaS\tand\nPaaS\tsolutions\t—\tthe\tterm\t "),a("em",[t._v("containers\tas\ta\tservice\t(CaaS)")]),t._v(" \tis\talready\tbeing\tused\tto")]),t._v(" "),a("p",[t._v("describe\tit.")]),t._v(" "),a("p",[t._v("Docker\tis\tbeing\tused\tin\tproduction\tby\tmultiple\tcompanies.\tIt\tprovides\tmany\tof\tthe\nbenefits\tof\tlightweight\tcontainers\tin\tterms\tof\tefficiency\tand\tspeed\tof\tprovisioning,\ntogether\twith\tthe\ttools\tto\tavoid\tmany\tof\tthe\tdownsides.\tIf\tyou\tare\tinterested\tin\tlooking\tat\nalternative\tdeployment\tplatforms,\tI’d\tstrongly\tsuggest\tyou\tgive\tDocker\ta\tlook.")]),t._v(" "),a("h2",{attrs:{id:"adeploymentinterface"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#adeploymentinterface"}},[t._v("#")]),t._v(" A\tDeployment\tInterface")]),t._v(" "),a("p",[t._v("Whatever\tunderlying\tplatform\tor\tartifacts\tyou\tuse,\thaving\ta\tuniform\tinterface\tto\tdeploy\ta\ngiven\tservice\tis\tvital.\tWe’ll\twant\tto\ttrigger\tdeployment\tof\ta\tmicroservice\ton\tdemand\tin\ta\nvariety\tof\tdifferent\tsituations,\tfrom\tdeployments\tlocally\tfor\tdev\tand\ttest\tto\tproduction\ndeployments.\tWe’ll\talso\twant\tto\tkeep\tour\tdeployment\tmechanisms\tas\tsimilar\tas\tpossible\nfrom\tdev\tto\tproduction,\tas\tthe\tlast\tthing\twe\twant\tis\tto\tfind\tourselves\thitting\tproblems\tin\nproduction\tbecause\tdeployment\tuses\ta\tcompletely\tdifferent\tprocess!")]),t._v(" "),a("p",[t._v("After\tmany\tyears\tof\tworking\tin\tthis\tspace,\tI\tam\tconvinced\tthat\tthe\tmost\tsensible\tway\tto\ntrigger\tany\tdeployment\tis\tvia\ta\tsingle,\tparameterizable\tcommand-line\tcall.\tThis\tcan\tbe\ntriggered\tby\tscripts,\tlaunched\tby\tyour\tCI\ttool,\tor\ttyped\tin\tby\thand.\tI’ve\tbuilt\twrapper\nscripts\tin\ta\tvariety\tof\ttechnology\tstacks\tto\tmake\tthis\twork,\tfrom\tWindows\tbatch,\tto\tbash,\nto\tPython\tFabric\tscripts,\tand\tmore,\tbut\tall\tof\tthe\tcommand\tlines\tshare\tthe\tsame\tbasic\nformat.")]),t._v(" "),a("p",[t._v("We\tneed\tto\tknow\twhat\twe\tare\tdeploying,\tso\twe\tneed\tto\tprovide\tthe\tname\tof\ta\tknown\nentity,\tor\tin\tour\tcase\ta\tmicroservice.\tWe\talso\tneed\tto\tknow\twhat\tversion\tof\tthe\tentity\twe\nwant.\tThe\tanswer\tto\t "),a("em",[t._v("what\tversion")]),t._v(" \ttends\tto\tbe\tone\tof\tthree\tpossibilities.\tWhen\tyou’re\nworking\tlocally,\tit’ll\tbe\twhatever\tversion\tis\ton\tyour\tlocal\tmachine.\tWhen\ttesting,\tyou’ll\nwant\tthe\tlatest\t "),a("em",[t._v("green")]),t._v(" \tbuild,\twhich\tcould\tjust\tbe\tthe\tmost\trecent\tblessed\tartifact\tin\tour\nartifact\trepository.\tOr\twhen\ttesting/diagnosing\tissues,\twe\tmay\twant\tto\tdeploy\tan\texact\nbuild.")]),t._v(" "),a("p",[t._v("The\tthird\tand\tfinal\tthing\twe’ll\tneed\tto\tknow\tis\twhat\tenvironment\twe\twant\tthe\nmicroservice\tdeployed\tinto.\tAs\twe\tdiscussed\tearlier,\tour\tmicroservice’s\ttopology\tmay\ndiffer\tfrom\tone\tenvironment\tto\tthe\tnext,\tbut\tthat\tshould\tbe\thidden\tfrom\tus\there.")]),t._v(" "),a("p",[t._v("So,\timagine\twe\tcreate\ta\tsimple\tdeploy\tscript\tthat\ttakes\tthese\tthree\tparameters.\tSay\twe’re\ndeveloping\tlocally\tand\twant\tto\tdeploy\tour\tcatalog\tservice\tinto\tour\tlocal\tenvironment.\tI\nmight\ttype:")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("$\tdeploy\tartifact=catalog\tenvironment=local\tversion=local\n")])])]),a("p",[t._v("Once\tI’ve\tchecked\tin,\tour\tCI\tbuild\tservice\tpicks\tup\tthe\tchange\tand\tcreates\ta\tnew\tbuild\nartifact,\tgiving\tit\tthe\tbuild\tnumber\tb456.\tAs\tis\tstandard\tin\tmost\tCI\ttools,\tthis\tvalue\tgets")]),t._v(" "),a("p",[t._v("passed\talong\tthe\tpipeline.\tWhen\tour\ttest\tstage\tgets\ttriggered,\tthe\tCI\tstage\twill\trun:")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("$\tdeploy\tartifact=catalog\tenvironment=ci\tversion=b456\n")])])]),a("p",[t._v("Meanwhile,\tour\tQA\twants\tto\tpull\tthe\tlatest\tversion\tof\tthe\tcatalog\tservice\tinto\tan\nintegrated\ttest\tenvironment\tto\tdo\tsome\texploratory\ttesting,\tand\tto\thelp\twith\ta\tshowcase.\nThat\tteam\truns:")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("$\tdeploy\tartifact=catalog\tenvironment=integrated_qa\tversion=latest\n")])])]),a("p",[t._v("The\ttool\tI’ve\tused\tthe\tmost\tfor\tthis\tis\tFabric,\ta\tPython\tlibrary\tdesigned\tto\tmap\tcommand-\nline\tcalls\tto\tfunctions,\talong\twith\tgood\tsupport\tfor\thandling\ttasks\tlike\tSSH\tinto\tremote\nmachines.\tPair\tit\twith\tan\tAWS\tclient\tlibrary\tlike\tBoto,\tand\tyou\thave\teverything\tyou\tneed\nto\tfully\tautomate\tvery\tlarge\tAWS\tenvironments.\tFor\tRuby,\tCapistrano\tis\tsimilar\tin\tsome\nways\tto\tFabric,\tand\ton\tWindows\tyou\tcould\tgo\ta\tlong\tway\tusing\tPowerShell.")]),t._v(" "),a("h2",{attrs:{id:"environmentdefinition"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#environmentdefinition"}},[t._v("#")]),t._v(" Environment\tDefinition")]),t._v(" "),a("p",[t._v("Clearly,\tfor\tthis\tto\twork,\twe\tneed\tto\thave\tsome\tway\tof\tdefining\twhat\tour\tenvironments\nlook\tlike,\tand\twhat\tour\tservice\tlooks\tlike\tin\ta\tgiven\tenvironment.\tYou\tcan\tthink\tof\tan\nenvironment\tdefinition\tas\ta\tmapping\tfrom\ta\tmicroservice\tto\tcompute,\tnetwork,\tand\nstorage\tresources.\tI’ve\tdone\tthis\twith\tYAML\tfiles\tbefore,\tand\tused\tmy\tscripts\tto\tpull\tthis\ndata\tin.\tExample\t6-1\tis\ta\tsimplified\tversion\tof\tsome\twork\tI\tdid\ta\tcouple\tof\tyears\tago\tfor\ta\nproject\tthat\tused\tAWS.")]),t._v(" "),a("p",[a("em",[t._v("Example\t6-1.\tAn\texample\tenvironment\tdefinition")]),t._v("\ndevelopment:\nnodes:")]),t._v(" "),a("ul",[a("li",[t._v("ami_id: ami-e1e1234\nsize: t1.micro\ncredentials_name: eu-west-ssh\nservices: [catalog-service]\nregion: eu-west-1")])]),t._v(" "),a("p",[t._v("production:\nnodes:")]),t._v(" "),a("ul",[a("li",[t._v("ami_id: ami-e1e1234\nsize: m3.xlarge\ncredentials_name: prod-credentials\nservices: [catalog-service]\nnumber: \t5")])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("We\tvaried\tthe\tsize\tof\tthe\tinstances\twe\tused\tto\tbe\tmore\tcost\teffective.\tYou\tdon’t\tneed\na\t16-core\tbox\twith\t64GB\tof\tRAM\tfor\texploratory\ttesting!\n")])])]),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("Being\table\tto\tspecify\tdifferent\tcredentials\tfor\tdifferent\tenvironments\tis\tkey.\nCredentials\tfor\tsensitive\tenvironments\twere\tstored\tin\tdifferent\tsource\tcode\trepos\tthat\nonly\tselect\tpeople\twould\thave\taccess\tto.\n")])])]),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("We\tdecided\tthat\tby\tdefault\tif\ta\tservice\thad\tmore\tthan\tone\tnode\tconfigured,\twe\twould\nautomatically\tcreate\ta\tload\tbalancer\tfor\tit.\n")])])]),a("p",[t._v("I\thave\tremoved\tsome\tdetail\tfor\tthe\tsake\tof\tbrevity.")]),t._v(" "),a("p",[t._v("The\tcatalog-service\tinformation\twas\tstored\telsewhere.\tIt\tdidn’t\tdiffer\tfrom\tone\nenvironment\tto\tthe\tnext,\tas\tyou\tcan\tsee\tin\tExample\t6-2.")]),t._v(" "),a("p",[a("em",[t._v("Example\t6-2.\tAn\texample\tenvironment\tdefinition")]),t._v("\ncatalog-service:\npuppet_manifest : catalog.pp\nconnectivity:")]),t._v(" "),a("ul",[a("li",[t._v("protocol: tcp\nports: [ \t8080 , \t8081\t ]\nallowed: [ WORLD ]")])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("This\twas\tthe\tname\tof\tthe\tPuppet\tfile\tto\trun\t—\twe\thappened\tto\tuse\tPuppet\tsolo\tin\tthis\nsituation,\tbut\ttheoretically\tcould\thave\tsupported\talternative\tconfiguration\tsystems.\n")])])]),a("p",[t._v("Obviously,\ta\tlot\tof\tthe\tbehavior\there\twas\tconvention\tbased.\tFor\texample,\twe\tdecided\tto\nnormalize\twhich\tports\tservices\tused\twherever\tthey\tran,\tand\tautomatically\tconfigured\tload\nbalancers\tif\ta\tservice\thad\tmore\tthan\tone\tinstance\t(something\tthat\tAWS’s\tELBs\tmake\nfairly\teasy).")]),t._v(" "),a("p",[t._v("Building\ta\tsystem\tlike\tthis\trequired\ta\tsignificant\tamount\tof\twork.\tThe\teffort\tis\toften\tfront-\nloaded,\tbut\tcan\tbe\tessential\tto\tmanage\tthe\tdeployment\tcomplexity\tyou\thave.\tI\thope\tin\tthe\nfuture\tyou\twon’t\thave\tto\tdo\tthis\tyourself.\tTerraform\tis\ta\tvery\tnew\ttool\tfrom\tHashicorp,\nwhich\tworks\tin\tthis\tspace.\tI’d\tgenerally\tshy\taway\tfrom\tmentioning\tsuch\ta\tnew\ttool\tin\ta\nbook\tthat\tis\tmore\tabout\tideas\tthan\ttechnology,\tbut\tit\tis\tattempting\tto\tcreate\tan\topen\tsource\ntool\talong\tthese\tlines.\tIt’s\tearly\tdays\tyet,\tbut\talready\tits\tcapabilities\tseem\treally\ninteresting.\tWith\tthe\tability\tto\ttarget\tdeployments\ton\ta\tnumber\tof\tdifferent\tplatforms,\tin\nthe\tfuture\tit\tcould\tbe\tjust\tthe\ttool\tfor\tthe\tjob.")]),t._v(" "),a("h2",{attrs:{id:"summary-6"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#summary-6"}},[t._v("#")]),t._v(" Summary")]),t._v(" "),a("p",[t._v("We’ve\tcovered\ta\tlot\tof\tground\there,\tso\ta\trecap\tis\tin\torder.\tFirst,\tfocus\ton\tmaintaining\tthe\nability\tto\trelease\tone\tservice\tindependently\tfrom\tanother,\tand\tmake\tsure\tthat\twhatever\ntechnology\tyou\tselect\tsupports\tthis.\tI\tgreatly\tprefer\thaving\ta\tsingle\trepository\tper\nmicroservice,\tbut\tam\tfirmer\tstill\tthat\tyou\tneed\tone\tCI\tbuild\tper\tmicroservice\tif\tyou\twant\nto\tdeploy\tthem\tseparately.")]),t._v(" "),a("p",[t._v("Next,\tif\tpossible,\tmove\tto\ta\tsingle-service\tper\thost/container.\tLook\tat\talternative\ntechnologies\tlike\tLXC\tor\tDocker\tto\tmake\tmanaging\tthe\tmoving\tparts\tcheaper\tand\teasier,\nbut\tunderstand\tthat\twhatever\ttechnology\tyou\tadopt,\ta\tculture\tof\tautomation\tis\tkey\tto\nmanaging\teverything.\tAutomate\teverything,\tand\tif\tthe\ttechnology\tyou\thave\tdoesn’t\tallow\nthis,\tget\tsome\tnew\ttechnology!\tBeing\table\tto\tuse\ta\tplatform\tlike\tAWS\twill\tgive\tyou\thuge\nbenefits\twhen\tit\tcomes\tto\tautomation.")]),t._v(" "),a("p",[t._v("Make\tsure\tyou\tunderstand\tthe\timpact\tyour\tdeployment\tchoices\thave\ton\tdevelopers,\tand\nmake\tsure\tthey\tfeel\tthe\tlove\ttoo.\tCreating\ttools\tthat\tlet\tyou\tself-service-deploy\tany\tgiven\nservice\tinto\ta\tnumber\tof\tdifferent\tenvironments\tis\treally\timportant,\tand\twill\thelp\ndevelopers,\ttesters,\tand\toperations\tpeople\talike.")]),t._v(" "),a("p",[t._v("Finally,\tif\tyou\twant\tto\tgo\tdeeper\tinto\tthis\ttopic,\tI\tthoroughly\trecommend\tyou\tread\tJez\nHumble\tand\tDavid\tFarley’s\t "),a("em",[t._v("Continuous\tDelivery")]),t._v(" \t(Addison-Wesley),\twhich\tgoes\tinto\nmuch\tmore\tdetail\ton\tsubjects\tlike\tpipeline\tdesign\tand\tartifact\tmanagement.")]),t._v(" "),a("p",[t._v("In\tthe\tnext\tchapter,\twe’ll\tbe\tgoing\tdeeper\tinto\ta\ttopic\twe\ttouched\ton\tbriefly\there.\tNamely,\nhow\tdo\twe\ttest\tour\tmicroservices\tto\tmake\tsure\tthey\tactually\twork?")]),t._v(" "),a("h1",{attrs:{id:"chapter7-testing"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#chapter7-testing"}},[t._v("#")]),t._v(" Chapter\t7.\tTesting")]),t._v(" "),a("p",[t._v("The\tworld\tof\tautomated\ttesting\thas\tadvanced\tsignificantly\tsince\tI\tfirst\tstarted\twriting\ncode,\tand\tevery\tmonth\tthere\tseems\tto\tbe\tsome\tnew\ttool\tor\ttechnique\tto\tmake\tit\teven\nbetter.\tBut\tchallenges\tremain\tas\thow\tto\teffectively\tand\tefficiently\ttest\tour\tfunctionality\nwhen\tit\tspans\ta\tdistributed\tsystem.\tThis\tchapter\tbreaks\tdown\tthe\tproblems\tassociated\twith\ntesting\tfiner-grained\tsystems\tand\tpresents\tsome\tsolutions\tto\thelp\tyou\tmake\tsure\tyou\tcan\nrelease\tyour\tnew\tfunctionality\twith\tconfidence.")]),t._v(" "),a("p",[t._v("Testing\tcovers\ta\tlot\tof\tground.\tEven\twhen\twe\tare\t "),a("em",[t._v("just")]),t._v(" \ttalking\tabout\tautomated\ttests,\tthere\nare\ta\tlarge\tnumber\tto\tconsider.\tWith\tmicroservices,\twe\thave\tadded\tanother\tlevel\tof\ncomplexity.\tUnderstanding\twhat\tdifferent\ttypes\tof\ttests\twe\tcan\trun\tis\timportant\tto\thelp\tus\nbalance\tthe\tsometimes-opposing\tforces\tof\tgetting\tour\tsoftware\tinto\tproduction\tas\tquickly\nas\tpossible\tversus\tmaking\tsure\tour\tsoftware\tis\tof\tsufficient\tquality.")]),t._v(" "),a("h2",{attrs:{id:"typesoftests"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#typesoftests"}},[t._v("#")]),t._v(" Types\tof\tTests")]),t._v(" "),a("p",[t._v("As\ta\tconsultant,\tI\tlike\tpulling\tout\tthe\todd\tquadrant\tas\ta\tway\tof\tcategorizing\tthe\tworld,\tand\nI\twas\tstarting\tto\tworry\tthis\tbook\twouldn’t\thave\tone.\tLuckily,\tBrian\tMarick\tcame\tup\twith\na\tfantastic\tcategorization\tsystem\tfor\ttests\tthat\tfits\tright\tin.\tFigure\t7-1\tshows\ta\tvariation\tof\nMarick’s\tquadrant\tfrom\tLisa\tCrispin\tand\tJanet\tGregory’s\tbook\t "),a("em",[t._v("Agile\tTesting")]),t._v(" \t(Addison-\nWesley)\tthat\thelps\tcategorize\tthe\tdifferent\ttypes\tof\ttests.")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("Figure\t7-1.\tBrian\tMarick’s\ttesting\tquadrant.\tCrispin,\tLisa;\tGregory,\tJanet,\tAgile\tTesting:\tA\tPractical\tGuide\tfor\tTesters\nand\tAgile\tTeams,\t1st\tEdition,\t©\t2009.\tAdapted\tby\tpermission\tof\tPearson\tEducation,\tInc.,\tUpper\tSaddle\tRiver,\tNJ.\n")])])]),a("p",[t._v("At\tthe\tbottom,\twe\thave\ttests\tthat\tare\t "),a("em",[t._v("technology-facing")]),t._v(" \t—\tthat\tis,\ttests\tthat\taid\tthe\ndevelopers\tin\tcreating\tthe\tsystem\tin\tthe\tfirst\tplace.\tPerformance\ttests\tand\tsmall-scoped\n"),a("em",[t._v("unit")]),t._v(" \ttests\tfall\tinto\tthis\tcategory\t—\tall\ttypically\tautomated.\tThis\tis\tcompared\twith\tthe\ttop\nhalf\tof\tthe\tquadrant,\twhere\ttests\thelp\tthe\tnontechnical\tstakeholders\tunderstand\thow\tyour\nsystem\tworks.\tThese\tcould\tbe\tlarge-scoped,\tend-to-end\ttests,\tas\tshown\tin\tthe\ttop-left\nAcceptance\tTest\tsquare,\tor\tmanual\ttesting\tas\ttypified\tby\tuser\ttesting\tdone\tagainst\ta\tUAT\nsystem,\tas\tshown\tin\tthe\tExploratory\tTesting\tsquare.")]),t._v(" "),a("p",[t._v("Each\ttype\tof\ttest\tshown\tin\tthis\tquadrant\thas\ta\tplace.\tExactly\thow\tmuch\tof\teach\ttest\tyou\nwant\tto\tdo\twill\tdepend\ton\tthe\tnature\tof\tyour\tsystem,\tbut\tthe\tkey\tpoint\tto\tunderstand\tis\nthat\tyou\thave\tmultiple\tchoices\tin\tterms\tof\thow\tto\ttest\tyour\tsystem.\tThe\ttrend\trecently\thas\nbeen\taway\tfrom\tany\tlarge-scale\tmanual\ttesting,\tin\tfavor\tof\tautomating\tas\tmuch\tas\npossible,\tand\tI\tcertainly\tagree\twith\tthis\tapproach.\tIf\tyou\tcurrently\tcarry\tout\tlarge\tamounts\nof\tmanual\ttesting,\tI\twould\tsuggest\tyou\taddress\tthat\tbefore\tproceeding\ttoo\tfar\tdown\tthe\npath\tof\tmicroservices,\tas\tyou\twon’t\tget\tmany\tof\ttheir\tbenefits\tif\tyou\tare\tunable\tto\tvalidate\nyour\tsoftware\tquickly\tand\tefficiently.")]),t._v(" "),a("p",[t._v("For\tthe\tpurposes\tof\tthis\tchapter,\twe\twill\tignore\tmanual\ttesting.\tAlthough\tthis\tsort\tof\ntesting\tcan\tbe\tvery\tuseful\tand\tcertainly\thas\tits\tpart\tto\tplay,\tthe\tdifferences\twith\ttesting\ta\nmicroservice\tarchitecture\tmostly\tplay\tout\tin\tthe\tcontext\tof\tvarious\ttypes\tof\tautomated\ntests,\tso\tthat\tis\twhere\twe\twill\tfocus\tour\ttime.")]),t._v(" "),a("p",[t._v("But\twhen\tit\tcomes\tto\tautomated\ttests,\thow\tmany\tof\teach\ttest\tdo\twe\twant?\tAnother\tmodel\nwill\tcome\tin\tvery\thandy\tto\thelp\tus\tanswer\tthis\tquestion,\tand\tunderstand\twhat\tthe\tdifferent\ntrade-offs\tmight\tbe.")]),t._v(" "),a("h2",{attrs:{id:"testscope"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#testscope"}},[t._v("#")]),t._v(" Test\tScope")]),t._v(" "),a("p",[t._v("In\this\tbook\t "),a("em",[t._v("Succeeding\twith\tAgile")]),t._v(" \t(Addison-Wesley),\tMike\tCohn\toutlines\ta\tmodel\tcalled\nthe\tTest\tPyramid\tto\thelp\texplain\twhat\ttypes\tof\tautomated\ttests\tyou\tneed.\tThe\tpyramid\nhelps\tus\tthink\tabout\tthe\tscopes\tthe\ttests\tshould\tcover,\tbut\talso\tthe\tproportions\tof\tdifferent\ntypes\tof\ttests\twe\tshould\taim\tfor.\tCohn’s\toriginal\tmodel\tsplit\tautomated\ttests\tinto\tUnit,\nService,\tand\tUI,\twhich\tyou\tcan\tsee\tin\tFigure\t7-2.")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("Figure\t7-2.\tMike\tCohn’s\tTest\tPyramid.\tCohn,\tMike,\tSucceeding\twith\tAgile:\tSoftware\tDevelopment\tUsing\tScrum,\t1st\nEdition,\t©\t2010.\tAdapted\tby\tpermission\tof\tPearson\tEducation,\tInc.,\tUpper\tSaddle\tRiver,\tNJ.\n")])])]),a("p",[t._v("The\tproblem\twith\tthis\tmodel\tis\tthat\tall\tthese\tterms\tmean\tdifferent\tthings\tto\tdifferent\npeople.\t“Service”\tis\tespecially\toverloaded,\tand\tthere\tare\tmany\tdefinitions\tof\ta\tunit\ttest\tout\nthere.\tIs\ta\ttest\ta\tunit\ttest\tif\tI\tonly\ttest\tone\tline\tof\tcode?\tI’d\tsay\tyes.\tIs\tit\tstill\ta\tunit\ttest\tif\tI\ntest\tmultiple\tfunctions\tor\tclasses?\tI’d\tsay\tno,\tbut\tmany\twould\tdisagree!\tI\ttend\tto\tstick\nwith\tthe\tUnit\tand\tService\tnames\tdespite\ttheir\tambiguity,\tbut\tmuch\tprefer\tcalling\t "),a("em",[t._v("UI")]),t._v(" \ttests\n"),a("em",[t._v("end-to-end")]),t._v(" \ttests,\twhich\twe’ll\tdo\tfrom\tnow\ton.")]),t._v(" "),a("p",[t._v("Given\tthe\tconfusion,\tit’s\tworth\tus\tlooking\tat\twhat\tthese\tdifferent\tlayers\tmean.")]),t._v(" "),a("p",[t._v("Let’s\tlook\tat\ta\tworked\texample.\tIn\tFigure\t7-3,\twe\thave\tour\thelpdesk\tapplication\tand\tour\nmain\twebsite,\tboth\tof\twhich\tare\tinteracting\twith\tour\tcustomer\tservice\tto\tretrieve,\treview,\nand\tedit\tcustomer\tdetails.\tOur\tcustomer\tservice\tin\tturn\tis\ttalking\tto\tour\tloyalty\tpoints\nbank,\twhere\tour\tcustomers\taccrue\tpoints\tby\tbuying\tJustin\tBieber\tCDs.\tProbably.\tThis\tis\nobviously\ta\tsliver\tof\tour\toverall\tmusic\tshop\tsystem,\tbut\tit\tis\ta\tgood\tenough\tslice\tfor\tus\tto")]),t._v(" "),a("p",[t._v("dive\tinto\ta\tfew\tdifferent\tscenarios\twe\tmay\twant\tto\ttest.")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("Figure\t7-3.\tPart\tof\tour\tmusic\tshop\tunder\ttest\n")])])]),a("h2",{attrs:{id:"unittests"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#unittests"}},[t._v("#")]),t._v(" Unit\tTests")]),t._v(" "),a("p",[t._v("These\tare\ttests\tthat\ttypically\ttest\ta\tsingle\tfunction\tor\tmethod\tcall.\tThe\ttests\tgenerated\tas\ta\nside\teffect\tof\t "),a("em",[t._v("test-driven\tdesign")]),t._v(" \t(TDD)\twill\tfall\tinto\tthis\tcategory,\tas\tdo\tthe\tsorts\tof\ttests\ngenerated\tby\ttechniques\tsuch\tas\tproperty-based\ttesting.\tWe’re\tnot\tlaunching\tservices\there,\nand\tare\tlimiting\tthe\tuse\tof\texternal\tfiles\tor\tnetwork\tconnections.\tIn\tgeneral,\tyou\twant\ta\nlarge\tnumber\tof\tthese\tsorts\tof\ttests.\tDone\tright,\tthey\tare\tvery,\tvery\tfast,\tand\ton\tmodern\nhardware\tyou\tcould\texpect\tto\trun\tmany\tthousands\tof\tthese\tin\tless\tthan\ta\tminute.")]),t._v(" "),a("p",[t._v("These\tare\ttests\tthat\thelp\tus\tdevelopers\tand\tso\twould\tbe\t "),a("em",[t._v("technology-facing")]),t._v(" ,\tnot\t "),a("em",[t._v("business-\nfacing")]),t._v(" ,\tin\tMarick’s\tterminology.\tThey\tare\talso\twhere\twe\thope\tto\tcatch\tmost\tof\tour\tbugs.\nSo,\tin\tour\texample,\twhen\twe\tthink\tabout\tthe\tcustomer\tservice,\tunit\ttests\twould\tcover\nsmall\tparts\tof\tthe\tcode\tin\tisolation,\tas\tshown\tin\tFigure\t7-4.")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("Figure\t7-4.\tScope\tof\tunit\ttests\ton\tour\texample\tsystem\n")])])]),a("p",[t._v("The\tprime\tgoal\tof\tthese\ttests\tis\tto\tgive\tus\tvery\tfast\tfeedback\tabout\twhether\tour\nfunctionality\tis\tgood.\tTests\tcan\tbe\timportant\tto\tsupport\trefactoring\tof\tcode,\tallowing\tus\tto\nrestructure\tour\tcode\tas\twe\tgo,\tknowing\tthat\tour\tsmall-scoped\ttests\twill\tcatch\tus\tif\twe\nmake\ta\tmistake.")]),t._v(" "),a("h2",{attrs:{id:"servicetests"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#servicetests"}},[t._v("#")]),t._v(" Service\tTests")]),t._v(" "),a("p",[t._v("Service\ttests\tare\tdesigned\tto\tbypass\tthe\tuser\tinterface\tand\ttest\tservices\tdirectly.\tIn\ta\nmonolithic\tapplication,\twe\tmight\tjust\tbe\ttesting\ta\tcollection\tof\tclasses\tthat\tprovide\ta\n"),a("em",[t._v("service")]),t._v(" \tto\tthe\tUI.\tFor\ta\tsystem\tcomprising\ta\tnumber\tof\tservices,\ta\tservice\ttest\twould\ttest\nan\tindividual\tservice’s\tcapabilities.")]),t._v(" "),a("p",[t._v("The\treason\twe\twant\tto\ttest\ta\tsingle\tservice\tby\titself\tis\tto\timprove\tthe\tisolation\tof\tthe\ttest\nto\tmake\tfinding\tand\tfixing\tproblems\tfaster.\tTo\tachieve\tthis\tisolation,\twe\tneed\tto\tstub\tout\nall\texternal\tcollaborators\tso\tonly\tthe\tservice\titself\tis\tin\tscope,\tas\tFigure\t7-5\tshows.")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("Figure\t7-5.\tScope\tof\tservice\ttests\ton\tour\texample\tsystem\n")])])]),a("p",[t._v("Some\tof\tthese\ttests\tcould\tbe\tas\tfast\tas\tsmall\ttests,\tbut\tif\tyou\tdecide\tto\ttest\tagainst\ta\treal\ndatabase,\tor\tgo\tover\tnetworks\tto\tstubbed\tdownstream\tcollaborators,\ttest\ttimes\tcan\nincrease.\tThey\talso\tcover\tmore\tscope\tthan\ta\tsimple\tunit\ttest,\tso\tthat\twhen\tthey\tfail\tit\tcan\nbe\tharder\tto\tdetect\twhat\tis\tbroken\tthan\twith\ta\tunit\ttest.\tHowever,\tthey\thave\tmuch\tfewer\nmoving\tparts\tand\tare\ttherefore\tless\tbrittle\tthan\tlarger-scoped\ttests.")]),t._v(" "),a("h2",{attrs:{id:"end-to-endtests"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#end-to-endtests"}},[t._v("#")]),t._v(" End-to-End\tTests")]),t._v(" "),a("p",[t._v("End-to-end\ttests\tare\ttests\trun\tagainst\tyour\tentire\tsystem.\tOften\tthey\twill\tbe\tdriving\ta\tGUI\nthrough\ta\tbrowser,\tbut\tcould\teasily\tbe\tmimicking\tother\tsorts\tof\tuser\tinteraction,\tlike\nuploading\ta\tfile.")]),t._v(" "),a("p",[t._v("These\ttests\tcover\ta\tlot\tof\tproduction\tcode,\tas\twe\tsee\tin\tFigure\t7-6\t.\tSo\twhen\tthey\tpass,\nyou\tfeel\tgood:\tyou\thave\ta\thigh\tdegree\tof\tconfidence\tthat\tthe\tcode\tbeing\ttested\twill\twork\nin\tproduction.\tBut\tthis\tincreased\tscope\tcomes\twith\tdownsides,\tand\tas\twe’ll\tsee\tshortly,\nthey\tcan\tbe\tvery\ttricky\tto\tdo\twell\tin\ta\tmicroservices\tcontext.")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("Figure\t7-6.\tScope\tof\tend-to-end\ttests\ton\tour\texample\tsystem\n")])])]),a("h2",{attrs:{id:"trade-offs"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#trade-offs"}},[t._v("#")]),t._v(" Trade-Offs")]),t._v(" "),a("p",[t._v("When\tyou’re\treading\tthe\tpyramid,\tthe\tkey\tthing\tto\ttake\taway\tis\tthat\tas\tyou\tgo\tup\tthe\npyramid,\tthe\ttest\tscope\tincreases,\tas\tdoes\tour\tconfidence\tthat\tthe\tfunctionality\tbeing\ntested\tworks.\tOn\tthe\tother\thand,\tthe\tfeedback\tcycle\ttime\tincreases\tas\tthe\ttests\ttake\tlonger\nto\trun,\tand\twhen\ta\ttest\tfails\tit\tcan\tbe\tharder\tto\tdetermine\twhich\tfunctionality\thas\tbroken.\nAs\tyou\tgo\tdown\tthe\tpyramid,\tin\tgeneral\tthe\ttests\tbecome\tmuch\tfaster,\tso\twe\tget\tmuch\nfaster\tfeedback\tcycles.\tWe\tfind\tbroken\tfunctionality\tfaster,\tour\tcontinuous\tintegration\nbuilds\tare\tfaster,\tand\twe\tare\tless\tlikely\tto\tmove\ton\tto\ta\tnew\ttask\tbefore\tfinding\tout\twe\nhave\tbroken\tsomething.\tWhen\tthose\tsmaller-scoped\ttests\tfail,\twe\talso\ttend\tto\tknow\twhat\nbroke,\toften\texactly\twhat\tline\tof\tcode.\tOn\tthe\tflipside,\twe\tdon’t\tget\ta\tlot\tof\tconfidence\nthat\tour\tsystem\tas\ta\twhole\tworks\tif\twe’ve\tonly\ttested\tone\tline\tof\tcode!")]),t._v(" "),a("p",[t._v("When\tbroader-scoped\ttests\tlike\tour\tservice\tor\tend-to-end\ttests\tfail,\twe\twill\ttry\tto\twrite\ta\nfast\tunit\ttest\tto\tcatch\tthat\tproblem\tin\tthe\tfuture.\tIn\tthat\tway,\twe\tare\tconstantly\ttrying\tto\nimprove\tour\tfeedback\tcycles.")]),t._v(" "),a("p",[t._v("Virtually\tevery\tteam\tI’ve\tworked\ton\thas\tused\tdifferent\tnames\tthan\tthe\tones\tthat\tCohn\nuses\tin\tthe\tpyramid.\tWhatever\tyou\tcall\tthem,\tthe\tkey\ttakeaway\tis\tthat\tyou\twill\twant\ttests\nof\tdifferent\tscope\tfor\tdifferent\tpurposes.")]),t._v(" "),a("h2",{attrs:{id:"howmany"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#howmany"}},[t._v("#")]),t._v(" How\tMany?")]),t._v(" "),a("p",[t._v("So\tif\tthese\ttests\tall\thave\ttrade-offs,\thow\tmany\tof\teach\ttype\tdo\tyou\twant?\tA\tgood\trule\tof\nthumb\tis\tthat\tyou\tprobably\twant\tan\torder\tof\tmagnitude\tmore\ttests\tas\tyou\tdescend\tthe\npyramid,\tbut\tthe\timportant\tthing\tis\tknowing\tthat\tyou\tdo\thave\tdifferent\ttypes\tof\tautomated\ntests\tand\tunderstanding\tif\tyour\tcurrent\tbalance\tgives\tyou\ta\tproblem!")]),t._v(" "),a("p",[t._v("I\tworked\ton\tone\tmonolithic\tsystem,\tfor\texample,\twhere\twe\thad\t4,000\tunit\ttests,\t1,000\nservice\ttests,\tand\t60\tend-to-end\ttests.\tWe\tdecided\tthat\tfrom\ta\tfeedback\tpoint\tof\tview\twe\nhad\tway\ttoo\tmany\tservice\tand\tend-to-end\ttests\t(the\tlatter\tof\twhich\twere\tthe\tworst\noffenders\tin\timpacting\tfeedback\tloops),\tso\twe\tworked\thard\tto\treplace\tthe\ttest\tcoverage\nwith\tsmaller-scoped\ttests.")]),t._v(" "),a("p",[t._v("A\tcommon\tanti-pattern\tis\twhat\tis\toften\treferred\tto\tas\ta\t "),a("em",[t._v("test\tsnow\tcone")]),t._v(" ,\tor\tinverted\npyramid.\tHere,\tthere\tare\tlittle\tto\tno\tsmall-scoped\ttests,\twith\tall\tthe\tcoverage\tin\tlarge-\nscoped\ttests.\tThese\tprojects\toften\thave\tglacially\tslow\ttest\truns,\tand\tvery\tlong\tfeedback\ncycles.\tIf\tthese\ttests\tare\trun\tas\tpart\tof\tcontinuous\tintegration,\tyou\twon’t\tget\tmany\tbuilds,\nand\tthe\tnature\tof\tthe\tbuild\ttimes\tmeans\tthat\tthe\tbuild\tcan\tstay\tbroken\tfor\ta\tlong\tperiod\nwhen\tsomething\tdoes\tbreak.")]),t._v(" "),a("h2",{attrs:{id:"implementingservicetests"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#implementingservicetests"}},[t._v("#")]),t._v(" Implementing\tService\tTests")]),t._v(" "),a("p",[t._v("Implementing\tunit\ttests\tis\ta\tfairly\tsimple\taffair\tin\tthe\tgrand\tscheme\tof\tthings,\tand\tthere\tis\nplenty\tof\tdocumentation\tout\tthere\texplaining\thow\tto\twrite\tthem.\tThe\tservice\tand\tend-to-\nend\ttests\tare\tthe\tones\tthat\tare\tmore\tinteresting.")]),t._v(" "),a("p",[t._v("Our\tservice\ttests\twant\tto\ttest\ta\tslice\tof\tfunctionality\tacross\tthe\twhole\tservice,\tbut\tto\nisolate\tourselves\tfrom\tother\tservices\twe\tneed\tto\tfind\tsome\tway\tto\tstub\tout\tall\tof\tour\ncollaborators.\tSo,\tif\twe\twanted\tto\twrite\ta\ttest\tlike\tthis\tfor\tthe\tcustomer\tservice\tfrom\nFigure\t7-3,\twe\twould\tdeploy\tan\tinstance\tof\tthe\tcustomer\tservice,\tand\tas\tdiscussed\tearlier\nwe\twould\twant\tto\tstub\tout\tany\tdownstream\tservices.")]),t._v(" "),a("p",[t._v("One\tof\tthe\tfirst\tthings\tour\tcontinuous\tintegration\tbuild\twill\tdo\tis\tcreate\ta\tbinary\tartifact\nfor\tour\tservice,\tso\tdeploying\tthat\tis\tpretty\tstraightforward.\tBut\thow\tdo\twe\thandle\tfaking\nthe\tdownstream\tcollaborators?")]),t._v(" "),a("p",[t._v("Our\tservice\ttest\tsuite\tneeds\tto\tlaunch\tstub\tservices\tfor\tany\tdownstream\tcollaborators\t(or\nensure\tthey\tare\trunning),\tand\tconfigure\tthe\tservice\tunder\ttest\tto\tconnect\tto\tthe\tstub\nservices.\tWe\tthen\tneed\tto\tconfigure\tthe\tstubs\tto\tsend\tresponses\tback\tto\tmimic\tthe\treal-\nworld\tservices.\tFor\texample,\twe\tmight\tconfigure\tthe\tstub\tfor\tthe\tloyalty\tpoints\tbank\tto\nreturn\tknown\tpoints\tbalances\tfor\tcertain\tcustomers.")]),t._v(" "),a("h2",{attrs:{id:"mockingorstubbing"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#mockingorstubbing"}},[t._v("#")]),t._v(" Mocking\tor\tStubbing")]),t._v(" "),a("p",[t._v("When\tI\ttalk\tabout\tstubbing\tdownstream\tcollaborators,\tI\tmean\tthat\twe\tcreate\ta\tstub\tservice\nthat\tresponds\twith\tcanned\tresponses\tto\tknown\trequests\tfrom\tthe\tservice\tunder\ttest.\tFor\nexample,\tI\tmight\ttell\tmy\tstub\tpoints\tbank\tthat\twhen\tasked\tfor\tthe\tbalance\tof\tcustomer\n123,\tit\tshould\treturn\t15,000.\tThe\ttest\tdoesn’t\tcare\tif\tthe\tstub\tis\tcalled\t0,\t1,\tor\t100\ttimes.\tA\nvariation\ton\tthis\tis\tto\tuse\ta\tmock\tinstead\tof\ta\tstub.")]),t._v(" "),a("p",[t._v("When\tusing\ta\tmock,\tI\tactually\tgo\tfurther\tand\tmake\tsure\tthe\tcall\twas\tmade.\tIf\tthe\texpected\ncall\tis\tnot\tmade,\tthe\ttest\tfails.\tImplementing\tthis\tapproach\trequires\tmore\tsmarts\tin\tthe\nfake\tcollaborators\tthat\twe\tcreate,\tand\tif\toverused\tcan\tcause\ttests\tto\tbecome\tbrittle.\tAs\nnoted,\thowever,\ta\tstub\tdoesn’t\tcare\tif\tit\tis\tcalled\t0,\t1,\tor\tmany\ttimes.")]),t._v(" "),a("p",[t._v("Sometimes,\tthough,\tmocks\tcan\tbe\tvery\tuseful\tto\tensure\tthat\tthe\texpected\tside\teffects\nhappen.\tFor\texample,\tI\tmight\twant\tto\tcheck\tthat\twhen\tI\tcreate\ta\tcustomer,\ta\tnew\tpoints\nbalance\tis\tset\tup\tfor\tthat\tcustomer.\tThe\tbalance\tbetween\tstubbing\tand\tmocking\tcalls\tis\ta\ndelicate\tone,\tand\tis\tjust\tas\tfraught\tin\tservice\ttests\tas\tin\tunit\ttests.\tIn\tgeneral,\tthough,\tI\tuse\nstubs\tfar\tmore\tthan\tmocks\tfor\tservice\ttests.\tFor\ta\tmore\tin-depth\tdiscussion\tof\tthis\ttrade-\noff,\ttake\ta\tlook\tat\t "),a("em",[t._v("Growing\tObject-Oriented\tSoftware,\tGuided\tby\tTests")]),t._v(" ,\tby\tSteve\tFreeman\nand\tNat\tPryce\t(Addison-Wesley).")]),t._v(" "),a("p",[t._v("In\tgeneral,\tI\trarely\tuse\tmocks\tfor\tthis\tsort\tof\ttesting.\tBut\thaving\ta\ttool\tthat\tcan\tdo\tboth\tis\nuseful.")]),t._v(" "),a("p",[t._v("While\tI\tfeel\tthat\tstubs\tand\tmocks\tare\tactually\tfairly\twell\tdifferentiated,\tI\tknow\tthe\ndistinction\tcan\tbe\tconfusing\tto\tsome,\tespecially\twhen\tsome\tpeople\tthrow\tin\tother\tterms\nlike\t "),a("em",[t._v("fakes")]),t._v(" ,\t "),a("em",[t._v("spies")]),t._v(" ,\tand\t "),a("em",[t._v("dummies")]),t._v(" .\tMartin\tFowler\tcalls\tall\tof\tthese\tthings,\tincluding\tstubs\tand\nmocks,\ttest\tdoubles.")]),t._v(" "),a("h2",{attrs:{id:"asmarterstubservice"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#asmarterstubservice"}},[t._v("#")]),t._v(" A\tSmarter\tStub\tService")]),t._v(" "),a("p",[t._v("Normally\tfor\tstub\tservices\tI’ve\trolled\tthem\tmyself.\tI’ve\tused\teverything\tfrom\tApache\tor\nNginx\tto\tembedded\tJetty\tcontainers\tor\teven\tcommand-line-launched\tPython\tweb\tservers\nused\tto\tlaunch\tstub\tservers\tfor\tsuch\ttest\tcases.\tI’ve\tprobably\treproduced\tthe\tsame\twork\ntime\tand\ttime\tagain\tin\tcreating\tthese\tstubs.\tMy\tThoughtWorks\tcolleague\tBrandon\tBryars\nhas\tpotentially\tsaved\tmany\tof\tus\ta\tchunk\tof\twork\twith\this\tstub/mock\tserver\tcalled\nMountebank.")]),t._v(" "),a("p",[t._v("You\tcan\tthink\tof\tMountebank\tas\ta\tsmall\tsoftware\tappliance\tthat\tis\tprogrammable\tvia\nHTTP.\tThe\tfact\tthat\tit\thappens\tto\tbe\twritten\tin\tNodeJS\tis\tcompletely\topaque\tto\tany\ncalling\tservice.\tWhen\tit\tlaunches,\tyou\tsend\tit\tcommands\ttelling\tit\twhat\tport\tto\tstub\ton,\nwhat\tprotocol\tto\thandle\t(currently\tTCP,\tHTTP,\tand\tHTTPS\tare\tsupported,\twith\tmore\nplanned),\tand\twhat\tresponses\tit\tshould\tsend\twhen\trequests\tare\tsent.\tIt\talso\tsupports\nsetting\texpectations\tif\tyou\twant\tto\tuse\tit\tas\ta\tmock.\tYou\tcan\tadd\tor\tremove\tthese\tstub\nendpoints\tat\twill,\tmaking\tit\tpossible\tfor\ta\tsingle\tMountebank\tinstance\tto\tstub\tmore\tthan\none\tdownstream\tdependency.")]),t._v(" "),a("p",[t._v("So,\tif\twe\twant\tto\trun\tour\tservice\ttests\tfor\tjust\tour\tcustomer\tservice\twe\tcan\tlaunch\tthe\ncustomer\tservice,\tand\ta\tMountebank\tinstance\tthat\tacts\tas\tour\tloyalty\tpoints\tbank.\tAnd\tif\nthose\ttests\tpass,\tI\tcan\tdeploy\tthe\tcustomer\tservice\tstraightaway!\tOr\tcan\tI?\tWhat\tabout\tthe\nservices\tthat\tcall\tthe\tcustomer\tservice\t—\tthe\thelpdesk\tand\tthe\tweb\tshop?\tDo\twe\tknow\tif\nwe\thave\tmade\ta\tchange\tthat\tmay\tbreak\tthem?\tOf\tcourse,\twe\thave\tforgotten\tthe\timportant\ntests\tat\tthe\ttop\tof\tthe\tpyramid:\tthe\tend-to-end\ttests.")]),t._v(" "),a("h2",{attrs:{id:"thosetrickyend-to-endtests"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#thosetrickyend-to-endtests"}},[t._v("#")]),t._v(" Those\tTricky\tEnd-to-End\tTests")]),t._v(" "),a("p",[t._v("In\ta\tmicroservice\tsystem,\tthe\tcapabilities\twe\texpose\tvia\tour\tuser\tinterfaces\tare\tdelivered\nby\ta\tnumber\tof\tservices.\tThe\tpoint\tof\tthe\tend-to-end\ttests\tas\toutlined\tin\tMike\tCohn’s\npyramid\tis\tto\tdrive\tfunctionality\tthrough\tthese\tuser\tinterfaces\tagainst\teverything\nunderneath\tto\tgive\tus\tan\toverview\tof\ta\tlarge\tamount\tof\tour\tsystem.")]),t._v(" "),a("p",[t._v("So,\tto\timplement\tan\tend-to-end\ttest\twe\tneed\tto\tdeploy\tmultiple\tservices\ttogether,\tthen\trun\na\ttest\tagainst\tall\tof\tthem.\tObviously,\tthis\ttest\thas\tmuch\tmore\tscope,\tresulting\tin\tmore\nconfidence\tthat\tour\tsystem\tworks!\tOn\tthe\tother\thand,\tthese\ttests\tare\tliable\tto\tbe\tslower\nand\tmake\tit\tharder\tto\tdiagnose\tfailure.\tLet’s\tdig\tinto\tthem\ta\tbit\tmore\tusing\tour\tprevious\nexample\tto\tsee\thow\tthese\ttests\tcan\tfit\tin.")]),t._v(" "),a("p",[t._v("Imagine\twe\twant\tto\tpush\tout\ta\tnew\tversion\tof\tthe\tcustomer\tservice.\tWe\twant\tto\tdeploy\nour\tchanges\tinto\tproduction\tas\tsoon\tas\tpossible,\tbut\tare\tconcerned\tthat\twe\tmay\thave\nintroduced\ta\tchange\tthat\tcould\tbreak\teither\tthe\thelpdesk\tor\tthe\tweb\tshop.\tNo\tproblem\t—\nlet’s\tdeploy\tall\tof\tour\tservices\ttogether,\tand\trun\tsome\ttests\tagainst\tthe\thelpdesk\tand\tweb\nshop\tto\tsee\tif\twe’ve\tintroduced\ta\tbug.\tNow\ta\tnaive\tapproach\twould\tbe\tto\tjust\tadd\tthese\ntests\tonto\tthe\tend\tof\tour\tcustomer\tservice\tpipeline,\tas\tin\tFigure\t7-7.")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("Figure\t7-7.\tAdding\tour\tend-to-end\ttests\tstage:\tthe\tright\tapproach?\n")])])]),a("p",[t._v("So\tfar,\tso\tgood.\tBut\tthe\tfirst\tquestion\twe\thave\tto\task\tourselves\tis\twhich\tversion\tof\tthe\nother\tservices\tshould\twe\tuse?\tShould\twe\trun\tour\ttests\tagainst\tthe\tversions\tof\thelpdesk\tand\nweb\tshop\tthat\tare\tin\tproduction?\tIt’s\ta\tsensible\tassumption,\tbut\twhat\tif\tthere\tis\ta\tnew\nversion\tof\teither\tthe\thelpdesk\tor\tweb\tshop\tqueued\tup\tto\tgo\tlive;\twhat\tshould\twe\tdo\tthen?")]),t._v(" "),a("p",[t._v("Another\tproblem:\tif\twe\thave\ta\tset\tof\tcustomer\tservice\ttests\tthat\tdeploy\tlots\tof\tservices\nand\trun\ttests\tagainst\tthem,\twhat\tabout\tthe\tend-to-end\ttests\tthat\tthe\tother\tservices\trun?\tIf\nthey\tare\ttesting\tthe\tsame\tthing,\twe\tmay\tfind\tourselves\tcovering\tlots\tof\tthe\tsame\tground,\nand\tmay\tduplicate\ta\tlot\tof\tthe\teffort\tto\tdeploy\tall\tthose\tservices\tin\tthe\tfirst\tplace.")]),t._v(" "),a("p",[t._v("We\tcan\tdeal\twith\tboth\tof\tthese\tproblems\telegantly\tby\thaving\tmultiple\tpipelines\t "),a("em",[t._v("fan\tin")]),t._v(" \tto\ta\nsingle,\tend-to-end\ttest\tstage.\tHere,\twhenever\ta\tnew\tbuild\tof\tone\tof\tour\tservices\tis\ntriggered,\twe\trun\tour\tend-to-end\ttests,\tan\texample\tof\twhich\twe\tcan\tsee\tin\tFigure\t7-8.\nSome\tCI\ttools\twith\tbetter\tbuild\tpipeline\tsupport\twill\tenable\tfan-in\tmodels\tlike\tthis\tout\tof\nthe\tbox.")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("Figure\t7-8.\tA\tstandard\tway\tto\thandle\tend-to-end\ttests\tacross\tservices\n")])])]),a("p",[t._v("So\tany\ttime\tany\tof\tour\tservices\tchanges,\twe\trun\tthe\ttests\tlocal\tto\tthat\tservice.\tIf\tthose\ntests\tpass,\twe\ttrigger\tour\tintegration\ttests.\tGreat,\teh?\tWell,\tthere\tare\ta\tfew\tproblems.")]),t._v(" "),a("h2",{attrs:{id:"downsidestoend-to-endtesting"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#downsidestoend-to-endtesting"}},[t._v("#")]),t._v(" Downsides\tto\tEnd-to-End\tTesting")]),t._v(" "),a("p",[t._v("There\tare,\tunfortunately,\tmany\tdisadvantages\tto\tend-to-end\ttesting.")]),t._v(" "),a("h2",{attrs:{id:"flakyandbrittletests"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#flakyandbrittletests"}},[t._v("#")]),t._v(" Flaky\tand\tBrittle\tTests")]),t._v(" "),a("p",[t._v("As\ttest\tscope\tincreases,\tso\ttoo\tdo\tthe\tnumber\tof\tmoving\tparts.\tThese\tmoving\tparts\tcan\nintroduce\ttest\tfailures\tthat\tdo\tnot\tshow\tthat\tthe\tfunctionality\tunder\ttest\tis\tbroken,\tbut\tthat\nsome\tother\tproblem\thas\toccurred.\tAs\tan\texample,\tif\twe\thave\ta\ttest\tto\tverify\tthat\twe\tcan\nplace\tan\torder\tfor\ta\tsingle\tCD,\tbut\twe\tare\trunning\tthat\ttest\tagainst\tfour\tor\tfive\tservices,\tif\nany\tof\tthem\tis\tdown\twe\tcould\tget\ta\tfailure\tthat\thas\tnothing\tto\tdo\twith\tthe\tnature\tof\tthe\ntest\titself.\tLikewise,\ta\ttemporary\tnetwork\tglitch\tcould\tcause\ta\ttest\tto\tfail\twithout\tsaying\nanything\tabout\tthe\tfunctionality\tunder\ttest.")]),t._v(" "),a("p",[t._v("The\tmore\tmoving\tparts,\tthe\tmore\tbrittle\tour\ttests\tmay\tbe,\tand\tthe\tless\tdeterministic\tthey\nare.\tIf\tyou\thave\ttests\tthat\t "),a("em",[t._v("sometimes")]),t._v(" \tfail,\tbut\teveryone\tjust\tre-runs\tthem\tbecause\tthey\tmay\npass\tagain\tlater,\tthen\tyou\thave\tflaky\ttests.\tIt\tisn’t\tonly\ttests\tcovering\tlots\tof\tdifferent\nprocess\tthat\tare\tthe\tculprit\there.\tTests\tthat\tcover\tfunctionality\tbeing\texercised\ton\tmultiple\nthreads\tare\toften\tproblematic,\twhere\ta\tfailure\tcould\tmean\ta\trace\tcondition,\ta\ttimeout,\tor\nthat\tthe\tfunctionality\tis\tactually\tbroken.\tFlaky\ttests\tare\tthe\tenemy.\tWhen\tthey\tfail,\tthey\ndon’t\ttell\tus\tmuch.\tWe\tre-run\tour\tCI\tbuilds\tin\tthe\thope\tthat\tthey\twill\tpass\tagain\tlater,\tonly\nto\tsee\tcheck-ins\tpile\tup,\tand\tsuddenly\twe\tfind\tourselves\twith\ta\tload\tof\tbroken\nfunctionality.")]),t._v(" "),a("p",[t._v("When\twe\tdetect\tflaky\ttests,\tit\tis\tessential\tthat\twe\tdo\tour\tbest\tto\tremove\tthem.\tOtherwise,\nwe\tstart\tto\tlose\tfaith\tin\ta\ttest\tsuite\tthat\t“always\tfails\tlike\tthat.”\tA\ttest\tsuite\twith\tflaky\ttests\ncan\tbecome\ta\tvictim\tof\twhat\tDiane\tVaughan\tcalls\tthe\t "),a("em",[t._v("normalization\tof\tdeviance")]),t._v(" \t—\tthe\nidea\tthat\tover\ttime\twe\tcan\tbecome\tso\taccustomed\tto\tthings\tbeing\twrong\tthat\twe\tstart\tto")]),t._v(" "),a("p",[t._v("accept\tthem\tas\tbeing\tnormal\tand\tnot\ta\tproblem.^2 \tThis\tvery\thuman\ttendency\tmeans\twe\nneed\tto\tfind\tand\teliminate\tthese\ttests\tas\tsoon\tas\twe\tcan\tbefore\twe\tstart\tto\tassume\tthat\nfailing\ttests\tare\tOK.")]),t._v(" "),a("p",[t._v("In\t“Eradicating\tNon-Determinism\tin\tTests”,\tMartin\tFowler\tadvocates\tthe\tapproach\tthat\tif\nyou\thave\tflaky\ttests,\tyou\tshould\ttrack\tthem\tdown\tand\tif\tyou\tcan’t\timmediately\tfix\tthem,\nremove\tthem\tfrom\tthe\tsuite\tso\tyou\tcan\ttreat\tthem.\tSee\tif\tyou\tcan\trewrite\tthem\tto\tavoid\ntesting\tcode\trunning\ton\tmultiple\tthreads.\tSee\tif\tyou\tcan\tmake\tthe\tunderlying\tenvironment\nmore\tstable.\tBetter\tyet,\tsee\tif\tyou\tcan\treplace\tthe\tflaky\ttest\twith\ta\tsmaller-scoped\ttest\tthat\nis\tless\tlikely\tto\texhibit\tproblems.\tIn\tsome\tcases,\tchanging\tthe\tsoftware\tunder\ttest\tto\tmake\nit\teasier\tto\ttest\tcan\talso\tbe\tthe\tright\tway\tforward.")]),t._v(" "),a("h2",{attrs:{id:"whowritesthesetests"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#whowritesthesetests"}},[t._v("#")]),t._v(" Who\tWrites\tThese\tTests?")]),t._v(" "),a("p",[t._v("With\tthe\ttests\tthat\trun\tas\tpart\tof\tthe\tpipeline\tfor\ta\tspecific\tservice,\tthe\tsensible\tstarting\npoint\tis\tthat\tthe\tteam\tthat\towns\tthat\tservice\tshould\twrite\tthose\ttests\t(we’ll\ttalk\tmore\tabout\nservice\townership\tin\tChapter\t10).\tBut\tif\twe\tconsider\tthat\twe\tmight\thave\tmultiple\tteams\ninvolved,\tand\tthe\tend-to-end-tests\tstep\tis\tnow\teffectively\tshared\tbetween\tthe\tteams,\twho\nwrites\tand\tlooks\tafter\tthese\ttests?")]),t._v(" "),a("p",[t._v("I\thave\tseen\ta\tnumber\tof\tanti-patterns\tcaused\there.\tThese\ttests\tbecome\ta\tfree-for-all,\twith\nall\tteams\tgranted\taccess\tto\tadd\ttests\twithout\tany\tunderstanding\tof\tthe\thealth\tof\tthe\twhole\nsuite.\tThis\tcan\toften\tresult\tin\tan\texplosion\tof\ttest\tcases,\tsometimes\tresulting\tin\tthe\ttest\nsnow\tcone\twe\ttalked\tabout\tearlier.\tI\thave\tseen\tsituations\twhere,\tbecause\tthere\twas\tno\treal\nobvious\townership\tof\tthese\ttests,\ttheir\tresults\tget\tignored.\tWhen\tthey\tbreak,\teveryone\nassumes\tit\tis\tsomeone\telse’s\tproblem,\tso\tthey\tdon’t\tcare\twhether\tthe\ttests\tare\tpassing.")]),t._v(" "),a("p",[t._v("Sometimes\torganizations\treact\tby\thaving\ta\tdedicated\tteam\twrite\tthese\ttests.\tThis\tcan\tbe\ndisastrous.\tThe\tteam\tdeveloping\tthe\tsoftware\tbecomes\tincreasingly\tdistant\tfrom\tthe\ttests\nfor\tits\tcode.\tCycle\ttimes\tincrease,\tas\tservice\towners\tend\tup\twaiting\tfor\tthe\ttest\tteam\tto\nwrite\tend-to-end\ttests\tfor\tthe\tfunctionality\tthey\tjust\twrote.\tBecause\tanother\tteam\twrites\nthese\ttests,\tthe\tteam\tthat\twrote\tthe\tservice\tis\tless\tinvolved\twith,\tand\ttherefore\tless\tlikely\nto\tknow,\thow\tto\trun\tand\tfix\tthese\ttests.\tAlthough\tit\tis\tunfortunately\tstill\ta\tcommon\norganizational\tpattern,\tI\tsee\tsignificant\tharm\tdone\twhenever\ta\tteam\tis\tdistanced\tfrom\nwriting\ttests\tfor\tthe\tcode\tit\twrote\tin\tthe\tfirst\tplace.")]),t._v(" "),a("p",[t._v("Getting\tthis\taspect\tright\tis\treally\thard.\tWe\tdon’t\twant\tto\tduplicate\teffort,\tnor\tdo\twe\twant\nto\tcompletely\tcentralize\tthis\tto\tthe\textent\tthat\tthe\tteams\tbuilding\tservices\tare\ttoo\tfar\nremoved\tfrom\tthings.\tThe\tbest\tbalance\tI\thave\tfound\tis\tto\ttreat\tthe\tend-to-end\ttest\tsuite\tas\na\tshared\tcodebase,\tbut\twith\tjoint\townership.\tTeams\tare\tfree\tto\tcheck\tin\tto\tthis\tsuite,\tbut\nthe\townership\tof\tthe\thealth\tof\tthe\tsuite\thas\tto\tbe\tshared\tbetween\tthe\tteams\tdeveloping\tthe\nservices\tthemselves.\tIf\tyou\twant\tto\tmake\textensive\tuse\tof\tend-to-end\ttests\twith\tmultiple\nteams\tI\tthink\tthis\tapproach\tis\tessential,\tand\tyet\tI\thave\tseen\tit\tdone\tvery\trarely,\tand\tnever\nwithout\tissue.")]),t._v(" "),a("h2",{attrs:{id:"howlong"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#howlong"}},[t._v("#")]),t._v(" How\tLong?")]),t._v(" "),a("p",[t._v("These\tend-to-end\ttests\tcan\ttake\ta\twhile.\tI\thave\tseen\tthem\ttake\tup\tto\ta\tday\tto\trun,\tif\tnot\nmore,\tand\ton\tone\tproject\tI\tworked\ton,\ta\tfull\tregression\tsuite\ttook\tsix\tweeks!\tI\trarely\tsee\nteams\tactually\tcurate\ttheir\tend-to-end\ttest\tsuites\tto\treduce\toverlap\tin\ttest\tcoverage,\tor\nspend\tenough\ttime\tin\tmaking\tthem\tfast.")]),t._v(" "),a("p",[t._v("This\tslowness,\tcombined\twith\tthe\tfact\tthat\tthese\ttests\tcan\toften\tbe\tflaky,\tcan\tbe\ta\tmajor\nproblem.\tA\ttest\tsuite\tthat\ttakes\tall\tday\tand\toften\thas\tbreakages\tthat\thave\tnothing\tto\tdo\nwith\tbroken\tfunctionality\tare\ta\tdisaster.\tEven\tif\tyour\tfunctionality\t "),a("em",[t._v("is")]),t._v(" \tbroken,\tit\tcould\ttake\nyou\tmany\thours\tto\tfind\tout\t—\tat\twhich\tpoint\tmany\tof\tus\twould\talready\thave\tmoved\ton\tto\nother\tactivities,\tand\tthe\tcontext\tswitch\tin\tshifting\tour\tbrains\tback\tto\tfix\tthe\tissue\tis\npainful.")]),t._v(" "),a("p",[t._v("We\tcan\tameliorate\tsome\tof\tthis\tby\trunning\ttests\tin\tparallel\t—\tfor\texample,\tmaking\tuse\tof\ntools\tlike\tSelenium\tGrid.\tHowever,\tthis\tapproach\tis\tnot\ta\tsubstitute\tfor\tactually\nunderstanding\twhat\tneeds\tto\tbe\ttested\tand\tactively\t "),a("em",[t._v("removing")]),t._v(" \ttests\tthat\tare\tno\tlonger\nneeded.")]),t._v(" "),a("p",[t._v("Removing\ttests\tis\tsometimes\ta\tfraught\texercise,\tand\tI\tsuspect\tshares\tmuch\tin\tcommon\nwith\tpeople\twho\twant\tto\tremove\tcertain\tairport\tsecurity\tmeasures.\tNo\tmatter\thow\nineffective\tthe\tsecurity\tmeasures\tmight\tbe,\tany\tconversation\tabout\tremoving\tthem\tis\toften\ncountered\twith\tknee-jerk\treactions\tabout\tnot\tcaring\tabout\tpeople’s\tsafety\tor\twanting\nterrorists\tto\twin.\tIt\tis\thard\tto\thave\ta\tbalanced\tconversation\tabout\tthe\tvalue\tsomething\tadds\nversus\tthe\tburden\tit\tentails.\tIt\tcan\talso\tbe\ta\tdifficult\trisk/reward\ttrade-off.\tDo\tyou\tget\nthanked\tif\tyou\tremove\ta\ttest?\tMaybe.\tBut\tyou’ll\tcertainly\tget\tblamed\tif\ta\ttest\tyou\nremoved\tlets\ta\tbug\tthrough.\tWhen\tit\tcomes\tto\tthe\tlarger-scoped\ttest\tsuites,\thowever,\tthis\nis\texactly\twhat\twe\tneed\tto\tbe\table\tto\tdo.\tIf\tthe\tsame\tfeature\tis\tcovered\tin\t20\tdifferent\ntests,\tperhaps\twe\tcan\tget\trid\tof\thalf\tof\tthem,\tas\tthose\t20\ttests\ttake\t10\tminutes\tto\trun!\nWhat\tthis\trequires\tis\ta\tbetter\tunderstanding\tof\trisk,\twhich\tsomething\thumans\tare\nfamously\tbad\tat.\tAs\ta\tresult,\tthis\tintelligent\tcuration\tand\tmanagement\tof\tlarger-scoped,\nhigh-burden\ttests\thappens\tincredibly\tinfrequently.\tWishing\tpeople\tdid\tthis\tmore\tisn’t\tthe\nsame\tthing\tas\tmaking\tit\thappen.")]),t._v(" "),a("h2",{attrs:{id:"thegreatpile-up"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#thegreatpile-up"}},[t._v("#")]),t._v(" The\tGreat\tPile-up")]),t._v(" "),a("p",[t._v("The\tlong\tfeedback\tcycles\tassociated\twith\tend-to-end\ttests\taren’t\tjust\ta\tproblem\twhen\tit\ncomes\tto\tdeveloper\tproductivity.\tWith\ta\tlong\ttest\tsuite,\tany\tbreaks\ttake\ta\twhile\tto\tfix,\nwhich\treduces\tthe\tamount\tof\ttime\tthat\tthe\tend-to-end\ttests\tcan\tbe\texpected\tto\tbe\tpassing.\nIf\twe\tdeploy\tonly\tsoftware\tthat\thas\tpassed\tthrough\tall\tour\ttests\tsuccessfully\t(which\twe\nshould!),\tthis\tmeans\tfewer\tof\tour\tservices\tget\tthrough\tto\tthe\tpoint\tof\tbeing\tdeployable\ninto\tproduction.")]),t._v(" "),a("p",[t._v("This\tcan\tlead\tto\ta\tpile-up.\tWhile\ta\tbroken\tintegration\ttest\tstage\tis\tbeing\tfixed,\tmore\nchanges\tfrom\tupstream\tteams\tcan\tpile\tin.\tAside\tfrom\tthe\tfact\tthat\tthis\tcan\tmake\tfixing\tthe\nbuild\tharder,\tit\tmeans\tthe\tscope\tof\tchanges\tto\tbe\tdeployed\tincreases.\tOne\tway\tto\tresolve\nthis\tis\tto\tnot\tlet\tpeople\tcheck\tin\tif\tthe\tend-to-end\ttests\tare\tfailing,\tbut\tgiven\ta\tlong\ttest\nsuite\ttime\tthis\tis\toften\timpractical.\tTry\tsaying,\t“You\t30\tdevelopers:\tno\tcheck-ins\ttil\twe\tfix\nthis\tseven-hour-long\tbuild!”")]),t._v(" "),a("p",[t._v("The\tlarger\tthe\tscope\tof\ta\tdeployment\tand\tthe\thigher\tthe\trisk\tof\ta\trelease,\tthe\tmore\tlikely\nwe\tare\tto\tbreak\tsomething.\tA\tkey\tdriver\tto\tensuring\twe\tcan\trelease\tour\tsoftware\nfrequently\tis\tbased\ton\tthe\tidea\tthat\twe\trelease\tsmall\tchanges\tas\tsoon\tas\tthey\tare\tready.")]),t._v(" "),a("h2",{attrs:{id:"themetaversion"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#themetaversion"}},[t._v("#")]),t._v(" The\tMetaversion")]),t._v(" "),a("p",[t._v("With\tthe\tend-to-end\ttest\tstep,\tit\tis\teasy\tto\tstart\tthinking,\t "),a("em",[t._v("So,\tI\tknow\tall\tthese\tservices\tat\nthese\tversions\twork\ttogether,\tso\twhy\tnot\tdeploy\tthem\tall\ttogether?")]),t._v(" \tThis\tvery\tquickly\nbecomes\ta\tconversation\talong\tthe\tlines\tof,\t "),a("em",[t._v("So\twhy\tnot\tuse\ta\tversion\tnumber\tfor\tthe\twhole\nsystem")]),t._v(" ?\tTo\tquote\tBrandon\tBryars,\t“Now\tyou\thave\t2.1.0\tproblems.”")]),t._v(" "),a("p",[t._v("By\tversioning\ttogether\tchanges\tmade\tto\tmultiple\tservices,\twe\teffectively\tembrace\tthe\tidea\nthat\tchanging\tand\tdeploying\tmultiple\tservices\tat\tonce\tis\tacceptable.\tIt\tbecomes\tthe\tnorm,\nit\tbecomes\tOK.\tIn\tdoing\tso,\twe\tcede\tone\tof\tthe\tmain\tadvantages\tof\tmicroservices:\tthe\nability\tto\tdeploy\tone\tservice\tby\titself,\tindependently\tof\tother\tservices.")]),t._v(" "),a("p",[t._v("All\ttoo\toften,\tthe\tapproach\tof\taccepting\tmultiple\tservices\tbeing\tdeployed\ttogether\tdrifts\ninto\ta\tsituation\twhere\tservices\tbecome\tcoupled.\tBefore\tlong,\tnicely\tseparate\tservices\nbecome\tincreasingly\ttangled\twith\tothers,\tand\tyou\tnever\tnotice\tas\tyou\tnever\ttry\tto\tdeploy\nthem\tby\tthemselves.\tYou\tend\tup\twith\ta\ttangled\tmess\twhere\tyou\thave\tto\torchestrate\tthe\ndeployment\tof\tmultiple\tservices\tat\tonce,\tand\tas\twe\tdiscussed\tpreviously,\tthis\tsort\tof\ncoupling\tcan\tleave\tus\tin\ta\tworse\tplace\tthan\twe\twould\tbe\twith\ta\tsingle,\tmonolithic\napplication.")]),t._v(" "),a("p",[t._v("This\tis\tbad.")]),t._v(" "),a("h2",{attrs:{id:"testjourneys-notstories"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#testjourneys-notstories"}},[t._v("#")]),t._v(" Test\tJourneys,\tNot\tStories")]),t._v(" "),a("p",[t._v("Despite\tthe\tdisadvantages\tjust\toutlined,\tfor\tmany\tusers\tend-to-end\ttests\tcan\tstill\tbe\nmanageable\twith\tone\tor\ttwo\tservices,\tand\tin\tthese\tsituations\tstill\tmake\ta\tlot\tof\tsense.\tBut\nwhat\thappens\twith\t3,\t4,\t10,\tor\t20\tservices?\tVery\tquickly\tthese\ttest\tsuites\tbecome\thugely\nbloated,\tand\tin\tthe\tworst\tcase\tcan\tresult\tin\tCartesian-like\texplosion\tin\tthe\tscenarios\tunder\ntest.")]),t._v(" "),a("p",[t._v("This\tsituation\tworsens\tif\twe\tfall\tinto\tthe\ttrap\tof\tadding\ta\tnew\tend-to-end\ttest\tfor\tevery\npiece\tof\tfunctionality\twe\tadd.\tShow\tme\ta\tcodebase\twhere\tevery\tnew\tstory\tresults\tin\ta\tnew\nend-to-end\ttest,\tand\tI’ll\tshow\tyou\ta\tbloated\ttest\tsuite\tthat\thas\tpoor\tfeedback\tcycles\tand\nhuge\toverlaps\tin\ttest\tcoverage.")]),t._v(" "),a("p",[t._v("The\tbest\tway\tto\tcounter\tthis\tis\tto\tfocus\ton\ta\t "),a("em",[t._v("small")]),t._v(" \tnumber\tof\tcore\tjourneys\tto\ttest\tfor\tthe\nwhole\tsystem.\tAny\tfunctionality\tnot\tcovered\tin\tthese\tcore\tjourneys\tneeds\tto\tbe\tcovered\tin\ntests\tthat\tanalyze\tservices\tin\tisolation\tfrom\teach\tother.\tThese\tjourneys\tneed\tto\tbe\tmutually\nagreed\tupon,\tand\tjointly\towned.\tFor\tour\tmusic\tshop,\twe\tmight\tfocus\ton\tactions\tlike\nordering\ta\tCD,\treturning\ta\tproduct,\tor\tperhaps\tcreating\ta\tnew\tcustomer\t—\thigh-value\ninteractions\tand\tvery\tfew\tin\tnumber.")]),t._v(" "),a("p",[t._v("By\tfocusing\ton\ta\tsmall\tnumber\t(and\tI\tmean\t "),a("em",[t._v("small")]),t._v(" :\tvery\tlow\tdouble\tdigits\teven\tfor\ncomplex\tsystems)\tof\ttests\twe\tcan\treduce\tthe\tdownsides\tof\tintegration\ttests,\tbut\twe\tcannot\navoid\tall\tof\tthem.\tIs\tthere\ta\tbetter\tway?")]),t._v(" "),a("h2",{attrs:{id:"consumer-driventeststotherescue"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#consumer-driventeststotherescue"}},[t._v("#")]),t._v(" Consumer-Driven\tTests\tto\tthe\tRescue")]),t._v(" "),a("p",[t._v("What\tis\tone\tof\tthe\tkey\tproblems\twe\tare\ttrying\tto\taddress\twhen\twe\tuse\tthe\tintegration\ttests\noutlined\tpreviously?\tWe\tare\ttrying\tto\tensure\tthat\twhen\twe\tdeploy\ta\tnew\tservice\tto\nproduction,\tour\tchanges\twon’t\tbreak\tconsumers.\tOne\tway\twe\tcan\tdo\tthis\twithout\nrequiring\ttesting\tagainst\tthe\treal\tconsumer\tis\tby\tusing\ta\t "),a("em",[t._v("consumer-driven\tcontract\t(CDC)")]),t._v(".")]),t._v(" "),a("p",[t._v("With\tCDCs,\twe\tare\tdefining\tthe\texpectations\tof\ta\tconsumer\ton\ta\tservice\t(or\tproducer).\nThe\texpectations\tof\tthe\tconsumers\tare\tcaptured\tin\tcode\tform\tas\ttests,\twhich\tare\tthen\trun\nagainst\tthe\tproducer.\tIf\tdone\tright,\tthese\tCDCs\tshould\tbe\trun\tas\tpart\tof\tthe\tCI\tbuild\tof\tthe\nproducer,\tensuring\tthat\tit\tnever\tgets\tdeployed\tif\tit\tbreaks\tone\tof\tthese\tcontracts.\tVery\nimportantly\tfrom\ta\ttest\tfeedback\tpoint\tof\tview,\tthese\ttests\tneed\tto\tbe\trun\tonly\tagainst\ta\nsingle\tproducer\tin\tisolation,\tso\tcan\tbe\tfaster\tand\tmore\treliable\tthan\tthe\tend-to-end\ttests\nthey\tmight\treplace.")]),t._v(" "),a("p",[t._v("As\tan\texample,\tlet’s\trevisit\tour\tcustomer\tservice\tscenario.\tThe\tcustomer\tservice\thas\ttwo\nseparate\tconsumers:\tthe\thelpdesk\tand\tweb\tshop.\tBoth\tthese\tconsuming\tservices\thave\nexpectations\tfor\thow\tthe\tcustomer\tservice\twill\tbehave.\tIn\tthis\texample,\tyou\tcreate\ttwo\nsets\tof\ttests:\tone\tfor\teach\tconsumer\trepresenting\tthe\thelpdesk’s\tand\tweb\tshop’s\tuse\tof\tthe\ncustomer\tservice.\tA\tgood\tpractice\there\tis\tto\thave\tsomeone\tfrom\tthe\tproducer\tand\nconsumer\tteams\tcollaborate\ton\tcreating\tthe\ttests,\tso\tperhaps\tpeople\tfrom\tthe\tweb\tshop\nand\thelpdesk\tteams\tpair\twith\tpeople\tfrom\tthe\tcustomer\tservice\tteam.")]),t._v(" "),a("p",[t._v("Because\tthese\tCDCs\tare\texpectations\ton\thow\tthe\tcustomer\tservice\tshould\tbehave,\tthey\ncan\tbe\trun\tagainst\tthe\tcustomer\tservice\tby\titself\twith\tany\tof\tits\tdownstream\tdependencies\nstubbed\tout,\tas\tFigure\t7-9\tshows.\tFrom\ta\tscope\tpoint\tof\tview,\tthey\tsit\tat\tthe\tsame\tlevel\tin\nthe\ttest\tpyramid\tas\tservice\ttests,\talbeit\twith\ta\tvery\tdifferent\tfocus,\tas\tshown\tin\tFigure\t7-\n10 .\tThese\ttests\tare\tfocused\ton\thow\ta\tconsumer\twill\tuse\tthe\tservice,\tand\tthe\ttrigger\tif\tthey\nbreak\tis\tvery\tdifferent\twhen\tcompared\twith\tservice\ttests.\tIf\tone\tof\tthese\tCDCs\tbreaks\nduring\ta\tbuild\tof\tthe\tcustomer\tservice,\tit\tbecomes\tobvious\twhich\tconsumer\twould\tbe\nimpacted.\tAt\tthis\tpoint,\tyou\tcan\teither\tfix\tthe\tproblem\tor\telse\tstart\tthe\tdiscussion\tabout\nintroducing\ta\tbreaking\tchange\tin\tthe\tmanner\twe\tdiscussed\tin\tChapter\t4.\tSo\twith\tCDCs,\nwe\tcan\tidentify\ta\tbreaking\tchange\tprior\tto\tour\tsoftware\tgoing\tinto\tproduction\twithout\nhaving\tto\tuse\ta\tpotentially\texpensive\tend-to-end\ttest.")]),t._v(" "),a("p",[a("em",[t._v("Figure\t7-9.\tConsumer-driven\ttesting\tin\tthe\tcontext\tof\tour\tcustomer\tservice\texample")])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("Figure\t7-10.\tIntegrating\tconsumer-driven\ttests\tinto\tthe\ttest\tpyramid\n")])])]),a("h2",{attrs:{id:"pact"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#pact"}},[t._v("#")]),t._v(" Pact")]),t._v(" "),a("p",[t._v("Pact\tis\ta\tconsumer-driven\ttesting\ttool\tthat\twas\toriginally\tdeveloped\tin-house\tat\nRealEstate.com.au,\tbut\tis\tnow\topen\tsource,\twith\tBeth\tSkurrie\tdriving\tmost\tof\tthe\ndevelopment.\tOriginally\tjust\tfor\tRuby,\tPact\tnow\tincludes\tJVM\tand\t.NET\tports.")]),t._v(" "),a("p",[t._v("Pact\tworks\tin\ta\tvery\tinteresting\tway,\tas\tsummarized\tin\tFigure\t7-11.\tThe\tconsumer\tstarts\nby\tdefining\tthe\texpectations\tof\tthe\tproducer\tusing\ta\tRuby\tDSL.\tThen,\tyou\tlaunch\ta\tlocal\nmock\tserver,\tand\trun\tthis\texpectation\tagainst\tit\tto\tcreate\tthe\tPact\tspecification\tfile.\tThe\nPact\tfile\tis\tjust\ta\tformal\tJSON\tspecification;\tyou\tcould\tobviously\thandcode\tthese,\tbut\nusing\tthe\tlanguage\tAPI\tis\tmuch\teasier.\tThis\talso\tgives\tyou\ta\trunning\tmock\tserver\tthat\tcan\nbe\tused\tfor\tfurther\tisolated\ttests\tof\tthe\tconsumer.")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("Figure\t7-11.\tAn\toverview\tof\thow\tPact\tdoes\tconsumer-driven\ttesting\n")])])]),a("p",[t._v("On\tthe\tproducer\tside,\tyou\tthen\tverify\tthat\tthis\tconsumer\tspecification\tis\tmet\tby\tusing\tthe\nJSON\tPact\tspecification\tto\tdrive\tcalls\tagainst\tyour\tAPI\tand\tverify\tresponses.\tFor\tthis\tto\nwork,\tthe\tproducer\tcodebase\tneeds\taccess\tto\tthe\tPact\tfile.\tAs\twe\tdiscussed\tearlier\tin\nChapter\t6,\twe\texpect\tboth\tthe\tconsumer\tand\tproducer\tto\tbe\tin\tdifferent\tbuilds.\tThe\tuse\tof\na\tlanguage-agnostic\tJSON\tspecification\tis\tan\tespecially\tnice\ttouch.\tIt\tmeans\tthat\tyou\tcan\ngenerate\tthe\tconsumer’s\tspecification\tusing\ta\tRuby\tclient,\tbut\tuse\tit\tto\tverify\ta\tJava\nproducer\tby\tusing\tthe\tJVM\tport\tof\tPact.")]),t._v(" "),a("p",[t._v("As\tthe\tJSON\tPact\tspecification\tis\tcreated\tby\tthe\tconsumer,\tthis\tneeds\tto\tbecome\tan\nartifact\tthat\tthe\tproducer\tbuild\thas\taccess\tto.\tYou\tcould\tstore\tthis\tin\tyour\tCI/CD\ttool’s\nartifact\trepository,\tor\telse\tuse\tthe\tPact\tBroker,\twhich\tallows\tyou\tto\tstore\tmultiple\tversions\nof\tyour\tPact\tspecifications.\tThis\tcould\tlet\tyou\trun\tyour\tconsumer-driven\tcontract\ttests\nagainst\tmultiple\tdifferent\tversions\tof\tthe\tconsumers,\tif\tyou\twanted\tto\ttest\tagainst,\tsay,\tthe\nversion\tof\tthe\tconsumer\tin\tproduction\tand\tthe\tversion\tof\tthe\tconsumer\tthat\twas\tmost\nrecently\tbuilt.")]),t._v(" "),a("p",[t._v("Confusingly,\tthere\tis\ta\tThoughtWorks\topen\tsource\tproject\tcalled\tPacto,\twhich\tis\talso\ta\nRuby\ttool\tused\tfor\tconsumer-driven\ttesting.\tIt\thas\tthe\tability\tto\trecord\tinteractions")]),t._v(" "),a("p",[t._v("between\tclient\tand\tserver\tto\tgenerate\tthe\texpectations.\tThis\tmakes\twriting\tconsumer-\ndriven\tcontracts\tfor\texisting\tservices\tfairly\teasy.\tWith\tPacto,\tonce\tgenerated\tthese\nexpectations\tare\tmore\tor\tless\tstatic,\twhereas\twith\tPact\tyou\tregenerate\tthe\texpectations\tin\nthe\tconsumer\twith\tevery\tbuild.\tThe\tfact\tthat\tyou\tcan\tdefine\texpectations\tfor\tcapabilities\nthe\tproducer\tmay\tnot\teven\thave\tyet\talso\tbetter\tfits\tinto\ta\tworkflow\twhere\tthe\tproducing\nservice\tis\tstill\tbeing\t(or\thas\tyet\tto\tbe)\tdeveloped.")]),t._v(" "),a("h2",{attrs:{id:"it-saboutconversations"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#it-saboutconversations"}},[t._v("#")]),t._v(" It’s\tAbout\tConversations")]),t._v(" "),a("p",[t._v("In\tagile,\tstories\tare\toften\treferred\tto\tas\ta\tplaceholder\tfor\ta\tconversation.\tCDCs\tare\tjust\nlike\tthat.\tThey\tbecome\tthe\tcodification\tof\ta\tset\tof\tdiscussions\tabout\twhat\ta\tservice\tAPI\nshould\tlook\tlike,\tand\twhen\tthey\tbreak,\tthey\tbecome\ta\ttrigger\tpoint\tto\thave\tconversations\nabout\thow\tthat\tAPI\tshould\tevolve.")]),t._v(" "),a("p",[t._v("It\tis\timportant\tto\tunderstand\tthat\tCDCs\trequire\tgood\tcommunication\tand\ttrust\tbetween\tthe\nconsumer\tand\tproducing\tservice.\tIf\tboth\tparties\tare\tin\tthe\tsame\tteam\t(or\tthe\tsame\nperson!),\tthen\tthis\tshouldn’t\tbe\thard.\tHowever,\tif\tyou\tare\tconsuming\ta\tservice\tprovided\nwith\ta\tthird\tparty,\tyou\tmay\tnot\thave\tthe\tfrequency\tof\tcommunication,\tor\ttrust,\tto\tmake\nCDCs\twork.\tIn\tthese\tsituations,\tyou\tmay\thave\tto\tmake\tdo\twith\tlimited\tlarger-scoped\nintegration\ttests\tjust\taround\tthe\t "),a("em",[t._v("untrusted")]),t._v(" \tcomponent.\tAlternatively,\tif\tyou\tare\tcreating\tan\nAPI\tfor\tthousands\tof\tpotential\tconsumers,\tsuch\tas\twith\ta\tpublicly\tavailable\tweb\tservice\nAPI,\tyou\tmay\thave\tto\tplay\tthe\trole\tof\tthe\tconsumer\tyourself\t(or\tperhaps\twork\twith\ta\nsubset\tof\tyour\tconsumers)\tin\tdefining\tthese\ttests.\tBreaking\thuge\tnumbers\tof\texternal\nconsumers\tis\ta\tpretty\tbad\tidea,\tso\tif\tanything\tthe\timportance\tof\tCDCs\tis\tincreased!")]),t._v(" "),a("h2",{attrs:{id:"soshouldyouuseend-to-endtests"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#soshouldyouuseend-to-endtests"}},[t._v("#")]),t._v(" So\tShould\tYou\tUse\tEnd-to-End\tTests?")]),t._v(" "),a("p",[t._v("As\toutlined\tin\tdetail\tearlier\tin\tthe\tchapter,\tend-to-end\ttests\thave\ta\tlarge\tnumber\tof\ndisadvantages\tthat\tgrow\tsignificantly\tas\tyou\tadd\tmore\tmoving\tparts\tunder\ttest.\tFrom\nspeaking\tto\tpeople\twho\thave\tbeen\timplementing\tmicroservices\tat\tscale\tfor\ta\twhile\tnow,\tI\nhave\tlearned\tthat\tmost\tof\tthem\tover\ttime\tremove\tthe\tneed\tentirely\tfor\tend-to-end\ttests\tin\nfavor\tof\ttools\tlike\tCDCs\tand\timproved\tmonitoring.\tBut\tthey\tdo\tnot\tnecessarily\tthrow\nthose\ttests\taway.\tThey\tend\tup\tusing\tmany\tof\tthose\tend-to-end\tjourney\ttests\tto\tmonitor\tthe\nproduction\tsystem\tusing\ta\ttechnique\tcalled\t "),a("em",[t._v("semantic\tmonitoring")]),t._v(" ,\twhich\twe\twill\tdiscuss\nmore\tin\tChapter\t8.")]),t._v(" "),a("p",[t._v("You\tcan\tview\trunning\tend-to-end\ttests\tprior\tto\tproduction\tdeployment\tas\ttraining\twheels.\nWhile\tyou\tare\tlearning\thow\tCDCs\twork,\tand\timproving\tyour\tproduction\tmonitoring\tand\ndeployment\ttechniques,\tthese\tend-to-end\ttests\tmay\tform\ta\tuseful\tsafety\tnet,\twhere\tyou\tare\ntrading\toff\tcycle\ttime\tfor\tdecreased\trisk.\tBut\tas\tyou\timprove\tthose\tother\tareas,\tyou\tcan\nstart\tto\treduce\tyour\treliance\ton\tend-to-end\ttests\tto\tthe\tpoint\twhere\tthey\tare\tno\tlonger\nneeded.")]),t._v(" "),a("p",[t._v("Similarly,\tyou\tmay\twork\tin\tan\tenvironment\twhere\tthe\tappetite\tto\t "),a("em",[t._v("learn\tin\tproduction")]),t._v(" \tis\nlow,\tand\tpeople\twould\trather\twork\tas\thard\tas\tthey\tcan\tto\teliminate\tany\tdefects\tbefore\nproduction,\teven\tif\tthat\tmeans\tsoftware\ttakes\tlonger\tto\tship.\tAs\tlong\tas\tyou\tunderstand\nthat\tyou\tcannot\tbe\tcertain\tthat\tyou\thave\teliminated\tall\tsources\tof\tdefects,\tand\tthat\tyou\twill\nstill\tneed\tto\thave\teffective\tmonitoring\tand\tremediation\tin\tplace\tin\tproduction,\tthis\tmay\tbe\na\tsensible\tdecision.")]),t._v(" "),a("p",[t._v("Obviously\tyou’ll\thave\ta\tbetter\tunderstanding\tof\tyour\town\torganization’s\trisk\tprofile\tthan\nme,\tbut\tI\twould\tchallenge\tyou\tto\tthink\tlong\tand\thard\tabout\thow\tmuch\tend-to-end\ttesting\nyou\treally\tneed\tto\tdo.")]),t._v(" "),a("h2",{attrs:{id:"testingafterproduction"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#testingafterproduction"}},[t._v("#")]),t._v(" Testing\tAfter\tProduction")]),t._v(" "),a("p",[t._v("Most\ttesting\tis\tdone\tbefore\tthe\tsystem\tis\tin\tproduction.\tWith\tour\ttests,\twe\tare\tdefining\ta\nseries\tof\tmodels\twith\twhich\twe\thope\tto\tprove\twhether\tour\tsystem\tworks\tand\tbehaves\tas\nwe\twould\tlike,\tboth\tfunctionally\tand\tnonfunctionally.\tBut\tif\tour\tmodels\tare\tnot\tperfect,\nthen\twe\twill\tencounter\tproblems\twhen\tour\tsystems\tare\tused\tin\tanger.\tBugs\tslip\tinto\nproduction,\tnew\tfailure\tmodes\tare\tdiscovered,\tand\tour\tusers\tuse\tthe\tsystem\tin\tways\twe\ncould\tnever\texpect.")]),t._v(" "),a("p",[t._v("One\treaction\tto\tthis\tis\toften\tto\tdefine\tmore\tand\tmore\ttests,\tand\trefine\tour\tmodels,\tto\tcatch\nmore\tissues\tearly\tand\treduce\tthe\tnumber\tof\tproblems\twe\tencounter\twith\tour\trunning\nproduction\tsystem.\tHowever,\tat\ta\tcertain\tpoint\twe\thave\tto\taccept\tthat\twe\thit\tdiminishing\nreturns\twith\tthis\tapproach.\tWith\ttesting\tprior\tto\tdeployment,\twe\tcannot\treduce\tthe\tchance\nof\tfailure\tto\tzero.")]),t._v(" "),a("h2",{attrs:{id:"separatingdeploymentfromrelease"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#separatingdeploymentfromrelease"}},[t._v("#")]),t._v(" Separating\tDeployment\tfrom\tRelease")]),t._v(" "),a("p",[t._v("One\tway\tin\twhich\twe\tcan\tcatch\tmore\tproblems\tbefore\tthey\toccur\tis\tto\textend\twhere\twe\nrun\tour\ttests\tbeyond\tthe\ttraditional\tpredeployment\tsteps.\tInstead,\tif\twe\tcan\tdeploy\tour\nsoftware,\tand\ttest\tit\tin\tsitu\tprior\tto\tdirecting\tproduction\tloads\tagainst\tit,\twe\tcan\tdetect\nissues\tspecific\tto\ta\tgiven\tenvironment.\tA\tcommon\texample\tof\tthis\tis\tthe\t "),a("em",[t._v("smoke\ttest\tsuite")]),t._v(" ,\na\tcollection\tof\ttests\tdesigned\tto\tbe\trun\tagainst\tnewly\tdeployed\tsoftware\tto\tconfirm\tthat\nthe\tdeployment\tworked.\tThese\ttests\thelp\tyou\tpick\tup\tany\tlocal\tenvironmental\tissues.\tIf\nyou’re\tusing\ta\tsingle\tcommand-line\tcommand\tto\tdeploy\tany\tgiven\tmicroservice\t(and\tyou\nshould),\tthis\tcommand\tshould\trun\tthe\tsmoke\ttests\tautomatically.")]),t._v(" "),a("p",[t._v("Another\texample\tof\tthis\tis\twhat\tis\tcalled\t "),a("em",[t._v("blue/green\tdeployment")]),t._v(" .\tWith\tblue/green,\twe\nhave\ttwo\tcopies\tof\tour\tsoftware\tdeployed\tat\ta\ttime,\tbut\tonly\tone\tversion\tof\tit\tis\treceiving\nreal\trequests.")]),t._v(" "),a("p",[t._v("Let’s\tconsider\ta\tsimple\texample,\tseen\tin\tFigure\t7-12.\tIn\tproduction,\twe\thave\tv123\tof\tthe\ncustomer\tservice\tlive.\tWe\twant\tto\tdeploy\ta\tnew\tversion,\tv456.\tWe\tdeploy\tthis\talongside\nv123,\tbut\tdo\tnot\tdirect\tany\ttraffic\tto\tit.\tInstead,\twe\tperform\tsome\ttesting\tin\tsitu\tagainst\tthe\nnewly\tdeployed\tversion.\tOnce\tthe\ttests\thave\tworked,\twe\tdirect\tthe\tproduction\tload\tto\tthe\nnew\tv456\tversion\tof\tthe\tcustomer\tservice.\tIt\tis\tcommon\tto\tkeep\tthe\told\tversion\taround\tfor\na\tshort\tperiod\tof\ttime,\tallowing\tfor\ta\tfast\tfallback\tif\tyou\tdetect\tany\terrors.")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("Figure\t7-12.\tUsing\tblue/green\tdeployments\tto\tseparate\tdeployment\tfrom\trelease\n")])])]),a("p",[t._v("Implementing\tblue/green\tdeployment\trequires\ta\tfew\tthings.\tFirst,\tyou\tneed\tto\tbe\table\tto\ndirect\tproduction\ttraffic\tto\tdifferent\thosts\t(or\tcollections\tof\thosts).\tYou\tcould\tdo\tthis\tby\nchanging\tDNS\tentries,\tor\tupdating\tload-balancing\tconfiguration.\tYou\talso\tneed\tto\tbe\table\nto\tprovision\tenough\thosts\tto\thave\tboth\tversions\tof\tthe\tmicroservice\trunning\tat\tonce.\tIf\nyou’re\tusing\tan\telastic\tcloud\tprovider,\tthis\tcould\tbe\tstraightforward.\tUsing\tblue/green\ndeployments\tallows\tyou\tto\treduce\tthe\trisk\tof\tdeployment,\tas\twell\tas\tgives\tyou\tthe\tchance\nto\trevert\tshould\tyou\tencounter\ta\tproblem.\tIf\tyou\tget\tgood\tat\tthis,\tthe\tentire\tprocess\tcan\tbe\ncompletely\tautomated,\twith\teither\tthe\tfull\troll-out\tor\trevert\thappening\twithout\tany\thuman\nintervention.")]),t._v(" "),a("p",[t._v("Quite\taside\tfrom\tthe\tbenefit\tof\tallowing\tus\tto\ttest\tour\tservices\tin\tsitu\tprior\tto\tsending\nthem\tproduction\ttraffic,\tby\tkeeping\tthe\told\tversion\trunning\twhile\twe\tperform\tour\trelease")]),t._v(" "),a("p",[t._v("we\tgreatly\treduce\tthe\tdowntime\tassociated\twith\treleasing\tour\tsoftware.\tDepending\ton\nwhat\tmechanism\tis\tused\tto\timplement\tthe\ttraffic\tredirection,\tthe\tswitchover\tbetween\nversions\tcan\tbe\tcompletely\tinvisible\tto\tthe\tcustomer,\tgiving\tus\tzero-downtime\ndeployments.")]),t._v(" "),a("p",[t._v("There\tis\tanother\ttechnique\tworth\tdiscussing\tbriefly\there\ttoo,\twhich\tis\tsometimes\tconfused\nwith\tblue/green\tdeployments,\tas\tit\tcan\tuse\tsome\tof\tthe\tsame\ttechnical\timplementations.\tIt\nis\tknown\tas\t "),a("em",[t._v("canary\treleasing")]),t._v(".")]),t._v(" "),a("h2",{attrs:{id:"canaryreleasing"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#canaryreleasing"}},[t._v("#")]),t._v(" Canary\tReleasing")]),t._v(" "),a("p",[t._v("With\tcanary\treleasing,\twe\tare\tverifying\tour\tnewly\tdeployed\tsoftware\tby\tdirecting\namounts\tof\tproduction\ttraffic\tagainst\tthe\tsystem\tto\tsee\tif\tit\tperforms\tas\texpected.\n“Performing\tas\texpected”\tcan\tcover\ta\tnumber\tof\tthings,\tboth\tfunctional\tand\nnonfunctional.\tFor\texample,\twe\tcould\tcheck\tthat\ta\tnewly\tdeployed\tservice\tis\tresponding\nto\trequests\twithin\t500ms,\tor\tthat\twe\tsee\tthe\tsame\tproportional\terror\trates\tfrom\tthe\tnew\nand\tthe\told\tservice.\tBut\tyou\tcould\tgo\tdeeper\tthan\tthat.\tImagine\twe’ve\treleased\ta\tnew\nversion\tof\tthe\trecommendation\tservice.\tWe\tmight\trun\tboth\tof\tthem\tside\tby\tside\tbut\tsee\tif\nthe\trecommendations\tgenerated\tby\tthe\tnew\tversion\tof\tthe\tservice\tresult\tin\tas\tmany\nexpected\tsales,\tmaking\tsure\tthat\twe\thaven’t\treleased\ta\tsuboptimal\talgorithm.")]),t._v(" "),a("p",[t._v("If\tthe\tnew\trelease\tis\tbad,\tyou\tget\tto\trevert\tquickly.\tIf\tit\tis\tgood,\tyou\tcan\tpush\tincreasing\namounts\tof\ttraffic\tthrough\tthe\tnew\tversion.\tCanary\treleasing\tdiffers\tfrom\tblue/green\tin\nthat\tyou\tcan\texpect\tversions\tto\tcoexist\tfor\tlonger,\tand\tyou’ll\toften\tvary\tthe\tamounts\tof\ntraffic.")]),t._v(" "),a("p",[t._v("Netflix\tuses\tthis\tapproach\textensively.\tPrior\tto\trelease,\tnew\tservice\tversions\tare\tdeployed\nalongside\ta\tbaseline\tcluster\tthat\trepresents\tthe\tsame\tversion\tas\tproduction.\tNetflix\tthen\nruns\ta\tsubset\tof\tthe\tproduction\tload\tover\ta\tnumber\tof\thours\tagainst\tboth\tthe\tnew\tversion\nand\tthe\tbaseline,\tscoring\tboth.\tIf\tthe\tcanary\tpasses,\tthe\tcompany\tthen\tproceeds\tto\ta\tfull\nroll-out\tinto\tproduction.")]),t._v(" "),a("p",[t._v("When\tconsidering\tcanary\treleasing,\tyou\tneed\tto\tdecide\tif\tyou\tare\tgoing\tto\tdivert\ta\tportion\nof\tproduction\trequests\tto\tthe\tcanary\tor\tjust\tcopy\tproduction\tload.\tSome\tteams\tare\table\tto\nshadow\tproduction\ttraffic\tand\tdirect\tit\tto\ttheir\tcanary.\tIn\tthis\tway,\tthe\texisting\tproduction\nand\tcanary\tversions\tcan\tsee\texactly\tthe\tsame\trequests,\tbut\tonly\tthe\tresults\tof\tthe\nproduction\trequests\tare\tseen\texternally.\tThis\tallows\tyou\tto\tdo\ta\tside-by-side\tcomparison\nwhile\teliminating\tthe\tchance\tthat\ta\tfailure\tin\tthe\tcanary\tcan\tbe\tseen\tby\ta\tcustomer\trequest.\nThe\twork\tto\tshadow\tproduction\ttraffic\tcan\tbe\tcomplex,\tthough,\tespecially\tif\tthe\nevents/requests\tbeing\treplayed\taren’t\tidempotent.")]),t._v(" "),a("p",[t._v("Canary\treleasing\tis\ta\tpowerful\ttechnique,\tand\tcan\thelp\tyou\tverify\tnew\tversions\tof\tyour\nsoftware\twith\treal\ttraffic,\twhile\tgiving\tyou\ttools\tto\tmanage\tthe\trisk\tof\tpushing\tout\ta\tbad\nrelease.\tIt\tdoes\trequire\ta\tmore\tcomplex\tsetup,\thowever,\tthan\tblue/green\tdeployment,\tand\ta\nbit\tmore\tthought.\tYou\tcould\texpect\tto\tcoexist\tdifferent\tversions\tof\tyour\tservices\tfor\tlonger\nthan\twith\tblue/green,\tso\tyou\tmay\tbe\ttying\tup\tmore\thardware\tfor\tlonger\tthan\tbefore.\tYou’ll\nalso\tneed\tmore\tsophisticated\ttraffic\trouting,\tas\tyou\tmay\twant\tto\tramp\tup\tor\tdown\tthe\npercentages\tof\tthe\ttraffic\tto\tget\tmore\tconfidence\tthat\tyour\trelease\tworks.\tIf\tyou\talready\nhandle\tblue/green\tdeployments,\tyou\tmay\thave\tsome\tof\tthe\tbuilding\tblocks\talready.")]),t._v(" "),a("h2",{attrs:{id:"meantimetorepairovermeantimebetweenfailures"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#meantimetorepairovermeantimebetweenfailures"}},[t._v("#")]),t._v(" Mean\tTime\tto\tRepair\tOver\tMean\tTime\tBetween\tFailures?")]),t._v(" "),a("p",[t._v("So\tby\tlooking\tat\ttechniques\tlike\tblue/green\tdeployment\tor\tcanary\treleasing,\twe\tfind\ta\tway\nto\ttest\tcloser\tto\t(or\teven\tin)\tproduction,\tand\twe\talso\tbuild\ttools\tto\thelp\tus\tmanage\ta\tfailure\nif\tit\toccurs.\tUsing\tthese\tapproaches\tis\ta\ttacit\tacknowledgment\tthat\twe\tcannot\tspot\tand\ncatch\tall\tproblems\tbefore\twe\tactually\trelease\tour\tsoftware.")]),t._v(" "),a("p",[t._v("Sometimes\texpending\tthe\tsame\teffort\tinto\tgetting\tbetter\tat\tremediation\tof\ta\trelease\tcan\tbe\nsignificantly\tmore\tbeneficial\tthan\tadding\tmore\tautomated\tfunctional\ttests.\tIn\tthe\tweb\noperations\tworld,\tthis\tis\toften\treferred\tto\tas\tthe\ttrade-off\tbetween\toptimizing\tfor\t "),a("em",[t._v("mean\ntime\tbetween\tfailures\t(MTBF)")]),t._v(" \tand\t "),a("em",[t._v("mean\ttime\tto\trepair\t(MTTR)")]),t._v(".")]),t._v(" "),a("p",[t._v("Techniques\tto\treduce\tthe\ttime\tto\trecovery\tcan\tbe\tas\tsimple\tas\tvery\tfast\trollbacks\tcoupled\nwith\tgood\tmonitoring\t(which\twe’ll\tdiscuss\tin\tChapter\t8),\tlike\tblue/green\tdeployments.\tIf\nwe\tcan\tspot\ta\tproblem\tin\tproduction\tearly,\tand\troll\tback\tearly,\twe\treduce\tthe\timpact\tto\tour\ncustomers.\tWe\tcan\talso\tuse\ttechniques\tlike\tblue/green\tdeployment,\twhere\twe\tdeploy\ta\nnew\tversion\tof\tour\tsoftware\tand\ttest\tit\tin\tsitu\tprior\tto\tdirecting\tour\tusers\tto\tthe\tnew\nversion.")]),t._v(" "),a("p",[t._v("For\tdifferent\torganizations,\tthis\ttrade-off\tbetween\tMTBF\tand\tMTTR\twill\tvary,\tand\tmuch\nof\tthis\tlies\twith\tunderstanding\tthe\ttrue\timpact\tof\tfailure\tin\ta\tproduction\tenvironment.\nHowever,\tmost\torganizations\tthat\tI\tsee\tspending\ttime\tcreating\tfunctional\ttest\tsuites\toften\nexpend\tlittle\tto\tno\teffort\tat\tall\ton\tbetter\tmonitoring\tor\trecovering\tfrom\tfailure.\tSo\twhile\nthey\tmay\treduce\tthe\tnumber\tof\tdefects\tthat\toccur\tin\tthe\tfirst\tplace,\tthey\tcan’t\teliminate\tall\nof\tthem,\tand\tare\tunprepared\tfor\tdealing\twith\tthem\tif\tthey\tpop\tup\tin\tproduction.")]),t._v(" "),a("p",[t._v("Trade-offs\tother\tthan\tMTBF\tand\tMTTR\texist.\tFor\texample,\tif\tyou\tare\ttrying\tto\twork\tout\nif\tanyone\twill\tactually\tuse\tyour\tsoftware,\tit\tmay\tmake\tmuch\tmore\tsense\tto\tget\tsomething\nout\tnow,\tto\tprove\tthe\tidea\tor\tthe\tbusiness\tmodel\tbefore\tbuilding\trobust\tsoftware.\tIn\tan\nenvironment\twhere\tthis\tis\tthe\tcase,\ttesting\tmay\tbe\toverkill,\tas\tthe\timpact\tof\tnot\tknowing\nif\tyour\tidea\tworks\tis\tmuch\thigher\tthan\thaving\ta\tdefect\tin\tproduction.\tIn\tthese\tsituations,\tit\ncan\tbe\tquite\tsensible\tto\tavoid\ttesting\tprior\tto\tproduction\taltogether.")]),t._v(" "),a("h2",{attrs:{id:"cross-functionaltesting"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#cross-functionaltesting"}},[t._v("#")]),t._v(" Cross-Functional\tTesting")]),t._v(" "),a("p",[t._v("The\tbulk\tof\tthis\tchapter\thas\tbeen\tfocused\ton\ttesting\tspecific\tpieces\tof\tfunctionality,\tand\nhow\tthis\tdiffers\twhen\tyou\tare\ttesting\ta\tmicroservice-based\tsystem.\tHowever,\tthere\tis\nanother\tcategory\tof\ttesting\tthat\tis\timportant\tto\tdiscuss.\t "),a("em",[t._v("Nonfunctional\trequirements")]),t._v(" \tis\tan\numbrella\tterm\tused\tto\tdescribe\tthose\tcharacteristics\tyour\tsystem\texhibits\tthat\tcannot\nsimply\tbe\timplemented\tlike\ta\tnormal\tfeature.\tThey\tinclude\taspects\tlike\tthe\tacceptable\nlatency\tof\ta\tweb\tpage,\tthe\tnumber\tof\tusers\ta\tsystem\tshould\tsupport,\thow\taccessible\tyour\nuser\tinterface\tshould\tbe\tto\tpeople\twith\tdisabilities,\tor\thow\tsecure\tyour\tcustomer\tdata\nshould\tbe.")]),t._v(" "),a("p",[t._v("The\tterm\t "),a("em",[t._v("nonfunctional")]),t._v(" \tnever\tsat\twell\twith\tme.\tSome\tof\tthe\tthings\tthat\tget\tcovered\tby\tthis\nterm\tseem\tvery\tfunctional\tin\tnature!\tOne\tof\tmy\tcolleagues,\tSarah\tTaraporewalla,\tcoined\nthe\tphrase\t "),a("em",[t._v("cross-functional\trequirements\t(CFR)")]),t._v(" \tinstead,\twhich\tI\tgreatly\tprefer.\tIt\tspeaks\nmore\tto\tthe\tfact\tthat\tthese\tsystem\tbehaviors\treally\tonly\temerge\tas\tthe\tresult\tof\tlots\tof\ncross-cutting\twork.")]),t._v(" "),a("p",[t._v("Many,\tif\tnot\tmost,\tCFRs\tcan\treally\tonly\tbe\tmet\tin\tproduction.\tThat\tsaid,\twe\tcan\tdefine\ntest\tstrategies\tto\thelp\tus\tsee\tif\twe\tare\tat\tleast\tmoving\ttoward\tmeeting\tthese\tgoals.\tThese\nsorts\tof\ttests\tfall\tinto\tthe\t "),a("em",[t._v("Property\tTesting")]),t._v(" \tquadrant.\tA\tgreat\texample\tof\tthis\tis\tthe\nperformance\ttest,\twhich\twe’ll\tdiscuss\tin\tmore\tdepth\tshortly.")]),t._v(" "),a("p",[t._v("For\tsome\tCFRs,\tyou\tmay\twant\tto\ttrack\tthem\tat\tan\tindividual\tservice\tlevel.\tFor\texample,\nyou\tmay\tdecide\tthat\tthe\tdurability\tof\tservice\tyou\trequire\tfrom\tyour\tpayment\tservice\tis\nsignificantly\thigher,\tbut\tyou\tare\thappy\twith\tmore\tdowntime\tfor\tyour\tmusic\nrecommendation\tservice,\tknowing\tthat\tyour\tcore\tbusiness\tcan\tsurvive\tif\tyou\tare\tunable\tto\nrecommend\tartists\tsimilar\tto\tMetallica\tfor\t10\tminutes\tor\tso.\tThese\ttrade-offs\twill\tend\tup\nhaving\ta\tlarge\timpact\ton\thow\tyou\tdesign\tand\tevolve\tyour\tsystem,\tand\tonce\tagain\tthe\tfine-\ngrained\tnature\tof\ta\tmicroservice-based\tsystem\tgives\tyou\tmany\tmore\tchances\tto\tmake\nthese\ttrade-offs.")]),t._v(" "),a("p",[t._v("Tests\taround\tCFRs\tshould\tfollow\tthe\tpyramid\ttoo.\tSome\ttests\twill\thave\tto\tbe\tend-to-end,\nlike\tload\ttests,\tbut\tothers\twon’t.\tFor\texample,\tonce\tyou’ve\tfound\ta\tperformance\nbottleneck\tin\tan\tend-to-end\tload\ttest,\twrite\ta\tsmaller-scoped\ttest\tto\thelp\tyou\tcatch\tthe\nproblem\tin\tthe\tfuture.\tOther\tCFRs\tfit\tfaster\ttests\tquite\teasily.\tI\tremember\tworking\ton\ta\nproject\twhere\twe\thad\tinsisted\ton\tensuring\tour\tHTML\tmarkup\twas\tusing\tproper\naccessibility\tfeatures\tto\thelp\tpeople\twith\tdisabilities\tuse\tour\twebsite.\tChecking\tthe\ngenerated\tmarkup\tto\tmake\tsure\tthat\tthe\tappropriate\tcontrols\twere\tthere\tcould\tbe\tdone\nvery\tquickly\twithout\tthe\tneed\tfor\tany\tnetworking\troundtrips.")]),t._v(" "),a("p",[t._v("All\ttoo\toften,\tconsiderations\tabout\tCFRs\tcome\tfar\ttoo\tlate.\tI\tstrongly\tsuggest\tlooking\tat\nyour\tCFRs\tas\tearly\tas\tpossible,\tand\treviewing\tthem\tregularly.")]),t._v(" "),a("h2",{attrs:{id:"performancetests"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#performancetests"}},[t._v("#")]),t._v(" Performance\tTests")]),t._v(" "),a("p",[t._v("Performance\ttests\tare\tworth\tcalling\tout\texplicitly\tas\ta\tway\tof\tensuring\tthat\tsome\tof\tour\ncross-functional\trequirements\tcan\tbe\tmet.\tWhen\tdecomposing\tsystems\tinto\tsmaller\nmicroservices,\twe\tincrease\tthe\tnumber\tof\tcalls\tthat\twill\tbe\tmade\tacross\tnetwork\nboundaries.\tWhere\tpreviously\tan\toperation\tmight\thave\tinvolved\tone\tdatabase\tcall,\tit\tmay\nnow\tinvolve\tthree\tor\tfour\tcalls\tacross\tnetwork\tboundaries\tto\tother\tservices,\twith\ta\nmatching\tnumber\tof\tdatabase\tcalls.\tAll\tof\tthis\tcan\tdecrease\tthe\tspeed\tat\twhich\tour\nsystems\toperate.\tTracking\tdown\tsources\tof\tlatency\tis\tespecially\timportant.\tWhen\tyou\nhave\ta\tcall\tchain\tof\tmultiple\tsynchronous\tcalls,\tif\tany\tpart\tof\tthe\tchain\tstarts\tacting\nslowly,\teverything\tis\taffected,\tpotentially\tleading\tto\ta\tsignificant\timpact.\tThis\tmakes\nhaving\tsome\tway\tto\tperformance\ttest\tyour\tapplications\teven\tmore\timportant\tthan\tit\tmight\nbe\twith\ta\tmore\tmonolithic\tsystem.\tOften\tthe\treason\tthis\tsort\tof\ttesting\tgets\tdelayed\tis\nbecause\tinitially\tthere\tisn’t\tenough\tof\tthe\tsystem\tthere\tto\ttest.\tI\tunderstand\tthis\tproblem,\nbut\tall\ttoo\toften\tit\tleads\tto\tkicking\tthe\tcan\tdown\tthe\troad,\twith\tperformance\ttesting\toften\nonly\tbeing\tdone\tjust\tbefore\tyou\tgo\tlive\tfor\tthe\tfirst\ttime,\tif\tat\tall!\tDon’t\tfall\tinto\tthis\ttrap.")]),t._v(" "),a("p",[t._v("As\twith\tfunctional\ttests,\tyou\tmay\twant\ta\tmix.\tYou\tmay\tdecide\tthat\tyou\twant\tperformance\ntests\tthat\tisolate\tindividual\tservices,\tbut\tstart\twith\ttests\tthat\tcheck\tcore\tjourneys\tin\tyour\nsystem.\tYou\tmay\tbe\table\tto\ttake\tend-to-end\tjourney\ttests\tand\tsimply\trun\tthese\tat\tvolume.")]),t._v(" "),a("p",[t._v("To\tgenerate\tworthwhile\tresults,\tyou’ll\toften\tneed\tto\trun\tgiven\tscenarios\twith\tgradually\nincreasing\tnumbers\tof\tsimulated\tcustomers.\tThis\tallows\tyou\tto\tsee\thow\tlatency\tof\tcalls\nvaries\twith\tincreasing\tload.\tThis\tmeans\tthat\tperformance\ttests\tcan\ttake\ta\twhile\tto\trun.\tIn\naddition,\tyou’ll\twant\tthe\tsystem\tto\tmatch\tproduction\tas\tclosely\tas\tpossible,\tto\tensure\tthat\nthe\tresults\tyou\tsee\twill\tbe\tindicative\tof\tthe\tperformance\tyou\tcan\texpect\ton\tthe\tproduction\nsystems.\tThis\tcan\tmean\tthat\tyou’ll\tneed\tto\tacquire\ta\tmore\tproduction-like\tvolume\tof\tdata,\nand\tmay\tneed\tmore\tmachines\tto\tmatch\tthe\tinfrastructure\t—\ttasks\tthat\tcan\tbe\tchallenging.\nEven\tif\tyou\tstruggle\tto\tmake\tthe\tperformance\tenvironment\ttruly\tproduction-like,\tthe\ttests\nmay\tstill\thave\tvalue\tin\ttracking\tdown\tbottlenecks.\tJust\tbe\taware\tthat\tyou\tmay\tget\tfalse\nnegatives,\tor\teven\tworse,\tfalse\tpositives.")]),t._v(" "),a("p",[t._v("Due\tto\tthe\ttime\tit\ttakes\tto\trun\tperformance\ttests,\tit\tisn’t\talways\tfeasible\tto\trun\tthem\ton\nevery\tcheck-in.\tIt\tis\ta\tcommon\tpractice\tto\trun\ta\tsubset\tevery\tday,\tand\ta\tlarger\tset\tevery\nweek.\tWhatever\tapproach\tyou\tpick,\tmake\tsure\tyou\trun\tthem\tas\tregularly\tas\tyou\tcan.\tThe\nlonger\tyou\tgo\twithout\trunning\tperformance\ttests,\tthe\tharder\tit\tcan\tbe\tto\ttrack\tdown\tthe\nculprit.\tPerformance\tproblems\tare\tespecially\tdifficult\tto\tresolve,\tso\tif\tyou\tcan\treduce\tthe\nnumber\tof\tcommits\tyou\tneed\tto\tlook\tat\tin\torder\tto\tsee\ta\tnewly\tintroduced\tproblem,\tyour\nlife\twill\tbe\tmuch\teasier.")]),t._v(" "),a("p",[t._v("And\tmake\tsure\tyou\talso\tlook\tat\tthe\tresults!\tI’ve\tbeen\tvery\tsurprised\tby\tthe\tnumber\tof\nteams\tI\thave\tencountered\twho\thave\tspent\ta\tlot\tof\twork\timplementing\ttests\tand\trunning\nthem,\tand\tnever\tcheck\tthe\tnumbers.\tOften\tthis\tis\tbecause\tpeople\tdon’t\tknow\twhat\ta\t "),a("em",[t._v("good")]),t._v("\nresult\tlooks\tlike.\tYou\treally\tneed\tto\thave\ttargets.\tThis\tway,\tyou\tcan\tmake\tthe\tbuild\tgo\t "),a("em",[t._v("red")])]),t._v(" "),a("p",[t._v("or\t "),a("em",[t._v("green")]),t._v(" \tbased\ton\tthe\tresults,\twith\ta\tred\t(failing)\tbuild\tbeing\ta\tclear\tcall\tto\taction.")]),t._v(" "),a("p",[t._v("Performance\ttesing\tneeds\tto\tbe\tdone\tin\tconcert\twith\tmonitoring\tthe\treal\tsystem\nperformance\t(which\twe’ll\tdiscuss\tmore\tin\tChapter\t8),\tand\tideally\tshould\tuse\tthe\tsame\ntools\tin\tyour\tperformance\ttest\tenvironment\tfor\tvisualizing\tsystem\tbehavior\tas\tthose\tyou\nuse\tin\tproduction.\tThis\tcan\tmake\tit\tmuch\teasier\tto\tcompare\tlike\twith\tlike.")]),t._v(" "),a("h2",{attrs:{id:"summary-7"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#summary-7"}},[t._v("#")]),t._v(" Summary")]),t._v(" "),a("p",[t._v("Bringing\tthis\tall\ttogether,\twhat\tI\thave\toutlined\there\tis\ta\tholistic\tapproach\tto\ttesting\tthat\nhopefully\tgives\tyou\tsome\tgeneral\tguidance\ton\thow\tto\tproceed\twhen\ttesting\tyour\town\nsystems.\tTo\treiterate\tthe\tbasics:")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("Optimize\tfor\tfast\tfeedback,\tand\tseparate\ttypes\tof\ttests\taccordingly.\n")])])]),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("Avoid\tthe\tneed\tfor\tend-to-end\ttests\twherever\tpossible\tby\tusing\tconsumer-driven\ncontracts.\n")])])]),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("Use\tconsumer-driven\tcontracts\tto\tprovide\tfocus\tpoints\tfor\tconversations\tbetween\nteams.\n")])])]),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("Try\tto\tunderstand\tthe\ttrade-off\tbetween\tputting\tmore\tefforts\tinto\ttesting\tand\ndetecting\tissues\tfaster\tin\tproduction\t(optimizing\tfor\tMTBF\tversus\tMTTR).\n")])])]),a("p",[t._v("If\tyou\tare\tinterested\tin\treading\tmore\tabout\ttesting,\tI\trecommend\t "),a("em",[t._v("Agile\tTesting")]),t._v(" \tby\tLisa\nCrispin\tand\tJanet\tGregory\t(Addison-Wesley),\twhich\tamong\tother\tthings\tcovers\tthe\tuse\tof\nthe\ttesting\tquadrant\tin\tmore\tdetail.")]),t._v(" "),a("p",[t._v("This\tchapter\tfocused\tmostly\ton\tmaking\tsure\tour\tcode\tworks\tbefore\tit\thits\tproduction,\tbut\nwe\talso\tneed\tto\tknow\thow\tto\tmake\tsure\tour\tcode\tworks\tonce\tit’s\tdeployed.\tIn\tthe\tnext\nchapter,\twe’ll\ttake\ta\tlook\tat\thow\tto\tmonitor\tour\tmicroservice-based\tsystems.")]),t._v(" "),a("p",[t._v("(^2) \tDiane\tVaughan,\t "),a("em",[t._v("The\tChallenger\tLaunch\tDecision:\tRisky\tTechnology,\tCulture,\tand\nDeviance\tat\tNASA")]),t._v(" \t(Chicago:\tUniversity\tof\tChicago\tPress,\t1996).")]),t._v(" "),a("h1",{attrs:{id:"chapter8-monitoring"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#chapter8-monitoring"}},[t._v("#")]),t._v(" Chapter\t8.\tMonitoring")]),t._v(" "),a("p",[t._v("As\tI’ve\thopefully\tshown\tso\tfar,\tbreaking\tour\tsystem\tup\tinto\tsmaller,\tfine-grained\nmicroservices\tresults\tin\tmultiple\tbenefits.\tIt\talso,\thowever,\tadds\tcomplexity\twhen\tit\ncomes\tto\tmonitoring\tthe\tsystem\tin\tproduction.\tIn\tthis\tchapter,\twe’ll\tlook\tat\tthe\tchallenges\nassociated\twith\tmonitoring\tand\tidentifying\tproblems\tin\tour\tfine-grained\tsystems,\tand\tI’ll\noutline\tsome\tof\tthe\tthings\tyou\tcan\tdo\tto\thave\tyour\tcake\tand\teat\tit\ttoo!")]),t._v(" "),a("p",[t._v("Picture\tthe\tscene.\tIt’s\ta\tquiet\tFriday\tafternoon,\tand\tthe\tteam\tis\tlooking\tforward\tto\tsloping\noff\tearly\tto\tthe\tpub\tas\ta\tway\tto\tstart\ta\tweekend\taway\tfrom\twork.\tThen\tsuddenly\tthe\nemails\tarrive.\tThe\twebsite\tis\tmisbehaving!\tTwitter\tis\tablaze\twith\tyour\tcompany’s\tfailings,\nyour\tboss\tis\tchewing\tyour\tear\toff,\tand\tthe\tprospects\tof\ta\tquiet\tweekend\tvanish.")]),t._v(" "),a("p",[t._v("What’s\tthe\tfirst\tthing\tyou\tneed\tto\tknow?\tWhat\tthe\thell\thas\tgone\twrong?")]),t._v(" "),a("p",[t._v("In\tthe\tworld\tof\tthe\tmonolithic\tapplication,\twe\tat\tleast\thave\ta\tvery\tobvious\tplace\tto\tstart\nour\tinvestigations.\tWebsite\tslow?\tIt’s\tthe\tmonolith.\tWebsite\tgiving\todd\terrors?\tIt’s\tthe\nmonolith.\tCPU\tat\t100%?\tMonolith.\tSmell\tof\tburning?\tWell,\tyou\tget\tthe\tidea.\tHaving\ta\nsingle\tpoint\tof\tfailure\talso\tmakes\tfailure\tinvestigation\tsomewhat\tsimpler!")]),t._v(" "),a("p",[t._v("Now\tlet’s\tthink\tabout\tour\town,\tmicroservice-based\tsystem.\tThe\tcapabilities\twe\toffer\tour\nusers\tare\tserved\tfrom\tmultiple\tsmall\tservices,\tsome\tof\twhich\tcommunicate\twith\tyet\tmore\nservices\tto\taccomplish\ttheir\ttasks.\tThere\tare\tlots\tof\tadvantages\tto\tsuch\tan\tapproach\n(which\tis\tgood,\tas\totherwise\tthis\tbook\twould\tbe\ta\twaste\tof\ttime),\tbut\tin\tthe\tworld\tof\nmonitoring,\twe\thave\ta\tmore\tcomplex\tproblem\ton\tour\thands.")]),t._v(" "),a("p",[t._v("We\tnow\thave\tmultiple\tservers\tto\tmonitor,\tmultiple\tlogfiles\tto\tsift\tthrough,\tand\tmultiple\nplaces\twhere\tnetwork\tlatency\tcould\tcause\tproblems.\tSo\thow\tdo\twe\tapproach\tthis?\tWe\nneed\tto\tmake\tsense\tof\twhat\totherwise\tmight\tbe\ta\tchaotic,\ttangled\tmess\t—\tthe\tlast\tthing\nany\tof\tus\twants\tto\tdeal\twith\ton\ta\tFriday\tafternoon\t(or\tat\tany\ttime,\tcome\tto\tthat!).")]),t._v(" "),a("p",[t._v("The\tanswer\there\tis\tpretty\tstraightforward:\tmonitor\tthe\tsmall\tthings,\tand\tuse\taggregation\tto\nsee\tthe\tbigger\tpicture.\tTo\tsee\thow,\twe’ll\tstart\twith\tthe\tsimplest\tsystem\twe\tcan:\ta\tsingle\nnode.")]),t._v(" "),a("h2",{attrs:{id:"singleservice-singleserver"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#singleservice-singleserver"}},[t._v("#")]),t._v(" Single\tService,\tSingle\tServer")]),t._v(" "),a("p",[t._v("Figure\t8-1\tpresents\ta\tvery\tsimple\tsetup:\tone\thost,\trunning\tone\tservice.\tNow\twe\tneed\tto\nmonitor\tit\tin\torder\tto\tknow\twhen\tsomething\tgoes\twrong,\tso\twe\tcan\tfix\tit.\tSo\twhat\tshould\nwe\tlook\tfor?")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("Figure\t8-1.\tA\tsingle\tservice\ton\ta\tsingle\thost\n")])])]),a("p",[t._v("First,\twe’ll\twant\tto\tmonitor\tthe\thost\titself.\tCPU,\tmemory\t—\tall\tof\tthese\tthings\tare\tuseful.\nWe’ll\twant\tto\tknow\twhat\tthey\tshould\tbe\twhen\tthings\tare\thealthy,\tso\twe\tcan\talert\twhen\nthey\tgo\tout\tof\tbounds.\tIf\twe\twant\tto\trun\tour\town\tmonitoring\tsoftware,\twe\tcould\tuse\nsomething\tlike\tNagios\tto\tdo\tso,\tor\telse\tuse\ta\thosted\tservice\tlike\tNew\tRelic.")]),t._v(" "),a("p",[t._v("Next,\twe’ll\twant\tto\thave\taccess\tto\tthe\tlogs\tfrom\tthe\tserver\titself.\tIf\ta\tuser\treports\tan\terror,\nthese\tlogs\tshould\tpick\tit\tup\tand\thopefully\ttell\tus\twhen\tand\twhere\tthe\terror\tis.\tAt\tthis\npoint,\twith\tour\tsingle\thost\twe\tcan\tprobably\tget\tby\twith\tjust\tlogging\ton\tto\tthe\thost\tand\nusing\tcommand-line\ttools\tto\tscan\tthe\tlog.\tWe\tmay\teven\tget\tadvanced\tand\tuse\tlogrotate\nto\tmove\told\tlogs\tout\tof\tthe\tway\tand\tavoid\tthem\ttaking\tup\tall\tour\tdisk\tspace.")]),t._v(" "),a("p",[t._v("Finally,\twe\tmight\twant\tto\tmonitor\tthe\tapplication\titself.\tAt\ta\tbare\tminimum,\tmonitoring\nthe\tresponse\ttime\tof\tthe\tservice\tis\ta\tgood\tidea.\tYou’ll\tprobably\tbe\table\tto\tdo\tthis\tby\nlooking\tat\tthe\tlogs\tcoming\teither\tfrom\ta\tweb\tserver\tfronting\tyour\tservice,\tor\tperhaps\tfrom\nthe\tservice\titself.\tIf\twe\tget\tvery\tadvanced,\twe\tmight\twant\tto\ttrack\tthe\tnumber\tof\terrors\twe\nare\treporting.")]),t._v(" "),a("p",[t._v("Time\tpasses,\tloads\tincrease,\tand\twe\tfind\tourselves\tneeding\tto\tscale...")]),t._v(" "),a("h2",{attrs:{id:"singleservice-multipleservers"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#singleservice-multipleservers"}},[t._v("#")]),t._v(" Single\tService,\tMultiple\tServers")]),t._v(" "),a("p",[t._v("Now\twe\thave\tmultiple\tcopies\tof\tthe\tservice\trunning\ton\tseparate\thosts,\tas\tshown\tin\nFigure\t8-2,\twith\trequests\tto\tthe\tdifferent\tservice\tinstances\tdistributed\tvia\ta\tload\tbalancer.\nThings\tstart\tto\tget\ta\tbit\ttrickier\tnow.\tWe\tstill\twant\tto\tmonitor\tall\tthe\tsame\tthings\tas\tbefore,\nbut\tneed\tto\tdo\tso\tin\tsuch\ta\tway\tthat\twe\tcan\tisolate\tthe\tproblem.\tWhen\tthe\tCPU\tis\thigh,\tis\nit\ta\tproblem\twe\tare\tseeing\ton\tall\thosts,\twhich\twould\tpoint\tto\tan\tissue\twith\tthe\tservice\nitself,\tor\tis\tit\tisolated\tto\ta\tsingle\thost,\timplying\tthat\tthe\thost\titself\thas\tthe\tproblem\t—\nperhaps\ta\trogue\tOS\tprocess?")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("Figure\t8-2.\tA\tsingle\tservice\tdistributed\tacross\tmultiple\thosts\n")])])]),a("p",[t._v("So\tat\tthis\tpoint,\twe\tstill\twant\tto\ttrack\tthe\thost-level\tmetrics,\tand\talert\ton\tthem.\tBut\tnow\nwe\twant\tto\tsee\twhat\tthey\tare\tacross\tall\thosts,\tas\twell\tas\tindividual\thosts.\tIn\tother\twords,\nwe\twant\tto\taggregate\tthem\tup,\tand\tstill\tbe\table\tto\tdrill\tdown.\tNagios\tlets\tus\tgroup\tour\nhosts\tlike\tthis\t—\tso\tfar,\tso\tgood.\tA\tsimilar\tapproach\twill\tprobably\tsuffice\tfor\tour\napplication.")]),t._v(" "),a("p",[t._v('Then\twe\thave\tour\tlogs.\tWith\tour\tservice\trunning\ton\tmore\tthan\tone\tserver,\twe’ll\tprobably\nget\ttired\tof\tlogging\tinto\teach\tbox\tto\tlook\tat\tit.\tWith\tjust\ta\tfew\thosts,\tthough,\twe\tcan\tuse\ntools\tlike\tssh-multiplexers,\twhich\tallow\tus\tto\trun\tthe\tsame\tcommands\ton\tmultiple\thosts.\nA\tbig\tmonitor\tand\ta\tgrep\t"Error"\tapp.log\tlater,\tand\twe\tcan\tfind\tour\tculprit.')]),t._v(" "),a("p",[t._v("For\ttasks\tlike\tresponse\ttime\ttracking,\twe\tcan\tget\tsome\tof\tthe\taggregation\tfor\tfree\tby\ntracking\tat\tthe\tload\tbalancer\titself.\tBut\twe\tneed\tto\ttrack\tthe\tload\tbalancer\tas\twell,\tof\ncourse;\tif\tthat\tmisbehaves,\twe\thave\ta\tproblem.\tAt\tthis\tpoint,\twe\talso\tprobably\tcare\ta\tlot\nmore\tabout\twhat\ta\thealthy\tservice\tlooks\tlike,\tas\twe’ll\tconfigure\tour\tload\tbalancer\tto\nremove\tunhealthy\tnodes\tfrom\tour\tapplication.\tHopefully\tby\tthe\ttime\twe\tget\there\twe\thave\nat\tleast\tsome\tidea\tof\tthat...")]),t._v(" "),a("h2",{attrs:{id:"multipleservices-multipleservers"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#multipleservices-multipleservers"}},[t._v("#")]),t._v(" Multiple\tServices,\tMultiple\tServers")]),t._v(" "),a("p",[t._v("In\tFigure\t8-3,\tthings\tget\tmuch\tmore\tinteresting.\tMultiple\tservices\tare\tcollaborating\tto\nprovide\tcapabilities\tto\tour\tusers,\tand\tthose\tservices\tare\trunning\ton\tmultiple\thosts\t—\tbe\nthey\tphysical\tor\tvirtual.\tHow\tdo\tyou\tfind\tthe\terror\tyou’re\tlooking\tfor\tin\tthousands\tof\tlines\nof\tlogs\ton\tmultiple\thosts?\tHow\tdo\tyou\tdetermine\tif\tone\tserver\tis\tmisbehaving,\tor\tif\tit\tis\ta\nsystematic\tissue?\tAnd\thow\tdo\tyou\ttrack\tback\tan\terror\tfound\tdeep\tdown\tin\ta\tcall\tchain\nbetween\tmultiple\thosts\tand\twork\tout\twhat\tcaused\tit?")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("Figure\t8-3.\tMultiple\tcollaborating\tservices\tdistributed\tacross\tmultiple\thosts\n")])])]),a("p",[t._v("The\tanswer\tis\tcollection\tand\tcentral\taggregation\tof\tas\tmuch\tas\twe\tcan\tget\tour\thands\ton,\nfrom\tlogs\tto\tapplication\tmetrics.")]),t._v(" "),a("h2",{attrs:{id:"logs-logs-andyetmorelogs"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#logs-logs-andyetmorelogs"}},[t._v("#")]),t._v(" Logs,\tLogs,\tand\tYet\tMore\tLogs...")]),t._v(" "),a("p",[t._v("Now\tthe\tnumber\tof\thosts\twe\tare\trunning\ton\tis\tbecoming\ta\tchallenge.\tSSH-multiplexing\tto\nretrieve\tlogs\tprobably\tisn’t\tgoing\tto\tcut\tit\tnow,\tand\tthere\tisn’t\ta\tscreen\tbig\tenough\tfor\tyou\nto\thave\tterminals\topen\ton\tevery\thost.\tInstead,\twe’re\tlooking\tto\tuse\tspecialized\tsubsystems\nto\tgrab\tour\tlogs\tand\tmake\tthem\tavailable\tcentrally.\tOne\texample\tof\tthis\tis\tlogstash,\twhich\ncan\tparse\tmultiple\tlogfile\tformats\tand\tcan\tsend\tthem\tto\tdownstream\tsystems\tfor\tfurther\ninvestigation.")]),t._v(" "),a("p",[t._v("Kibana\tis\tan\tElasticSearch-backed\tsystem\tfor\tviewing\tlogs,\tillustrated\tin\tFigure\t8-4.\tYou\ncan\tuse\ta\tquery\tsyntax\tto\tsearch\tthrough\tlogs,\tallowing\tyou\tto\tdo\tthings\tlike\trestrict\ttime\nand\tdate\tranges\tor\tuse\tregular\texpressions\tto\tfind\tmatching\tstrings.\tKibana\tcan\teven\ngenerate\tgraphs\tfrom\tthe\tlogs\tyou\tsend\tit,\tallowing\tyou\tto\tsee\tat\ta\tglance\thow\tmany\nerrors\thave\tbeen\tgenerated\tover\ttime,\tfor\texample.")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("Figure\t8-4.\tUsing\tKibana\tto\tview\taggregated\tlogs\n")])])]),a("h2",{attrs:{id:"metrictrackingacrossmultipleservices"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#metrictrackingacrossmultipleservices"}},[t._v("#")]),t._v(" Metric\tTracking\tAcross\tMultiple\tServices")]),t._v(" "),a("p",[t._v("As\twith\tthe\tchallenge\tof\tlooking\tat\tlogs\tfor\tdifferent\thosts,\twe\tneed\tto\tlook\tat\tbetter\tways\nto\tgather\tand\tview\tour\tmetrics.\tIt\tcan\tbe\thard\tto\tknow\twhat\t "),a("em",[t._v("good")]),t._v(" \tlooks\tlike\twhen\twe’re\nlooking\tat\tmetrics\tfor\ta\tmore\tcomplex\tsystem.\tOur\twebsite\tis\tseeing\tnearly\t50\t4XX\tHTTP\nerror\tcodes\tper\tsecond.\tIs\tthat\tbad?\tThe\tCPU\tload\ton\tthe\tcatalog\tservice\thas\tincreased\tby\n20%\tsince\tlunch;\thas\tsomething\tgone\twrong?\tThe\tsecret\tto\tknowing\twhen\tto\tpanic\tand\nwhen\tto\trelax\tis\tto\tgather\tmetrics\tabout\thow\tyour\tsystem\tbehaves\tover\ta\tlong-enough\nperiod\tof\ttime\tthat\tclear\tpatterns\temerge.")]),t._v(" "),a("p",[t._v("In\ta\tmore\tcomplex\tenvironment,\twe’ll\tbe\tprovisioning\tnew\tinstances\tof\tour\tservices\npretty\tfrequently,\tso\twe\twant\tthe\tsystem\twe\tpick\tto\tmake\tit\tvery\teasy\tto\tcollect\tmetrics\nfrom\tnew\thosts.\tWe’ll\twant\tto\tbe\table\tto\tlook\tat\ta\tmetric\taggregated\tfor\tthe\twhole\tsystem\n—\tfor\texample,\tthe\tavergage\tCPU\tload\t—\tbut\twe’ll\talso\twant\tto\taggregate\tthat\tmetric\tfor\nall\tthe\tinstances\tof\ta\tgiven\tservice,\tor\teven\tfor\ta\tsingle\tinstance\tof\tthat\tservice.\tThat\nmeans\twe’ll\tneed\tto\tbe\table\tto\tassociate\tmetadata\twith\tthe\tmetric\tto\tallow\tus\tto\tinfer\tthis\nstructure.")]),t._v(" "),a("p",[t._v("Graphite\tis\tone\tsuch\tsystem\tthat\tmakes\tthis\tvery\teasy.\tIt\texposes\ta\tvery\tsimple\tAPI\tand\nallows\tyou\tto\tsend\tmetrics\tin\treal\ttime.\tIt\tthen\tallows\tyou\tto\tquery\tthose\tmetrics\tto\nproduce\tcharts\tand\tother\tdisplays\tto\tsee\twhat\tis\thappening.\tThe\tway\tit\thandles\tvolume\tis\nalso\tinteresting.\tEffectively,\tyou\tconfigure\tit\tso\tthat\tyou\treduce\tthe\tresolution\tof\tolder\nmetrics\tto\tensure\tthe\tvolumes\tdon’t\tget\ttoo\tlarge.\tSo,\tfor\texample,\tI\tmight\trecord\tthe\tCPU\nfor\tmy\thosts\tonce\tevery\t10\tseconds\tfor\tthe\tlast\t10\tminutes,\tthen\tan\taggregated\tsample\nevery\tminute\tfor\tthe\tlast\tday,\tdown\tto\tperhaps\tone\tsample\tevery\t30\tminutes\tfor\tthe\tlast\nseveral\tyears.\tIn\tthis\tway,\tyou\tcan\tstore\tinformation\tabout\thow\tyour\tsystem\thas\tbehaved\nover\ta\tlong\tperiod\tof\ttime\twithout\tneeding\thuge\tamounts\tof\tstorage.")]),t._v(" "),a("p",[t._v("Graphite\talso\tenables\tyou\tto\taggregate\tacross\tsamples,\tor\tdrill\tdown\tto\ta\tsingle\tseries,\tso\nyou\tcan\tsee\tthe\tresponse\ttime\tfor\tyour\twhole\tsystem,\ta\tgroup\tof\tservices,\tor\ta\tsingle\ninstance.\tIf\tGraphite\tdoesn’t\twork\tfor\tyou\tfor\twhatever\treason,\tmake\tsure\tyou\tget\tsimilar\ncapabilities\tin\tany\tother\ttool\tyou\tselect.\tAnd\tcertainly\tmake\tsure\tyou\tcan\tget\taccess\tto\tthe\nraw\tdata\tto\tprovide\tyour\town\treporting\tor\tdashboards\tif\tyou\tneed\tto.")]),t._v(" "),a("p",[t._v("Another\tkey\tbenefit\tof\tunderstanding\tyour\ttrends\tis\twhen\tit\tcomes\tto\tcapacity\tplanning.\nAre\twe\treaching\tour\tlimit?\tHow\tlong\tuntil\twe\tneed\tmore\thosts?\tIn\tthe\tpast\twhen\twe\nbrought\tphysical\thosts,\tthis\twas\toften\tan\tannual\tjob.\tIn\tthe\tnew\tage\tof\ton-demand\ncomputing\tprovided\tby\tinfrastructure\tas\ta\tservice\t(IaaS)\tvendors,\twe\tcan\tnow\tscale\tup\tor\ndown\tin\tminutes,\tif\tnot\tseconds.\tThis\tmeans\tthat\tif\twe\tunderstand\tour\tusage\tpatterns,\twe\ncan\tmake\tsure\twe\thave\tjust\tenough\tinfrastructure\tto\tserve\tour\tneeds.\tThe\tsmarter\twe\tare\nin\ttracking\tour\ttrends\tand\tknowing\twhat\tto\tdo\twith\tthem,\tthe\tmore\tcost\teffective\tand\nresponsive\tour\tsystems\tcan\tbe.")]),t._v(" "),a("h2",{attrs:{id:"servicemetrics"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#servicemetrics"}},[t._v("#")]),t._v(" Service\tMetrics")]),t._v(" "),a("p",[t._v("The\toperating\tsystems\twe\trun\ton\tgenerate\ta\tlarge\tnumber\tof\tmetrics\tfor\tus,\tas\tyou’ll\tfind\nthe\tmoment\tyou\tinstall\tcollectd\ton\ta\tLinux\tbox\tand\tpoint\tit\tat\tGraphite.\tLikewise,\nsupporting\tsubsystems\tlike\tNginx\tor\tVarnish\texposes\tuseful\tinformation\tlike\tresponse\ntimes\tor\tcache\thit\trates.\tBut\twhat\tabout\tyour\town\tservice?")]),t._v(" "),a("p",[t._v("I\twould\tstrongly\tsuggest\thaving\tyour\tservices\texpose\tbasic\tmetrics\tthemselves.\tAt\ta\tbare\nminimum,\tfor\ta\tweb\tservice\tyou\tshould\tprobably\texpose\tmetrics\tlike\tresponse\ttimes\tand\nerror\trates\t—\tvital\tif\tyour\tserver\tisn’t\tfronted\tby\ta\tweb\tserver\tthat\tis\tdoing\tthis\tfor\tyou.\nBut\tyou\tshould\treally\tgo\tfurther.\tFor\texample,\tour\taccounts\tservice\tmay\twant\tto\texpose\nthe\tnumber\tof\ttimes\tcustomers\tview\ttheir\tpast\torders,\tor\tyour\tweb\tshop\tmight\twant\tto\ncapture\thow\tmuch\tmoney\thas\tbeen\tmade\tduring\tthe\tlast\tday.")]),t._v(" "),a("p",[t._v("Why\tdo\twe\tcare\tabout\tthis?\tWell,\tfor\ta\tnumber\tof\treasons.\tFirst,\tthere\tis\tan\told\tadage\tthat\n80%\tof\tsoftware\tfeatures\tare\tnever\tused.\tNow\tI\tcan’t\tcomment\ton\thow\taccurate\tthat\nfigure\tis,\tbut\tas\tsomeone\twho\thas\tbeen\tdeveloping\tsoftware\tfor\tnearly\t20\tyears,\tI\t "),a("em",[t._v("know")]),t._v("\nthat\tI\thave\tspent\ta\tlot\tof\ttime\ton\tfeatures\tthat\tnever\tactually\tget\tused.\tWouldn’t\tit\tbe\tnice\nto\tknow\twhat\tthey\tare?")]),t._v(" "),a("p",[t._v("Second,\twe\tare\tgetting\tbetter\tthan\tever\tat\treacting\tto\thow\tour\tusers\tare\tusing\tour\tsystem\nto\twork\tout\thow\tto\timprove\tit.\tMetrics\tthat\tinform\tus\tof\thow\tour\tsystems\tbehave\tcan\tonly\nhelp\tus\there.\tWe\tpush\tout\ta\tnew\tversion\tof\tthe\twebsite,\tand\tfind\tthat\tthe\tnumber\tof\nsearches\tby\tgenre\thas\tgone\tup\tsignificantly\ton\tthe\tcatalog\tservice.\tIs\tthat\ta\tproblem,\tor\nexpected?")]),t._v(" "),a("p",[t._v("Finally,\twe\tcan\tnever\tknow\twhat\tdata\twill\tbe\tuseful!\tMore\ttimes\tthan\tI\tcan\tcount\tI’ve\nwanted\tto\tcapture\tdata\tto\thelp\tme\tunderstand\tsomething\tonly\tafter\tthe\tchance\tto\tdo\tso\thas\nlong\tpassed.\tI\ttend\tto\terr\ttoward\texposing\teverything\tand\trelying\ton\tmy\tmetrics\tsystem\tto\nhandle\tthis\tlater.")]),t._v(" "),a("p",[t._v("Libraries\texist\tfor\ta\tnumber\tof\tdifferent\tplatforms\tthat\tallow\tour\tservices\tto\tsend\tmetrics\nto\tstandard\tsystems.\tCodahale’s\tMetrics\tlibrary\tis\tone\tsuch\texample\tlibrary\tfor\tthe\tJVM.\nIt\tallows\tyou\tto\tstore\tmetrics\tas\tcounters,\ttimers,\tor\tgauges;\tsupports\ttime-boxing\tmetrics\n(so\tyou\tcan\tspecify\tmetrics\tlike\t“number\tof\torders\tin\tthe\tlast\tfive\tminutes”);\tand\talso\ncomes\tout\tof\tthe\tbox\twith\tsupport\tfor\tsending\tdata\tto\tGraphite\tand\tother\taggregating\tand\nreporting\tsystems.")]),t._v(" "),a("h2",{attrs:{id:"syntheticmonitoring"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#syntheticmonitoring"}},[t._v("#")]),t._v(" Synthetic\tMonitoring")]),t._v(" "),a("p",[t._v("We\tcan\ttry\tto\twork\tout\tif\ta\tservice\tis\t "),a("em",[t._v("healthy")]),t._v(" \tby,\tfor\texample,\tdeciding\twhat\ta\tgood\tCPU\nlevel\tis,\tor\twhat\tmakes\tfor\tan\tacceptable\tresponse\ttime.\tIf\tour\tmonitoring\tsystem\tdetects\nthat\tthe\tactual\tvalues\tfall\toutside\tthis\tsafe\tlevel,\twe\tcan\ttrigger\tan\talert\t—\tsomething\tthat\na\ttool\tlike\tNagios\tis\tmore\tthan\tcapable\tof.")]),t._v(" "),a("p",[t._v("However,\tin\tmany\tways,\tthese\tvalues\tare\tone\tstep\tremoved\tfrom\twhat\twe\tactually\twant\tto\ntrack\t—\tnamely,\t "),a("em",[t._v("is\tthe\tsystem\tworking?")]),t._v(" \tThe\tmore\tcomplex\tthe\tinteractions\tbetween\tthe\nservices,\tthe\tfurther\tremoved\twe\tare\tfrom\tactually\tanswering\tthat\tquestion.\tSo\twhat\tif\tour\nmonitoring\tsystems\twere\tprogrammed\tto\tact\ta\tbit\tlike\tour\tusers,\tand\tcould\treport\tback\tif\nsomething\tgoes\twrong?")]),t._v(" "),a("p",[t._v("I\tfirst\tdid\tthis\tback\tin\t2005.\tI\twas\tpart\tof\ta\tsmall\tThoughtWorks\tteam\tthat\twas\tbuilding\ta\nsystem\tfor\tan\tinvestment\tbank.\tThroughout\tthe\ttrading\tday,\tlots\tof\tevents\tcame\tin\nrepresenting\tchanges\tin\tthe\tmarket.\tOur\tjob\twas\tto\treact\tto\tthese\tchanges,\tand\tlook\tat\tthe\nimpact\ton\tthe\tbank’s\tportfolio.\tWe\twere\tworking\tunder\tsome\tfairly\ttight\tdeadlines,\tas\tthe\ngoal\twas\tto\thave\tdone\tall\tour\tcalculations\tin\tless\tthan\t10\tseconds\tafter\tthe\tevent\tarrived.\nThe\tsystem\titself\tconsisted\tof\taround\tfive\tdiscrete\tservices,\tat\tleast\tone\tof\twhich\twas\nrunning\ton\ta\tcomputing\tgrid\tthat,\tamong\tother\tthings,\twas\tscavenging\tunused\tCPU\tcycles\non\taround\t250\tdesktop\thosts\tin\tthe\tbank’s\tdisaster\trecovery\tcenter.")]),t._v(" "),a("p",[t._v("The\tnumber\tof\tmoving\tparts\tin\tthe\tsystem\tmeant\ta\tlot\tof\tnoise\twas\tbeing\tgenerated\tfrom\nmany\tof\tthe\tlower-level\tmetrics\twe\twere\tgathering.\tWe\tdidn’t\thave\tthe\tbenefit\tof\tscaling\ngradually\tor\thaving\tthe\tsystem\trun\tfor\ta\tfew\tmonths\tto\tunderstand\twhat\t "),a("em",[t._v("good")]),t._v(" \tlooked\tlike\nfor\tmetrics\tlike\tour\tCPU\trate\tor\teven\tthe\tlatencies\tof\tsome\tof\tthe\tindividual\tcomponents.\nOur\tapproach\twas\tto\tgenerate\tfake\tevents\tto\tprice\tpart\tof\tthe\tportfolio\tthat\twas\tnot\nbooked\tinto\tthe\tdownstream\tsystems.\tEvery\tminute\tor\tso,\twe\thad\tNagios\trun\ta\tcommand-\nline\tjob\tthat\tinserted\ta\tfake\tevent\tinto\tone\tof\tour\tqueues.\tOur\tsystem\tpicked\tit\tup\tand\tran\nall\tthe\tvarious\tcalculations\tjust\tlike\tany\tother\tjob,\texcept\tthe\tresults\tappeared\tin\tthe\t "),a("em",[t._v("junk")]),t._v("\nbook,\twhich\twas\tused\tonly\tfor\ttesting.\tIf\ta\tre-pricing\twasn’t\tseen\twithin\ta\tgiven\ttime,\nNagios\treported\tthis\tas\tan\tissue.")]),t._v(" "),a("p",[t._v("This\tfake\tevent\twe\tcreated\tis\tan\texample\tof\t "),a("em",[t._v("synthetic\ttransaction")]),t._v(" .\tWe\tused\tthis\tsynthetic\ntransaction\tto\tensure\tthe\tsystem\twas\tbehaving\tsemantically,\twhich\tis\twhy\tthis\ttechnique\tis\noften\tcalled\t "),a("em",[t._v("semantic\tmonitoring")]),t._v(".")]),t._v(" "),a("p",[t._v("In\tpractice,\tI’ve\tfound\tthe\tuse\tof\tsynthetic\ttransactions\tto\tperform\tsemantic\tmonitoring\nlike\tthis\tto\tbe\ta\tfar\tbetter\tindicator\tof\tissues\tin\tsystems\tthan\talerting\ton\tthe\tlower-level\nmetrics.\tThey\tdon’t\treplace\tthe\tneed\tfor\tthe\tlower-level\tmetrics,\tthough\t—\twe’ll\tstill\twant\nthat\tdetail\twhen\twe\tneed\tto\tfind\tout\t "),a("em",[t._v("why")]),t._v(" \tour\tsemantic\tmonitoring\tis\treporting\ta\tproblem.")]),t._v(" "),a("h2",{attrs:{id:"implementingsemanticmonitoring"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#implementingsemanticmonitoring"}},[t._v("#")]),t._v(" Implementing\tSemantic\tMonitoring")]),t._v(" "),a("p",[t._v("Now\tin\tthe\tpast,\timplementing\tsemantic\tmonitoring\twas\ta\tfairly\tdaunting\ttask.\tBut\tthe\nworld\thas\tmoved\ton,\tand\tthe\tmeans\tto\tdo\tthis\tis\tat\tour\tfingertips!\tYou\tare\trunning\ttests\nfor\tyour\tsystems,\tright?\tIf\tnot,\tgo\tread\tChapter\t7\tand\tcome\tback.\tAll\tdone?\tGood!")]),t._v(" "),a("p",[t._v("If\twe\tlook\tat\tthe\ttests\twe\thave\tthat\ttest\ta\tgiven\tservice\tend\tto\tend,\tor\teven\tour\twhole\nsystem\tend\tto\tend,\twe\thave\tmuch\tof\twhat\twe\tneed\tto\timplement\tsemantic\tmonitoring.\nOur\tsystem\talready\texposes\tthe\thooks\tneeded\tto\tlaunch\tthe\ttest\tand\tcheck\tthe\tresult.\tSo\nwhy\tnot\tjust\trun\ta\tsubset\tof\tthese\ttests,\ton\tan\tongoing\tbasis,\tas\ta\tway\tof\tmonitoring\tour\nsystem?")]),t._v(" "),a("p",[t._v("There\tare\tsome\tthings\twe\tneed\tto\tdo,\tof\tcourse.\tFirst,\twe\tneed\tto\tbe\tcareful\tabout\tthe\tdata\nrequirements\tof\tour\ttests.\tWe\tmay\tneed\tto\tfind\ta\tway\tfor\tour\ttests\tto\tadapt\tto\tdifferent\tlive\ndata\tif\tthis\tchanges\tover\ttime,\tor\telse\tset\ta\tdifferent\tsource\tof\tdata.\tFor\texample,\twe\tcould\nhave\ta\tset\tof\tfake\tusers\twe\tuse\tin\tproduction\twith\ta\tknown\tset\tof\tdata.")]),t._v(" "),a("p",[t._v("Likewise,\twe\thave\tto\tmake\tsure\twe\tdon’t\taccidentally\ttrigger\tunforeseen\tside\teffects.\tA\nfriend\ttold\tme\ta\tstory\tabout\tan\tecommerce\tcompany\tthat\taccidentally\tran\tits\ttests\tagainst\nits\tproduction\tordering\tsystems.\tIt\tdidn’t\trealize\tits\tmistake\tuntil\ta\tlarge\tnumber\tof\nwashing\tmachines\tarrived\tat\tthe\thead\toffice.")]),t._v(" "),a("h2",{attrs:{id:"correlationids"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#correlationids"}},[t._v("#")]),t._v(" Correlation\tIDs")]),t._v(" "),a("p",[t._v("With\ta\tlarge\tnumber\tof\tservices\tinteracting\tto\tprovide\tany\tgiven\tend-user\tcapability,\ta\nsingle\tinitiating\tcall\tcan\tend\tup\tgenerating\tmultiple\tmore\tdownstream\tservice\tcalls.\tFor\nexample,\tconsider\tthe\texample\tof\ta\tcustomer\tbeing\tregistered.\tThe\tcustomer\tfills\tin\tall\ther\ndetails\tin\ta\tform\tand\tclicks\tsubmit.\tBehind\tthe\tscenes,\twe\tcheck\tvalidity\tof\tthe\tcredit\tcard\ndetails\twith\tour\tpayment\tservice,\ttalk\tto\tour\tpostal\tservice\tto\tsend\tout\ta\twelcome\tpack\tin\nthe\tpost,\tand\tsend\ta\twelcome\temail\tusing\tour\temail\tservice.\tNow\twhat\thappens\tif\tthe\tcall\nto\tthe\tpayment\tservice\tends\tup\tgenerating\tan\todd\terror?\tWe’ll\ttalk\tat\tlength\tabout\nhandling\tthe\tfailure\tin\tChapter\t11,\tbut\tconsider\tthe\tdifficulty\tof\tdiagnosing\twhat\nhappened.")]),t._v(" "),a("p",[t._v("If\twe\tlook\tat\tthe\tlogs,\tthe\tonly\tservice\tregistering\tan\terror\tis\tour\tpayment\tservice.\tIf\twe\nare\tlucky,\twe\tcan\twork\tout\twhat\trequest\tcaused\tthe\tproblem,\tand\twe\tmay\teven\tbe\table\tto\nlook\tat\tthe\tparameters\tof\tthe\tcall.\tNow\tconsider\tthat\tthis\tis\ta\tsimple\texample,\tand\tthat\tone\ninitiating\trequest\tcould\tgenerate\ta\tchain\tof\tdownstream\tcalls\tand\tmaybe\tevents\tbeing\tfired\noff\tthat\tare\thandled\tin\tan\tasynchronous\tmanner.\tHow\tcan\twe\treconstruct\tthe\tflow\tof\tcalls\nin\torder\tto\treproduce\tand\tfix\tthe\tproblem?\tOften\twhat\twe\tneed\tis\tto\tsee\tthat\terror\tin\tthe\nwider\tcontext\tof\tthe\tinitiating\tcall;\tin\tother\twords,\twe’d\tlike\tto\ttrace\tthe\tcall\tchain\nupstream,\tjust\tlike\twe\tdo\twith\ta\tstack\ttrace.")]),t._v(" "),a("p",[t._v("One\tapproach\tthat\tcan\tbe\tuseful\there\tis\tto\tuse\tcorrelation\tIDs.\tWhen\tthe\tfirst\tcall\tis\tmade,\nyou\tgenerate\ta\tGUID\tfor\tthe\tcall.\tThis\tis\tthen\tpassed\talong\tto\tall\tsubsequent\tcalls,\tas\tseen\nin\tFigure\t8-5,\tand\tcan\tbe\tput\tinto\tyour\tlogs\tin\ta\tstructured\tway,\tmuch\tas\tyou’ll\talready\tdo\nwith\tcomponents\tlike\tthe\tlog\tlevel\tor\tdate.\tWith\tthe\tright\tlog\taggregation\ttooling,\tyou’ll\nthen\tbe\table\tto\ttrace\tthat\tevent\tall\tthe\tway\tthrough\tyour\tsystem:")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("15-02-2014\t16:01:01\tWeb-Frontend\tINFO\t[abc-123]\tRegister\n15-02-2014\t16:01:02\tRegisterService\tINFO\t[abc-123]\tRegisterCustomer...\n15-02-2014\t16:01:03\tPostalSystem\tINFO\t[abc-123]\tSendWelcomePack...\n15-02-2014\t16:01:03\tEmailSystem\tINFO\t[abc-123]\tSendWelcomeEmail...\n15-02-2014\t16:01:03\tPaymentGateway\tERROR\t[abc-123]\tValidatePayment...\n")])])]),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("Figure\t8-5.\tUsing\tcorrelation\tIDs\tto\ttrack\tcall\tchains\tacross\tmultiple\tservices\n")])])]),a("p",[t._v("You\twill,\tof\tcourse,\tneed\tto\tensure\tthat\teach\tservice\tknows\tto\tpass\ton\tthe\tcorrelation\tID.\nThis\tis\twhere\tyou\tneed\tto\tstandardize\tand\tbe\tstronger\tin\tenforcing\tthis\tacross\tyour\nsystem.\tBut\tonce\tyou\thave\tdone\tthis,\tyou\tcan\tactually\tcreate\ttooling\tto\ttrack\tall\tsorts\tof\ninteractions.\tSuch\ttooling\tcan\tbe\tuseful\tin\ttracking\tdown\tevent\tstorms,\todd\tcorner\tcases,\nor\teven\tidentifying\tespecially\tcostly\ttransactions,\tas\tyou\tcan\tpicture\tthe\twhole\tcascade\tof\ncalls.")]),t._v(" "),a("p",[t._v("Software\tsuch\tas\tZipkin\tcan\talso\ttrace\tcalls\tacross\tmultiple\tsystem\tboundaries.\tBased\ton\nthe\tideas\tfrom\tGoogle’s\town\ttracing\tsystem,\tDapper,\tZipkin\tcan\tprovide\tvery\tdetailed\ntracing\tof\tinterservice\tcalls,\talong\twith\ta\tUI\tto\thelp\tpresent\tthe\tdata.\tPersonally,\tI’ve\nfound\tthe\trequirements\tof\tZipkin\tto\tbe\tsomewhat\theavyweight,\trequiring\tcustom\tclients\nand\tsupporting\tcollection\tsystems.\tGiven\tthat\tyou’ll\talready\twant\tlog\taggregation\tfor\nother\tpurposes,\tit\tfeels\tmuch\tsimpler\tto\tinstead\tmake\tuse\tof\tdata\tyou’re\talready\tcollecting\nthan\thave\tto\tplumb\tin\tadditional\tsources\tof\tdata.\tThat\tsaid,\tif\tyou\tfind\tthat\tyou\tneed\ta\nmore\tadvanced\ttool\tto\ttrack\tinterservice\tcalls\tlike\tthis,\tyou\tmight\twant\tto\tgive\tthem\ta\nlook.")]),t._v(" "),a("p",[t._v("One\tof\tthe\treal\tproblems\twith\tcorrelation\tIDs\tis\tthat\tyou\toften\tdon’t\tknow\tyou\tneed\tone\nuntil\t "),a("em",[t._v("after")]),t._v(" \tyou\talready\thave\ta\tproblem\tthat\tcould\tbe\tdiagnosed\tonly\tif\tyou\thad\tthe\tID\tat\nthe\tbeginning!\tThis\tis\tespecially\tproblematic,\tas\tretrofitting\tcorrelation\tIDs\tin\tis\tvery\ndifficult;\tyou\tneed\tto\thandle\tthem\tin\ta\tstandardized\tway\tto\tbe\table\tto\teasily\treconsititute\ncall\tchains.\tAlthough\tit\tmight\tseem\tlike\tadditional\twork\tup\tfront,\tI\twould\tstrongly\tsuggest\nyou\tconsider\tputting\tthem\tin\tas\tsoon\tas\tyou\tcan,\tespecially\tif\tyour\tsystem\twill\tmake\tuse\nof\tevent-drive\tarchitecture\tpatterns,\twhich\tcan\tlead\tto\tsome\todd\temergent\tbehavior.")]),t._v(" "),a("p",[t._v("Needing\tto\thandle\ttasks\tlike\tconsistently\tpassing\tthrough\tcorrelation\tIDs\tcan\tbe\ta\tstrong\nargument\tfor\tthe\tuse\tof\tthin\tshared\tclient\twrapper\tlibraries.\tAt\ta\tcertain\tscale,\tit\tbecomes\ndifficult\tto\tensure\tthat\teveryone\tis\tcalling\tdownstream\tservices\tin\tthe\tright\tway\tand\ncollecting\tthe\tright\tsort\tof\tdata.\tIt\tonly\ttakes\tone\tservice\tpartway\tthrough\tthe\tchain\tto\nforget\tto\tdo\tthis\tfor\tyou\tto\tlose\tcritical\tinformation.\tIf\tyou\tdo\tdecide\tto\tcreate\tan\tin-house\nclient\tlibrary\tto\tmake\tthings\tlike\tthis\twork\tout\tof\tthe\tbox,\tdo\tmake\tsure\tyou\tkeep\tit\tvery\nthin\tand\tnot\ttied\tto\tany\tparticular\tproducing\tservice.\tFor\texample,\tif\tyou\tare\tusing\tHTTP\nas\tthe\tunderlying\tprotocol\tfor\tcommunication,\tjust\twrap\ta\tstandard\tHTTP\tclient\tlibrary,\nadding\tin\tcode\tto\tmake\tsure\tyou\tpropogate\tthe\tcorrelation\tIDs\tin\tthe\theaders.")]),t._v(" "),a("h2",{attrs:{id:"thecascade"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#thecascade"}},[t._v("#")]),t._v(" The\tCascade")]),t._v(" "),a("p",[t._v("Cascading\tfailures\tcan\tbe\tespecially\tperilous.\tImagine\ta\tsituation\twhere\tthe\tnetwork\nconnection\tbetween\tour\tmusic\tshop\twebsite\tand\tthe\tcatalog\tservice\tgoes\tdown.\tThe\nservices\tthemselves\tappear\thealthy,\tbut\tthey\tcan’t\ttalk\tto\teach\tother.\tIf\twe\tjust\tlooked\tat\nthe\thealth\tof\tthe\tindividual\tservice,\twe\twouldn’t\tknow\tthere\tis\ta\tproblem.\tUsing\tsynthetic\nmonitoring\t—\tfor\texample,\tto\tmimic\ta\tcustomer\tsearching\tfor\ta\tsong\t—\twould\tpick\tup\nthe\tproblem.\tBut\twe’d\talso\tneed\tto\treport\ton\tthe\tfact\tthat\tone\tservice\tcannot\tsee\tanother\nin\torder\tto\tdetermine\tthe\tcause\tof\tthe\tproblem.")]),t._v(" "),a("p",[t._v("Therefore,\tmonitoring\tthe\tintegration\tpoints\tbetween\tsystems\tis\tkey.\tEach\tservice\tinstance\nshould\ttrack\tand\texpose\tthe\thealth\tof\tits\tdownstream\tdependencies,\tfrom\tthe\tdatabase\tto\nother\tcollaborating\tservices.\tYou\tshould\talso\tallow\tthis\tinformation\tto\tbe\taggregated\tto\ngive\tyou\ta\trolled-up\tpicture.\tYou’ll\twant\tto\tsee\tthe\tresponse\ttime\tof\tthe\tdownstream\tcalls,\nand\talso\tdetect\tif\tit\tis\terroring.")]),t._v(" "),a("p",[t._v("As\twe’ll\tdiscuss\tmore\tin\tChapter\t11,\tyou\tcan\tuse\tlibraries\tto\timplement\ta\tcircuit\tbreaker\naround\tnetwork\tcalls\tto\thelp\tyou\thandle\tcascading\tfailures\tin\ta\tmore\telegant\tfashion,\nallowing\tyou\tto\tmore\tgracefully\tdegrade\tyour\tsystem.\tSome\tof\tthese\tlibraries,\tsuch\tas\nHystrix\tfor\tthe\tJVM,\talso\tdo\ta\tgood\tjob\tof\tproviding\tthese\tmonitoring\tcapabilities\tfor\nyou.")]),t._v(" "),a("h2",{attrs:{id:"standardization"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#standardization"}},[t._v("#")]),t._v(" Standardization")]),t._v(" "),a("p",[t._v("As\twe’ve\tcovered\tpreviously,\tone\tof\tthe\tongoing\tbalancing\tacts\tyou’ll\tneed\tto\tpull\toff\tis\nwhere\tto\tallow\tfor\tdecisions\tto\tbe\tmade\tnarrowly\tfor\ta\tsingle\tservice\tversus\twhere\tyou\nneed\tto\tstandardize\tacross\tyour\tsystem.\tIn\tmy\topinion,\tmonitoring\tis\tone\tarea\twhere\nstandardization\tis\tincredibly\timportant.\tWith\tservices\tcollaborating\tin\tlots\tof\tdifferent\nways\tto\tprovide\tcapabilities\tto\tusers\tusing\tmultiple\tinterfaces,\tyou\tneed\tto\tview\tthe\nsystem\tin\ta\tholistic\tway.")]),t._v(" "),a("p",[t._v("You\tshould\ttry\tto\twrite\tyour\tlogs\tout\tin\ta\tstandard\tformat.\tYou\tdefinitely\twant\tto\thave\tall\nyour\tmetrics\tin\tone\tplace,\tand\tyou\tmay\twant\tto\thave\ta\tlist\tof\tstandard\tnames\tfor\tyour\nmetrics\ttoo;\tit\twould\tbe\tvery\tannoying\tfor\tone\tservice\tto\thave\ta\tmetric\tcalled\nResponseTime,\tand\tanother\tto\thave\tone\tcalled\tRspTimeSecs,\twhen\tthey\tmean\tthe\tsame")]),t._v(" "),a("p",[t._v("thing.")]),t._v(" "),a("p",[t._v("As\talways\twith\tstandardization,\ttools\tcan\thelp.\tAs\tI’ve\tsaid\tbefore,\tthe\tkey\tis\tmaking\tit\neasy\tto\tdo\tthe\tright\tthing\t—\tso\twhy\tnot\tprovide\tpreconfigured\tvirtual\tmachine\timages\nwith\tlogstash\tand\tcollectd\tready\tto\tgo,\talong\twith\tapplication\tlibraries\tthat\tlet\tyou\ttalk\tto\nGraphite\treally\teasily?")]),t._v(" "),a("h2",{attrs:{id:"considertheaudience"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#considertheaudience"}},[t._v("#")]),t._v(" Consider\tthe\tAudience")]),t._v(" "),a("p",[t._v("All\tthis\tdata\twe\tare\tgathering\tis\tfor\ta\tpurpose.\tMore\tspecifically,\twe\tare\tgathering\tall\tthis\ndata\tfor\tdifferent\tpeople\tto\thelp\tthem\tdo\ttheir\tjobs;\tthis\tdata\tbecomes\ta\tcall\tto\taction.\nSome\tof\tthis\tdata\tneeds\tto\ttrigger\tan\timmediate\tcall\tto\taction\tfor\tour\tsupport\tteam\t—\tfor\nexample,\tin\tthe\tcase\tof\tone\tof\tour\tsynthetic\tmonitoring\ttests\tfailing.\tOther\tdata,\tlike\tthe\nfact\tthat\tour\tCPU\tload\thas\tincreased\tby\t2%\tover\tthe\tlast\tweek,\tis\tpotentially\tonly\tof\ninterest\twhen\twe’re\tdoing\tcapacity\tplanning.\tLikewise,\tyour\tboss\tis\tprobably\tgoing\tto\nwant\tto\tknow\tright\taway\tthat\trevenue\tdipped\t25%\tafter\tthe\tlast\trelease,\tbut\tprobably\ndoesn’t\tneed\tto\tbe\twoken\tup\tbecause\tsearches\tfor\t“Justin\tBieber”\thave\tgone\tup\t5%\tin\tthe\nlast\thour.")]),t._v(" "),a("p",[t._v("What\tour\tpeople\twant\tto\tsee\tand\treact\tto\t "),a("em",[t._v("right\tnow")]),t._v(" \tis\tdifferent\tthan\twhat\tthey\tneed\twhen\ndrilling\tdown.\tSo,\tfor\tthe\ttype\tof\tperson\twho\twill\tbe\tlooking\tat\tthis\tdata,\tconsider\tthe\nfollowing:")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("What\tthey\tneed\tto\tknow\tright\tnow\n")])])]),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("What\tthey\tmight\twant\tlater\n")])])]),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("How\tthey\tlike\tto\tconsume\tdata\n")])])]),a("p",[t._v("Alert\ton\tthe\tthings\tthey\tneed\tto\tknow\tright\tnow.\tCreate\tbig\tvisible\tdisplays\twith\tthis\ninformation\tthat\tsit\tin\tthe\tcorner\tof\tthe\troom.\tGive\tthem\teasy\taccess\tto\tthe\tdata\tthey\tneed\nto\tknow\tlater.\tAnd\tspend\ttime\twith\tthem\tto\tknow\thow\tthey\twant\tto\tconsume\tdata.\tA\ndiscussion\tabout\tall\tthe\tnuances\tinvolved\tin\tthe\tgraphical\tdisplay\tof\tquantitative\ninformation\tis\tcertainly\toutside\tthe\tscope\tof\tthis\tbook,\tbut\ta\tgreat\tplace\tto\tstart\tis\tStephen\nFew’s\texcellent\tbook\t "),a("em",[t._v("Information\tDashboard\tDesign:\tDisplaying\tData\tfor\tAt-a-Glance\nMonitoring")]),t._v(" \t(Analytics\tPress).")]),t._v(" "),a("h2",{attrs:{id:"thefuture"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#thefuture"}},[t._v("#")]),t._v(" The\tFuture")]),t._v(" "),a("p",[t._v("I\thave\tseen\tmany\torganizations\twhere\tmetrics\tare\tsiloed\tinto\tdifferent\tsystems.\nApplication-level\tmetrics,\tlike\tthe\tnumber\tof\torders\tplaced,\tend\tup\tin\ta\tproprietary\nanalytics\tsystem\tlike\tOmniture,\twhich\tis\toften\tavailable\tonly\tto\tselect\tparts\tof\t "),a("em",[t._v("the\nbusiness")]),t._v(" ,\tor\telse\tends\tup\tin\tthe\tdreaded\tdata\twarehouse,\taka\twhere\tdata\tgoes\tto\tdie.\nReporting\tfrom\tsuch\tsystems\tis\toften\tnot\tavailable\tin\treal\ttime,\talthough\tthat\tis\tstarting\tto\nchange.\tMeanwhile,\t "),a("em",[t._v("system")]),t._v(" \tmetrics\tlike\tresponse\ttimes,\terror\trates,\tand\tCPU\tload\tare\nstored\tin\tsystems\tthat\tthe\toperations\tteams\tcan\taccess.\tThese\tsystems\ttypically\tallow\tfor\nreal-time\treporting,\tas\tnormally\tthe\tpoint\tof\tthem\tis\tto\tprovoke\tan\timmediate\tcall\tto\naction.")]),t._v(" "),a("p",[t._v("Historically,\tthe\tidea\tthat\twe\tcan\tfind\tout\tabout\tkey\tbusiness\tmetrics\ta\tday\tor\ttwo\tlater\nwas\tfine,\tas\ttypically\twe\twere\tunable\tto\treact\tfast\tenough\tto\tthis\tdata\tto\tdo\tanything\tabout\nit\tanyway.\tNow,\tthough,\twe\toperate\tin\ta\tworld\tin\twhich\tmany\tof\tus\tcan\tand\tdo\tpush\tout\nmultiple\treleases\tper\tday.\tTeams\tnow\tmeasure\tthemselves\tnot\tin\tterms\tof\thow\tmany\n"),a("em",[t._v("points")]),t._v(" \tthey\tcomplete,\tbut\tinstead\toptimize\tfor\thow\tlong\tit\ttakes\tfor\tcode\tto\tget\tfrom\nlaptop\tto\tlive.\tIn\tsuch\tan\tenvironment,\twe\tneed\tall\tour\tmetrics\tat\tour\tfingertips\tto\ttake\tthe\nright\taction.\tIronically,\tthe\tvery\tsystems\tthat\tstore\tbusiness\tmetrics\tare\toften\tnot\ttuned\tfor\nimmediate\taccess\tto\tdata,\tbut\tour\toperational\tsystems\tare.")]),t._v(" "),a("p",[t._v("So\twhy\thandle\toperational\tand\tbusiness\tmetrics\tin\tthe\tsame\tway?\tUltimately,\tboth\ttypes\nof\tthings\tbreak\tdown\tto\tevents\tthat\tsay\t "),a("em",[t._v("something\thappened\tat\tX")]),t._v(" .\tSo,\tif\twe\tcan\tunify\tthe\nsystems\twe\tuse\tto\tgather,\taggregate,\tand\tstore\tthese\tevents,\tand\tmake\tthem\tavailable\tfor\nreporting,\twe\tend\tup\twith\ta\tmuch\tsimpler\tarchitecture.")]),t._v(" "),a("p",[t._v("Riemann\tis\tan\tevent\tserver\tthat\tallows\tfor\tfairly\tadvanced\taggregation\tand\trouting\tof\nevents\tand\tcan\tform\tpart\tof\tsuch\ta\tsolution.\tSuro\tis\tNetflix’s\t "),a("em",[t._v("data\tpipeline")]),t._v(" \tand\toperates\tin\na\tsimilar\tspace.\tSuro\tis\texplicitly\tused\tto\thandle\tboth\tmetrics\tassociated\twith\tuser\nbehavior,\tand\tmore\toperational\tdata\tlike\tapplication\tlogs.\tThis\tdata\tcan\tthen\tbe\tdispatched\nto\ta\tvariety\tof\tsystems,\tlike\tStorm\tfor\treal-time\tanalysis,\tHadoop\tfor\toffline\tbatch\nprocessing,\tor\tKibana\tfor\tlog\tanalysis.")]),t._v(" "),a("p",[t._v("Many\torganizations\tare\tmoving\tin\ta\tfundamentally\tdifferent\tdirection:\taway\tfrom\thaving\nspecialized\ttool\tchains\tfor\tdifferent\ttypes\tof\tmetrics\tand\ttoward\tmore\tgeneric\tevent\nrouting\tsystems\tcapable\tof\tsignificant\tscale.\tThese\tsystems\tmanage\tto\tprovide\tmuch\tmore\nflexibility,\twhile\tat\tthe\tsame\ttime\tactually\tsimplifying\tour\tarchitecture.")]),t._v(" "),a("h2",{attrs:{id:"summary-8"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#summary-8"}},[t._v("#")]),t._v(" Summary")]),t._v(" "),a("p",[t._v("So,\twe’ve\tcovered\ta\tlot\there!\tI’ll\tattempt\tto\tsummarize\tthis\tchapter\tinto\tsome\teasy-to-\nfollow\tadvice.")]),t._v(" "),a("p",[t._v("For\teach\tservice:")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("Track\tinbound\tresponse\ttime\tat\ta\tbare\tminimum.\tOnce\tyou’ve\tdone\tthat,\tfollow\twith\nerror\trates\tand\tthen\tstart\tworking\ton\tapplication-level\tmetrics.\n")])])]),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("Track\tthe\thealth\tof\tall\tdownstream\tresponses,\tat\ta\tbare\tminimum\tincluding\tthe\nresponse\ttime\tof\tdownstream\tcalls,\tand\tat\tbest\ttracking\terror\trates.\tLibraries\tlike\nHystrix\tcan\thelp\there.\n")])])]),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("Standardize\ton\thow\tand\twhere\tmetrics\tare\tcollected.\n")])])]),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("Log\tinto\ta\tstandard\tlocation,\tin\ta\tstandard\tformat\tif\tpossible.\tAggregation\tis\ta\tpain\tif\nevery\tservice\tuses\ta\tdifferent\tlayout!\n")])])]),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("Monitor\tthe\tunderlying\toperating\tsystem\tso\tyou\tcan\ttrack\tdown\trogue\tprocesses\tand\ndo\tcapacity\tplanning.\n")])])]),a("p",[t._v("For\tthe\tsystem:")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("Aggregate\thost-level\tmetrics\tlike\tCPU\ttogether\twith\tapplication-level\tmetrics.\n")])])]),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("Ensure\tyour\tmetric\tstorage\ttool\tallows\tfor\taggregation\tat\ta\tsystem\tor\tservice\tlevel,\nand\tdrill\tdown\tto\tindividual\thosts.\n")])])]),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("Ensure\tyour\tmetric\tstorage\ttool\tallows\tyou\tto\tmaintain\tdata\tlong\tenough\tto\nunderstand\ttrends\tin\tyour\tsystem.\n")])])]),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("Have\ta\tsingle,\tqueryable\ttool\tfor\taggregating\tand\tstoring\tlogs.\n")])])]),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("Strongly\tconsider\tstandardizing\ton\tthe\tuse\tof\tcorrelation\tIDs.\n")])])]),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("Understand\twhat\trequires\ta\tcall\tto\taction,\tand\tstructure\talerting\tand\tdashboards\naccordingly.\n")])])]),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("Investigate\tthe\tpossibility\tof\tunifying\thow\tyou\taggregate\tall\tof\tyour\tvarious\tmetrics\nby\tseeing\tif\ta\ttool\tlike\tSuro\tor\tRiemann\tmakes\tsense\tfor\tyou.\n")])])]),a("p",[t._v("I’ve\talso\tattempted\tto\toutline\tthe\tdirection\tin\twhich\tmonitoring\tis\tmoving:\taway\tfrom\nsystems\tspecialized\tto\tdo\tjust\tone\tthing,\tand\ttoward\tgeneric\tevent\tprocessing\tsystems\tthat\nallow\tyou\tto\tlook\tat\tyour\tsystem\tin\ta\tmore\tholistic\tway.\tThis\tis\tan\texciting\tand\temerging\nspace,\tand\twhile\ta\tfull\tinvestigation\tis\toutside\tthe\tscope\tof\tthis\tbook,\thopefully\tI’ve\tgiven\nyou\tenough\tto\tget\tstarted\twith.\tIf\tyou\twant\tto\tknow\tmore,\tI\tgo\tinto\tsome\tof\tthese\tideas")]),t._v(" "),a("p",[t._v("and\tmore\tin\tmy\tearlier\tpublication\t "),a("em",[t._v("Lightweight\tSystems\tfor\tRealtime\tMonitoring")]),t._v("\n(O’Reilly).")]),t._v(" "),a("p",[t._v("In\tthe\tnext\tchapter,\twe’ll\ttake\ta\tdifferent\tholistic\tview\tof\tour\tsystems\tto\tconsider\tsome\tof\nthe\tunique\tadvantages\t—\tand\tchallenges\t—\tthat\tfine-grained\tarchitectures\tcan\tprovide\tin\nthe\tarea\tof\tsecurity.")]),t._v(" "),a("h1",{attrs:{id:"chapter11-microservicesatscale"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#chapter11-microservicesatscale"}},[t._v("#")]),t._v(" Chapter\t11.\tMicroservices\tat\tScale")]),t._v(" "),a("p",[t._v("When\tyou’re\tdealing\twith\tnice,\tsmall,\tbook-sized\texamples,\teverything\tseems\tsimple.\tBut\nthe\treal\tworld\tis\ta\tmore\tcomplex\tspace.\tWhat\thappens\twhen\tour\tmicroservice\narchitectures\tgrow\tfrom\tsimpler,\tmore\thumble\tbeginnings\tto\tsomething\tmore\tcomplex?\nWhat\thappens\twhen\twe\thave\tto\thandle\tfailure\tof\tmultiple\tseparate\tservices\tor\tmanage\nhundreds\tof\tservices?\tWhat\tare\tsome\tof\tthe\tcoping\tpatterns\twhen\tyou\thave\tmore\nmicroservices\tthan\tpeople?\tLet’s\tfind\tout.")]),t._v(" "),a("h2",{attrs:{id:"failureiseverywhere"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#failureiseverywhere"}},[t._v("#")]),t._v(" Failure\tIs\tEverywhere")]),t._v(" "),a("p",[t._v("We\tunderstand\tthat\tthings\tcan\tgo\twrong.\tHard\tdisks\tcan\tfail.\tOur\tsoftware\tcan\tcrash.\tAnd\nas\tanyone\twho\thas\tread\tthe\tfallacies\tof\tdistributed\tcomputing\tcan\ttell\tyou,\twe\tknow\tthat\nthe\tnetwork\tis\tunreliable.\tWe\tcan\tdo\tour\tbest\tto\ttry\tto\tlimit\tthe\tcauses\tof\tfailure,\tbut\tat\ta\ncertain\tscale,\tfailure\tbecomes\tinevitable.\tHard\tdrives,\tfor\texample,\tare\tmore\treliable\tnow\nthan\tever\tbefore,\tbut\tthey’ll\tbreak\teventually.\tThe\tmore\thard\tdrives\tyou\thave,\tthe\thigher\nthe\tlikelihood\tof\tfailure\tfor\tan\tindividual\tunit;\tfailure\tbecomes\ta\tstatistical\tcertainty\tat\nscale.")]),t._v(" "),a("p",[t._v("Even\tfor\tthose\tof\tus\tnot\tthinking\tat\textreme\tscale,\tif\twe\tcan\tembrace\tthe\tpossibility\tof\nfailure\twe\twill\tbe\tbetter\toff.\tFor\texample,\tif\twe\tcan\thandle\tthe\tfailure\tof\ta\tservice\ngracefully,\tthen\tit\tfollows\tthat\twe\tcan\talso\tdo\tin-place\tupgrades\tof\ta\tservice,\tas\ta\tplanned\noutage\tis\tmuch\teasier\tto\tdeal\twith\tthan\tan\tunplanned\tone.")]),t._v(" "),a("p",[t._v("We\tcan\talso\tspend\ta\tbit\tless\tof\tour\ttime\ttrying\tto\tstop\tthe\tinevitable,\tand\ta\tbit\tmore\tof\tour\ntime\tdealing\twith\tit\tgracefully.\tI’m\tamazed\tat\thow\tmany\torganizations\tput\tprocesses\tand\ncontrols\tin\tplace\tto\ttry\tto\tstop\tfailure\tfrom\toccurring,\tbut\tput\tlittle\tto\tno\tthought\tinto\nactually\tmaking\tit\teasier\tto\trecover\tfrom\tfailure\tin\tthe\tfirst\tplace.")]),t._v(" "),a("p",[t._v("Baking\tin\tthe\tassumption\tthat\teverything\tcan\tand\twill\tfail\tleads\tyou\tto\tthink\tdifferently\nabout\thow\tyou\tsolve\tproblems.")]),t._v(" "),a("p",[t._v("I\tsaw\tone\texample\tof\tthis\tthinking\twhile\tspending\tsome\ttime\ton\tthe\tGoogle\tcampus\tmany\nyears\tago.\tIn\tthe\treception\tarea\tof\tone\tof\tthe\tbuildings\tin\tMountain\tView\twas\tan\told\track\nof\tmachines,\tthere\tas\ta\tsort\tof\texhibit.\tI\tnoticed\ta\tcouple\tof\tthings.\tFirst,\tthese\tservers\nweren’t\tin\tserver\tenclosures,\tthey\twere\tjust\tbare\tmotherboards\tslotted\tinto\tthe\track.\tThe\nmain\tthing\tI\tnoticed,\tthough,\twas\tthat\tthe\thard\tdrives\twere\tattached\tby\tvelcro.\tI\tasked\tone\nof\tthe\tGooglers\twhy\tthat\twas.\t“Oh,”\the\tsaid,\t“the\thard\tdrives\tfail\tso\tmuch\twe\tdon’t\twant\nthem\tscrewed\tin.\tWe\tjust\trip\tthem\tout,\tthrow\tthem\tin\tthe\tbin,\tand\tvelcro\tin\ta\tnew\tone.”")]),t._v(" "),a("p",[t._v("So\tlet\tme\trepeat:\tat\tscale,\teven\tif\tyou\tbuy\tthe\tbest\tkit,\tthe\tmost\texpensive\thardware,\tyou\ncannot\tavoid\tthe\tfact\tthat\tthings\tcan\tand\twill\tfail.\tTherefore,\tyou\tneed\tto\tassume\tfailure\ncan\thappen.\tIf\tyou\tbuild\tthis\tthinking\tinto\teverything\tyou\tdo,\tand\tplan\tfor\tfailure,\tyou\tcan\nmake\tdifferent\ttrade-offs.\tIf\tyou\tknow\tyour\tsystem\tcan\thandle\tthe\tfact\tthat\ta\tserver\tcan\nand\twill\tfail,\twhy\tbother\tspending\tmuch\ton\tit\tat\tall?\tWhy\tnot\tuse\ta\tbare\tmotherboard\twith\ncheaper\tcomponents\t(and\tsome\tvelcro)\tlike\tGoogle\tdid,\trather\tthan\tworrying\ttoo\tmuch\nabout\tthe\tresiliency\tof\ta\tsingle\tnode?")]),t._v(" "),a("h2",{attrs:{id:"howmuchistoomuch"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#howmuchistoomuch"}},[t._v("#")]),t._v(" How\tMuch\tIs\tToo\tMuch?")]),t._v(" "),a("p",[t._v("We\ttouched\ton\tthe\ttopic\tof\tcross-functional\trequirements\tin\tChapter\t7.\tUnderstanding\ncross-functional\trequirements\tis\tall\tabout\tconsidering\taspects\tlike\tdurability\tof\tdata,\navailability\tof\tservices,\tthroughput,\tand\tacceptable\tlatency\tof\tservices.\tMany\tof\tthe\ntechniques\tcovered\tin\tthis\tchapter\tand\telsewhere\ttalk\tabout\tapproaches\tto\timplement\nthese\trequirements,\tbut\tonly\tyou\tknow\texactly\twhat\tthe\trequirements\tthemselves\tmight\nbe.")]),t._v(" "),a("p",[t._v("Having\tan\tautoscaling\tsystem\tcapable\tof\treacting\tto\tincreased\tload\tor\tfailure\tof\tindividual\nnodes\tmight\tbe\tfantastic,\tbut\tcould\tbe\toverkill\tfor\ta\treporting\tsystem\tthat\tonly\tneeds\tto\nrun\ttwice\ta\tmonth,\twhere\tbeing\tdown\tfor\ta\tday\tor\ttwo\tisn’t\tthat\tbig\tof\ta\tdeal.\tLikewise,\nfiguring\tout\thow\tto\tdo\tblue/green\tdeployments\tto\teliminate\tdowntime\tof\ta\tservice\tmight\nmake\tsense\tfor\tyour\tonline\tecommerce\tsystem,\tbut\tfor\tyour\tcorporate\tintranet\tknowledge\nbase\tit’s\tprobably\ta\tstep\ttoo\tfar.")]),t._v(" "),a("p",[t._v("Knowing\thow\tmuch\tfailure\tyou\tcan\ttolerate,\tor\thow\tfast\tyour\tsystem\tneeds\tto\tbe,\tis\ndriven\tby\tthe\tusers\tof\tyour\tsystem.\tThat\tin\tturn\twill\thelp\tyou\tunderstand\twhich\ntechniques\twill\tmake\tthe\tmost\tsense\tfor\tyou.\tThat\tsaid,\tyour\tusers\twon’t\talways\tbe\table\tto\narticulate\twhat\tthe\texact\trequirements\tare.\tSo\tyou\tneed\tto\task\tquestions\tto\thelp\textract\tthe\nright\tinformation,\tand\thelp\tthem\tunderstand\tthe\trelative\tcosts\tof\tproviding\tdifferent\tlevels\nof\tservice.")]),t._v(" "),a("p",[t._v("As\tI\tmentioned\tpreviously,\tthese\tcross-functional\trequirements\tcan\tvary\tfrom\tservice\tto\nservice,\tbut\tI\twould\tsuggest\tdefining\tsome\tgeneral\tcross-functionals\tand\tthen\toverriding\nthem\tfor\tparticular\tuse\tcases.\tWhen\tit\tcomes\tto\tconsidering\tif\tand\thow\tto\tscale\tout\tyour\nsystem\tto\tbetter\thandle\tload\tor\tfailure,\tstart\tby\ttrying\tto\tunderstand\tthe\tfollowing\nrequirements:")]),t._v(" "),a("p",[a("em",[t._v("Response\ttime/latency")])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("How\tlong\tshould\tvarious\toperations\ttake?\tIt\tcan\tbe\tuseful\there\tto\tmeasure\tthis\twith\ndifferent\tnumbers\tof\tusers\tto\tunderstand\thow\tincreasing\tload\twill\timpact\tthe\nresponse\ttime.\tGiven\tthe\tnature\tof\tnetworks,\tyou’ll\talways\thave\toutliers,\tso\tsetting\ntargets\tfor\ta\tgiven\tpercentile\tof\tthe\tresponses\tmonitored\tcan\tbe\tuseful.\tThe\ttarget\nshould\talso\tinclude\tthe\tnumber\tof\tconcurrent\tconnections/users\tyou\twill\texpect\tyour\nsoftware\tto\thandle.\tSo\tyou\tmight\tsay,\t“We\texpect\tthe\twebsite\tto\thave\ta\t90th-\npercentile\tresponse\ttime\tof\t2\tseconds\twhen\thandling\t200\tconcurrent\tconnections\tper\nsecond.”\n")])])]),a("p",[a("em",[t._v("Availability")])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("Can\tyou\texpect\ta\tservice\tto\tbe\tdown?\tIs\tthis\tconsidered\ta\t24/7\tservice?\tSome\tpeople\nlike\tto\tlook\tat\tperiods\tof\tacceptable\tdowntime\twhen\tmeasuring\tavailability,\tbut\thow\nuseful\tis\tthis\tto\tsomeone\tcalling\tyour\tservice?\tI\tshould\teither\tbe\table\tto\trely\ton\tyour\nservice\tresponding\tor\tnot.\tMeasuring\tperiods\tof\tdowntime\tis\treally\tmore\tuseful\tfrom\na\thistorical\treporting\tangle.\n")])])]),a("p",[a("em",[t._v("Durability\tof\tdata")])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("How\tmuch\tdata\tloss\tis\tacceptable?\tHow\tlong\tshould\tdata\tbe\tkept\tfor?\tThis\tis\thighly\nlikely\tto\tchange\ton\ta\tcase-by-case\tbasis.\tFor\texample,\tyou\tmight\tchoose\tto\tkeep\tuser\nsession\tlogs\tfor\ta\tyear\tor\tless\tto\tsave\tspace,\tbut\tyour\tfinancial\ttransaction\trecords\nmight\tneed\tto\tbe\tkept\tfor\tmany\tyears.\n")])])]),a("p",[t._v("Once\tyou\thave\tthese\trequirements\tin\tplace,\tyou’ll\twant\ta\tway\tto\tsystematically\tmeasure\nthem\ton\tan\tongoing\tbasis.\tYou\tmay\tdecide\tto\tmake\tuse\tof\tperformance\ttests,\tfor\texample,\nto\tensure\tyour\tsystem\tmeets\tacceptable\tperformance\ttargets,\tbut\tyou’ll\twant\tto\tmake\tsure\nyou\tare\tmonitoring\tthese\tstats\tin\tproduction\tas\twell!")]),t._v(" "),a("h2",{attrs:{id:"degradingfunctionality"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#degradingfunctionality"}},[t._v("#")]),t._v(" Degrading\tFunctionality")]),t._v(" "),a("p",[t._v("An\tessential\tpart\tof\tbuilding\ta\tresilient\tsystem,\tespecially\twhen\tyour\tfunctionality\tis\nspread\tover\ta\tnumber\tof\tdifferent\tmicroservices\tthat\tmay\tbe\tup\tor\tdown,\tis\tthe\tability\tto\nsafely\tdegrade\tfunctionality.\tLet’s\timagine\ta\tstandard\tweb\tpage\ton\tour\tecommerce\tsite.\tTo\npull\ttogether\tthe\tvarious\tparts\tof\tthat\twebsite,\twe\tmight\tneed\tseveral\tmicroservices\tto\tplay\na\tpart.\tOne\tmicroservice\tmight\tdisplay\tthe\tdetails\tabout\tthe\talbum\tbeing\toffered\tfor\tsale.\nAnother\tmight\tshow\tthe\tprice\tand\tstock\tlevel.\tAnd\twe’ll\tprobably\tbe\tshowing\tshopping\ncart\tcontents\ttoo,\twhich\tmay\tbe\tyet\tanother\tmicroservice.\tNow\tif\tone\tof\tthose\tservices\tis\ndown,\tand\tthat\tresults\tin\tthe\twhole\tweb\tpage\tbeing\tunavailable,\tthen\twe\thave\targuably\nmade\ta\tsystem\tthat\tis\tless\tresilient\tthan\tone\tthat\trequires\tonly\tone\tservice\tto\tbe\tavailable.")]),t._v(" "),a("p",[t._v("What\twe\tneed\tto\tdo\tis\tunderstand\tthe\timpact\tof\teach\toutage,\tand\twork\tout\thow\tto\nproperly\tdegrade\tfunctionality.\tIf\tthe\tshopping\tcart\tservice\tis\tunavailable,\twe’re\tprobably\nin\ta\tlot\tof\ttrouble,\tbut\twe\tcould\tstill\tshow\tthe\tweb\tpage\twith\tthe\tlisting.\tPerhaps\twe\tjust\nhide\tthe\tshopping\tcart\tor\treplace\tit\twith\tan\ticon\tsaying\t“Be\tBack\tSoon!”")]),t._v(" "),a("p",[t._v("With\ta\tsingle,\tmonolithic\tapplication,\twe\tdon’t\thave\tmany\tdecisions\tto\tmake.\tSystem\nhealth\tis\tbinary.\tBut\twith\ta\tmicroservice\tarchitecture,\twe\tneed\tto\tconsider\ta\tmuch\tmore\nnuanced\tsituation.\tThe\tright\tthing\tto\tdo\tin\tany\tsituation\tis\toften\tnot\ta\ttechnical\tdecision.\nWe\tmight\tknow\twhat\tis\ttechnically\tpossible\twhen\tthe\tshopping\tcart\tis\tdown,\tbut\tunless\nwe\tunderstand\tthe\tbusiness\tcontext\twe\twon’t\tunderstand\twhat\taction\twe\tshould\tbe\ttaking.\nFor\texample,\tperhaps\twe\tclose\tthe\tentire\tsite,\tstill\tallow\tpeople\tto\tbrowse\tthe\tcatalog\tof\nitems,\tor\treplace\tthe\tpart\tof\tthe\tUI\tcontaining\tthe\tcart\tcontrol\twith\ta\tphone\tnumber\tfor\nplacing\tan\torder.\tBut\tfor\tevery\tcustomer-facing\tinterface\tthat\tuses\tmultiple\tmicroservices,\nor\tevery\tmicroservice\tthat\tdepends\ton\tmultiple\tdownstream\tcollaborators,\tyou\tneed\tto\task\nyourself,\t“What\thappens\tif\tthis\tis\tdown?”\tand\tknow\twhat\tto\tdo.")]),t._v(" "),a("p",[t._v("By\tthinking\tabout\tthe\tcriticality\tof\teach\tof\tour\tcapabilities\tin\tterms\tof\tour\tcross-functional\nrequirements,\twe’ll\tbe\tmuch\tbetter\tpositioned\tto\tknow\twhat\twe\tcan\tdo.\tNow\tlet’s\nconsider\tsome\tthings\twe\tcan\tdo\tfrom\ta\ttechnical\tpoint\tof\tview\tto\tmake\tsure\tthat\twhen\nfailure\toccurs\twe\tcan\thandle\tit\tgracefully.")]),t._v(" "),a("h2",{attrs:{id:"architecturalsafetymeasures"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#architecturalsafetymeasures"}},[t._v("#")]),t._v(" Architectural\tSafety\tMeasures")]),t._v(" "),a("p",[t._v("There\tare\ta\tfew\tpatterns,\twhich\tcollectively\tI\trefer\tto\tas\t "),a("em",[t._v("architectural\tsafety\tmeasures")]),t._v(" ,\tthat\nwe\tcan\tmake\tuse\tof\tto\tensure\tthat\tif\tsomething\tdoes\tgo\twrong,\tit\tdoesn’t\tcause\tnasty\nripple-out\teffects.\tThese\tare\tpoints\tit\tis\tessential\tyou\tunderstand,\tand\tshould\tstrongly\nconsider\tstandardizing\tin\tyour\tsystem\tto\tensure\tthat\tone\tbad\tcitizen\tdoesn’t\tbring\tthe\nwhole\tworld\tcrashing\tdown\taround\tyour\tears.\tIn\ta\tmoment,\twe’ll\ttake\ta\tlook\tat\ta\tfew\tkey\nsafety\tmeasures\tyou\tshould\tconsider,\tbut\tbefore\twe\tdo,\tI’d\tlike\tto\tshare\ta\tbrief\tstory\tto\noutline\tthe\tsort\tof\tthing\tthat\tcan\tgo\twrong.")]),t._v(" "),a("p",[t._v("I\twas\ta\ttechnical\tlead\ton\ta\tproject\twhere\twe\twere\tbuilding\tan\tonline\tclassified\tads\nwebsite.\tThe\twebsite\titself\thandled\tfairly\thigh\tvolumes,\tand\tgenerated\ta\tgood\tdeal\tof\nincome\tfor\tthe\tbusiness.\tOur\tcore\tapplication\thandled\tsome\tdisplay\tof\tclassified\tads\titself,\nand\talso\tproxied\tcalls\tto\tother\tservices\tthat\tprovided\tdifferent\ttypes\tof\tproducts,\tas\tshown\nin\tFigure\t11-1.\tThis\tis\tactually\tan\texample\tof\ta\t "),a("em",[t._v("strangler\tapplication")]),t._v(" ,\twhere\ta\tnew\tsystem\nintercepts\tcalls\tmade\tto\tlegacy\tapplications\tand\tgradually\treplaces\tthem\taltogether.\tAs\npart\tof\tthis\tproject,\twe\twere\tpartway\tthrough\tretiring\tthe\tolder\tapplications.\tWe\thad\tjust\nmoved\tover\tthe\thighest\tvolume\tand\tbiggest\tearning\tproduct,\tbut\tmuch\tof\tthe\trest\tof\tthe\nads\twere\tstill\tbeing\tserved\tby\ta\tnumber\tof\tolder\tapplications.\tIn\tterms\tof\tboth\tthe\tnumber\nof\tsearches\tand\tthe\tmoney\tmade\tby\tthese\tapplications,\tthere\twas\ta\tvery\tlong\ttail.")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("Figure\t11-1.\tA\tclassified\tads\twebsite\tstrangling\tolder\tlegacy\tapplications\n")])])]),a("p",[t._v("Our\tsystem\thad\tbeen\tlive\tfor\ta\twhile\tand\twas\tbehaving\tvery\twell,\thandling\ta\tnot\ninsignificant\tload.\tAt\tthat\ttime\twe\tmust\thave\tbeen\thandling\taround\t6,000–7,000\trequests\nper\tsecond\tduring\tpeak,\tand\talthough\tmost\tof\tthat\twas\tvery\theavily\tcached\tby\treverse\nproxies\tsitting\tin\tfront\tof\tour\tapplication\tservers,\tthe\tsearches\tfor\tproducts\t(the\tmost\nimportant\taspect\tof\tthe\tsite)\twere\tmostly\tuncached\tand\trequired\ta\tfull\tserver\tround-trip.")]),t._v(" "),a("p",[t._v("One\tmorning,\tjust\tbefore\twe\thit\tour\tdaily\tlunchtime\tpeak,\tthe\tsystem\tstarted\tbehaving\nslowly,\tthen\tgradually\tstarted\tfailing.\tWe\thad\tsome\tlevel\tof\tmonitoring\ton\tour\tnew\tcore\napplication,\tenough\tto\ttell\tus\tthat\teach\tof\tour\tapplication\tnodes\twas\thitting\ta\t100%\tCPU\nspike,\twell\tabove\tthe\tnormal\tlevels\teven\tat\tpeak.\tIn\ta\tshort\tperiod\tof\ttime,\tthe\tentire\tsite\nwent\tdown.")]),t._v(" "),a("p",[t._v("We\tmanaged\tto\ttrack\tdown\tthe\tculprit\tand\tbring\tthe\tsite\tback\tup.\tIt\tturned\tout\tone\tof\tthe\ndownstream\tad\tsystems,\tone\tof\tthe\toldest\tand\tleast\tactively\tmaintained,\thad\tstarted\nresponding\tvery\tslowly.\tResponding\tvery\tslowly\tis\tone\tof\tthe\tworst\tfailure\tmodes\tyou\tcan\nexperience.\tIf\ta\tsystem\tis\tjust\tnot\tthere,\tyou\tfind\tout\tpretty\tquickly.\tWhen\tit’s\tjust\t "),a("em",[t._v("slow")]),t._v(" ,\nyou\tend\tup\twaiting\taround\tfor\ta\twhile\tbefore\tgiving\tup.\tBut\twhatever\tthe\tcause\tof\tthe\nfailure,\twe\thad\tcreated\ta\tsystem\tthat\twas\tvulnerable\tto\ta\tcascading\tfailure.\tA\tdownstream\nservice,\tover\twhich\twe\thad\tlittle\tcontrol,\twas\table\tto\ttake\tdown\tour\twhole\tsystem.")]),t._v(" "),a("p",[t._v("While\tone\tteam\tlooked\tat\tthe\tproblems\twith\tthe\tdownstream\tsystem,\tthe\trest\tof\tus\tstarted\nlooking\tat\twhat\thad\tgone\twrong\tin\tour\tapplication.\tWe\tfound\ta\tfew\tproblems.\tWe\twere\nusing\tan\tHTTP\tconnection\tpool\tto\thandle\tour\tdownstream\tconnections.\tThe\tthreads\tin\tthe\npool\titself\thad\ttimeouts\tconfigured\tfor\thow\tlong\tthey\twould\twait\twhen\tmaking\tthe\ndownstream\tHTTP\tcall,\twhich\tis\tgood.\tThe\tproblem\twas\tthat\tthe\tworkers\twere\tall\ttaking\na\twhile\tto\ttime\tout\tdue\tto\tthe\tslow\tdownstream\tsystem.\tWhile\tthey\twere\twaiting,\tmore\nrequests\twent\tto\tthe\tpool\tasking\tfor\tworker\tthreads.\tWith\tno\tworkers\tavailable,\tthese\nrequests\tthemselves\thung.\tIt\tturned\tout\tthe\tconnection\tpool\tlibrary\twe\twere\tusing\tdid\nhave\ta\ttimeout\tfor\twaiting\tfor\tworkers,\tbut\tthis\twas\t "),a("em",[t._v("disabled\tby\tdefault")]),t._v(" !\tThis\tled\tto\ta\thuge\nbuild-up\tof\tblocked\tthreads.\tOur\tapplication\tnormally\thad\t40\tconcurrent\tconnections\tat\nany\tgiven\ttime.\tIn\tthe\tspace\tof\tfive\tminutes,\tthis\tsituation\tcaused\tus\tto\tpeak\tat\taround\t800\nconnections,\tbringing\tthe\tsystem\tdown.")]),t._v(" "),a("p",[t._v("What\twas\tworse\twas\tthat\tthe\tdownstream\tservice\twe\twere\ttalking\tto\trepresented\nfunctionality\tthat\tless\tthan\t5%\tof\tour\tcustomer\tbase\tused,\tand\tgenerated\teven\tless\trevenue\nthan\tthat.\tWhen\tyou\tget\tdown\tto\tit,\twe\tdiscovered\tthe\thard\tway\tthat\tsystems\tthat\tjust\tact\nslow\tare\t "),a("em",[t._v("much")]),t._v(" \tharder\tto\tdeal\twith\tthan\tsystems\tthat\tjust\tfail\tfast.\tIn\ta\tdistributed\tsystem,\nlatency\tkills.")]),t._v(" "),a("p",[t._v("Even\tif\twe’d\thad\tthe\ttimeouts\ton\tthe\tpool\tset\tcorrectly,\twe\twere\talso\tsharing\ta\tsingle\nHTTP\tconnection\tpool\tfor\tall\toutbound\trequests.\tThis\tmeant\tthat\tone\tslow\tservice\tcould\nexhaust\tthe\tnumber\tof\tavailable\tworkers\tall\tby\titself,\teven\tif\teverything\telse\twas\thealthy.\nLastly,\tit\twas\tclear\tthat\tthe\tdownstream\tservice\tin\tquestion\twasn’t\thealthy,\tbut\twe\tkept\nsending\ttraffic\tits\tway.\tIn\tour\tsituation,\tthis\tmeant\twe\twere\tactually\tmaking\ta\tbad\nsituation\tworse,\tas\tthe\tdownstream\tservice\thad\tno\tchance\tto\trecover.\tWe\tended\tup\nimplementing\tthree\tfixes\tto\tavoid\tthis\thappening\tagain:\tgetting\tour\t "),a("em",[t._v("timeouts")]),t._v(" \tright,\nimplementing\t "),a("em",[t._v("bulkheads")]),t._v(" \tto\tseparate\tout\tdifferent\tconnection\tpools,\tand\timplementing\ta\n"),a("em",[t._v("circuit\tbreaker")]),t._v(" \tto\tavoid\tsending\tcalls\tto\tan\tunhealthy\tsystem\tin\tthe\tfirst\tplace.")]),t._v(" "),a("h2",{attrs:{id:"theantifragileorganization"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#theantifragileorganization"}},[t._v("#")]),t._v(" The\tAntifragile\tOrganization")]),t._v(" "),a("p",[t._v("In\this\tbook\t "),a("em",[t._v("Antifragile")]),t._v(" \t(Random\tHouse),\tNassim\tTaleb\ttalks\tabout\tthings\tthat\tactually\nbenefit\tfrom\tfailure\tand\tdisorder.\tAriel\tTseitlin\tused\tthis\tconcept\tto\tcoin\tthe\tconcept\tof\tthe\nantifragile\torganization\tin\tregards\tto\thow\tNetflix\toperates.")]),t._v(" "),a("p",[t._v("The\tscale\tat\twhich\tNetflix\toperates\tis\twell\tknown,\tas\tis\tthe\tfact\tthat\tNetflix\tis\tbased\nentirely\ton\tthe\tAWS\tinfrastructure.\tThese\ttwo\tfactors\tmean\tthat\tit\thas\tto\tembrace\tfailure\nwell.\tNetflix\tgoes\tbeyond\tthat\tby\tactually\t "),a("em",[t._v("inciting")]),t._v(" \tfailure\tto\tensure\tthat\tits\tsystems\tare\ntolerant\tof\tit.")]),t._v(" "),a("p",[t._v("Some\torganizations\twould\tbe\thappy\twith\t "),a("em",[t._v("game\tdays")]),t._v(" ,\twhere\tfailure\tis\tsimulated\tby\nsystems\tbeing\tswitched\toff\tand\thaving\tthe\tvarious\tteams\treact.\tDuring\tmy\ttime\tat\tGoogle,\nthis\twas\ta\tfairly\tcommon\toccurrence\tfor\tvarious\tsystems,\tand\tI\tcertainly\tthink\tthat\tmany\norganizations\tcould\tbenefit\tfrom\thaving\tthese\tsorts\tof\texercises\tregularly.\tGoogle\tgoes\nbeyond\tsimple\ttests\tto\tmimic\tserver\tfailure,\tand\tas\tpart\tof\tits\tannual\tDiRT\t(Disaster\nRecovery\tTest)\texercises\tit\thas\tsimulated\tlarge-scale\tdisasters\tsuch\tas\tearthquakes.\tNetflix\nalso\ttakes\ta\tmore\taggressive\tapproach,\tby\twriting\tprograms\tthat\tcause\tfailure\tand\trunning\nthem\tin\tproduction\ton\ta\tdaily\tbasis.")]),t._v(" "),a("p",[t._v("The\tmost\tfamous\tof\tthese\tprograms\tis\tthe\tChaos\tMonkey,\twhich\tduring\tcertain\thours\tof\nthe\tday\twill\tturn\toff\trandom\tmachines.\tKnowing\tthat\tthis\tcan\tand\twill\thappen\tin\nproduction\tmeans\tthat\tthe\tdevelopers\twho\tcreate\tthe\tsystems\treally\thave\tto\tbe\tprepared\nfor\tit.\tThe\tChaos\tMonkey\tis\tjust\tone\tpart\tof\tNetflix’s\tSimian\tArmy\tof\tfailure\tbots.\tThe\nChaos\tGorilla\tis\tused\tto\ttake\tout\tan\tentire\tavailability\tcenter\t(the\tAWS\tequivalent\tof\ta\ndata\tcenter),\twhereas\tthe\tLatency\tMonkey\tsimulates\tslow\tnetwork\tconnectivity\tbetween\nmachines.\tNetflix\thas\tmade\tthese\ttools\tavailable\tunder\tan\topen\tsource\tlicense.\tFor\tmany,\nthe\tultimate\ttest\tof\twhether\tyour\tsystem\treally\tis\trobust\tmight\tbe\tunleashing\tyour\tvery\nown\tSimian\tArmy\ton\tyour\tproduction\tinfrastructure.")]),t._v(" "),a("p",[t._v("Embracing\tand\tinciting\tfailure\tthrough\tsoftware,\tand\tbuilding\tsystems\tthat\tcan\thandle\tit,\nis\tonly\tpart\tof\twhat\tNetflix\tdoes.\tIt\talso\tunderstands\tthe\timportance\tof\tlearning\tfrom\tthe\nfailure\twhen\tit\toccurs,\tand\tadopting\ta\tblameless\tculture\twhen\tmistakes\tdo\thappen.\nDevelopers\tare\tfurther\tempowered\tto\tbe\tpart\tof\tthis\tlearning\tand\tevolving\tprocess,\tas\teach\ndeveloper\tis\talso\tresponsible\tfor\tmanaging\this\tor\ther\tproduction\tservices.")]),t._v(" "),a("p",[t._v("By\tcausing\tfailure\tto\thappen,\tand\tbuilding\tfor\tit,\tNetflix\thas\tensured\tthat\tthe\tsystems\tit\nhas\tscale\tbetter,\tand\tbetter\tsupport\tthe\tneeds\tof\tits\tcustomers.")]),t._v(" "),a("p",[t._v("Not\teveryone\tneeds\tto\tgo\tto\tthe\tsorts\tof\textremes\tthat\tGoogle\tor\tNetflix\tdo,\tbut\tit\tis\nimportant\tto\tunderstand\tthe\tmindset\tshift\tthat\tis\trequired\twith\tdistributed\tsystems.\tThings\nwill\tfail.\tThe\tfact\tthat\tyour\tsystem\tis\tnow\tspread\tacross\tmultiple\tmachines\t(which\tcan\tand\nwill\tfail)\tacross\ta\tnetwork\t(which\twill\tbe\tunreliable)\tcan\tactually\tmake\tyour\tsystem\tmore\nvulnerable,\tnot\tless.\tSo\tregardless\tof\twhether\tyou’re\ttrying\tto\tprovide\ta\tservice\tat\tthe\nscale\tof\tGoogle\tor\tNetflix,\tpreparing\tyourself\tfor\tthe\tsorts\tof\tfailure\tthat\thappen\twith")]),t._v(" "),a("p",[t._v("more\tdistributed\tarchitectures\tis\tpretty\timportant.\tSo\twhat\tdo\twe\tneed\tto\tdo\tto\thandle\nfailure\tin\tour\tsystems?")]),t._v(" "),a("h2",{attrs:{id:"timeouts"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#timeouts"}},[t._v("#")]),t._v(" Timeouts")]),t._v(" "),a("p",[t._v("Timeouts\tare\tsomething\tit\tis\teasy\tto\toverlook,\tbut\tin\ta\tdownstream\tsystem\tthey\tare\nimportant\tto\tget\tright.\tHow\tlong\tcan\tI\twait\tbefore\tI\tcan\tconsider\ta\tdownstream\tsystem\tto\nactually\tbe\tdown?")]),t._v(" "),a("p",[t._v("Wait\ttoo\tlong\tto\tdecide\tthat\ta\tcall\thas\tfailed,\tand\tyou\tcan\tslow\tthe\twhole\tsystem\tdown.\nTime\tout\ttoo\tquickly,\tand\tyou’ll\tconsider\ta\tcall\tthat\tmight\thave\tworked\tas\tfailed.\tHave\tno\ntimeouts\tat\tall,\tand\ta\tdownstream\tsystem\tbeing\tdown\tcould\thang\tyour\twhole\tsystem.")]),t._v(" "),a("p",[t._v("Put\ttimeouts\ton\tall\tout-of-process\tcalls,\tand\tpick\ta\tdefault\ttimeout\tfor\teverything.\tLog\nwhen\ttimeouts\toccur,\tlook\tat\twhat\thappens,\tand\tchange\tthem\taccordingly.")]),t._v(" "),a("h2",{attrs:{id:"circuitbreakers"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#circuitbreakers"}},[t._v("#")]),t._v(" Circuit\tBreakers")]),t._v(" "),a("p",[t._v("In\tyour\town\thome,\tcircuit\tbreakers\texist\tto\tprotect\tyour\telectrical\tdevices\tfrom\tspikes\tin\nthe\tpower.\tIf\ta\tspike\toccurs,\tthe\tcircuit\tbreaker\tgets\tblown,\tprotecting\tyour\texpensive\nhome\tappliances.\tYou\tcan\talso\tmanually\tdisable\ta\tcircuit\tbreaker\tto\tcut\tthe\tpower\tto\tpart\nof\tyour\thome,\tallowing\tyou\tto\twork\tsafely\ton\tthe\telectrics.\tMichael\tNygard’s\tbook\n"),a("em",[t._v("Release\tIt!")]),t._v(" \t(Pragmatic\tProgrammers)\tshows\thow\tthe\tsame\tidea\tcan\twork\twonders\tas\ta\nprotection\tmechanism\tfor\tour\tsoftware.")]),t._v(" "),a("p",[t._v("Consider\tthe\tstory\tI\tshared\tjust\ta\tmoment\tago.\tThe\tdownstream\tlegacy\tad\tapplication\twas\nresponding\tvery\tslowly,\tbefore\teventually\treturning\tan\terror.\tEven\tif\twe’d\tgot\tthe\ntimeouts\tright,\twe’d\tbe\twaiting\ta\tlong\ttime\tbefore\twe\tgot\tthe\terror.\tAnd\tthen\twe’d\ttry\tit\nagain\tthe\tnext\ttime\ta\trequest\tcame\tin,\tand\twait.\tIt’s\tbad\tenough\tthat\tthe\tdownstream\nservice\tis\tmalfunctioning,\tbut\tit’s\tmaking\tus\tgo\tslow\ttoo.")]),t._v(" "),a("p",[t._v("With\ta\tcircuit\tbreaker,\tafter\ta\tcertain\tnumber\tof\trequests\tto\tthe\tdownstream\tresource\thave\nfailed,\tthe\tcircuit\tbreaker\tis\tblown.\tAll\tfurther\trequests\tfail\tfast\twhile\tthe\tcircuit\tbreaker\tis\nin\tits\tblown\tstate.\tAfter\ta\tcertain\tperiod\tof\ttime,\tthe\tclient\tsends\ta\tfew\trequests\tthrough\tto\nsee\tif\tthe\tdownstream\tservice\thas\trecovered,\tand\tif\tit\tgets\tenough\thealthy\tresponses\tit\nresets\tthe\tcircuit\tbreaker.\tYou\tcan\tsee\tan\toverview\tof\tthis\tprocess\tin\tFigure\t11-2.")]),t._v(" "),a("p",[t._v("How\tyou\timplement\ta\tcircuit\tbreaker\tdepends\ton\twhat\ta\t "),a("em",[t._v("failed")]),t._v(" \trequest\tmeans,\tbut\twhen\nI’ve\timplemented\tthem\tfor\tHTTP\tconnections\tI’ve\ttaken\tfailure\tto\tmean\teither\ta\ttimeout\nor\ta\t5XX\tHTTP\treturn\tcode.\tIn\tthis\tway,\twhen\ta\tdownstream\tresource\tis\tdown,\tor\ttiming\nout,\tor\treturning\terrors,\tafter\ta\tcertain\tthreshold\tis\treached\twe\tautomatically\tstop\tsending\ntraffic\tand\tstart\tfailing\tfast.\tAnd\twe\tcan\tautomatically\tstart\tagain\twhen\tthings\tare\thealthy.")]),t._v(" "),a("p",[t._v("Getting\tthe\tsettings\tright\tcan\tbe\ta\tlittle\ttricky.\tYou\tdon’t\twant\tto\tblow\tthe\tcircuit\tbreaker\ntoo\treadily,\tnor\tdo\tyou\twant\tto\ttake\ttoo\tlong\tto\tblow\tit.\tLikewise,\tyou\treally\twant\tto\tmake\nsure\tthat\tthe\tdownstream\tservice\tis\thealthy\tagain\tbefore\tsending\ttraffic.\tAs\twith\ttimeouts,\nI’d\tpick\tsome\tsensible\tdefaults\tand\tstick\twith\tthem\teverywhere,\tthen\tchange\tthem\tfor\nspecific\tcases.")]),t._v(" "),a("p",[t._v("While\tthe\tcircuit\tbreaker\tis\tblown,\tyou\thave\tsome\toptions.\tOne\tis\tto\tqueue\tup\tthe\trequests\nand\tretry\tthem\tlater\ton.\tFor\tsome\tuse\tcases,\tthis\tmight\tbe\tappropriate,\tespecially\tif\tyou’re\ncarrying\tout\tsome\twork\tas\tpart\tof\ta\tasynchronous\tjob.\tIf\tthis\tcall\tis\tbeing\tmade\tas\tpart\tof\na\tsynchronous\tcall\tchain,\thowever,\tit\tis\tprobably\tbetter\tto\tfail\tfast.\tThis\tcould\tmean\npropagating\tan\terror\tup\tthe\tcall\tchain,\tor\ta\tmore\tsubtle\tdegrading\tof\tfunctionality.")]),t._v(" "),a("p",[t._v("If\twe\thave\tthis\tmechanism\tin\tplace\t(as\twith\tthe\tcircuit\tbreakers\tin\tour\thome),\twe\tcould\nuse\tthem\tmanually\tto\tmake\tit\tsafer\tto\tdo\tour\twork.\tFor\texample,\tif\twe\twanted\tto\ttake\ta\nmicroservice\tdown\tas\tpart\tof\troutine\tmaintenance,\twe\tcould\tmanually\tblow\tall\tthe\tcircuit\nbreakers\tof\tthe\tdependent\tsystems\tso\tthey\tfail\tfast\twhile\tthe\tmicroservice\tis\toffline.\tOnce\nit’s\tback,\twe\tcan\treset\tthe\tcircuit\tbreakers\tand\teverything\tshould\tgo\tback\tto\tnormal.")]),t._v(" "),a("p",[a("em",[t._v("Figure\t11-2.\tAn\toverview\tof\tcircuit\tbreakers")])]),t._v(" "),a("h2",{attrs:{id:"bulkheads"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#bulkheads"}},[t._v("#")]),t._v(" Bulkheads")]),t._v(" "),a("p",[t._v("In\tanother\tpattern\tfrom\t "),a("em",[t._v("Release\tIt!")]),t._v(" ,\tNygard\tintroduces\tthe\tconcept\tof\ta\t "),a("em",[t._v("bulkhead")]),t._v(" \tas\ta\tway\nto\tisolate\tyourself\tfrom\tfailure.\tIn\tshipping,\ta\tbulkhead\tis\ta\tpart\tof\tthe\tship\tthat\tcan\tbe\nsealed\toff\tto\tprotect\tthe\trest\tof\tthe\tship.\tSo\tif\tthe\tship\tsprings\ta\tleak,\tyou\tcan\tclose\tthe\nbulkhead\tdoors.\tYou\tlose\tpart\tof\tthe\tship,\tbut\tthe\trest\tof\tit\tremains\tintact.")]),t._v(" "),a("p",[t._v("In\tsoftware\tarchitecture\tterms,\tthere\tare\tlots\tof\tdifferent\tbulkheads\twe\tcan\tconsider.\nReturning\tto\tmy\town\texperience,\twe\tactually\tmissed\tthe\tchance\tto\timplement\ta\tbulkhead.\nWe\tshould\thave\tused\tdifferent\tconnection\tpools\tfor\teach\tdownstream\tconnection.\tThat\nway,\tif\tone\tconnection\tpool\tgets\texhausted,\tthe\tother\tconnections\taren’t\timpacted,\tas\twe\nsee\tin\tFigure\t11-3.\tThis\twould\tensure\tthat\tif\ta\tdownstream\tservice\tstarted\tbehaving\nslowly\tin\tthe\tfuture,\tonly\tthat\tone\tconnection\tpool\twould\tbe\timpacted,\tallowing\tother\ncalls\tto\tproceed\tas\tnormal.")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("Figure\t11-3.\tUsing\ta\tconnection\tpool\tper\tdownstream\tservice\tto\tprovide\tbulkheads\n")])])]),a("p",[t._v("Separation\tof\tconcerns\tcan\talso\tbe\ta\tway\tto\timplement\tbulkheads.\tBy\tteasing\tapart\nfunctionality\tinto\tseparate\tmicroservices,\twe\treduce\tthe\tchance\tof\tan\toutage\tin\tone\tarea\naffecting\tanother.")]),t._v(" "),a("p",[t._v("Look\tat\tall\tthe\taspects\tof\tyour\tsystem\tthat\tcan\tgo\twrong,\tboth\tinside\tyour\tmicroservices\nand\tbetween\tthem.\tDo\tyou\thave\tbulkheads\tin\tplace?\tI’d\tsuggest\tstarting\twith\tseparate\nconnection\tpools\tfor\teach\tdownstream\tconnection\tat\tthe\tvery\tleast.\tYou\tmay\twant\tto\tgo\nfurther,\thowever,\tand\tconsider\tusing\tcircuit\tbreakers\ttoo.")]),t._v(" "),a("p",[t._v("We\tcan\tthink\tof\tour\tcircuit\tbreakers\tas\tan\tautomatic\tmechanism\tto\tseal\ta\tbulkhead,\tto\tnot\nonly\tprotect\tthe\tconsumer\tfrom\tthe\tdownstream\tproblem,\tbut\talso\tto\tpotentially\tprotect\nthe\tdownstream\tservice\tfrom\tmore\tcalls\tthat\tmay\tbe\thaving\tan\tadverse\timpact.\tGiven\tthe\nperils\tof\tcascading\tfailure,\tI’d\trecommend\tmandating\tcircuit\tbreakers\tfor\tall\tyour\nsynchronous\tdownstream\tcalls.\tYou\tdon’t\thave\tto\twrite\tyour\town,\teither.\tNetflix’s\tHystrix")]),t._v(" "),a("p",[t._v("library\tis\ta\tJVM\tcircuit\tbreaker\tabstraction\tthat\tcomes\twith\tsome\tpowerful\tmonitoring,\nbut\tother\timplementations\texist\tfor\tdifferent\ttechnology\tstacks,\tsuch\tas\tPolly\tfor\t.NET,\tor\nthe\tcircuit_breaker\tmixin\tfor\tRuby.")]),t._v(" "),a("p",[t._v("In\tmany\tways,\tbulkheads\tare\tthe\tmost\timportant\tof\tthese\tthree\tpatterns.\tTimeouts\tand\ncircuit\tbreakers\thelp\tyou\tfree\tup\tresources\twhen\tthey\tare\tbecoming\tconstrained,\tbut\nbulkheads\tcan\tensure\tthey\tdon’t\tbecome\tconstrained\tin\tthe\tfirst\tplace.\tHystrix\tallows\tyou,\nfor\texample,\tto\timplement\tbulkheads\tthat\tactually\treject\trequests\tin\tcertain\tconditions\tto\nensure\tthat\tresources\tdon’t\tbecome\teven\tmore\tsaturated;\tthis\tis\tknown\tas\t "),a("em",[t._v("load\tshedding")]),t._v(".\nSometimes\trejecting\ta\trequest\tis\tthe\tbest\tway\tto\tstop\tan\timportant\tsystem\tfrom\tbecoming\noverwhelmed\tand\tbeing\ta\tbottleneck\tfor\tmultiple\tupstream\tservices.")]),t._v(" "),a("h2",{attrs:{id:"isolation"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#isolation"}},[t._v("#")]),t._v(" Isolation")]),t._v(" "),a("p",[t._v("The\tmore\tone\tservice\tdepends\ton\tanother\tbeing\tup,\tthe\tmore\tthe\thealth\tof\tone\timpacts\tthe\nability\tof\tthe\tother\tto\tdo\tits\tjob.\tIf\twe\tcan\tuse\tintegration\ttechniques\tthat\tallow\ta\ndownstream\tserver\tto\tbe\toffline,\tupstream\tservices\tare\tless\tlikely\tto\tbe\taffected\tby\noutages,\tplanned\tor\tunplanned.")]),t._v(" "),a("p",[t._v("There\tis\tanother\tbenefit\tto\tincreasing\tisolation\tbetween\tservices.\tWhen\tservices\tare\nisolated\tfrom\teach\tother,\tmuch\tless\tcoordination\tis\tneeded\tbetween\tservice\towners.\tThe\nless\tcoordination\tneeded\tbetween\tteams,\tthe\tmore\tautonomy\tthose\tteams\thave,\tas\tthey\tare\nable\tto\toperate\tand\tevolve\ttheir\tservices\tmore\tfreely.")]),t._v(" "),a("h2",{attrs:{id:"idempotency"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#idempotency"}},[t._v("#")]),t._v(" Idempotency")]),t._v(" "),a("p",[t._v("In\t "),a("em",[t._v("idempotent")]),t._v(" \toperations,\tthe\toutcome\tdoesn’t\tchange\tafter\tthe\tfirst\tapplication,\teven\tif\nthe\toperation\tis\tsubsequently\tapplied\tmultiple\ttimes.\tIf\toperations\tare\tidempotent,\twe\tcan\nrepeat\tthe\tcall\tmultiple\ttimes\twithout\tadverse\timpact.\tThis\tis\tvery\tuseful\twhen\twe\twant\tto\nreplay\tmessages\tthat\twe\taren’t\tsure\thave\tbeen\tprocessed,\ta\tcommon\tway\tof\trecovering\nfrom\terror.")]),t._v(" "),a("p",[t._v("Let’s\tconsider\ta\tsimple\tcall\tto\tadd\tsome\tpoints\tas\ta\tresult\tof\tone\tof\tour\tcustomers\tplacing\nan\torder.\tWe\tmight\tmake\ta\tcall\twith\tthe\tsort\tof\tpayload\tshown\tin\tExample\t11-1.")]),t._v(" "),a("p",[a("em",[t._v("Example\t11-1.\tCrediting\tpoints\tto\tan\taccount")]),t._v(" "),a("strong",[a("credit",[a("amount")],1)],1),t._v(" 100 "),a("strong",[a("forAccount")],1),t._v(" 1234 "),a("strong")]),t._v(" "),a("p",[t._v("If\tthis\tcall\tis\treceived\tmultiple\ttimes,\twe\twould\tadd\t100\tpoints\tmultiple\ttimes.\tAs\tit\nstands,\ttherefore,\tthis\tcall\tis\tnot\tidempotent.\tWith\ta\tbit\tmore\tinformation,\tthough,\twe\nallow\tthe\tpoints\tbank\tto\tmake\tthis\tcall\tidempotent,\tas\tshown\tin\tExample\t11-2.")]),t._v(" "),a("p",[a("em",[t._v("Example\t11-2.\tAdding\tmore\tinformation\tto\tthe\tpoints\tcredit\tto\tmake\tit\tidempotent")]),t._v(" "),a("strong",[a("credit",[a("amount")],1)],1),t._v(" 100 "),a("strong",[a("forAccount")],1),t._v(" 1234 "),a("strong",[a("reason",[a("forPurchase")],1)],1),t._v(" 4567 "),a("strong")]),t._v(" "),a("p",[t._v("Now\twe\tknow\tthat\tthis\tcredit\trelates\tto\ta\tspecific\torder,\t 4567 .\tAssuming\tthat\twe\tcould\nreceive\tonly\tone\tcredit\tfor\ta\tgiven\torder,\twe\tcould\tapply\tthis\tcredit\tagain\twithout\nincreasing\tthe\toverall\tnumber\tof\tpoints.")]),t._v(" "),a("p",[t._v("This\tmechanism\tworks\tjust\tas\twell\twith\tevent-based\tcollaboration,\tand\tcan\tbe\tespecially\nuseful\tif\tyou\thave\tmultiple\tinstances\tof\tthe\tsame\ttype\tof\tservice\tsubscribing\tto\tevents.\nEven\tif\twe\tstore\twhich\tevents\thave\tbeen\tprocessed,\twith\tsome\tforms\tof\tasynchronous\nmessage\tdelivery\tthere\tmay\tbe\tsmall\twindows\twhere\ttwo\tworkers\tcan\tsee\tthe\tsame\nmessage.\tBy\tprocessing\tthe\tevents\tin\tan\tidempotent\tmanner,\twe\tensure\tthis\twon’t\tcause\nus\tany\tissues.")]),t._v(" "),a("p",[t._v("Some\tpeople\tget\tquite\tcaught\tup\twith\tthis\tconcept,\tand\tassume\tit\tmeans\tthat\tsubsequent\ncalls\twith\tthe\tsame\tparameters\tcan’t\thave\t "),a("em",[t._v("any")]),t._v(" \timpact,\twhich\tthen\tleaves\tus\tin\tan\ninteresting\tposition.\tWe\treally\twould\tstill\tlike\tto\trecord\tthe\tfact\tthat\ta\tcall\twas\treceived\tin\nour\tlogs,\tfor\texample.\tWe\twant\tto\trecord\tthe\tresponse\ttime\tof\tthe\tcall\tand\tcollect\tthis\tdata\nfor\tmonitoring.\tThe\tkey\tpoint\there\tis\tthat\tit\tis\tthe\tunderlying\tbusiness\toperation\tthat\twe\nare\tconsidering\tidempotent,\tnot\tthe\tentire\tstate\tof\tthe\tsystem.")]),t._v(" "),a("p",[t._v("Some\tof\tthe\tHTTP\tverbs,\tsuch\tas\tGET\tand\tPUT,\tare\tdefined\tin\tthe\tHTTP\tspecification\tto\nbe\tidempotent,\tbut\tfor\tthat\tto\tbe\tthe\tcase,\tthey\trely\ton\tyour\tservice\thandling\tthese\tcalls\tin")]),t._v(" "),a("p",[t._v("an\tidempotent\tmanner.\tIf\tyou\tstart\tmaking\tthese\tverbs\tnonidempotent,\tbut\tcallers\tthink\nthey\tcan\tsafely\texecute\tthem\trepeatedly,\tyou\tmay\tget\tyourself\tinto\ta\tmess.\tRemember,\njust\tbecause\tyou’re\tusing\tHTTP\tas\tan\tunderlying\tprotocol\tdoesn’t\tmean\tyou\tget\neverything\tfor\tfree!")]),t._v(" "),a("h2",{attrs:{id:"scaling-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#scaling-2"}},[t._v("#")]),t._v(" Scaling")]),t._v(" "),a("p",[t._v("We\tscale\tour\tsystems\tin\tgeneral\tfor\tone\tof\ttwo\treasons.\tFirst,\tto\thelp\tdeal\twith\tfailure:\tif\nwe’re\tworried\tthat\tsomething\twill\tfail,\tthen\thaving\tmore\tof\tit\twill\thelp,\tright?\tSecond,\twe\nscale\tfor\tperformance,\teither\tin\tterms\tof\thandling\tmore\tload,\treducing\tlatency,\tor\tboth.\nLet’s\tlook\tat\tsome\tcommon\tscaling\ttechniques\twe\tcan\tuse\tand\tthink\tabout\thow\tthey\tapply\nto\tmicroservice\tarchitectures.")]),t._v(" "),a("h2",{attrs:{id:"gobigger"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#gobigger"}},[t._v("#")]),t._v(" Go\tBigger")]),t._v(" "),a("p",[t._v("Some\toperations\tcan\tjust\tbenefit\tfrom\tmore\tgrunt.\tGetting\ta\tbigger\tbox\twith\tfaster\tCPU\nand\tbetter\tI/O\tcan\toften\timprove\tlatency\tand\tthroughput,\tallowing\tyou\tto\tprocess\tmore\nwork\tin\tless\ttime.\tHowever,\tthis\tform\tof\tscaling,\toften\tcalled\t "),a("em",[t._v("vertical\tscaling")]),t._v(" ,\tcan\tbe\nexpensive\t—\tsometimes\tone\tbig\tserver\tcan\tcost\tmore\tthan\ttwo\tsmaller\tservers\twith\tthe\nsame\tcombined\traw\tpower,\tespecially\twhen\tyou\tstart\tgetting\tto\treally\tbig\tmachines.\nSometimes\tour\tsoftware\titself\tcannot\tdo\tmuch\twith\tthe\textra\tresources\tavailable\tto\tit.\nLarger\tmachines\toften\tjust\tgive\tus\tmore\tCPU\tcores,\tbut\tnot\tenough\tof\tour\tsoftware\tis\nwritten\tto\ttake\tadvantage\tof\tthem.\tThe\tother\tproblem\tis\tthat\tthis\tform\tof\tscaling\tmay\tnot\ndo\tmuch\tto\timprove\tour\tserver’s\tresiliency\tif\twe\tonly\thave\tone\tof\tthem!\tNonetheless,\tthis\ncan\tbe\ta\tgood\tquick\twin,\tespecially\tif\tyou’re\tusing\ta\tvirtualization\tprovider\tthat\tlets\tyou\nresize\tmachines\teasily.")]),t._v(" "),a("h2",{attrs:{id:"splittingworkloads"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#splittingworkloads"}},[t._v("#")]),t._v(" Splitting\tWorkloads")]),t._v(" "),a("p",[t._v("As\toutlined\tin\tChapter\t6,\thaving\ta\tsingle\tmicroservice\tper\thost\tis\tcertainly\tpreferable\tto\ta\nmultiservice-per-host\tmodel.\tInitially,\thowever,\tmany\tpeople\tdecide\tto\tcoexist\tmultiple\nmicroservices\ton\tone\tbox\tto\tkeep\tcosts\tdown\tor\tto\tsimplify\thost\tmanagement\t(although\nthat\tis\tan\targuable\treason).\tAs\tthe\tmicroservices\tare\tindependent\tprocesses\tthat\ncommunicate\tover\tthe\tnetwork,\tit\tshould\tbe\tan\teasy\ttask\tto\tthen\tmove\tthem\tonto\ttheir\nown\thosts\tto\timprove\tthroughput\tand\tscaling.\tThis\tcan\talso\tincrease\tthe\tresiliency\tof\tthe\nsystem,\tas\ta\tsingle\thost\toutage\twill\timpact\ta\treduced\tnumber\tof\tmicroservices.")]),t._v(" "),a("p",[t._v("Of\tcourse,\twe\tcould\talso\tuse\tthe\tneed\tfor\tincreased\tscale\tto\tsplit\tan\texisting\tmicroservice\ninto\tparts\tto\tbetter\thandle\tthe\tload.\tAs\ta\tsimplistic\texample,\tlet’s\timagine\tthat\tour\naccounts\tservice\tprovides\tthe\tability\tto\tcreate\tand\tmanage\tindividual\tcustomers’\tfinancial\naccounts,\tbut\talso\texposes\tan\tAPI\tfor\trunning\tqueries\tto\tgenerate\treports.\tThis\tquery\ncapability\tplaces\ta\tsignificant\tload\ton\tthe\tsystem.\tThe\tquery\tcapacity\tis\tconsidered\nnoncritical,\tas\tit\tisn’t\tneeded\tto\tkeep\torders\tflowing\tin\tduring\tthe\tday.\tThe\tability\tto\nmanage\tthe\tfinancial\trecords\tfor\tour\tcustomers\t "),a("em",[t._v("is")]),t._v(" \tcritical,\tthough,\tand\twe\tcan’t\tafford\tfor\nit\tto\tbe\tdown.\tBy\tsplitting\tthese\ttwo\tcapabilities\tinto\tseparate\tservices,\twe\treduce\tthe\tload\non\tthe\tcritical\taccounts\tservice,\tand\tintroduce\ta\tnew\taccounts\treporting\tservice\tthat\tis\ndesigned\tnot\tonly\twith\tquerying\tin\tmind\t(perhaps\tusing\tsome\tof\tthe\ttechniques\twe\noutlined\tin\tChapter\t4,\tbut\talso\tas\ta\tnoncritical\tsystem\tdoesn’t\tneed\tto\tbe\tdeployed\tin\tas\nresilient\ta\tway\tas\tthe\tcore\taccounts\tservice.")]),t._v(" "),a("h2",{attrs:{id:"spreadingyourrisk"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#spreadingyourrisk"}},[t._v("#")]),t._v(" Spreading\tYour\tRisk")]),t._v(" "),a("p",[t._v("One\tway\tto\tscale\tfor\tresilience\tis\tto\tensure\tthat\tyou\tdon’t\tput\tall\tyour\teggs\tin\tone\tbasket.\nA\tsimplistic\texample\tof\tthis\tis\tmaking\tsure\tthat\tyou\tdon’t\thave\tmultiple\tservices\ton\tone\nhost,\twhere\tan\toutage\twould\timpact\tmultiple\tservices.\tBut\tlet’s\tconsider\twhat\t "),a("em",[t._v("host")]),t._v(" \tmeans.\nIn\tmost\tsituations\tnowadays,\ta\t "),a("em",[t._v("host")]),t._v(" \tis\tactually\ta\tvirtual\tconcept.\tSo\twhat\tif\tI\thave\tall\tof\nmy\tservices\ton\tdifferent\thosts,\tbut\tall\tthose\thosts\tare\tactually\tvirtual\thosts,\trunning\ton\tthe\nsame\tphysical\tbox?\tIf\tthat\tbox\tgoes\tdown,\tI\tcould\tlose\tmultiple\tservices.\tSome\nvirtualization\tplatforms\tenable\tyou\tto\tensure\tthat\tyour\thosts\tare\tdistributed\tacross\nmultiple\tdifferent\tphysical\tboxes\tto\treduce\tthis\tchance.")]),t._v(" "),a("p",[t._v("For\tinternal\tvirtualization\tplatforms,\tit\tis\ta\tcommon\tpractice\tto\thave\tthe\tvirtual\tmachine’s\nroot\tpartition\tmapped\tto\ta\tsingle\tSAN\t(storage\tarea\tnetwork).\tIf\tthat\tSAN\tgoes\tdown,\tit\ncan\ttake\tdown\tall\tconnected\tVMs.\tSANs\tare\tbig,\texpensive,\tand\tdesigned\tnot\tto\tfail.\tThat\nsaid,\tI\thave\thad\tbig\texpensive\tSANs\tfail\ton\tme\tat\tleast\ttwice\tin\tthe\tlast\t10\tyears,\tand\teach\ntime\tthe\tresults\twere\tfairly\tserious.")]),t._v(" "),a("p",[t._v("Another\tcommon\tform\tof\tseparation\tto\treduce\tfailure\tis\tto\tensure\tthat\tnot\tall\tyour\tservices\nare\trunning\tin\ta\tsingle\track\tin\tthe\tdata\tcenter,\tor\tthat\tyour\tservices\tare\tdistributed\tacross\nmore\tthan\tone\tdata\tcenter.\tIf\tyou’re\tusing\tan\tunderlying\tservice\tprovider,\tit\tis\timportant\tto\nknow\tif\ta\tservice-level\tagreement\t(SLA)\tis\toffered\tand\tplan\taccordingly.\tIf\tyou\tneed\tto\nensure\tyour\tservices\tare\tdown\tfor\tno\tmore\tthan\tfour\thours\tevery\tquarter,\tbut\tyour\thosting\nprovider\tcan\tonly\tguarantee\ta\tdowntime\tof\teight\thours\tper\tquarter,\tyou\thave\tto\teither\nchange\tthe\tSLA,\tor\tcome\tup\twith\tan\talternative\tsolution.")]),t._v(" "),a("p",[t._v("AWS,\tfor\texample,\tis\tsplit\tinto\tregions,\twhich\tyou\tcan\tthink\tof\tas\tdistinct\tclouds.\tEach\nregion\tis\tin\tturn\tsplit\tinto\ttwo\tor\tmore\tavailability\tzones\t(AZs).\tAZs\tare\tAWS’s\tequivalent\nof\ta\tdata\tcenter.\tIt\tis\tessential\tto\thave\tservices\tdistributed\tacross\tmultiple\tavailability\nzones,\tas\tAWS\tdoes\tnot\toffer\tany\tguarantees\tabout\tthe\tavailability\tof\ta\tsingle\tnode,\tor\neven\tan\tentire\tavailability\tzone.\tFor\tits\tcompute\tservice,\tit\toffers\tonly\ta\t99.95%\tuptime\nover\ta\tgiven\tmonthly\tperiod\tof\tthe\tregion\tas\ta\twhole,\tso\tyou’ll\twant\tto\tdistribute\tyour\nworkloads\tacross\tmultiple\tavailability\tzones\tinside\ta\tsingle\tregion.\tFor\tsome\tpeople,\tthis\nisn’t\tgood\tenough,\tand\tinstead\tthey\trun\ttheir\tservices\tacross\tmultiple\tregions\ttoo.")]),t._v(" "),a("p",[t._v("It\tshould\tbe\tnoted,\tof\tcourse,\tthat\tbecause\tproviders\tgive\tyou\tan\tSLA\t "),a("em",[t._v("guarantee")]),t._v(" ,\tthey\twill\ntend\tto\tlimit\ttheir\tliability!\tIf\tthem\tmissing\ttheir\ttargets\tcosts\tyou\tcustomers\tand\ta\tlarge\namount\tof\tmoney,\tyou\tmight\tfind\tyourself\tsearching\tthrough\tcontracts\tto\tsee\tif\tyou\tcan\nclaw\tanything\tback\tfrom\tthem.\tTherefore,\tI\twould\tstrongly\tsuggest\tyou\tunderstand\tthe\nimpact\tof\ta\tsupplier\tfailing\tin\tits\tobligations\tto\tyou,\tand\twork\tout\tif\tyou\tneed\tto\thave\ta\nplan\tB\t(or\tC)\tin\tyour\tpocket.\tMore\tthan\tone\tclient\tI’ve\tworked\twith\thas\thad\ta\tdisaster\nrecovery\thosting\tplatform\twith\ta\tdifferent\tsupplier,\tfor\texample,\tto\tensure\tthey\tweren’t\ntoo\tvulnerable\tto\tthe\tmistakes\tof\tone\tcompany.")]),t._v(" "),a("h2",{attrs:{id:"loadbalancing"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#loadbalancing"}},[t._v("#")]),t._v(" Load\tBalancing")]),t._v(" "),a("p",[t._v("When\tyou\tneed\tyour\tservice\tto\tbe\tresilient,\tyou\twant\tto\tavoid\tsingle\tpoints\tof\tfailure.\tFor\na\ttypical\tmicroservice\tthat\texposes\ta\tsynchronous\tHTTP\tendpoint,\tthe\teasiest\tway\tto\nachieve\tthis\tis\tto\thave\tmultiple\thosts\trunning\tyour\tmicroservice\tinstance,\tsitting\tbehind\ta\nload\tbalancer,\tas\tshown\tin\tFigure\t11-4.\tTo\tconsumers\tof\tthe\tmicroservice,\tyou\tdon’t\tknow\nif\tyou\tare\ttalking\tto\tone\tmicroservice\tinstance\tor\ta\thundred.")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("Figure\t11-4.\tAn\texample\tof\ta\tload\tbalancing\tapproach\tto\tscale\tthe\tnumber\tof\tcustomer\tservice\tinstances\n")])])]),a("p",[t._v("Load\tbalancers\tcome\tin\tall\tshapes\tand\tsizes,\tfrom\tbig\tand\texpensive\thardware\tappliances\nto\tsoftware-based\tload\tbalancers\tlike\tmod_proxy.\tThey\tall\tshare\tsome\tkey\tcapabilities.\nThey\tdistribute\tcalls\tsent\tto\tthem\tto\tone\tor\tmore\tinstances\tbased\ton\tsome\talgorithm,\nremove\tinstances\twhen\tthey\tare\tno\tlonger\thealthy,\tand\thopefully\tadd\tthem\tback\tin\twhen\nthey\tare.")]),t._v(" "),a("p",[t._v("Some\tload\tbalancers\tprovide\tuseful\tfeatures.\tA\tcommon\tone\tis\t "),a("em",[t._v("SSL\ttermination")]),t._v(" ,\twhere\ninbound\tHTTPS\tconnections\tto\tthe\tload\tbalancer\tare\ttransformed\tto\tHTTP\tconnections\nonce\tthey\thit\tthe\tinstance\titself.\tHistorically,\tthe\toverhead\tof\tmanaging\tSSL\twas\nsignificant\tenough\tthat\thaving\ta\tload\tbalancer\thandle\tthis\tprocess\tfor\tyou\twas\tfairly\nuseful.\tNowadays,\tthis\tis\tas\tmuch\tabout\tsimplifying\tthe\tset-up\tof\tthe\tindividual\thosts\nrunning\tthe\tinstance.\tThe\tpoint\tof\tusing\tHTTPS,\tthough,\tis\tto\tensure\tthat\tthe\trequests\naren’t\tvulnerable\tto\ta\tman-in-the-middle\tattack,\tas\twe\tdiscussed\tin\tChapter\t9,\tso\tif\twe\tuse\nSSL\ttermination,\twe\tare\tpotentially\texposing\tourselves\tsomewhat.\tOne\tmitigation\tis\tto\nhave\tall\tthe\tinstances\tof\tthe\tmicroservice\tinside\ta\tsingle\tVLAN,\tas\twe\tsee\tin\tFigure\t11-5.\nA\tVLAN\tis\ta\tvirtual\tlocal\tarea\tnetwork,\tthat\tis\tisolated\tin\tsuch\ta\tway\tthat\trequests\tfrom\noutside\tit\tcan\tcome\tonly\tvia\ta\trouter,\tand\tin\tthis\tcase\tour\trouter\tis\talso\tour\tSSL-\nterminating\tload\tbalancer.\tThe\tonly\tcommunication\tto\tthe\tmicroservice\tfrom\toutside\tthe\nVLAN\tcomes\tover\tHTTPS,\tbut\tinternally\teverything\tis\tHTTP.")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("Figure\t11-5.\tUsing\tHTTPS\ttermination\tat\tthe\tload\tbalancer\twith\ta\tVLAN\tfor\timproved\tsecurity\n")])])]),a("p",[t._v("AWS\tprovides\tHTTPS-terminating\tload\tbalancers\tin\tthe\tform\tof\tELBs\t(elastic\tload\nbalancers)\tand\tyou\tcan\tuse\tits\tsecurity\tgroups\tor\tvirtual\tprivate\tclouds\t(VPCs)\tto\nimplement\tthe\tVLAN.\tOtherwise,\tsoftware\tlike\tmod_proxy\tcan\tplay\ta\tsimilar\trole\tas\ta\nsoftware\tload\tbalancer.\tMany\torganizations\thave\thardware\tload\tbalancers,\twhich\tcan\tbe\ndifficult\tto\tautomate.\tIn\tsuch\tcircumstances\tI\thave\tfound\tmyself\tadvocating\tfor\tsoftware\nload\tbalancers\tsitting\t "),a("em",[t._v("behind")]),t._v(" \tthe\thardware\tload\tbalancers\tto\tallow\tteams\tthe\tfreedom\tto\nreconfigure\tthese\tas\trequired.\tYou\tdo\twant\tto\twatch\tfor\tthe\tfact\tthat\tall\ttoo\toften\tthe\nhardware\tload\tbalancers\tthemselves\tare\tsingle\tpoints\tof\tfailure!\tWhatever\tapproach\tyou\ntake,\twhen\tconsidering\tthe\tconfiguration\tof\ta\tload\tbalancer,\ttreat\tit\tas\tyou\ttreat\tthe\nconfiguration\tof\tyour\tservice:\tmake\tsure\tit\tis\tstored\tin\tversion\tcontrol\tand\tcan\tbe\tapplied\nautomatically.")]),t._v(" "),a("p",[t._v("Load\tbalancers\tallow\tus\tto\tadd\tmore\tinstances\tof\tour\tmicroservice\tin\ta\tway\tthat\tis\ntransparent\tto\tany\tservice\tconsumers.\tThis\tgives\tus\tan\tincreased\tability\tto\thandle\tload,\nand\talso\treduce\tthe\timpact\tof\ta\tsingle\thost\tfailing.\tHowever,\tmany,\tif\tnot\tmost,\tof\tyour\nmicroservices\twill\thave\tsome\tsort\tof\tpersistent\tdata\tstore,\tprobably\ta\tdatabase\tsitting\ton\ta\ndifferent\tmachine.\tIf\twe\thave\tmultiple\tmicroservice\tinstances\ton\tdifferent\tmachines,\tbut\nonly\ta\tsingle\thost\trunning\tthe\tdatabase\tinstance,\tour\tdatabase\tis\tstill\ta\tsingle\tsource\tof\nfailure.\tWe’ll\ttalk\tabout\tpatterns\tto\thandle\tthis\tshortly.")]),t._v(" "),a("h2",{attrs:{id:"worker-basedsystems"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#worker-basedsystems"}},[t._v("#")]),t._v(" Worker-Based\tSystems")]),t._v(" "),a("p",[t._v("Load\tbalancing\tisn’t\tthe\tonly\tway\tto\thave\tmultiple\tinstances\tof\tyour\tservice\tshare\tload\nand\treduce\tfragility.\tDepending\ton\tthe\tnature\tof\tthe\toperations,\ta\tworker-based\tsystem\ncould\tbe\tjust\tas\teffective.\tHere,\ta\tcollection\tof\tinstances\tall\twork\ton\tsome\tshared\tbacklog\nof\twork.\tThis\tcould\tbe\ta\tnumber\tof\tHadoop\tprocesses,\tor\tperhaps\ta\tnumber\tof\tlisteners\tto\na\tshared\tqueue\tof\twork.\tThese\ttypes\tof\toperations\tare\twell\tsuited\tto\tbatch\twork\tor\nasynchronous\tjobs.\tThink\tof\ttasks\tlike\timage\tthumbnail\tprocessing,\tsending\temail,\tor\ngenerating\treports.")]),t._v(" "),a("p",[t._v("The\tmodel\talso\tworks\twell\tfor\t "),a("em",[t._v("peaky")]),t._v(" \tload,\twhere\tyou\tcan\tspin\tup\tadditional\tinstances\ton\ndemand\tto\tmatch\tthe\tload\tcoming\tin.\tAs\tlong\tas\tthe\twork\tqueue\titself\tis\tresilient,\tthis\nmodel\tcan\tbe\tused\tto\tscale\tboth\tfor\timproved\tthroughput\tof\twork,\tbut\talso\tfor\timproved\nresiliency\t—\tthe\timpact\tof\ta\tworker\tfailing\t(or\tnot\tbeing\tthere)\tis\teasy\tto\tdeal\twith.\tWork\nwill\ttake\tlonger,\tbut\tnothing\tgets\tlost.")]),t._v(" "),a("p",[t._v("I’ve\tseen\tthis\twork\twell\tin\torganizations\twhere\tthere\tis\tlots\tof\tunused\tcompute\tcapacity\tat\ncertain\ttimes\tof\tday.\tFor\texample,\tovernight\tyou\tmight\tnot\tneed\tas\tmany\tmachines\tto\trun\nyour\tecommerce\tsystem,\tso\tyou\tcan\ttemporarily\tuse\tthem\tto\trun\tworkers\tfor\ta\treporting\njob\tinstead.")]),t._v(" "),a("p",[t._v("With\tworker-based\tsystems,\talthough\tthe\tworkers\tthemselves\tdon’t\tneed\tto\tbe\tthat\nreliable,\tthe\tsystem\tthat\tcontains\tthe\twork\tto\tbe\tdone\tdoes.\tYou\tcould\thandle\tthis\tby\nrunning\ta\tpersistent\tmessage\tbroker,\tfor\texample,\tor\tperhaps\ta\tsystem\tlike\tZookeeper.\tThe\nbenefit\there\tis\tthat\tif\twe\tuse\texisting\tsoftware\tfor\tthis\tpurpose,\tsomeone\thas\tdone\tmuch\tof\nthe\thard\twork\tfor\tus.\tHowever,\twe\tstill\tneed\tto\tknow\thow\tto\tset\tup\tand\tmaintain\tthese\nsystems\tin\ta\tresilient\tfashion.")]),t._v(" "),a("h2",{attrs:{id:"startingagain"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#startingagain"}},[t._v("#")]),t._v(" Starting\tAgain")]),t._v(" "),a("p",[t._v("The\tarchitecture\tthat\tgets\tyou\tstarted\tmay\tnot\tbe\tthe\tarchitecture\tthat\tkeeps\tyou\tgoing\nwhen\tyour\tsystem\thas\tto\thandle\tvery\tdifferent\tvolumes\tof\tload.\tAs\tJeff\tDean\tsaid\tin\this\npresentation\t“Challenges\tin\tBuilding\tLarge-Scale\tInformation\tRetrieval\tSystems”\n(WSDM\t2009\tconference),\tyou\tshould\t“design\tfor\t~10×\tgrowth,\tbut\tplan\tto\trewrite\nbefore\t~100×.”\tAt\tcertain\tpoints,\tyou\tneed\tto\tdo\tsomething\tpretty\tradical\tto\tsupport\tthe\nnext\tlevel\tof\tgrowth.")]),t._v(" "),a("p",[t._v("Recall\tthe\tstory\tof\tGilt,\twhich\twe\ttouched\ton\tin\tChapter\t6.\tA\tsimple\tmonolithic\tRails\napplication\tdid\twell\tfor\tGilt\tfor\ttwo\tyears.\tIts\tbusiness\tbecame\tincreasingly\tsuccessful,\nwhich\tmeant\tmore\tcustomers\tand\tmore\tload.\tAt\ta\tcertain\ttipping\tpoint,\tthe\tcompany\thad\nto\tredesign\tthe\tapplication\tto\thandle\tthe\tload\tit\twas\tseeing.")]),t._v(" "),a("p",[t._v("A\tredesign\tmay\tmean\tsplitting\tapart\tan\texisting\tmonolith,\tas\tit\tdid\tfor\tGilt.\tOr\tit\tmight\nmean\tpicking\tnew\tdata\tstores\tthat\tcan\thandle\tthe\tload\tbetter,\twhich\twe’ll\tlook\tat\tin\ta\nmoment.\tIt\tcould\talso\tmean\tadopting\tnew\ttechniques,\tsuch\tas\tmoving\tfrom\tsynchronous\nrequest/response\tto\tevent-based\tsystems,\tadopting\tnew\tdeployment\tplatforms,\tchanging\nwhole\ttechnology\tstacks,\tor\teverything\tin\tbetween.")]),t._v(" "),a("p",[t._v("There\tis\ta\tdanger\tthat\tpeople\twill\tsee\tthe\tneed\tto\trearchitect\twhen\tcertain\tscaling\nthresholds\tare\treached\tas\ta\treason\tto\tbuild\tfor\tmassive\tscale\tfrom\tthe\tbeginning.\tThis\tcan\nbe\tdisastrous.\tAt\tthe\tstart\tof\ta\tnew\tproject,\twe\toften\tdon’t\tknow\texactly\twhat\twe\twant\tto\nbuild,\tnor\tdo\twe\tknow\tif\tit\twill\tbe\tsuccessful.\tWe\tneed\tto\tbe\table\tto\trapidly\texperiment,\nand\tunderstand\twhat\tcapabilities\twe\tneed\tto\tbuild.\tIf\twe\ttried\tbuilding\tfor\tmassive\tscale\nup\tfront,\twe’d\tend\tup\tfront-loading\ta\thuge\tamount\tof\twork\tto\tprepare\tfor\tload\tthat\tmay\nnever\tcome,\twhile\tdiverting\teffort\taway\tfrom\tmore\timportant\tactivities,\tlike\nunderstanding\tif\tanyone\twill\twant\tto\tactually\tuse\tour\tproduct.\tEric\tRies\ttells\tthe\tstory\tof\nspending\tsix\tmonths\tbuilding\ta\tproduct\tthat\tno\tone\tever\tdownloaded.\tHe\treflected\tthat\the\ncould\thave\tput\tup\ta\tlink\ton\ta\tweb\tpage\tthat\t404’d\twhen\tpeople\tclicked\ton\tit\tto\tsee\tif\tthere\nwas\tany\tdemand,\tspent\tsix\tmonths\ton\tthe\tbeach\tinstead,\tand\tlearned\tjust\tas\tmuch!")]),t._v(" "),a("p",[t._v("The\tneed\tto\tchange\tour\tsystems\tto\tdeal\twith\tscale\tisn’t\ta\tsign\tof\tfailure.\tIt\tis\ta\tsign\tof\nsuccess.")]),t._v(" "),a("h2",{attrs:{id:"scalingdatabases"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#scalingdatabases"}},[t._v("#")]),t._v(" Scaling\tDatabases")]),t._v(" "),a("p",[t._v("Scaling\tstateless\tmicroservices\tis\tfairly\tstraightforward.\tBut\twhat\tif\twe\tare\tstoring\tdata\tin\na\tdatabase?\tWe’ll\tneed\tto\tknow\thow\tto\tscale\tthat\ttoo.\tDifferent\ttypes\tof\tdatabases\tprovide\ndifferent\tforms\tof\tscaling,\tand\tunderstanding\twhat\tform\tsuits\tyour\tuse\tcase\tbest\twill\nensure\tyou\tselect\tthe\tright\tdatabase\ttechnology\tfrom\tthe\tbeginning.")]),t._v(" "),a("h2",{attrs:{id:"availabilityofserviceversusdurabilityofdata"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#availabilityofserviceversusdurabilityofdata"}},[t._v("#")]),t._v(" Availability\tof\tService\tVersus\tDurability\tof\tData")]),t._v(" "),a("p",[t._v("Straight\toff,\tit\tis\timportant\tto\tseparate\tthe\tconcept\tof\tavailability\tof\tthe\tservice\tfrom\tthe\ndurability\tof\tthe\tdata\titself.\tYou\tneed\tto\tunderstand\tthat\tthese\tare\ttwo\tdifferent\tthings,\tand\nas\tsuch\tthey\twill\thave\tdifferent\tsolutions.")]),t._v(" "),a("p",[t._v("For\texample,\tI\tcould\tstore\ta\tcopy\tof\tall\tdata\twritten\tto\tmy\tdatabase\tin\ta\tresilient\nfilesystem.\tIf\tthe\tdatabase\tgoes\tdown,\tmy\tdata\tisn’t\tlost,\tas\tI\thave\ta\tcopy,\tbut\tthe\tdatabase\nitself\tisn’t\tavailable,\twhich\tmay\tmake\tmy\tmicroservice\tunavailable\ttoo.\tA\tmore\tcommon\nmodel\twould\tbe\tusing\ta\tstandby.\tAll\tdata\twritten\tto\tthe\tprimary\tdatabase\tgets\tcopied\tto\nthe\tstandby\treplica\tdatabase.\tIf\tthe\tprimary\tgoes\tdown,\tmy\tdata\tis\tsafe,\tbut\twithout\ta\nmechanism\tto\teither\tbring\tit\tback\tup\tor\tpromote\tthe\treplica\tto\tthe\tprimary,\twe\tdon’t\thave\nan\tavailable\tdatabase,\teven\tthough\tour\tdata\tis\tsafe.")]),t._v(" "),a("h2",{attrs:{id:"scalingforreads"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#scalingforreads"}},[t._v("#")]),t._v(" Scaling\tfor\tReads")]),t._v(" "),a("p",[t._v("Many\tservices\tare\tread-mostly.\tThink\tof\ta\tcatalog\tservice\tthat\tstores\tinformation\tfor\tthe\nitems\twe\thave\tfor\tsale.\tWe\tadd\trecords\tfor\tnew\titems\ton\ta\tfairly\tirregular\tbasis,\tand\tit\nwouldn’t\tat\tall\tbe\tsurprising\tif\twe\tget\tmore\tthan\t100\treads\tof\tour\tcatalog’s\tdata\tfor\tevery\nwrite.\tHappily,\tscaling\tfor\treads\tis\tmuch\teasier\tthan\tscaling\tfor\twrites.\tCaching\tof\tdata\ncan\tplay\ta\tlarge\tpart\there,\tand\twe’ll\tdiscuss\tthat\tin\tmore\tdepth\tshortly.\tAnother\tmodel\tis\nto\tmake\tuse\tof\t "),a("em",[t._v("read\treplicas")]),t._v(".")]),t._v(" "),a("p",[t._v("In\ta\trelational\tdatabase\tmanagement\tsystem\t(RDBMS)\tlike\tMySQL\tor\tPostgres,\tdata\tcan\nbe\tcopied\tfrom\ta\tprimary\tnode\tto\tone\tor\tmore\treplicas.\tThis\tis\toften\tdone\tto\tensure\tthat\ta\ncopy\tof\tour\tdata\tis\tkept\tsafe,\tbut\twe\tcan\talso\tuse\tit\tto\tdistribute\tour\treads.\tA\tservice\tcould\ndirect\tall\twrites\tto\tthe\tsingle\tprimary\tnode,\tbut\tdistribute\treads\tto\tone\tor\tmore\tread\nreplicas,\tas\twe\tsee\tin\tFigure\t11-6.\tThe\treplication\tfrom\tthe\tprimary\tdatabase\tto\tthe\nreplicas\thappens\tat\tsome\tpoint\tafter\tthe\twrite.\tThis\tmeans\tthat\twith\tthis\ttechnique\treads\nmay\tsometimes\tsee\t "),a("em",[t._v("stale")]),t._v(" \tdata\tuntil\tthe\treplication\thas\tcompleted.\tEventually\tthe\treads\nwill\tsee\tthe\tconsistent\tdata.\tSuch\ta\tsetup\tis\tcalled\t "),a("em",[t._v("eventually\tconsistent")]),t._v(" ,\tand\tif\tyou\tcan\nhandle\tthe\ttemporary\tinconsistency\tit\tis\ta\tfairly\teasy\tand\tcommon\tway\tto\thelp\tscale\nsystems.\tWe’ll\tlook\tinto\tthis\tin\tmore\tdepth\tshortly\twhen\twe\tlook\tat\tthe\tCAP\ttheorem.")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("Figure\t11-6.\tUsing\tread\treplicas\tto\tscale\treads\n")])])]),a("p",[t._v("Years\tago,\tusing\tread\treplicas\tto\tscale\twas\tall\tthe\trage,\talthough\tnowadays\tI\twould\nsuggest\tyou\tlook\tto\tcaching\tfirst,\tas\tit\tcan\tdeliver\tmuch\tmore\tsignificant\timprovements\tin\nperformance,\toften\twith\tless\twork.")]),t._v(" "),a("h2",{attrs:{id:"scalingforwrites"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#scalingforwrites"}},[t._v("#")]),t._v(" Scaling\tfor\tWrites")]),t._v(" "),a("p",[t._v("Reads\tare\tcomparatively\teasy\tto\tscale.\tWhat\tabout\twrites?\tOne\tapproach\tis\tto\tuse\n"),a("em",[t._v("sharding")]),t._v(" .\tWith\tsharding,\tyou\thave\tmultiple\tdatabase\tnodes.\tYou\ttake\ta\tpiece\tof\tdata\tto\tbe\nwritten,\tapply\tsome\thashing\tfunction\tto\tthe\tkey\tof\tthe\tdata,\tand\tbased\ton\tthe\tresult\tof\tthe\nfunction\tlearn\twhere\tto\tsend\tthe\tdata.\tTo\tpick\ta\tvery\tsimplistic\t(and\tactually\tbad)\nexample,\timagine\tthat\tcustomer\trecords\tA–M\tgo\tto\tone\tdatabase\tinstance,\tand\tN–Z\nanother.\tYou\tcan\tmanage\tthis\tyourself\tin\tyour\tapplication,\tbut\tsome\tdatabases,\tlike\nMongo,\thandle\tmuch\tof\tit\tfor\tyou.")]),t._v(" "),a("p",[t._v("The\tcomplexity\twith\tsharding\tfor\twrites\tcomes\tfrom\thandling\tqueries.\tLooking\tup\tan\nindividual\trecord\tis\teasy,\tas\tI\tcan\tjust\tapply\tthe\thashing\tfunction\tto\tfind\twhich\tinstance\nthe\tdata\tshould\tbe\ton,\tand\tthen\tretrieve\tit\tfrom\tthe\tcorrect\tshard.\tBut\twhat\tabout\tqueries\nthat\tspan\tthe\tdata\tin\tmultiple\tnodes\t—\tfor\texample,\tfinding\tall\tthe\tcustomers\twho\tare\tover\n18?\tIf\tyou\twant\tto\tquery\tall\tshards,\tyou\teither\tneed\tto\tquery\teach\tindividual\tshard\tand\njoin\tin\tmemory,\tor\thave\tan\talternative\tread\tstore\twhere\tboth\tdata\tsets\tare\tavailable.\tOften\nquerying\tacross\tshards\tis\thandled\tby\tan\tasynchronous\tmechanism,\tusing\tcached\tresults.\nMongo\tuses\tmap/reduce\tjobs,\tfor\texample,\tto\tperform\tthese\tqueries.")]),t._v(" "),a("p",[t._v("One\tof\tthe\tquestions\tthat\temerges\twith\tsharded\tsystems\tis,\twhat\thappens\tif\tI\twant\tto\tadd\nan\textra\tdatabase\tnode?\tIn\tthe\tpast,\tthis\twould\toften\trequire\tsignificant\tdowntime\t—\nespecially\tfor\tlarge\tclusters\t—\tas\tyou\tmight\thave\tto\ttake\tthe\tentire\tdatabase\tdown\tand\nrebalance\tthe\tdata.\tMore\trecently,\tmore\tsystems\tsupport\tadding\textra\tshards\tto\ta\tlive\nsystem,\twhere\tthe\trebalancing\tof\tdata\thappens\tin\tthe\tbackground;\tCassandra,\tfor\texample,\nhandles\tthis\tvery\twell.\tAdding\tshards\tto\tan\texisting\tcluster\tisn’t\tfor\tthe\tfaint\tof\theart,\nthough,\tso\tmake\tsure\tyou\ttest\tthis\tthoroughly.")]),t._v(" "),a("p",[t._v("Sharding\tfor\twrites\tmay\tscale\tfor\twrite\tvolume,\tbut\tmay\tnot\timprove\tresiliency.\tIf\ncustomer\trecords\tA–M\talways\tgo\tto\tInstance\tX,\tand\tInstance\tX\tis\tunavailable,\taccess\tto\nrecords\tA–M\tcan\tbe\tlost.\tCassandra\toffers\tadditional\tcapabilities\there,\twhere\twe\tcan\nensure\tthat\tdata\tis\treplicated\tto\tmultiple\tnodes\tin\ta\t "),a("em",[t._v("ring")]),t._v(" \t(Cassandra’s\tterm\tfor\ta\tcollection\nof\tCassandra\tnodes).")]),t._v(" "),a("p",[t._v("As\tyou\tmay\thave\tinferred\tfrom\tthis\tbrief\toverview,\tscaling\tdatabases\tfor\twrites\tare\twhere\nthings\tget\tvery\ttricky,\tand\twhere\tthe\tcapabilities\tof\tthe\tvarious\tdatabases\treally\tstart\tto\nbecome\tdifferentiated.\tI\toften\tsee\tpeople\tchanging\tdatabase\ttechnology\twhen\tthey\tstart\nhitting\tlimits\ton\thow\teasily\tthey\tcan\tscale\ttheir\texisting\twrite\tvolume.\tIf\tthis\thappens\tto\nyou,\tbuying\ta\tbigger\tbox\tis\toften\tthe\tquickest\tway\tto\tsolve\tthe\tproblem,\tbut\tin\tthe\nbackground\tyou\tmight\twant\tto\tlook\tat\tsystems\tlike\tCassandra,\tMongo,\tor\tRiak\tto\tsee\tif\ntheir\talternative\tscaling\tmodels\tmight\toffer\tyou\ta\tbetter\tlong-term\tsolution.")]),t._v(" "),a("h2",{attrs:{id:"shareddatabaseinfrastructure"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#shareddatabaseinfrastructure"}},[t._v("#")]),t._v(" Shared\tDatabase\tInfrastructure")]),t._v(" "),a("p",[t._v("Some\ttypes\tof\tdatabases,\tsuch\tas\tthe\ttraditional\tRDBMS,\tseparate\tthe\tconcept\tof\tthe\ndatabase\titself\tand\tthe\tschema.\tThis\tmeans\tone\trunning\tdatabase\tcould\thost\tmultiple,\nindependent\tschemas,\tone\tfor\teach\tmicroservice.\tThis\tcan\tbe\tvery\tuseful\tin\tterms\tof\nreducing\tthe\tnumber\tof\tmachines\twe\tneed\tto\trun\tour\tsystem,\tbut\twe\tare\tintroducing\ta\nsignificant\tsingle\tpoint\tof\tfailure.\tIf\tthis\tdatabase\tinfrastructure\tgoes\tdown,\tit\tcan\timpact\nmultiple\tmicroservices\tat\tonce,\tpotentially\tresulting\tin\ta\tcatastrophic\toutage.\tIf\tyou\tare\nrunning\tthis\tsort\tof\tsetup,\tmake\tsure\tyou\tconsider\tthe\trisks.\tAnd\tbe\tvery\tsure\tthat\tthe\ndatabase\titself\tis\tas\tresilient\tas\tit\tcan\tbe.")]),t._v(" "),a("h2",{attrs:{id:"cqrs"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#cqrs"}},[t._v("#")]),t._v(" CQRS")]),t._v(" "),a("p",[t._v("The\tCommand-Query\tResponsibility\tSegregation\t(CQRS)\tpattern\trefers\tto\tan\talternate\nmodel\tfor\tstoring\tand\tquerying\tinformation.\tWith\tnormal\tdatabases,\twe\tuse\tone\tsystem\nfor\tperforming\tmodifications\tto\tdata\tand\tquerying\tthe\tdata.\tWith\tCQRS,\tpart\tof\tthe\nsystem\tdeals\twith\tcommands,\twhich\tcapture\trequests\tto\tmodify\tstate,\twhile\tanother\tpart\nof\tthe\tsystem\tdeals\twith\tqueries.")]),t._v(" "),a("p",[t._v("Commands\tcome\tin\trequesting\tchanges\tin\tstate.\tThese\tcommands\tare\tvalidated,\tand\tif\nthey\twork,\tthey\twill\tbe\tapplied\tto\tthe\tmodel.\tCommands\tshould\tcontain\tinformation\tabout\ntheir\tintent.\tThey\tcan\tbe\tprocessed\tsynchronously\tor\tasynchronously,\tallowing\tfor\ndifferent\tmodels\tto\thandle\tscaling;\twe\tcould,\tfor\texample,\tjust\tqueue\tup\tinbound\trequests\nand\tprocess\tthem\tlater.")]),t._v(" "),a("p",[t._v("The\tkey\ttakeaway\there\tis\tthat\tthe\tinternal\tmodels\tused\tto\thandle\tcommands\tand\tqueries\nare\tthemselves\tcompletely\tseparate.\tFor\texample,\tI\tmight\tchoose\tto\thandle\tand\tprocess\ncommands\tas\tevents,\tperhaps\tjust\tstoring\tthe\tlist\tof\tcommands\tin\ta\tdata\tstore\t(a\tprocess\nknown\tas\t "),a("em",[t._v("event\tsourcing")]),t._v(" ).\tMy\tquery\tmodel\tcould\tquery\tan\tevent\tstore\tand\tcreate\nprojections\tfrom\tstored\tevents\tto\tassemble\tthe\tstate\tof\tdomain\tobjects,\tor\tcould\tjust\tpick\nup\ta\tfeed\tfrom\tthe\tcommand\tpart\tof\tthe\tsystem\tto\tupdate\ta\tdifferent\ttype\tof\tstore.\tIn\tmany\nways,\twe\tget\tthe\tsame\tbenefits\tof\tread\treplicas\tthat\twe\tdiscussed\tearlier,\twithout\tthe\nrequirement\tthat\tthe\tbacking\tstore\tfor\tthe\treplicas\tbe\tthe\tsame\tas\tthe\tdata\tstore\tused\tto\nhandle\tdata\tmodifications.")]),t._v(" "),a("p",[t._v("This\tform\tof\tseparation\tallows\tfor\tdifferent\ttypes\tof\tscaling.\tThe\tcommand\tand\tquery\nparts\tof\tour\tsystem\tcould\tlive\tin\tdifferent\tservices,\tor\ton\tdifferent\thardware,\tand\tcould\nmake\tuse\tof\tradically\tdifferent\ttypes\tof\tdata\tstore.\tThis\tcan\tunlock\ta\tlarge\tnumber\tof\tways\nto\thandle\tscale.\tYou\tcould\teven\tsupport\tdifferent\ttypes\tof\tread\tformat\tby\thaving\tmultiple\nimplementations\tof\tthe\tquery\tpiece,\tperhaps\tsupporting\ta\tgraph-based\trepresentation\tof\nyour\tdata,\tor\ta\tkey/value-based\tform\tof\tyour\tdata.")]),t._v(" "),a("p",[t._v("Be\twarned,\thowever:\tthis\tsort\tof\tpattern\tis\tquite\ta\tshift\taway\tfrom\ta\tmodel\twhere\ta\tsingle\ndata\tstore\thandles\tall\tour\tCRUD\toperations.\tI’ve\tseen\tmore\tthan\tone\texperienced\ndevelopment\tteam\tstruggle\tto\tget\tthis\tpattern\tright!")]),t._v(" "),a("h2",{attrs:{id:"caching"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#caching"}},[t._v("#")]),t._v(" Caching")]),t._v(" "),a("p",[t._v("Caching\tis\ta\tcommonly\tused\tperformance\toptimization\twhereby\tthe\tprevious\tresult\tof\nsome\toperation\tis\tstored,\tso\tthat\tsubsequent\trequests\tcan\tuse\tthis\tstored\tvalue\trather\tthan\nspending\ttime\tand\tresources\trecalculating\tthe\tvalue.\tMore\toften\tthan\tnot,\tcaching\tis\tabout\neliminating\tneedless\tround-trips\tto\tdatabases\tor\tother\tservices\tto\tserve\tresults\tfaster.\tUsed\nwell,\tit\tcan\tyield\thuge\tperformance\tbenefits.\tThe\treason\tthat\tHTTP\tscales\tso\twell\tin\nhandling\tlarge\tnumbers\tof\trequests\tis\tthat\tthe\tconcept\tof\tcaching\tis\tbuilt\tin.")]),t._v(" "),a("p",[t._v("Even\twith\ta\tsimple\tmonolithic\tweb\tapplication,\tthere\tare\tquite\ta\tfew\tchoices\tas\tto\twhere\nand\thow\tto\tcache.\tWith\ta\tmicroservice\tarchitecture,\twhere\teach\tservice\tis\tits\town\tsource\nof\tdata\tand\tbehavior,\twe\thave\tmany\tmore\tchoices\tto\tmake\tabout\twhere\tand\thow\tto\tcache.\nWith\ta\tdistributed\tsystem,\twe\ttypically\tthink\tof\tcaching\teither\ton\tthe\tclient\tside\tor\ton\tthe\nserver\tside.\tBut\twhich\tis\tbest?")]),t._v(" "),a("h2",{attrs:{id:"client-side-proxy-andserver-sidecaching"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#client-side-proxy-andserver-sidecaching"}},[t._v("#")]),t._v(" Client-Side,\tProxy,\tand\tServer-Side\tCaching")]),t._v(" "),a("p",[t._v("In\tclient-side\tcaching,\tthe\tclient\tstores\tthe\tcached\tresult.\tThe\tclient\tgets\tto\tdecide\twhen\n(and\tif)\tit\tgoes\tand\tretrieves\ta\tfresh\tcopy.\tIdeally,\tthe\tdownstream\tservice\twill\tprovide\nhints\tto\thelp\tthe\tclient\tunderstand\twhat\tto\tdo\twith\tthe\tresponse,\tso\tit\tknows\twhen\tand\tif\tto\nmake\ta\tnew\trequest.\tWith\tproxy\tcaching,\ta\tproxy\tis\tplaced\tbetween\tthe\tclient\tand\tthe\nserver.\tA\tgreat\texample\tof\tthis\tis\tusing\ta\treverse\tproxy\tor\tcontent\tdelivery\tnetwork\n(CDN).\tWith\tserver-side\tcaching,\tthe\tserver\thandles\tcaching\tresponsibility,\tperhaps\nmaking\tuse\tof\ta\tsystem\tlike\tRedis\tor\tMemcache,\tor\teven\ta\tsimple\tin-memory\tcache.")]),t._v(" "),a("p",[t._v("Which\tone\tmakes\tthe\tmost\tsense\tdepends\ton\twhat\tyou\tare\ttrying\tto\toptimize.\tClient-side\ncaching\tcan\thelp\treduce\tnetwork\tcalls\tdrastically,\tand\tcan\tbe\tone\tof\tthe\tfastest\tways\tof\nreducing\tload\ton\ta\tdownstream\tservice.\tIn\tthis\tcase,\tthe\tclient\tis\tin\tcharge\tof\tthe\tcaching\nbehavior,\tand\tif\tyou\twant\tto\tmake\tchanges\tto\thow\tcaching\tis\tdone,\trolling\tout\tchanges\tto\na\tnumber\tof\tconsumers\tcould\tbe\tdifficult.\tInvalidation\tof\tstale\tdata\tcan\talso\tbe\ttrickier,\nalthough\twe’ll\tdiscuss\tsome\tcoping\tmechanisms\tfor\tthis\tin\ta\tmoment.")]),t._v(" "),a("p",[t._v("With\tproxy\tcaching,\teverything\tis\topaque\tto\tboth\tthe\tclient\tand\tserver.\tThis\tis\toften\ta\tvery\nsimple\tway\tto\tadd\tcaching\tto\tan\texisting\tsystem.\tIf\tthe\tproxy\tis\tdesigned\tto\tcache\tgeneric\ntraffic,\tit\tcan\talso\tcache\tmore\tthan\tone\tservice;\ta\tcommon\texample\tis\ta\treverse\tproxy\tlike\nSquid\tor\tVarnish,\twhich\tcan\tcache\tany\tHTTP\ttraffic.\tHaving\ta\tproxy\tbetween\tthe\tclient\nand\tserver\tdoes\tintroduce\tadditional\tnetwork\thops,\talthough\tin\tmy\texperience\tit\tis\tvery\nrare\tthat\tthis\tcauses\tproblems,\tas\tthe\tperformance\toptimizations\tresulting\tfrom\tthe\ncaching\titself\toutweigh\tany\tadditional\tnetwork\tcosts.")]),t._v(" "),a("p",[t._v("With\tserver-side\tcaching,\teverything\tis\topaque\tto\tthe\tclients;\tthey\tdon’t\tneed\tto\tworry\nabout\tanything.\tWith\ta\tcache\tnear\tor\tinside\ta\tservice\tboundary,\tit\tcan\tbe\teasier\tto\treason\nabout\tthings\tlike\tinvalidation\tof\tdata,\tor\ttrack\tand\toptimize\tcache\thits.\tIn\ta\tsituation\twhere\nyou\thave\tmultiple\ttypes\tof\tclients,\ta\tserver-side\tcache\tcould\tbe\tthe\tfastest\tway\tto\timprove\nperformance.")]),t._v(" "),a("p",[t._v("For\tevery\tpublic-facing\twebsite\tI’ve\tworked\ton,\twe’ve\tended\tup\tdoing\ta\tmix\tof\tall\tthree\napproaches.\tBut\tfor\tmore\tthan\tone\tdistributed\tsystem,\tI’ve\tgotten\taway\twith\tno\tcaching\tat\nall.\tBut\tit\tall\tcomes\tdown\tto\tknowing\twhat\tload\tyou\tneed\tto\thandle,\thow\tfresh\tyour\tdata\nneeds\tto\tbe,\tand\twhat\tyour\tsystem\tcan\tdo\tright\tnow.\tKnowing\tthat\tyou\thave\ta\tnumber\tof\ndifferent\ttools\tat\tyour\tdisposal\tis\tjust\tthe\tbeginning.")]),t._v(" "),a("h2",{attrs:{id:"cachinginhttp"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#cachinginhttp"}},[t._v("#")]),t._v(" Caching\tin\tHTTP")]),t._v(" "),a("p",[t._v("HTTP\tprovides\tsome\treally\tuseful\tcontrols\tto\thelp\tus\tcache\teither\ton\tthe\tclient\tside\tor\nserver\tside,\twhich\tare\tworth\tunderstanding\teven\tif\tyou\taren’t\tusing\tHTTP\titself.")]),t._v(" "),a("p",[t._v("First,\twith\tHTTP,\twe\tcan\tuse\tcache-control\tdirectives\tin\tour\tresponses\tto\tclients.\tThese\ntell\tclients\tif\tthey\tshould\tcache\tthe\tresource\tat\tall,\tand\tif\tso\thow\tlong\tthey\tshould\tcache\tit\nfor\tin\tseconds.\tWe\talso\thave\tthe\toption\tof\tsetting\tan\tExpires\theader,\twhere\tinstead\tof")]),t._v(" "),a("p",[t._v("saying\thow\tlong\ta\tpiece\tof\tcontent\tcan\tbe\tcached\tfor,\twe\tspecify\ta\ttime\tand\tdate\tat\twhich\na\tresource\tshould\tbe\tconsidered\tstale\tand\tfetched\tagain.\tThe\tnature\tof\tthe\tresources\tyou\nare\tsharing\tdetermines\twhich\tone\tis\tmost\tlikely\tto\tfit.\tStandard\tstatic\twebsite\tcontent\tlike\nCSS\tor\timages\toften\tfit\twell\twith\ta\tsimple\tcache-control\ttime\tto\tlive\t(TTL).\tOn\tthe\nother\thand,\tif\tyou\tknow\tin\tadvance\twhen\ta\tnew\tversion\tof\ta\tresource\twill\tbe\tupdated,\nsetting\tan\tExpires\theader\twill\tmake\tmore\tsense.\tAll\tof\tthis\tis\tvery\tuseful\tin\tstopping\ta")]),t._v(" "),a("p",[t._v("client\tfrom\teven\tneeding\tto\tmake\ta\trequest\tto\tthe\tserver\tin\tthe\tfirst\tplace.")]),t._v(" "),a("p",[t._v("Aside\tfrom\tcache-control\tand\tExpires,\twe\thave\tanother\toption\tin\tour\tarsenal\tof\tHTTP\ngoodies:\tEntity\tTags,\tor\tETags.\tAn\tETag\tis\tused\tto\tdetermine\tif\tthe\tvalue\tof\ta\tresource\thas\nchanged.\tIf\tI\tupdate\ta\tcustomer\trecord,\tthe\tURI\tto\tthe\tresource\tis\tthe\tsame,\tbut\tthe\tvalue\nis\tdifferent,\tso\tI\twould\texpect\tthe\tETag\tto\tchange.\tThis\tbecomes\tpowerful\twhen\twe’re\nusing\twhat\tis\tcalled\ta\t "),a("em",[t._v("conditional\tGET")]),t._v(" .\tWhen\tmaking\ta\tGET\trequest,\twe\tcan\tspecify\nadditional\theaders,\ttelling\tthe\tservice\tto\tsend\tus\tthe\tresource\tonly\tif\tsome\tcriteria\tare\tmet.")]),t._v(" "),a("p",[t._v("For\texample,\tlet’s\timagine\twe\tfetch\ta\tcustomer\trecord,\tand\tits\tETag\tcomes\tback\tas\no5t6fkd2sa.\tLater\ton,\tperhaps\tbecause\ta\tcache-control\tdirective\thas\ttold\tus\tthe\tresource\nshould\tbe\tconsidered\tstale,\twe\twant\tto\tmake\tsure\twe\tget\tthe\tlatest\tversion.\tWhen\tissuing\nthe\tsubsequent\tGET\trequest,\twe\tcan\tpass\tin\ta\tIf-None-Match:\to5t6fkd2sa.\tThis\ttells\tthe\nserver\tthat\twe\twant\tthe\tresource\tat\tthe\tspecified\tURI,\tunless\tit\talready\tmatches\tthis\tETag\nvalue.\tIf\twe\talready\thave\tthe\tup-to-date\tversion,\tthe\tservice\tsends\tus\ta\t304\tNot\tModified")]),t._v(" "),a("p",[t._v("response,\ttelling\tus\twe\thave\tthe\tlatest\tversion.\tIf\tthere\tis\ta\tnewer\tversion\tavailable,\twe\tget\na\t200\tOK\twith\tthe\tchanged\tresource,\tand\ta\tnew\tETag\tfor\tthe\tresource.")]),t._v(" "),a("p",[t._v("The\tfact\tthat\tthese\tcontrols\tare\tbuilt\tinto\tsuch\ta\twidely\tused\tspecification\tmeans\twe\tget\tto\ntake\tadvantage\tof\ta\tlot\tof\tpreexisting\tsoftware\tthat\thandles\tthe\tcaching\tfor\tus.\tReverse\nproxies\tlike\tSquid\tor\tVarnish\tcan\tsit\ttransparently\ton\tthe\tnetwork\tbetween\tclient\tand\nserver,\tstoring\tand\texpiring\tcached\tcontent\tas\trequired.\tThese\tsystems\tare\tgeared\ttoward\nserving\thuge\tnumbers\tof\tconcurrent\trequests\tvery\tfast,\tand\tare\ta\tstandard\tway\tof\tscaling\npublic-facing\twebsites.\tCDNs\tlike\tAWS’s\tCloudFront\tor\tAkamai\tcan\tensure\tthat\trequests\nare\trouted\tto\tcaches\tnear\tthe\tcalling\tclient,\tmaking\tsure\tthat\ttraffic\tdoesn’t\tgo\thalfway\nround\tthe\tworld\twhen\tit\tneeds\tto.\tAnd\tmore\tprosaically,\tHTTP\tclient\tlibraries\tand\tclient\ncaches\tcan\thandle\ta\tlot\tof\tthis\twork\tfor\tus.")]),t._v(" "),a("p",[t._v("ETags,\tExpires,\tand\tcache-control\tcan\toverlap\ta\tbit,\tand\tif\tyou\taren’t\tcareful\tyou\tcan\nend\tup\tgiving\tconflicting\tinformation\tif\tyou\tdecide\tto\tuse\tall\tof\tthem!\tFor\ta\tmore\tin-depth")]),t._v(" "),a("p",[t._v("discussion\tof\tthe\tvarious\tmerits,\ttake\ta\tlook\tat\tthe\tbook\t "),a("em",[t._v("REST\tIn\tPractice")]),t._v(" \t(O’Reilly)\tor\nread\tsection\t13\tof\tthe\tHTTP\t1.1\tspecification,\twhich\tdescribes\thow\tboth\tclients\tand\nservers\tare\tsupposed\tto\timplement\tthese\tvarious\tcontrols.")]),t._v(" "),a("p",[t._v("Whether\tyou\tdecide\tto\tuse\tHTTP\tas\tan\tinterservice\tprotocol,\tcaching\tat\tthe\tclient\tand\nreducing\tthe\tneed\tfor\tround-trips\tto\tthe\tclient\tis\twell\tworth\tit.\tIf\tyou\tdecide\tto\tpick\ta\ndifferent\tprotocol,\tunderstand\twhen\tand\thow\tyou\tcan\tprovide\thints\tto\tthe\tclient\tto\thelp\tit\nunderstand\thow\tlong\tit\tcan\tcache\tfor.")]),t._v(" "),a("h2",{attrs:{id:"cachingforwrites"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#cachingforwrites"}},[t._v("#")]),t._v(" Caching\tfor\tWrites")]),t._v(" "),a("p",[t._v("Although\tyou’ll\tfind\tyourself\tusing\tcaching\tfor\treads\tmore\toften,\tthere\tare\tsome\tuse\tcases\nwhere\tcaching\tfor\twrites\tmake\tsense.\tFor\texample,\tif\tyou\tmake\tuse\tof\ta\twrite-behind\ncache,\tyou\tcan\twrite\tto\ta\tlocal\tcache,\tand\tat\tsome\tlater\tpoint\tthe\tdata\twill\tbe\tflushed\tto\ta\ndownstream\tsource,\tprobably\tthe\tcanonical\tsource\tof\tdata.\tThis\tcan\tbe\tuseful\twhen\tyou\nhave\tbursts\tof\twrites,\tor\twhen\tthere\tis\ta\tgood\tchance\tthat\tthe\tsame\tdata\twill\tbe\twritten\nmultiple\ttimes.\tWhen\tused\tto\tbuffer\tand\tpotentially\tbatch\twrites,\twrite-behind\tcaches\tcan\nbe\ta\tuseful\tfurther\tperformance\toptimization.")]),t._v(" "),a("p",[t._v("With\ta\twrite-behind\tcache,\tif\tthe\tbuffered\twrites\tare\tsuitably\tpersistent,\teven\tif\tthe\ndownstream\tservice\tis\tunavailable\twe\tcould\tqueue\tup\tthe\twrites\tand\tsend\tthem\tthrough\nwhen\tit\tis\tavailable\tagain.")]),t._v(" "),a("h2",{attrs:{id:"cachingforresilience"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#cachingforresilience"}},[t._v("#")]),t._v(" Caching\tfor\tResilience")]),t._v(" "),a("p",[t._v("Caching\tcan\tbe\tused\tto\timplement\tresiliency\tin\tcase\tof\tfailure.\tWith\tclient-side\tcaching,\tif\nthe\tdownstream\tservice\tis\tunavailable,\tthe\tclient\tcould\tdecide\tto\tsimply\tuse\tcached\tbut\npotentially\tstale\tdata.\tWe\tcould\talso\tuse\tsomething\tlike\ta\treverse\tproxy\tto\tserve\tup\tstale\ndata.\tFor\tsome\tsystems,\tbeing\tavailable\teven\twith\tstale\tdata\tis\tbetter\tthan\tnot\treturning\ta\nresult\tat\tall,\tbut\tthat\tis\ta\tjudgment\tcall\tyou’ll\thave\tto\tmake.\tObviously,\tif\twe\tdon’t\thave\nthe\trequested\tdata\tin\tthe\tcache,\tthen\twe\tcan’t\tdo\tmuch\tto\thelp,\tbut\tthere\tare\tways\tto\nmitigate\tthis.")]),t._v(" "),a("p",[t._v("A\ttechnique\tI\tsaw\tused\tat\tthe\t "),a("em",[t._v("Guardian")]),t._v(" ,\tand\tsubsequently\telsewhere,\twas\tto\tcrawl\tthe\nexisting\t "),a("em",[t._v("live")]),t._v(" \tsite\tperiodically\tto\tgenerate\ta\tstatic\tversion\tof\tthe\twebsite\tthat\tcould\tbe\nserved\tin\tthe\tevent\tof\tan\toutage.\tAlthough\tthis\tcrawled\tversion\twasn’t\tas\tfresh\tas\tthe\ncached\tcontent\tserved\tfrom\tthe\tlive\tsystem,\tin\ta\tpinch\tit\tcould\tensure\tthat\ta\tversion\tof\tthe\nsite\twould\tget\tdisplayed.")]),t._v(" "),a("h2",{attrs:{id:"hidingtheorigin"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#hidingtheorigin"}},[t._v("#")]),t._v(" Hiding\tthe\tOrigin")]),t._v(" "),a("p",[t._v("With\ta\tnormal\tcache,\tif\ta\trequest\tresults\tin\ta\tcache\tmiss,\tthe\trequest\tgoes\ton\tto\tthe\torigin\nto\tfetch\tthe\tfresh\tdata\twith\tthe\tcaller\tblocking,\twaiting\ton\tthe\tresult.\tIn\tthe\tnormal\tcourse\nof\tthings,\tthis\tis\tto\tbe\texpected.\tBut\tif\twe\tsuffer\ta\tmassive\tcache\tmiss,\tperhaps\tbecause\tan\nentire\tmachine\t(or\tgroup\tof\tmachines)\tthat\tprovide\tour\tcache\tfail,\ta\tlarge\tnumber\tof\nrequests\twill\thit\tthe\torigin.")]),t._v(" "),a("p",[t._v("For\tthose\tservices\tthat\tserve\tup\thighly\tcachable\tdata,\tit\tis\tcommon\tfor\tthe\torigin\titself\tto\nbe\tscaled\tto\thandle\tonly\ta\tfraction\tof\tthe\ttotal\ttraffic,\tas\tmost\trequests\tget\tserved\tout\tof\nmemory\tby\tthe\tcaches\tthat\tsit\tin\tfront\tof\tthe\torigin.\tIf\twe\tsuddenly\tget\ta\tthundering\therd\ndue\tto\tan\tentire\tcache\tregion\tvanishing,\tour\torigin\tcould\tbe\tpummelled\tout\tof\texistence.")]),t._v(" "),a("p",[t._v("One\tway\tto\tprotect\tthe\torigin\tin\tsuch\ta\tsituation\tis\tnever\tto\tallow\trequests\tto\tgo\tto\tthe\norigin\tin\tthe\tfirst\tplace.\tInstead,\tthe\torigin\titself\tpopulates\tthe\tcache\tasynchronously\twhen\nneeded,\tas\tshown\tin\tFigure\t11-7.\tIf\ta\tcache\tmiss\tis\tcaused,\tthis\ttriggers\tan\tevent\tthat\tthe\norigin\tcan\tpick\tup\ton,\talerting\tit\tthat\tit\tneeds\tto\trepopulate\tthe\tcache.\tSo\tif\tan\tentire\tshard\nhas\tvanished,\twe\tcan\trebuild\tthe\tcache\tin\tthe\tbackground.\tWe\tcould\tdecide\tto\tblock\tthe\noriginal\trequest\twaiting\tfor\tthe\tregion\tto\tbe\trepopulated,\tbut\tthis\tcould\tcause\tcontention\non\tthe\tcache\titself,\tleading\tto\tfurther\tproblems.\tIt’s\tmore\tlikely\tif\twe\tare\tprioritizing\nkeeping\tthe\tsystem\tstable\tthat\twe\twould\tfail\tthe\toriginal\trequest,\tbut\tit\twould\tfail\tfast.")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("Figure\t11-7.\tHiding\tthe\torigin\tfrom\tthe\tclient\tand\tpopulating\tthe\tcache\tasynchronously\n")])])]),a("p",[t._v("This\tsort\tof\tapproach\tmay\tnot\tmake\tsense\tfor\tsome\tsituations,\tbut\tit\tcan\tbe\ta\tway\tto\nensure\tthe\tsystem\tremains\tup\twhen\tparts\tof\tit\tfail.\tBy\tfailing\trequests\tfast,\tand\tensuring\nwe\tdon’t\ttake\tup\tresources\tor\tincrease\tlatency,\twe\tavoid\ta\tfailure\tin\tour\tcache\tfrom\ncascading\tdownstream\tand\tgive\tourselves\ta\tchance\tto\trecover.")]),t._v(" "),a("h2",{attrs:{id:"keepitsimple"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#keepitsimple"}},[t._v("#")]),t._v(" Keep\tIt\tSimple")]),t._v(" "),a("p",[t._v("Be\tcareful\tabout\tcaching\tin\ttoo\tmany\tplaces!\tThe\tmore\tcaches\tbetween\tyou\tand\tthe\nsource\tof\tfresh\tdata,\tthe\tmore\tstale\tthe\tdata\tcan\tbe,\tand\tthe\tharder\tit\tcan\tbe\tto\tdetermine\nthe\tfreshness\tof\tthe\tdata\tthat\ta\tclient\teventually\tsees.\tThis\tcan\tbe\tespecially\tproblematic\nwith\ta\tmicroservice\tarchitecture\twhere\tyou\thave\tmultiple\tservices\tinvolved\tin\ta\tcall\tchain.\nAgain,\tthe\tmore\tcaching\tyou\thave,\tthe\tharder\tit\twill\tbe\tto\tassess\tthe\tfreshness\tof\tany\tpiece\nof\tdata.\tSo\tif\tyou\tthink\ta\tcache\tis\ta\tgood\tidea,\tkeep\tit\tsimple,\tstick\tto\tone,\tand\tthink\ncarefully\tbefore\tadding\tmore!")]),t._v(" "),a("h2",{attrs:{id:"cachepoisoning-acautionarytale"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#cachepoisoning-acautionarytale"}},[t._v("#")]),t._v(" Cache\tPoisoning:\tA\tCautionary\tTale")]),t._v(" "),a("p",[t._v("With\tcaching\twe\toften\tthink\tthat\tif\twe\tget\tit\twrong\tthe\tworst\tthing\tthat\tcan\thappen\tis\twe\nserve\tstale\tdata\tfor\ta\tbit.\tBut\twhat\thappens\tif\tyou\tend\tup\tserving\tstale\tdata\tforever?\nEarlier\tI\tmentioned\tthe\tproject\tI\tworked\ton\twhere\twe\twere\tusing\ta\tstrangler\tapplication\tto\nhelp\tintercept\tcalls\tto\tmultiple\tlegacy\tsystems\twith\ta\tview\tof\tincrementally\tretiring\tthem.\nOur\tapplication\toperated\teffectively\tas\ta\tproxy.\tTraffic\tto\tour\tapplication\twas\trouted\nthrough\tto\tthe\tlegacy\tapplication.\tOn\tthe\tway\tback,\twe\tdid\ta\tfew\thousekeeping\tthings;\tfor\nexample,\twe\tmade\tsure\tthat\tthe\tresults\tfrom\tthe\tlegacy\tapplication\thad\tproper\tHTTP\ncache\theaders\tapplied.")]),t._v(" "),a("p",[t._v("One\tday,\tshortly\tafter\ta\tnormal\troutine\trelease,\tsomething\todd\tstarted\thappening.\tA\tbug\nhad\tbeen\tintroduced\twhereby\ta\tsmall\tsubset\tof\tpages\twere\tfalling\tthrough\ta\tlogic\ncondition\tin\tour\tcache\theader\tinsertion\tcode,\tresulting\tin\tus\tnot\tchanging\tthe\theader\tat\tall.\nUnfortunately,\tthis\tdownstream\tapplication\thad\talso\tbeen\tchanged\tsometime\tpreviously\tto\ninclude\tan\tExpires:\tNever\tHTTP\theader.\tThis\thadn’t\thad\tany\teffect\tearlier,\tas\twe\twere\noverriding\tthis\theader.\tNow\twe\tweren’t.")]),t._v(" "),a("p",[t._v("Our\tapplication\tmade\theavy\tuse\tof\tSquid\tto\tcache\tHTTP\ttraffic,\tand\twe\tnoticed\tthe\nproblem\tquite\tquickly\tas\twe\twere\tseeing\tmore\trequests\tbypassing\tSquid\titself\tto\thit\tour\napplication\tservers.\tWe\tfixed\tthe\tcache\theader\tcode\tand\tpushed\tout\ta\trelease,\tand\talso\nmanually\tcleared\tthe\trelevant\tregion\tof\tthe\tSquid\tcache.\tHowever,\tthat\twasn’t\tenough.")]),t._v(" "),a("p",[t._v("As\tI\tmentioned\tearlier,\tyou\tcan\tcache\tin\tmultiple\tplaces.\tWhen\tit\tcomes\tto\tserving\tup\ncontent\tto\tusers\tof\ta\tpublic-facing\tweb\tapplication,\tyou\tcould\thave\tmultiple\tcaches\nbetween\tyou\tand\tyour\tcustomer.\tNot\tonly\tmight\tyou\tbe\tfronting\tyour\twebsite\twith\nsomething\tlike\ta\tCDN,\tbut\tsome\tISPs\tmake\tuse\tof\tcaching.\tCan\tyou\tcontrol\tthose\tcaches?\nAnd\teven\tif\tyou\tcould,\tthere\tis\tone\tcache\tthat\tyou\thave\tlittle\tcontrol\tover:\tthe\tcache\tin\ta\nuser’s\tbrowser.")]),t._v(" "),a("p",[t._v("Those\tpages\twith\tExpires:\tNever\tstuck\tin\tthe\tcaches\tof\tmany\tof\tour\tusers,\tand\twould\nnever\tbe\tinvalidated\tuntil\tthe\tcache\tbecame\tfull\tor\tthe\tuser\tcleaned\tthem\tout\tmanually.\nClearly\twe\tcouldn’t\tmake\teither\tthing\thappen;\tour\tonly\toption\twas\tto\tchange\tthe\tURLs\tof\nthese\tpages\tso\tthey\twere\trefetched.")]),t._v(" "),a("p",[t._v("Caching\tcan\tbe\tvery\tpowerful\tindeed,\tbut\tyou\tneed\tto\tunderstand\tthe\tfull\tpath\tof\tdata\tthat\nis\tcached\tfrom\tsource\tto\tdestination\tto\treally\tappreciate\tits\tcomplexities\tand\twhat\tcan\tgo\nwrong.")]),t._v(" "),a("h2",{attrs:{id:"autoscaling"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#autoscaling"}},[t._v("#")]),t._v(" Autoscaling")]),t._v(" "),a("p",[t._v("If\tyou\tare\tlucky\tenough\tto\thave\tfully\tautomatable\tprovisioning\tof\tvirtual\thosts,\tand\tcan\nfully\tautomate\tthe\tdeployment\tof\tyour\tmicroservice\tinstances,\tthen\tyou\thave\tthe\tbuilding\nblocks\tto\tallow\tyou\tto\tautomatically\tscale\tyour\tmicroservices.")]),t._v(" "),a("p",[t._v("For\texample,\tyou\tcould\talso\thave\tthe\tscaling\ttriggered\tby\twell-known\ttrends.\tYou\tmight\nknow\tthat\tyour\tsystem’s\tpeak\tload\tis\tbetween\t9\ta.m.\tand\t5\tp.m.,\tso\tyou\tbring\tup\nadditional\tinstances\tat\t8:45\ta.m.,\tand\tturn\tthem\toff\tat\t5:15\tp.m..\tIf\tyou’re\tusing\tsomething\nlike\tAWS\t(which\thas\tvery\tgood\tsupport\tfor\tautoscaling\tbuilt\tin),\tturning\toff\tinstances\tyou\ndon’t\tneed\tany\tlonger\twill\thelp\tsave\tmoney.\tYou’ll\tneed\tdata\tto\tunderstand\thow\tyour\tload\nchanges\tover\ttime,\tfrom\tday\tto\tday,\tweek\tto\tweek.\tSome\tbusinesses\thave\tobvious\nseasonal\tcycles\ttoo,\tso\tyou\tmay\tneed\tdata\tgoing\tback\ta\tfair\tway\tto\tmake\tproper\tjudgment\ncalls.")]),t._v(" "),a("p",[t._v("On\tthe\tother\thand,\tyou\tcould\tbe\treactive,\tbringing\tup\tadditional\tinstances\twhen\tyou\tsee\nan\tincrease\tin\tload\tor\tan\tinstance\tfailure,\tand\tremove\tinstances\twhen\tyou\tno\tlonger\nneeded\tthem.\tKnowing\thow\tfast\tyou\tcan\tscale\tup\tonce\tyou\tspot\tan\tupward\ttrend\tis\tkey.\tIf\nyou\tknow\tyou’ll\tonly\tget\ta\tcouple\tof\tminutes’\tnotice\tabout\tan\tincrease\tin\tload,\tbut\tscaling\nup\twill\ttake\tyou\tat\tleast\t10\tminutes,\tyou\tknow\tyou’ll\tneed\tto\tkeep\textra\tcapacity\taround\nto\tbridge\tthis\tgap.\tHaving\ta\tgood\tsuite\tof\tload\ttests\tis\talmost\tessential\there.\tYou\tcan\tuse\nthem\tto\ttest\tyour\tautoscaling\trules.\tIf\tyou\tdon’t\thave\ttests\tthat\tcan\treproduce\tdifferent\nloads\tthat\twill\ttrigger\tscaling,\tthen\tyou’re\tonly\tgoing\tto\tfind\tout\tin\tproduction\tif\tyou\tgot\nthe\trules\twrong.\tAnd\tthe\tconsequences\tof\tfailure\taren’t\tgreat!")]),t._v(" "),a("p",[t._v("A\tnews\tsite\tis\ta\tgreat\texample\tof\ta\ttype\tof\tbusiness\twhere\tyou\tmay\twant\ta\tmix\tof\npredictive\tand\treactive\tscaling.\tOn\tthe\tlast\tnews\tsite\tI\tworked\ton,\twe\tsaw\tvery\tclear\tdaily\ntrends,\twith\tviews\tclimbing\tfrom\tthe\tmorning\tto\tlunchtime\tand\tthen\tstarting\tto\tdecline.\nThis\tpattern\twas\trepeated\tday\tin,\tday\tout,\twith\ttraffic\tless\tpronounced\tat\tthe\tweekend.\nThat\tgave\tyou\ta\tfairly\tclear\ttrend\tthat\tcould\tdrive\tproactive\tscaling\tup\t(and\tdown)\tof\nresources.\tOn\tthe\tother\thand,\ta\tbig\tnews\tstory\twould\tcause\tan\tunexpected\tspike,\trequiring\nmore\tcapacity\tat\toften\tshort\tnotice.")]),t._v(" "),a("p",[t._v("I\tactually\tsee\tautoscaling\tused\tmuch\tmore\tfor\thandling\tfailure\tof\tinstances\tthan\tfor\nreacting\tto\tload\tconditions.\tAWS\tlets\tyou\tspecify\trules\tlike\t“There\tshould\tbe\tat\tleast\t5\ninstances\tin\tthis\tgroup,”\tso\tif\tone\tgoes\tdown\ta\tnew\tone\tis\tautomatically\tlaunched.\tI’ve\nseen\tthis\tapproach\tlead\tto\ta\tfun\tgame\tof\twhack-a-mole\twhen\tsomeone\tforgets\tto\tturn\toff\nthe\trule\tand\tthen\ttries\tto\ttake\tdown\tthe\tinstances\tfor\tmaintenance,\tonly\tto\tsee\tthem\tkeep\nspinning\tup!")]),t._v(" "),a("p",[t._v("Both\treactive\tand\tpredictive\tscaling\tare\tvery\tuseful,\tand\tcan\thelp\tyou\tbe\tmuch\tmore\tcost\neffective\tif\tyou’re\tusing\ta\tplatform\tthat\tallows\tyou\tto\tpay\tonly\tfor\tthe\tcomputing\nresources\tyou\tuse.\tBut\tthey\talso\trequire\tcareful\tobservation\tof\tthe\tdata\tavailable\tto\tyou.\nI’d\tsuggest\tusing\tautoscaling\tfor\tfailure\tconditions\tfirst\twhile\tyou\tcollect\tthe\tdata.\tOnce")]),t._v(" "),a("p",[t._v("you\twant\tto\tstart\tscaling\tfor\tload,\tmake\tsure\tyou\tare\tvery\tcautious\tabout\tscaling\tdown\ttoo\nquickly.\tIn\tmost\tsituations,\thaving\tmore\tcomputing\tpower\tat\tyour\thands\tthan\tyou\tneed\tis\nmuch\tbetter\tthan\tnot\thaving\tenough!")]),t._v(" "),a("h2",{attrs:{id:"captheorem"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#captheorem"}},[t._v("#")]),t._v(" CAP\tTheorem")]),t._v(" "),a("p",[t._v("We’d\tlike\tto\thave\tit\tall,\tbut\tunfortunately\twe\tknow\twe\tcan’t.\tAnd\twhen\tit\tcomes\tto\ndistributed\tsystems\tlike\tthose\twe\tbuild\tusing\tmicroservice\tarchitectures,\twe\teven\thave\ta\nmathematical\tproof\tthat\ttells\tus\twe\tcan’t.\tYou\tmay\twell\thave\theard\tabout\tthe\tCAP\ntheorem,\tespecially\tin\tdiscussions\tabout\tthe\tmerits\tof\tvarious\tdifferent\ttypes\tof\tdata\nstores.\tAt\tits\theart\tit\ttells\tus\tthat\tin\ta\tdistributed\tsystem,\twe\thave\tthree\tthings\twe\tcan\ttrade\noff\tagainst\teach\tother:\t "),a("em",[t._v("consistency")]),t._v(" ,\t "),a("em",[t._v("availability")]),t._v(" ,\tand\t "),a("em",[t._v("partition\ttolerance")]),t._v(" .\tSpecifically,\tthe\ntheorem\ttells\tus\tthat\twe\tget\tto\tkeep\ttwo\tin\ta\tfailure\tmode.")]),t._v(" "),a("p",[t._v("Consistency\tis\tthe\tsystem\tcharacteristic\tby\twhich\tI\twill\tget\tthe\tsame\tanswer\tif\tI\tgo\tto\nmultiple\tnodes.\tAvailability\tmeans\tthat\tevery\trequest\treceives\ta\tresponse.\tPartition\ntolerance\tis\tthe\tsystem’s\tability\tto\thandle\tthe\tfact\tthat\tcommunication\tbetween\tits\tparts\tis\nsometimes\timpossible.")]),t._v(" "),a("p",[t._v("Since\tEric\tBrewer\tpublished\this\toriginal\tconjecture,\tthe\tidea\thas\tgained\ta\tmathematical\nproof.\tI’m\tnot\tgoing\tto\tdive\tinto\tthe\tmath\tof\tthe\tproof\titself,\tas\tnot\tonly\tis\tthis\tnot\tthat\nsort\tof\tbook,\tbut\tI\tcan\talso\tguarantee\tthat\tI\twould\tget\tit\twrong.\tInstead,\tlet’s\tuse\tsome\nworked\texamples\tthat\twill\thelp\tus\tunderstand\tthat\tunder\tit\tall,\tthe\tCAP\ttheorem\tis\ta\ndistillation\tof\ta\tvery\tlogical\tset\tof\treasoning.")]),t._v(" "),a("p",[t._v("We’ve\talready\ttalked\tabout\tsome\tsimple\tdatabase\tscaling\ttechniques.\tLet’s\tuse\tone\tof\nthese\tto\tprobe\tthe\tideas\tbehind\tthe\tCAP\ttheorem.\tLet’s\timagine\tthat\tour\tinventory\tservice\nis\tdeployed\tacross\ttwo\tseparate\tdata\tcenters,\tas\tshown\tin\tFigure\t11-8.\tBacking\tour\tservice\ninstance\tin\teach\tdata\tcenter\tis\ta\tdatabase,\tand\tthese\ttwo\tdatabases\ttalk\tto\teach\tother\tto\ttry\nto\tsynchronize\tdata\tbetween\tthem.\tReads\tand\twrites\tare\tdone\tvia\tthe\tlocal\tdatabase\tnode,\nand\treplication\tis\tused\tto\tsynchronize\tthe\tdata\tbetween\tthe\tnodes.")]),t._v(" "),a("p",[t._v("Now\tlet’s\tthink\tabout\twhat\thappens\twhen\tsomething\tfails.\tImagine\tthat\tsomething\tas\nsimple\tas\tthe\tnetwork\tlink\tbetween\tthe\ttwo\tdata\tcenters\tstops\tworking.\tThe\nsynchronization\tat\tthis\tpoint\tfails.\tWrites\tmade\tto\tthe\tprimary\tdatabase\tin\tDC1\twill\tnot\npropagate\tto\tDC2,\tand\tvice\tversa.\tMost\tdatabases\tthat\tsupport\tthese\tsetups\talso\tsupport\nsome\tsort\tof\tqueuing\ttechnique\tto\tensure\tthat\twe\tcan\trecover\tfrom\tthis\tafterward,\tbut\nwhat\thappens\tin\tthe\tmeantime?")]),t._v(" "),a("p",[a("em",[t._v("Figure\t11-8.\tUsing\tmultiprimary\treplication\tto\tshare\tdata\tbetween\ttwo\tdatabase\tnodes")])]),t._v(" "),a("h2",{attrs:{id:"sacrificingconsistency"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#sacrificingconsistency"}},[t._v("#")]),t._v(" Sacrificing\tConsistency")]),t._v(" "),a("p",[t._v("Let’s\tassume\tthat\twe\tdon’t\tshut\tthe\tinventory\tservice\tdown\tentirely.\tIf\tI\tmake\ta\tchange\nnow\tto\tthe\tdata\tin\tDC1,\tthe\tdatabase\tin\tDC2\tdoesn’t\tsee\tit.\tThis\tmeans\tany\trequests\tmade\nto\tour\tinventory\tnode\tin\tDC2\tsee\tpotentially\tstale\tdata.\tIn\tother\twords,\tour\tsystem\tis\tstill\n"),a("em",[t._v("available")]),t._v(" \tin\tthat\tboth\tnodes\tare\table\tto\tserve\trequests,\tand\twe\thave\tkept\tthe\tsystem\nrunning\tdespite\tthe\t "),a("em",[t._v("partition")]),t._v(" ,\tbut\twe\thave\tlost\t "),a("em",[t._v("consistency")]),t._v(" .\tThis\tis\toften\tcalled\ta\t "),a("em",[t._v("AP")]),t._v("\nsystem.\tWe\tdon’t\tget\tto\tkeep\tall\tthree.")]),t._v(" "),a("p",[t._v("During\tthis\tpartition,\tif\twe\tkeep\taccepting\twrites\tthen\twe\taccept\tthe\tfact\tthat\tat\tsome\npoint\tin\tthe\tfuture\tthey\thave\tto\tbe\tresynchronized.\tThe\tlonger\tthe\tpartition\tlasts,\tthe\tmore\ndifficult\tthis\tresynchronization\tcan\tbecome.")]),t._v(" "),a("p",[t._v("The\treality\tis\tthat\teven\tif\twe\tdon’t\thave\ta\tnetwork\tfailure\tbetween\tour\tdatabase\tnodes,\nreplication\tof\tdata\tis\tnot\tinstantaneous.\tAs\ttouched\ton\tearlier,\tsystems\tthat\tare\thappy\tto\ncede\tconsistency\tto\tkeep\tpartition\ttolerance\tand\tavailability\tare\tsaid\tto\tbe\t "),a("em",[t._v("eventually\nconsistent")]),t._v(" ;\tthat\tis,\twe\texpect\tat\tsome\tpoint\tin\tthe\tfuture\tthat\tall\tnodes\twill\tsee\tthe\tupdated\ndata,\tbut\tit\twon’t\thappen\tat\tonce\tso\twe\thave\tto\tlive\twith\tthe\tpossibility\tthat\tusers\tsee\told\ndata.")]),t._v(" "),a("h2",{attrs:{id:"sacrificingavailability"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#sacrificingavailability"}},[t._v("#")]),t._v(" Sacrificing\tAvailability")]),t._v(" "),a("p",[t._v("What\thappens\tif\twe\tneed\tto\tkeep\tconsistency\tand\twant\tto\tdrop\tsomething\telse\tinstead?\nWell,\tto\tkeep\tconsistency,\teach\tdatabase\tnode\tneeds\tto\tknow\tthe\tcopy\tof\tthe\tdata\tit\thas\tis\nthe\tsame\tas\tthe\tother\tdatabase\tnode.\tNow\tin\tthe\tpartition,\tif\tthe\tdatabase\tnodes\tcan’t\ttalk\nto\teach\tother,\tthey\tcannot\tcoordinate\tto\tensure\tconsistency.\tWe\tare\tunable\tto\tguarantee\nconsistency,\tso\tour\tonly\toption\tis\tto\trefuse\tto\trespond\tto\tthe\trequest.\tIn\tother\twords,\twe\nhave\tsacrificed\tavailability.\tOur\tsystem\tis\tconsistent\tand\tpartition\ttolerant,\tor\tCP.\tIn\tthis\nmode\tour\tservice\twould\thave\tto\twork\tout\thow\tto\tdegrade\tfunctionality\tuntil\tthe\tpartition\nis\thealed\tand\tthe\tdatabase\tnodes\tcan\tbe\tresynchronized.")]),t._v(" "),a("p",[t._v("Consistency\tacross\tmultiple\tnodes\tis\treally\thard.\tThere\tare\tfew\tthings\t(perhaps\tnothing)\nharder\tin\tdistributed\tsystems.\tThink\tabout\tit\tfor\ta\tmoment.\tImagine\tI\twant\tto\tread\ta\nrecord\tfrom\tthe\tlocal\tdatabase\tnode.\tHow\tdo\tI\tknow\tit\tis\tup\tto\tdate?\tI\thave\tto\tgo\tand\task\nthe\tother\tnode.\tBut\tI\talso\thave\tto\task\tthat\tdatabase\tnode\tto\tnot\tallow\tit\tto\tbe\tupdated\nwhile\tthe\tread\tcompletes;\tin\tother\twords,\tI\tneed\tto\tinitiate\ta\ttransactional\tread\tacross\nmultiple\tdatabase\tnodes\tto\tensure\tconsistency.\tBut\tin\tgeneral\tpeople\tdon’t\tdo\ntransactional\treads,\tdo\tthey?\tBecause\ttransactional\treads\tare\tslow.\tThey\trequire\tlocks.\tA\nread\tcan\tblock\tan\tentire\tsystem\tup.\tAll\tconsistent\tsystems\trequire\tsome\tlevel\tof\tlocking\tto\ndo\ttheir\tjob.")]),t._v(" "),a("p",[t._v("As\twe’ve\talready\tdiscussed,\tdistributed\tsystems\thave\tto\texpect\tfailure.\tConsider\tour\ntransactional\tread\tacross\ta\tset\tof\tconsistent\tnodes.\tI\task\ta\tremote\tnode\tto\tlock\ta\tgiven\nrecord\twhile\tthe\tread\tis\tinitiated.\tI\tcomplete\tthe\tread,\tand\task\tthe\tremote\tnode\tto\trelease\nits\tlock,\tbut\tnow\tI\tcan’t\ttalk\tto\tit.\tWhat\thappens\tnow?\tLocks\tare\treally\thard\tto\tget\tright\neven\tin\ta\tsingle\tprocess\tsystem,\tand\tare\tsignificantly\tmore\tdifficult\tto\timplement\twell\tin\ta\ndistributed\tsystem.")]),t._v(" "),a("p",[t._v("Remember\twhen\twe\ttalked\tabout\tdistributed\ttransactions\tin\tChapter\t5?\tThe\tcore\treason\nthey\tare\tchallenging\tis\tbecause\tof\tthis\tproblem\twith\tensuring\tconsistency\tacross\tmultiple\nnodes.")]),t._v(" "),a("p",[t._v("Getting\tmultinode\tconsistency\tright\tis\tso\thard\tthat\tI\twould\tstrongly,\t "),a("em",[t._v("strongly")]),t._v(" \tsuggest\tthat\nif\tyou\tneed\tit,\tdon’t\ttry\tto\tinvent\tit\tyourself.\tInstead,\tpick\ta\tdata\tstore\tor\tlock\tservice\tthat\noffers\tthese\tcharacteristics.\tConsul,\tfor\texample,\twhich\twe’ll\tdiscuss\tshortly,\timplements\na\tstrongly\tconsistent\tkey/value\tstore\tdesigned\tto\tshare\tconfiguration\tbetween\tmultiple\nnodes.\tAlong\twith\t“Friends\tdon’t\tlet\tfriends\twrite\ttheir\town\tcrypto”\tshould\tgo\t“Friends\ndon’t\tlet\tfriends\twrite\ttheir\town\tdistributed\tconsistent\tdata\tstore.”\tIf\tyou\tthink\tyou\tneed\tto\nwrite\tyour\town\tCP\tdata\tstore,\tread\tall\tthe\tpapers\ton\tthe\tsubject\tfirst,\tthen\tget\ta\tPhD,\tand\nthen\tlook\tforward\tto\tspending\ta\tfew\tyears\tgetting\tit\twrong.\tMeanwhile,\tI’ll\tbe\tusing\nsomething\toff\tthe\tshelf\tthat\tdoes\tit\tfor\tme,\tor\tmore\tlikely\ttrying\t "),a("em",[t._v("really\thard")]),t._v(" \tto\tbuild\neventually\tconsistent\tAP\tsystems\tinstead.")]),t._v(" "),a("h2",{attrs:{id:"sacrificingpartitiontolerance"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#sacrificingpartitiontolerance"}},[t._v("#")]),t._v(" Sacrificing\tPartition\tTolerance?")]),t._v(" "),a("p",[t._v("We\tget\tto\tpick\ttwo,\tright?\tSo\twe’ve\tgot\tour\teventually\tconsistent\tAP\tsystem.\tWe\thave\tour\nconsistent,\tbut\thard\tto\tbuild\tand\tscale,\tCP\tsystem.\tWhy\tnot\ta\tCA\tsystem?\tWell,\thow\tcan\nwe\tsacrifice\tpartition\ttolerance?\tIf\tour\tsystem\thas\tno\tpartition\ttolerance,\tit\tcan’t\trun\tover\ta\nnetwork.\tIn\tother\twords,\tit\tneeds\tto\tbe\ta\tsingle\tprocess\toperating\tlocally.\tCA\tsystems\ndon’t\texist\tin\tdistributed\tsystems.")]),t._v(" "),a("h2",{attrs:{id:"aporcp"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#aporcp"}},[t._v("#")]),t._v(" AP\tor\tCP?")]),t._v(" "),a("p",[t._v("Which\tis\tright,\tAP\tor\tCP?\tWell,\tthe\treality\tis\t "),a("em",[t._v("it\tdepends")]),t._v(" .\tAs\tthe\tpeople\tbuilding\tthe\nsystem,\twe\tknow\tthe\ttrade-off\texists.\tWe\tknow\tthat\tAP\tsystems\tscale\tmore\teasily\tand\tare\nsimpler\tto\tbuild,\tand\twe\tknow\tthat\ta\tCP\tsystem\twill\trequire\tmore\twork\tdue\tto\tthe\nchallenges\tin\tsupporting\tdistributed\tconsistency.\tBut\twe\tmay\tnot\tunderstand\tthe\tbusiness\nimpact\tof\tthis\ttrade-off.\tFor\tour\tinventory\tsystem,\tif\ta\trecord\tis\tout\tof\tdate\tby\tfive\nminutes,\tis\tthat\tOK?\tIf\tthe\tanswer\tis\tyes,\tan\tAP\tsystem\tmight\tbe\tthe\tanswer.\tBut\twhat\nabout\tthe\tbalance\theld\tfor\ta\tcustomer\tin\ta\tbank?\tCan\tthat\tbe\tout\tof\tdate?\tWithout\nknowing\tthe\tcontext\tin\twhich\tthe\toperation\tis\tbeing\tused,\twe\tcan’t\tknow\tthe\tright\tthing\tto\ndo.\tKnowing\tabout\tthe\tCAP\ttheorem\tjust\thelps\tyou\tunderstand\tthat\tthis\ttrade-off\texists\nand\twhat\tquestions\tto\task.")]),t._v(" "),a("h2",{attrs:{id:"it-snotallornothing"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#it-snotallornothing"}},[t._v("#")]),t._v(" It’s\tNot\tAll\tor\tNothing")]),t._v(" "),a("p",[t._v("Our\tsystem\tas\ta\twhole\tdoesn’t\tneed\tto\tbe\teither\tAP\tor\tCP.\tOur\tcatalog\tcould\tbe\tAP,\tas\twe\ndon’t\tmind\ttoo\tmuch\tabout\ta\tstale\trecord.\tBut\twe\tmight\tdecide\tthat\tour\tinventory\tservice\nneeds\tto\tbe\tCP,\tas\twe\tdon’t\twant\tto\tsell\ta\tcustomer\tsomething\twe\tdon’t\thave\tand\tthen\nhave\tto\tapologize\tlater.")]),t._v(" "),a("p",[t._v("But\tindividual\tservices\tdon’t\teven\tneed\tto\tbe\tCP\tor\tAP.")]),t._v(" "),a("p",[t._v("Let’s\tthink\tabout\tour\tpoints\tbalance\tservice,\twhere\twe\tstore\trecords\tof\thow\tmany\tloyalty\npoints\tour\tcustomers\thave\tbuilt\tup.\tWe\tcould\tdecide\tthat\twe\tdon’t\tcare\tif\tthe\tbalance\twe\nshow\tfor\ta\tcustomer\tis\tstale,\tbut\tthat\twhen\tit\tcomes\tto\tupdating\ta\tbalance\twe\tneed\tit\tto\tbe\nconsistent\tto\tensure\tthat\tcustomers\tdon’t\tuse\tmore\tpoints\tthan\tthey\thave\tavailable.\tIs\tthis\nmicroservice\tCP,\tor\tAP,\tor\tis\tit\tboth?\tReally,\twhat\twe\thave\tdone\tis\tpush\tthe\ttrade-offs\naround\tthe\tCAP\ttheorem\tdown\tto\tindividual\tservice\tcapabilities.")]),t._v(" "),a("p",[t._v("Another\tcomplexity\tis\tthat\tneither\tconsistency\tnor\tavailability\tis\tall\tor\tnothing.\tMany\nsystems\tallow\tus\ta\tfar\tmore\tnuanced\ttrade-off.\tFor\texample,\twith\tCassandra\tI\tcan\tmake\ndifferent\ttrade-offs\tfor\tindividual\tcalls.\tSo\tif\tI\tneed\tstrict\tconsistency,\tI\tcan\tperform\ta\tread\nthat\tblocks\tuntil\tall\treplicas\thave\tresponded\tconfirming\tthe\tvalue\tis\tconsistent,\tor\tuntil\ta\nspecific\tquorum\tof\treplicas\thave\tresponded,\tor\teven\tjust\ta\tsingle\tnode.\tObviously,\tif\tI\nblock\twaiting\tfor\tall\treplicas\tto\treport\tback\tand\tone\tof\tthem\tis\tunavailable,\tI’ll\tbe\nblocking\tfor\ta\tlong\ttime.\tBut\tif\tI\tam\tsatisfied\twith\tjust\ta\tsimple\tquorum\tof\tnodes\nreporting\tback,\tI\tcan\taccept\tsome\tlack\tof\tconsistency\tto\tbe\tless\tvulnerable\tto\ta\tsingle\nreplica\tbeing\tunavailable.")]),t._v(" "),a("p",[t._v("You’ll\toften\tsee\tposts\tabout\tpeople\t "),a("em",[t._v("beating")]),t._v(" \tthe\tCAP\ttheorem.\tThey\thaven’t.\tWhat\tthey\nhave\tdone\tis\tcreate\ta\tsystem\twhere\tsome\tcapabilities\tare\tCP,\tand\tsome\tare\tAP.\tThe\nmathematical\tproof\tbehind\tthe\tCAP\ttheorem\tholds.\tDespite\tmany\tattempts\tat\tschool,\tI’ve\nlearned\tthat\tyou\tdon’t\tbeat\tmath.")]),t._v(" "),a("h2",{attrs:{id:"andtherealworld"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#andtherealworld"}},[t._v("#")]),t._v(" And\tthe\tReal\tWorld")]),t._v(" "),a("p",[t._v("Much\tof\twhat\twe’ve\ttalked\tabout\tis\tthe\telectronic\tworld\t—\tbits\tand\tbytes\tstored\tin\nmemory.\tWe\ttalk\tabout\tconsistency\tin\tan\talmost\tchild-like\tfashion;\twe\timagine\tthat\twithin\nthe\tscope\tof\tthe\tsystem\twe\thave\tcreated,\twe\tcan\tstop\tthe\tworld\tand\thave\tit\tall\tmake\tsense.\nAnd\tyet\tso\tmuch\tof\twhat\twe\tbuild\tis\tjust\ta\treflection\tof\tthe\treal\tworld,\tand\twe\tdon’t\tget\tto\ncontrol\tthat,\tdo\twe?")]),t._v(" "),a("p",[t._v("Let’s\trevisit\tour\tinventory\tsystem.\tThis\tmaps\tto\treal-world,\tphysical\titems.\tWe\tkeep\ta\ncount\tin\tour\tsystem\tof\thow\tmany\talbums\twe\thave.\tAt\tthe\tstart\tof\tthe\tday\twe\thad\t100\ncopies\tof\t "),a("em",[t._v("Give\tBlood")]),t._v(" \tby\tThe\tBrakes.\tWe\tsold\tone.\tNow\twe\thave\t99\tcopies.\tEasy,\tright?\nBy\twhat\thappens\tif\twhen\tthe\torder\twas\tbeing\tsent\tout,\tsomeone\tknocks\ta\tcopy\tof\tthe\nalbum\tonto\tthe\tfloor\tand\tit\tgets\tstepped\ton\tand\tbroken?\tWhat\thappens\tnow?\tOur\tsystems\nsay\t99,\tbut\tthere\tare\t98\tcopies\ton\tthe\tshelf.")]),t._v(" "),a("p",[t._v("What\tif\twe\tmade\tour\tinventory\tsystem\tAP\tinstead,\tand\toccasionally\thad\tto\tcontact\ta\tuser\nlater\ton\tand\ttell\thim\tthat\tone\tof\this\titems\tis\tactually\tout\tof\tstock?\tWould\tthat\tbe\tthe\tworst\nthing\tin\tthe\tworld?\tIt\twould\tcertainly\tbe\tmuch\teasier\tto\tbuild,\tscale,\tand\tensure\tit\tis\ncorrect.")]),t._v(" "),a("p",[t._v("We\thave\tto\trecognize\tthat\tno\tmatter\thow\tconsistent\tour\tsystems\tmight\tbe\tin\tand\tof\nthemselves,\tthey\tcannot\tknow\teverything\tthat\thappens,\tespecially\twhen\twe’re\tkeeping\nrecords\tof\tthe\treal\tworld.\tThis\tis\tone\tof\tthe\tmain\treasons\twhy\tAP\tsystems\tend\tup\tbeing\nthe\tright\tcall\tin\tmany\tsituations.\tAside\tfrom\tthe\tcomplexity\tof\tbuilding\tCP\tsystems,\tthey\ncan’t\tfix\tall\tour\tproblems\tanyway.")]),t._v(" "),a("h2",{attrs:{id:"servicediscovery"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#servicediscovery"}},[t._v("#")]),t._v(" Service\tDiscovery")]),t._v(" "),a("p",[t._v("Once\tyou\thave\tmore\tthan\ta\tfew\tmicroservices\tlying\taround,\tyour\tattention\tinevitably\nturns\tto\tknowing\twhere\ton\tearth\teverything\tis.\tPerhaps\tyou\twant\tto\tknow\twhat\tis\trunning\nin\ta\tgiven\tenvironment\tso\tyou\tknow\twhat\tyou\tshould\tbe\tmonitoring.\tMaybe\tit’s\tas\tsimple\nas\tknowing\twhere\tyour\taccounts\tservice\tis\tso\tthat\tthose\tmicroservices\tthat\tuse\tit\tknow\nwhere\tto\tfind\tit.\tOr\tperhaps\tyou\tjust\twant\tto\tmake\tit\teasy\tfor\tdevelopers\tin\tyour\norganization\tto\tknow\twhat\tAPIs\tare\tavailable\tso\tthey\tdon’t\treinvent\tthe\twheel.\tBroadly\nspeaking,\tall\tof\tthese\tuse\tcases\tfall\tunder\tthe\tbanner\tof\t "),a("em",[t._v("service\tdiscovery")]),t._v(" .\tAnd\tas\talways\nwith\tmicroservices,\twe\thave\tquite\ta\tfew\tdifferent\toptions\tat\tour\tdisposal\tfor\tdealing\twith\nit.")]),t._v(" "),a("p",[t._v("All\tof\tthe\tsolutions\twe’ll\tlook\tat\thandle\tthings\tin\ttwo\tparts.\tFirst,\tthey\tprovide\tsome\nmechanism\tfor\tan\tinstance\tto\tregister\titself\tand\tsay,\t“I’m\there!”\tSecond,\tthey\tprovide\ta\nway\tto\tfind\tthe\tservice\tonce\tit’s\tregistered.\tService\tdiscovery\tgets\tmore\tcomplicated,\nthough,\twhen\twe\tare\tconsidering\tan\tenvironment\twhere\twe\tare\tconstantly\tdestroying\tand\ndeploying\tnew\tinstances\tof\tservices.\tIdeally,\twe’d\twant\twhatever\tsolution\twe\tpick\tto\tcope\nwith\tthis.")]),t._v(" "),a("p",[t._v("Let’s\tlook\tat\tsome\tof\tthe\tmost\tcommon\tsolutions\tto\tservice\tdelivery\tand\tconsider\tour\noptions.")]),t._v(" "),a("h2",{attrs:{id:"dns"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#dns"}},[t._v("#")]),t._v(" DNS")]),t._v(" "),a("p",[t._v("It’s\tnice\tto\tstart\tsimple.\tDNS\tlets\tus\tassociate\ta\tname\twith\tthe\tIP\taddress\tof\tone\tor\tmore\nmachines.\tWe\tcould\tdecide,\tfor\texample,\tthat\tour\taccounts\tservice\tis\talways\tfound\tat\n"),a("em",[t._v("accounts.musiccorp.com")]),t._v(" .\tWe\twould\tthen\thave\tthat\tentry\tpoint\tto\tthe\tIP\taddress\tof\tthe\thost\nrunning\tthat\tservice,\tor\tperhaps\thave\tit\tresolve\tto\ta\tload\tbalancer\tthat\tis\tdistributing\tload\nacross\ta\tnumber\tof\tinstances.\tThis\tmeans\twe’d\thave\tto\thandle\tupdating\tthese\tentries\tas\npart\tof\tdeploying\tour\tservice.")]),t._v(" "),a("p",[t._v("When\tdealing\twith\tinstances\tof\ta\tservice\tin\tdifferent\tenvironments,\tI\thave\tseen\ta\nconvention-based\tdomain\ttemplate\twork\twell.\tFor\texample,\twe\tmight\thave\ta\ttemplate\ndefined\tas\t "),a("em",[a("servicename",[t._v("-"),a("environment",[t._v(".musiccorp.com")])],1)],1),t._v(" ,\tgiving\tus\tentries\tlike\n"),a("em",[t._v("accounts-uat.musiccorp.com")]),t._v(" \tor\t "),a("em",[t._v("accounts-dev.musiccorp.com")]),t._v(".")]),t._v(" "),a("p",[t._v("A\tmore\tadvanced\tway\tof\thandling\tdifferent\tenvironments\tis\tto\thave\tdifferent\tdomain\nname\tservers\tfor\tdifferent\tenvironments.\tSo\tI\tcould\tassume\tthat\t "),a("em",[t._v("accounts.musiccorp.com")]),t._v("\nis\twhere\tI\talways\tfind\tthe\taccounts\tservice,\tbut\tit\tcould\tresolve\tto\tdifferent\thosts\ndepending\ton\twhere\tI\tdo\tthe\tlookup.\tIf\tyou\talready\thave\tyour\tenvironments\tsitting\tin\ndifferent\tnetwork\tsegments\tand\tare\tcomfortable\twith\tmanaging\tyour\town\tDNS\tservers\nand\tentries,\tthis\tcould\tbe\tquite\ta\tneat\tsolution,\tbut\tit\tis\ta\tlot\tof\twork\tif\tyou\taren’t\tgetting\nother\tbenefits\tfrom\tthis\tsetup.")]),t._v(" "),a("p",[t._v("DNS\thas\ta\thost\tof\tadvantages,\tthe\tmain\tone\tbeing\tit\tis\tsuch\ta\twell-understood\tand\twell-\nused\tstandard\tthat\talmost\tany\ttechnology\tstack\twill\tsupport\tit.\tUnfortunately,\twhile\ta\nnumber\tof\tservices\texist\tfor\tmanaging\tDNS\tinside\tan\torganization,\tfew\tof\tthem\tseem\ndesigned\tfor\tan\tenvironment\twhere\twe\tare\tdealing\twith\thighly\tdisposable\thosts,\tmaking\nupdating\tDNS\tentries\tsomewhat\tpainful.\tAmazon’s\tRoute53\tservice\tdoes\ta\tpretty\tgood\njob\tof\tthis,\tbut\tI\thaven’t\tseen\ta\tself-hosted\toption\tthat\tis\tas\tgood\tyet,\talthough\t(as\twe’ll\ndiscuss\tshortly)\tConsul\tmay\thelp\tus\there.\tAside\tfrom\tthe\tproblems\tin\tupdating\tDNS\nentries,\tthe\tDNS\tspecification\titself\tcan\tcause\tus\tsome\tissues.")]),t._v(" "),a("p",[t._v("DNS\tentries\tfor\tdomain\tnames\thave\ta\t "),a("em",[t._v("time\tto\tlive")]),t._v(" \t(TTL).\tThis\tis\thow\tlong\ta\tclient\tcan\nconsider\tthe\tentry\tfresh.\tWhen\twe\twant\tto\tchange\tthe\thost\tto\twhich\tthe\tdomain\tname\nrefers,\twe\tupdate\tthat\tentry,\tbut\twe\thave\tto\tassume\tthat\tclients\twill\tbe\tholding\ton\tto\tthe\nold\tIP\tfor\t "),a("em",[t._v("at\tleast")]),t._v(" \tas\tlong\tas\tthe\tTTL\tstates.\tDNS\tentries\tcan\tget\tcached\tin\tmultiple\tplaces\n(even\tthe\tJVM\twill\tcache\tDNS\tentries\tunless\tyou\ttell\tit\tnot\tto),\tand\tthe\tmore\tplaces\tthey\nare\tcached\tin,\tthe\tmore\tstale\tthe\tentry\tcan\tbe.")]),t._v(" "),a("p",[t._v("One\tway\tto\twork\taround\tthis\tproblem\tis\tto\thave\tthe\tdomain\tname\tentry\tfor\tyour\tservice\npoint\tto\ta\tload\tbalancer,\twhich\tin\tturn\tpoints\tto\tthe\tinstances\tof\tyour\tservice,\tas\tshown\tin\nFigure\t11-9.\tWhen\tyou\tdeploy\ta\tnew\tinstance,\tyou\tcan\ttake\tthe\told\tone\tout\tof\tthe\tload-\nbalancer\tentry\tand\tadd\tthe\tnew\tone.\tSome\tpeople\tuse\tDNS\tround-robining,\twhere\tthe\nDNS\tentries\tthemselves\trefer\tto\ta\tgroup\tof\tmachines.\tThis\ttechnique\tis\textremely\nproblematic,\tas\tthe\tclient\tis\thidden\tfrom\tthe\tunderlying\thost,\tand\ttherefore\tcannot\teasily")]),t._v(" "),a("p",[t._v("stop\trouting\ttraffic\tto\tone\tof\tthe\thosts\tshould\tit\tbecome\tsick.")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("Figure\t11-9.\tUsing\tDNS\tto\tresolve\tto\ta\tload\tbalancer\tto\tavoid\tstale\tDNS\tentries\n")])])]),a("p",[t._v("As\tmentioned,\tDNS\tis\twell\tunderstood\tand\twidely\tsupported.\tBut\tit\tdoes\thave\tone\tor\ttwo\ndownsides.\tI\twould\tsuggest\tinvestigating\twhether\tit\tis\ta\tgood\tfit\tfor\tyou\tbefore\tpicking\nsomething\tmore\tcomplex.\tFor\ta\tsituation\twhere\tyou\thave\tonly\tsingle\tnodes,\thaving\tDNS\nrefer\tdirectly\tto\thosts\tis\tprobably\tfine.\tBut\tfor\tthose\tsituations\twhere\tyou\tneed\tmore\tthan\none\tinstance\tof\ta\thost,\thave\tDNS\tentries\tresolve\tto\tload\tbalancers\tthat\tcan\thandle\tputting\nindividual\thosts\tinto\tand\tout\tof\tservice\tas\tappropriate.")]),t._v(" "),a("h2",{attrs:{id:"dynamicserviceregistries"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#dynamicserviceregistries"}},[t._v("#")]),t._v(" Dynamic\tService\tRegistries")]),t._v(" "),a("p",[t._v("The\tdownsides\tof\tDNS\tas\ta\tway\tof\tfinding\tnodes\tin\ta\thighly\tdynamic\tenvironment\thave\nled\tto\ta\tnumber\tof\talternative\tsystems,\tmost\tof\twhich\tinvolve\tthe\tservice\tregistering\titself\nwith\tsome\tcentral\tregistry,\twhich\tin\tturn\toffers\tthe\tability\tto\tlook\tup\tthese\tservices\tlater\non.\tOften,\tthese\tsystems\tdo\tmore\tthan\tjust\tproviding\tservice\tregistration\tand\tdiscovery,\nwhich\tmay\tor\tmay\tnot\tbe\ta\tgood\tthing.\tThis\tis\ta\tcrowded\tfield,\tso\twe’ll\tjust\tlook\tat\ta\tfew\noptions\tto\tgive\tyou\ta\tsense\tof\twhat\tis\tavailable.")]),t._v(" "),a("h2",{attrs:{id:"zookeeper"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#zookeeper"}},[t._v("#")]),t._v(" Zookeeper")]),t._v(" "),a("p",[t._v("Zookeeper\twas\toriginally\tdeveloped\tas\tpart\tof\tthe\tHadoop\tproject.\tIt\tis\tused\tfor\tan\talmost\nbewildering\tarray\tof\tuse\tcases,\tincluding\tconfiguration\tmanagement,\tsynchronizing\tdata\nbetween\tservices,\tleader\telection,\tmessage\tqueues,\tand\t(usefully\tfor\tus)\tas\ta\tnaming\nservice.")]),t._v(" "),a("p",[t._v("Like\tmany\tsimilar\ttypes\tof\tsystems,\tZookeeper\trelies\ton\trunning\ta\tnumber\tof\tnodes\tin\ta\ncluster\tto\tprovide\tvarious\tguarantees.\tThis\tmeans\tyou\tshould\texpect\tto\tbe\trunning\tat\tleast\nthree\tZookeeper\tnodes.\tMost\tof\tthe\tsmarts\tin\tZookeeper\tare\taround\tensuring\tthat\tdata\tis\nreplicated\tsafely\tbetween\tthese\tnodes,\tand\tthat\tthings\tremain\tconsistent\twhen\tnodes\tfail.")]),t._v(" "),a("p",[t._v("At\tits\theart,\tZookeeper\tprovides\ta\thierarchical\tnamespace\tfor\tstoring\tinformation.\tClients\ncan\tinsert\tnew\tnodes\tin\tthis\thierarchy,\tchange\tthem,\tor\tquery\tthem.\tFurthermore,\tthey\tcan\nadd\twatches\tto\tnodes\tto\tbe\ttold\twhen\tthey\tchange.\tThis\tmeans\twe\tcould\tstore\tthe\ninformation\tabout\twhere\tour\tservices\tare\tlocated\tin\tthis\tstructure,\tand\tas\ta\tclient\tbe\ttold\nwhen\tthey\tchange.\tZookeeper\tis\toften\tused\tas\ta\tgeneral\tconfiguration\tstore,\tso\tyou\tcould\nalso\tstore\tservice-specific\tconfiguration\tin\tit,\tallowing\tyou\tto\tdo\ttasks\tlike\tdynamically\nchanging\tlog\tlevels\tor\tturning\toff\tfeatures\tof\ta\trunning\tsystem.\tPersonally,\tI\ttend\tto\tshy\naway\tfrom\tthe\tuse\tof\tsystems\tlike\tZookeeper\tas\ta\tconfiguration\tsource,\tas\tI\tthink\tit\tcan\nmake\tit\tharder\tto\treason\tabout\tthe\tbehavior\tof\ta\tgiven\tservice.")]),t._v(" "),a("p",[t._v("Zookeeper\titself\tis\tfairly\tgeneric\tin\twhat\tit\toffers,\twhich\tis\twhy\tit\tis\tused\tfor\tso\tmany\tuse\ncases.\tYou\tcan\tthink\tof\tit\tjust\tas\ta\treplicated\ttree\tof\tinformation\tthat\tyou\tcan\tbe\talerted\nabout\twhen\tit\tchanges.\tThis\tmeans\tthat\tyou’ll\ttypically\tbuild\tthings\ton\ttop\tof\tit\tto\tsuit\nyour\tparticular\tuse\tcase.\tLuckily,\tclient\tlibraries\texist\tfor\tmost\tlanguages\tout\tthere.")]),t._v(" "),a("p",[t._v("In\tthe\tgrand\tscheme\tof\tthings,\tZookeeper\tcould\tbe\tconsidered\t "),a("em",[t._v("old")]),t._v(" \tby\tnow,\tand\tdoesn’t\nprovide\tus\tthat\tmuch\tfunctionality\tout\tof\tthe\tbox\tto\thelp\twith\tservice\tdiscovery\tcompared\nto\tsome\tof\tthe\tnewer\talternatives.\tThat\tsaid,\tit\tis\tcertainly\ttried\tand\ttested,\tand\twidely\nused.\tThe\tunderlying\talgorithms\tZookeeper\timplements\tare\tquite\thard\tto\tget\tright.\tI\tknow\none\tdatabase\tvendor,\tfor\texample,\tthat\twas\tusing\tZookeeper\tjust\tfor\tleader\telection\tin\norder\tto\tensure\tthat\ta\tprimary\tnode\tgot\tproperly\tpromoted\tduring\tfailure\tconditions.\tThe\nclient\tfelt\tthat\tZookeeper\twas\ttoo\theavyweight\tand\tspent\ta\tlong\ttime\tironing\tout\tbugs\tin\nits\town\timplementation\tof\tthe\tPAXOS\talgorithm\tto\treplace\twhat\tZookeeper\tdid.\tPeople\noften\tsay\tyou\tshouldn’t\twrite\tyour\town\tcryptography\tlibraries.\tI’d\textend\tthat\tby\tsaying\nyou\tshouldn’t\twrite\tyour\town\tdistributed\tcoordination\tsystems\teither.\tThere\tis\ta\tlot\tto\tbe\nsaid\tfor\tusing\texisting\tstuff\tthat\tjust\tworks.")]),t._v(" "),a("h2",{attrs:{id:"consul"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#consul"}},[t._v("#")]),t._v(" Consul")]),t._v(" "),a("p",[t._v("Like\tZookeeper,\tConsul\tsupports\tboth\tconfiguration\tmanagement\tand\tservice\tdiscovery.\nBut\tit\tgoes\tfurther\tthan\tZookeeper\tin\tproviding\tmore\tsupport\tfor\tthese\tkey\tuse\tcases.\tFor\nexample,\tit\texposes\tan\tHTTP\tinterface\tfor\tservice\tdiscovery,\tand\tone\tof\tConsul’s\tkiller\nfeatures\tis\tthat\tit\tactually\tprovides\ta\tDNS\tserver\tout\tof\tthe\tbox;\tspecifically,\tit\tcan\tserve\nSRV\trecords,\twhich\tgive\tyou\tboth\tan\tIP\tand\tport\tfor\ta\tgiven\tname.\tThis\tmeans\tif\tpart\tof\nyour\tsystem\tuses\tDNS\talready\tand\tcan\tsupport\tSRV\trecords,\tyou\tcan\tjust\tdrop\tin\tConsul\nand\tstart\tusing\tit\twithout\tany\tchanges\tto\tyour\texisting\tsystem.")]),t._v(" "),a("p",[t._v("Consul\talso\tbuilds\tin\tother\tcapabilities\tthat\tyou\tmight\tfind\tuseful,\tsuch\tas\tthe\tability\tto\nperform\thealth\tchecks\ton\tnodes.\tThis\tmeans\tthat\tConsul\tcould\twell\toverlap\tthe\ncapabilities\tprovided\tby\tother\tdedicated\tmonitoring\ttools,\talthough\tyou\twould\tmore\tlikely\nuse\tConsul\tas\ta\tsource\tof\tthis\tinformation\tand\tthen\tpull\tit\tinto\ta\tmore\tcomprehensive\ndashboard\tor\talerting\tsystem.\tConsul’s\thighly\tfault-tolerant\tdesign\tand\tfocus\ton\thandling\nsystems\tthat\tmake\theavy\tuse\tof\tephemeral\tnodes\tdoes\tmake\tme\twonder,\tthough,\tif\tit\tmay\nend\tup\treplacing\tsystems\tlike\tNagios\tand\tSensu\tfor\tsome\tuse\tcases.")]),t._v(" "),a("p",[t._v("Consul\tuses\ta\tRESTful\tHTTP\tinterface\tfor\teverything\tfrom\tregistering\ta\tservice,\tquerying\nthe\tkey/value\tstore,\tor\tinserting\thealth\tchecks.\tThis\tmakes\tintegration\twith\tdifferent\ntechnology\tstacks\tvery\tstraightforward.\tOne\tof\tthe\tother\tthings\tI\treally\tlike\tabout\tConsul\nis\tthat\tthe\tteam\tbehind\tit\thas\tsplit\tout\tthe\tunderlying\tcluster\tmanagement\tpiece.\tSerf,\nwhich\tConsul\tsits\ton\ttop\tof,\thandles\tdetection\tof\tnodes\tin\ta\tcluster,\tfailure\tmanagement,\nand\talerting.\tConsul\tthen\tadds\tservice\tdiscovery\tand\tconfiguration\tmanagement.\tThis\nseparation\tof\tconcerns\tappeals\tto\tme,\twhich\tshould\tbe\tno\tsurprise\tto\tyou\tgiven\tthe\tthemes\nthat\trun\tthrough\tthis\tbook!")]),t._v(" "),a("p",[t._v("Consul\tis\tvery\tnew,\tand\tgiven\tthe\tcomplexity\tof\tthe\talgorithms\tit\tuses,\tthis\twould\nnormally\tmake\tme\thesitant\tin\trecommending\tit\tfor\tsuch\tan\timportant\tjob.\tThat\tsaid,\nHashicorp,\tthe\tteam\tbehind\tit,\tcertainly\thas\ta\tgreat\ttrack\trecord\tin\tcreating\tvery\tuseful\nopen\tsource\ttechnology\t(in\tthe\tform\tof\tboth\tPacker\tand\tVagrant),\tthe\tproject\tis\tbeing\nactively\tdeveloped,\tand\tI’ve\tspoken\tto\ta\tfew\tpeople\twho\tare\thappily\tusing\tit\tin\nproduction.\tGiven\tthat,\tI\tthink\tit\tis\twell\tworth\ta\tlook.")]),t._v(" "),a("h2",{attrs:{id:"eureka"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#eureka"}},[t._v("#")]),t._v(" Eureka")]),t._v(" "),a("p",[t._v("Netflix’s\topen\tsource\tEureka\tsystem\tbucks\tthe\ttrend\tof\tsystems\tlike\tConsul\tand\nZookeeper\tin\tthat\tit\tdoesn’t\talso\ttry\tto\tbe\ta\tgeneral-purpose\tconfiguration\tstore.\tIt\tis\nactually\tvery\ttargeted\tin\tits\tuse\tcase.")]),t._v(" "),a("p",[t._v("Eureka\talso\tprovides\tbasic\tload-balancing\tcapabilities\tin\tthat\tit\tcan\tsupport\tbasic\tround-\nrobin\tlookup\tof\tservice\tinstances.\tIt\tprovides\ta\tREST-based\tendpoint\tso\tyou\tcan\twrite\nyour\town\tclients,\tor\tyou\tcan\tuse\tits\town\tJava\tclient.\tThe\tJava\tclient\tprovides\tadditional\ncapabilities,\tsuch\tas\thealth\tchecking\tof\tinstances.\tObviously\tif\tyou\tbypass\tEureka’s\town\nclient\tand\tgo\tdirectly\tto\tthe\tREST\tendpoint,\tyou’re\ton\tyour\town\tthere.")]),t._v(" "),a("p",[t._v("By\thaving\tthe\tclients\tdeal\twith\tservice\tdiscovery\tdirectly,\twe\tavoid\tthe\tneed\tfor\ta\tseparate\nprocess.\tHowever,\tyou\tdo\trequire\tthat\tevery\tclient\timplement\tservice\tdiscovery.\tNetflix,\nwhich\tstandardizes\ton\tthe\tJVM,\tachieves\tthis\tby\thaving\tall\tclients\tuse\tEureka.\tIf\tyou’re\tin\na\tmore\tpolyglot\tenvironment,\tthis\tmay\tbe\tmore\tof\ta\tchallenge.")]),t._v(" "),a("h2",{attrs:{id:"rollingyourown"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#rollingyourown"}},[t._v("#")]),t._v(" Rolling\tYour\tOwn")]),t._v(" "),a("p",[t._v("One\tapproach\tI\thave\tused\tmyself\tand\tseen\tdone\telsewhere\tis\tto\troll\tyour\town\tsystem.\tOn\none\tproject\twe\twere\tmaking\theavy\tuse\tof\tAWS,\twhich\toffers\tthe\tability\tto\tadd\ttags\tto\ninstances.\tWhen\tlaunching\tservice\tinstances,\tI\twould\tapply\ttags\tto\thelp\tdefine\twhat\tthe\ninstance\twas\tand\twhat\tit\twas\tused\tfor.\tThese\tallowed\tfor\tsome\trich\tmetadata\tto\tbe\nassociated\twith\ta\tgiven\thost,\tfor\texample:")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("service\t=\taccounts\n")])])]),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("environment\t=\tproduction\n")])])]),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("version\t=\t154\n")])])]),a("p",[t._v("I\tcould\tthen\tuse\tthe\tAWS\tAPIs\tto\tquery\tall\tthe\tinstances\tassociated\twith\ta\tgiven\tAWS\naccount\tto\tfind\tmachines\tI\tcared\tabout.\tHere,\tAWS\titself\tis\thandling\tthe\tstoring\tof\tthe\nmetadata\tassociated\twith\teach\tinstance,\tand\tproviding\tus\twith\tthe\tability\tto\tquery\tit.\tI\tthen\nbuilt\tcommand-line\ttools\tfor\tinteracting\twith\tthese\tinstances,\tand\tmaking\tdashboards\tfor\nstatus\tmonitoring\tbecomes\tfairly\teasy,\tespecially\tif\tyou\tadopt\tthe\tidea\tof\thaving\teach\nservice\tinstance\texposing\thealth\tcheck\tdetails.")]),t._v(" "),a("p",[t._v("The\tlast\ttime\tI\tdid\tthis\twe\tdidn’t\tgo\tas\tfar\tas\thaving\tservices\tuse\tthe\tAWS\tAPIs\tto\tfind\ntheir\tservice\tdependencies,\tbut\tthere\tis\tno\treason\twhy\tyou\tcouldn’t.\tObviously,\tif\tyou\nwant\tupstream\tservices\tto\tbe\talerted\twhen\tthe\tlocation\tof\ta\tdownstream\tservice\tchanges,\nyou’re\ton\tyour\town.")]),t._v(" "),a("h2",{attrs:{id:"don-tforgetthehumans"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#don-tforgetthehumans"}},[t._v("#")]),t._v(" Don’t\tForget\tthe\tHumans!")]),t._v(" "),a("p",[t._v("The\tsystems\twe’ve\tlooked\tat\tso\tfar\tmake\tit\teasy\tfor\ta\tservice\tinstance\tto\tregister\titself\tand\nlook\tup\tother\tservices\tit\tneeds\tto\ttalk\tto.\tBut\tas\thumans\twe\tsometimes\twant\tthis\ninformation\ttoo.\tWhatever\tsystem\tyou\tpick,\tmake\tsure\tyou\thave\ttools\tavailable\tthat\tlet\nyou\tbuild\treports\tand\tdashboards\ton\ttop\tof\tthese\tregistries\tto\tcreate\tdisplays\tfor\thumans,\nnot\tjust\tfor\tcomputers.")]),t._v(" "),a("h2",{attrs:{id:"documentingservices"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#documentingservices"}},[t._v("#")]),t._v(" Documenting\tServices")]),t._v(" "),a("p",[t._v("By\tdecomposing\tour\tsystems\tinto\tfiner-grained\tmicroservices,\twe’re\thoping\tto\texpose\tlots\nof\tseams\tin\tthe\tform\tof\tAPIs\tthat\tpeople\tcan\tuse\tto\tdo\tmany,\thopefully\twonderful,\tthings.\nIf\tyou\tget\tyour\tdiscovery\tright,\twe\tknow\twhere\tthings\tare.\tBut\thow\tdo\twe\tknow\twhat\nthose\tthings\tdo,\tor\thow\tto\tuse\tthem?\tOne\toption\tis\tobviously\tto\thave\tdocumentation\tabout\nthe\tAPIs.\tOf\tcourse,\tdocumentation\tcan\toften\tbe\tout\tof\tdate.\tIdeally,\twe’d\tensure\tthat\tour\ndocumentation\tis\talways\tup\tto\tdate\twith\tthe\tmicroservice\tAPI,\tand\tmake\tit\teasy\tto\tsee\tthis\ndocumentation\twhen\twe\tknow\twhere\ta\tservice\tendpoint\tis.\tTwo\tdifferent\tpieces\tof\ntechnology,\tSwagger\tand\tHAL,\ttry\tto\tmake\tthis\ta\treality,\tand\tboth\tare\tworth\tlooking\tat.")]),t._v(" "),a("h2",{attrs:{id:"swagger"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#swagger"}},[t._v("#")]),t._v(" Swagger")]),t._v(" "),a("p",[t._v("Swagger\tlets\tyou\tdescribe\tyour\tAPI\tin\torder\tto\tgenerate\ta\tvery\tnice\tweb\tUI\tthat\tallows\nyou\tto\tview\tthe\tdocumentation\tand\tinteract\twith\tthe\tAPI\tvia\ta\tweb\tbrowser.\tThe\tability\tto\nexecute\trequests\tis\tvery\tnice:\tyou\tcan\tdefine\tPOST\ttemplates,\tfor\texample,\tmaking\tit\nclear\twhat\tsort\tof\tcontent\tthe\tserver\texpects.")]),t._v(" "),a("p",[t._v("To\tdo\tall\tof\tthis,\tSwagger\tneeds\tthe\tservice\tto\texpose\ta\tsidecar\tfile\tmatching\tthe\tSwagger\nformat.\tSwagger\thas\ta\tnumber\tof\tlibraries\tfor\tdifferent\tlanguages\tthat\tdoes\tthis\tfor\tyou.\nFor\texample,\tfor\tJava\tyou\tcan\tannotate\tmethods\tthat\tmatch\tyour\tAPI\tcalls,\tand\tthe\tfile\ngets\tgenerated\tfor\tyou.")]),t._v(" "),a("p",[t._v("I\tlike\tthe\tend-user\texperience\tthat\tSwagger\tgives\tyou,\tbut\tit\tdoes\tlittle\tfor\tthe\tincremental\nexploration\tconcept\tat\tthe\theart\tof\thypermedia.\tStill,\tit’s\ta\tpretty\tnice\tway\tto\texpose\ndocumentation\tabout\tyour\tservices.")]),t._v(" "),a("h2",{attrs:{id:"halandthehalbrowser"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#halandthehalbrowser"}},[t._v("#")]),t._v(" HAL\tand\tthe\tHAL\tBrowser")]),t._v(" "),a("p",[t._v("By\titself,\tthe\tHypertext\tApplication\tLanguage\t(HAL)\tis\ta\tstandard\tthat\tdescribes\nstandards\tfor\thypermedia\tcontrols\tthat\twe\texpose.\tAs\twe\tcovered\tin\tChapter\t4,\nhypermedia\tcontrols\tare\tthe\tmeans\tby\twhich\twe\tallow\tclients\tto\tprogressively\texplore\tour\nAPIs\tto\tuse\tour\tservice’s\tcapabilities\tin\ta\tless\tcoupled\tfashion\tthan\tother\tintegration\ntechniques.\tIf\tyou\tdecide\tto\tadopt\tHAL’s\thypermedia\tstandard,\tthen\tnot\tonly\tcan\tyou\nmake\tuse\tof\ta\twide\tnumber\tof\tclient\tlibraries\tfor\tconsuming\tthe\tAPI\t(at\tthe\ttime\tof\nwriting,\tthe\tHAL\twiki\tlisted\t50\tsupporting\tlibraries\tfor\ta\tnumber\tof\tdifferent\tlanguages),\nbut\tyou\tcan\talso\tmake\tuse\tof\tthe\tHAL\tbrowser,\twhich\tgives\tyou\ta\tway\tto\texplore\tthe\tAPI\nvia\ta\tweb\tbrowser.")]),t._v(" "),a("p",[t._v("Like\tSwagger,\tthis\tUI\tcan\tbe\tused\tnot\tonly\tto\tact\tas\tliving\tdocumentation,\tbut\talso\tto\nexecute\tcalls\tagainst\tthe\tservice\titself.\tExecuting\tcalls\tisn’t\tquite\tas\tslick,\tthough.\nWhereas\twith\tSwagger\tyou\tcan\tdefine\ttemplates\tto\tdo\tthings\tlike\tissue\ta\tPOST\trequest,\nwith\tHAL\tyou’re\tmore\ton\tyour\town.\tThe\tflipside\tto\tthis\tis\tthat\tthe\tinherent\tpower\tof\nhypermedia\tcontrols\tlets\tyou\tmuch\tmore\teffectively\texplore\tthe\tAPI\texposed\tby\tthe\nservice,\tas\tyou\tcan\tfollow\tlinks\taround\tvery\teasily.\tIt\tturns\tout\tthat\tweb\tbrowsers\tare\npretty\tgood\tat\tthat\tsort\tof\tthing!")]),t._v(" "),a("p",[t._v("Unlike\twith\tSwagger,\tall\tthe\tinformation\tneeded\tto\tdrive\tthis\tdocumentation\tand\tsandbox\nis\tembedded\tin\tthe\thypermedia\tcontrols.\tThis\tis\ta\tdouble-edged\tsword.\tIf\tyou\tare\talready\nusing\thypermedia\tcontrols,\tit\ttakes\tlittle\teffort\tto\texpose\ta\tHAL\tbrowser\tand\thave\tclients\nexplore\tyour\tAPI.\tHowever,\tif\tyou\taren’t\tusing\thypermedia,\tyou\teither\tcan’t\tuse\tHAL\tor\nhave\tto\tretrofit\tyour\tAPI\tto\tuse\thypermedia,\twhich\tis\tlikely\tto\tbe\tan\texercise\tthat\tbreaks\nexisting\tconsumers.")]),t._v(" "),a("p",[t._v("The\tfact\tthat\tHAL\talso\tdescribes\ta\thypermedia\tstandard\twith\tsome\tsupporting\tclient\nlibraries\tis\tan\tadded\tbonus,\tand\tI\tsuspect\tis\ta\tbig\treason\twhy\tI’ve\tseen\tmore\tuptake\tof\nHAL\tas\ta\tway\tof\tdocumenting\tAPIs\tthan\tSwagger\tfor\tthose\tpeople\talready\tusing\nhypermedia\tcontrols.\tIf\tyou’re\tusing\thypermedia,\tmy\trecommendation\tis\tto\tgo\twith\tHAL\nover\tSwagger.\tBut\tif\tyou’re\tusing\thypermedia\tand\tcan’t\tjustify\tthe\tswitch,\tI’d\tdefinitely\nsuggest\tgiving\tSwagger\ta\tgo.")]),t._v(" "),a("h2",{attrs:{id:"theself-describingsystem"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#theself-describingsystem"}},[t._v("#")]),t._v(" The\tSelf-Describing\tSystem")]),t._v(" "),a("p",[t._v("During\tthe\tearly\tevolution\tof\tSOA,\tstandards\tlike\tUniversal\tDescription,\tDiscovery,\tand\nIntegration\t(UDDI)\temerged\tto\thelp\tpeople\tmake\tsense\tof\twhat\tservices\twere\trunning.\nThese\tapproaches\twere\tfairly\theavyweight,\twhich\tled\tto\talternative\ttechniques\tto\ttry\tto\nmake\tsense\tof\tour\tsystems.\tMartin\tFowler\tdiscussed\tthe\tconcept\tof\tthe\thumane\tregistry,\nwhere\ta\tmuch\tmore\tlightweight\tapproach\tis\tsimply\tto\thave\ta\tplace\twhere\thumans\tcan\nrecord\tinformation\tabout\tthe\tservices\tin\tthe\torganization\tin\tsomething\tas\tbasic\tas\ta\twiki.")]),t._v(" "),a("p",[t._v("Getting\ta\tpicture\tof\tour\tsystem\tand\thow\tit\tis\tbehaving\tis\timportant,\tespecially\twhen\twe’re\nat\tscale.\tWe’ve\tcovered\ta\tnumber\tof\tdifferent\ttechniques\tthat\twill\thelp\tus\tgain\nunderstanding\tdirectly\tfrom\tour\tsystem.\tBy\ttracking\tthe\thealth\tof\tour\tdownstream\nservices\ttogether\twith\tcorrelation\tIDs\tto\thelp\tus\tsee\tcall\tchains,\twe\tcan\tget\treal\tdata\tin\nterms\tof\thow\tour\tservices\tinterrelate.\tUsing\tservice\tdiscovery\tsystems\tlike\tConsul,\twe\tcan\nsee\twhere\tour\tmicroservices\tare\trunning.\tHAL\tlets\tus\tsee\twhat\tcapabilities\tare\tbeing\nhosted\ton\tany\tgiven\tendpoint,\twhile\tour\thealth-check\tpages\tand\tmonitoring\tsystems\tlet\tus\nknow\tthe\thealth\tof\tboth\tthe\toverall\tsystem\tand\tindividual\tservices.")]),t._v(" "),a("p",[t._v("All\tof\tthis\tinformation\tis\tavailable\tprogramatically.\tAll\tof\tthis\tdata\tallows\tus\tto\tmake\tour\nhumane\tregistry\tmore\tpowerful\tthan\ta\tsimple\twiki\tpage\tthat\twill\tno\tdoubt\tget\tout\tof\tdate.\nInstead,\twe\tshould\tuse\tit\tto\tharness\tand\tdisplay\tall\tthe\tinformation\tour\tsystem\twill\tbe\nemitting.\tBy\tcreating\tcustom\tdashboards,\twe\tcan\tpull\ttogether\tthe\tvast\tarray\tof\ninformation\tthat\tis\tavailable\tto\thelp\tus\tmake\tsense\tof\tour\tecosystem.")]),t._v(" "),a("p",[t._v("By\tall\tmeans,\tstart\twith\tsomething\tas\tsimple\tas\ta\tstatic\tweb\tpage\tor\twiki\tthat\tperhaps\nscrapes\tin\ta\tbit\tof\tdata\tfrom\tthe\tlive\tsystem.\tBut\tlook\tto\tpull\tin\tmore\tand\tmore\ninformation\tover\ttime.\tMaking\tthis\tinformation\treadily\tavailable\tis\ta\tkey\ttool\tto\tmanaging\nthe\temerging\tcomplexity\tthat\twill\tcome\tfrom\trunning\tthese\tsystems\tat\tscale.")]),t._v(" "),a("h2",{attrs:{id:"summary-9"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#summary-9"}},[t._v("#")]),t._v(" Summary")]),t._v(" "),a("p",[t._v("As\ta\tdesign\tapproach,\tmicroservices\tare\tstill\tfairly\tyoung,\tso\talthough\twe\thave\tsome\nnotable\texperiences\tto\tdraw\tupon,\tI’m\tsure\tthe\tnext\tfew\tyears\twill\tyield\tmore\tuseful\npatterns\tin\thandling\tthem\tat\tscale.\tNonetheless,\tI\thope\tthis\tchapter\thas\toutlined\tsome\nsteps\tyou\tcan\ttake\ton\tyour\tjourney\tto\tmicroservices\tat\tscale\tthat\twill\thold\tyou\tin\tgood\nstead.")]),t._v(" "),a("p",[t._v("In\taddition\tto\twhat\tI\thave\tcovered\there,\tI\trecommend\tMichael\tNygard’s\texcellent\tbook\n"),a("em",[t._v("Release\tIt!")]),t._v(" .\tIn\tit\the\tshares\ta\tcollection\tof\tstories\tabout\tsystem\tfailure\tand\tsome\tpatterns\tto\nhelp\tdeal\twith\tit\twell.\tThe\tbook\tis\twell\tworth\ta\tread\t(in\tfact,\tI\twould\tgo\tso\tfar\tas\tto\tsay\tit\nshould\tbe\tconsidered\tessential\treading\tfor\tanyone\tbuilding\tsystems\tat\tscale).")]),t._v(" "),a("p",[t._v("We’ve\tcovered\tquite\ta\tlot\tof\tground,\tand\twe’re\tnearing\tthe\tend.\tIn\tour\tnext\tand\tfinal\nchapter,\twe\twill\tlook\tto\tpull\teverything\tback\ttogether\tand\tsummarize\twhat\twe\thave\nlearned\tin\tthe\tbook\toverall.")]),t._v(" "),a("h1",{attrs:{id:"chapter12-bringingitalltogether"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#chapter12-bringingitalltogether"}},[t._v("#")]),t._v(" Chapter\t12.\tBringing\tIt\tAll\tTogether")]),t._v(" "),a("p",[t._v("We’ve\tcovered\ta\tfair\tamount\tin\tthe\tprevious\tchapters,\tfrom\twhat\tmicroservices\tare\tto\thow\nto\tdefine\ttheir\tboundaries,\tand\tfrom\tintegration\ttechnology\tto\tconcerns\tabout\tsecurity\tand\nmonitoring.\tAnd\twe\teven\tfound\ttime\tto\twork\tout\thow\tthe\trole\tof\tthe\tarchitect\tfits\tin.\nThere\tis\ta\tlot\tto\ttake\tin,\tas\talthough\tmicroservices\tthemselves\tmay\tbe\tsmall,\tthe\tbreadth\nand\timpact\tof\ttheir\tarchitecture\tare\tnot.\tSo\there\tI’ll\ttry\tto\tsummarize\tsome\tof\tthe\tkey\npoints\tcovered\tthroughout\tthe\tbook.")]),t._v(" "),a("h2",{attrs:{id:"principlesofmicroservices"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#principlesofmicroservices"}},[t._v("#")]),t._v(" Principles\tof\tMicroservices")]),t._v(" "),a("p",[t._v("We\tdiscussed\tthe\trole\tthat\tprinciples\tcan\tplay\tin\tChapter\t2.\tThey\tare\tstatements\tabout\thow\nthings\tshould\tbe\tdone,\tand\twhy\twe\tthink\tthey\tshould\tbe\tdone\tthat\tway.\tThey\thelp\tus\nframe\tthe\tvarious\tdecisions\twe\thave\tto\tmake\twhen\tbuilding\tour\tsystems.\tYou\tshould\nabsolutely\tdefine\tyour\town\tprinciples,\tbut\tI\tthought\tit\tworth\tspelling\tout\twhat\tI\tsee\tas\nbeing\tthe\tkey\tprinciples\tfor\tmicroservice\tarchitectures,\twhich\tyou\tcan\tsee\tsummarized\tin\nFigure\t12-1.\tThese\tare\tthe\tprinciples\tthat\twill\thelp\tus\tcreate\tsmall\tautonomous\tservices\nthat\twork\twell\ttogether.\tWe’ve\talready\tcovered\teverything\there\tat\tleast\tonce\tso\tfar,\tso\nnothing\tshould\tbe\tnew,\tbut\tthere\tis\tvalue\tin\tdistilling\tit\tdown\tto\tits\tcore\tessence.")]),t._v(" "),a("p",[t._v("You\tcan\tchoose\tto\tadopt\tthese\tprinciples\twholesale,\tor\tperhaps\ttweak\tthem\tto\tmake\tsense\nin\tyour\town\torganization.\tBut\tnote\tthe\tvalue\tthat\tcomes\tfrom\tusing\tthem\tin\tcombination:\nthe\twhole\tshould\tbe\tgreater\tthan\tthe\tsum\tof\tthe\tparts.\tSo\tif\tyou\tdecide\tto\tdrop\tone\tof\nthem,\tmake\tsure\tyou\tunderstand\twhat\tyou’ll\tbe\tmissing.")]),t._v(" "),a("p",[t._v("For\teach\tof\tthese\tprinciples,\tI’ve\ttried\tto\tpull\tout\tsome\tof\tthe\tsupporting\tpractices\tthat\twe\nhave\tcovered\tin\tthe\tbook.\tAs\tthe\tsaying\tgoes,\tthere\tis\tmore\tthan\tone\tway\tto\tskin\ta\tcat:\nyou\tmight\tfind\tyour\town\tpractices\tto\thelp\tdeliver\ton\tthese\tprinciples,\tbut\tthis\tshould\tget\nyou\tstarted.")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("Figure\t12-1.\tPrinciples\tof\tmicroservices\n")])])]),a("h2",{attrs:{id:"modelaroundbusinessconcepts"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#modelaroundbusinessconcepts"}},[t._v("#")]),t._v(" Model\tAround\tBusiness\tConcepts")]),t._v(" "),a("p",[t._v("Experience\thas\tshown\tus\tthat\tinterfaces\tstructured\taround\tbusiness-bounded\tcontexts\tare\nmore\tstable\tthan\tthose\tstructured\taround\ttechnical\tconcepts.\tBy\tmodeling\tthe\tdomain\tin\nwhich\tour\tsystem\toperates,\tnot\tonly\tdo\twe\tattempt\tto\tform\tmore\tstable\tinterfaces,\tbut\twe\nalso\tensure\tthat\twe\tare\tbetter\table\tto\treflect\tchanges\tin\tbusiness\tprocesses\teasily.\tUse\n"),a("em",[t._v("bounded\tcontexts")]),t._v(" \tto\tdefine\tpotential\tdomain\tboundaries.")]),t._v(" "),a("h2",{attrs:{id:"adoptacultureofautomation"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#adoptacultureofautomation"}},[t._v("#")]),t._v(" Adopt\ta\tCulture\tof\tAutomation")]),t._v(" "),a("p",[t._v("Microservices\tadd\ta\tlot\tof\tcomplexity,\ta\tkey\tpart\tof\twhich\tcomes\tfrom\tthe\tsheer\tnumber\nof\tmoving\tparts\twe\thave\tto\tdeal\twith.\tEmbracing\ta\tculture\tof\tautomation\tis\tone\tkey\tway\nto\taddress\tthis,\tand\tfront-loading\teffort\tto\tcreate\tthe\ttooling\tto\tsupport\tmicroservices\tcan\nmake\ta\tlot\tof\tsense.\t "),a("em",[t._v("Automated\ttesting")]),t._v(" \tis\tessential,\tas\tensuring\tour\tservices\tstill\twork\tis\ta\nmore\tcomplex\tprocess\tthan\twith\tmonolithic\tsystems.\tHaving\ta\tuniform\tcommand-line\tcall\nto\t "),a("em",[t._v("deploy\tthe\tsame\tway\teverywhere")]),t._v(" \tcan\thelp,\tand\tthis\tcan\tbe\ta\tkey\tpart\tof\tadopting\n"),a("em",[t._v("continuous\tdelivery")]),t._v(" \tto\tgive\tus\tfast\tfeedback\ton\tthe\tproduction\tquality\tof\teach\tcheck-in.")]),t._v(" "),a("p",[t._v("Consider\tusing\t "),a("em",[t._v("environment\tdefinitions")]),t._v(" \tto\thelp\tyou\tspecify\tthe\tdifferences\tfrom\tone\nenvironment\tto\tanother,\twithout\tsacrificing\tthe\tability\tto\tuse\ta\tuniform\tdeployment\nmethod.\tThink\tabout\tcreating\t "),a("em",[t._v("custom\timages")]),t._v(" \tto\tspeed\tup\tdeployment,\tand\tembracing\tthe\ncreation\tof\tfully\tautomated\t "),a("em",[t._v("immutable\tservers")]),t._v(" \tto\tmake\tit\teasier\tto\treason\tabout\tyour\nsystems.")]),t._v(" "),a("h2",{attrs:{id:"hideinternalimplementationdetails"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#hideinternalimplementationdetails"}},[t._v("#")]),t._v(" Hide\tInternal\tImplementation\tDetails")]),t._v(" "),a("p",[t._v("To\tmaximize\tthe\tability\tof\tone\tservice\tto\tevolve\tindependently\tof\tany\tothers,\tit\tis\tvital\nthat\twe\thide\timplementation\tdetails.\tModeling\t "),a("em",[t._v("bounded\tcontexts")]),t._v(" \tcan\thelp,\tas\tthis\thelps\tus\nfocus\ton\tthose\tmodels\tthat\tshould\tbe\tshared,\tand\tthose\tthat\tshould\tbe\thidden.\tServices\nshould\talso\t "),a("em",[t._v("hide\ttheir\tdatabases")]),t._v(" \tto\tavoid\tfalling\tinto\tone\tof\tthe\tmost\tcommon\tsorts\tof\ncoupling\tthat\tcan\tappear\tin\ttraditional\tservice-oriented\tarchitectures,\tand\tuse\t "),a("em",[t._v("data\tpumps")]),t._v("\nor\t "),a("em",[t._v("event\tdata\tpumps")]),t._v(" \tto\tconsolidate\tdata\tacross\tmultiple\tservices\tfor\treporting\tpurposes.")]),t._v(" "),a("p",[t._v("Where\tpossible,\tpick\t "),a("em",[t._v("technology-agnostic\tAPIs")]),t._v(" \tto\tgive\tyou\tfreedom\tto\tuse\tdifferent\ntechnology\tstacks.\tConsider\tusing\t "),a("em",[t._v("REST")]),t._v(" ,\twhich\tformalizes\tthe\tseparation\tof\tinternal\tand\nexternal\timplementation\tdetails,\talthough\teven\tif\tusing\tremote\tprocedure\tcalls\t(RPCs),\nyou\tcan\tstill\tembrace\tthese\tideas.")]),t._v(" "),a("h2",{attrs:{id:"decentralizeallthethings"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#decentralizeallthethings"}},[t._v("#")]),t._v(" Decentralize\tAll\tthe\tThings")]),t._v(" "),a("p",[t._v("To\tmaximize\tthe\tautonomy\tthat\tmicroservices\tmake\tpossible,\twe\tneed\tto\tconstantly\tbe\nlooking\tfor\tthe\tchance\tto\tdelegate\tdecision\tmaking\tand\tcontrol\tto\tthe\tteams\tthat\town\tthe\nservices\tthemselves.\tThis\tprocess\tstarts\twith\tembracing\t "),a("em",[t._v("self-service")]),t._v(" \twherever\tpossible,\nallowing\tpeople\tto\tdeploy\tsoftware\ton\tdemand,\tmaking\tdevelopment\tand\ttesting\tas\teasy\nas\tpossible,\tand\tavoiding\tthe\tneed\tfor\tseparate\tteams\tto\tperform\tthese\tactivities.")]),t._v(" "),a("p",[t._v("Ensuring\tthat\t "),a("em",[t._v("teams\town\ttheir\tservices")]),t._v(" \tis\tan\timportant\tstep\ton\tthis\tjourney,\tmaking\tteams\nresponsible\tfor\tthe\tchanges\tthat\tare\tmade,\tideally\teven\thaving\tthem\tdecide\twhen\tto\nrelease\tthose\tchanges.\tMaking\tuse\tof\t "),a("em",[t._v("internal\topen\tsource")]),t._v(" \tensures\tthat\tpeople\tcan\tmake\nchanges\ton\tservices\towned\tby\tother\tteams,\talthough\tremember\tthat\tthis\trequires\twork\tto\nimplement.\t "),a("em",[t._v("Align\tteams\tto\tthe\torganization")]),t._v(" \tto\tensure\tthat\tConway’s\tlaw\tworks\tfor\tyou,\nand\thelp\tyour\tteam\tbecome\tdomain\texperts\tin\tthe\tbusiness-focused\tservices\tthey\tare\ncreating.\tWhere\tsome\toverarching\tguidance\tis\tneeded,\ttry\tto\tembrace\ta\t "),a("em",[t._v("shared\ngovernance")]),t._v(" \tmodel\twhere\tpeople\tfrom\teach\tteam\tcollectively\tshare\tresponsibility\tfor\nevolving\tthe\ttechnical\tvision\tof\tthe\tsystem.")]),t._v(" "),a("p",[t._v("This\tprinciple\tcan\tapply\tto\tarchitecture\ttoo.\tAvoid\tapproaches\tlike\tenterprise\tservice\tbus\nor\torchestration\tsystems,\twhich\tcan\tlead\tto\tcentralization\tof\tbusiness\tlogic\tand\tdumb\nservices.\tInstead,\t "),a("em",[t._v("prefer\tchoreography\tover\torchestration")]),t._v(" \tand\t "),a("em",[t._v("dumb\tmiddleware,\twith\nsmart\tendpoints")]),t._v(" \tto\tensure\tthat\tyou\tkeep\tassociated\tlogic\tand\tdata\twithin\tservice\nboundaries,\thelping\tkeep\tthings\tcohesive.")]),t._v(" "),a("h2",{attrs:{id:"independentlydeployable"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#independentlydeployable"}},[t._v("#")]),t._v(" Independently\tDeployable")]),t._v(" "),a("p",[t._v("We\tshould\talways\tstrive\tto\tensure\tthat\tour\tmicroservices\tcan\tand\tare\tdeployed\tby\nthemselves.\tEven\twhen\tbreaking\tchanges\tare\trequired,\twe\tshould\tseek\tto\t "),a("em",[t._v("coexist\nversioned\tendpoints")]),t._v(" \tto\tallow\tour\tconsumers\tto\tchange\tover\ttime.\tThis\tallows\tus\tto\noptimize\tfor\tspeed\tof\trelease\tof\tnew\tfeatures,\tas\twell\tas\tincreasing\tthe\tautonomy\tof\tthe\nteams\towning\tthese\tmicroservices\tby\tensuring\tthat\tthey\tdon’t\thave\tto\tconstantly\norchestrate\ttheir\tdeployments.\tWhen\tusing\tRPC-based\tintegration,\t "),a("em",[t._v("avoid\ttightly\tbound\nclient/server\tstub\tgeneration")]),t._v(" \tsuch\tas\tthat\tpromoted\tby\tJava\tRMI.")]),t._v(" "),a("p",[t._v("By\tadopting\ta\t "),a("em",[t._v("one-service-per-host")]),t._v(" \tmodel,\tyou\treduce\tside\teffects\tthat\tcould\tcause\ndeploying\tone\tservice\tto\timpact\tanother\tunrelated\tservice.\tConsider\tusing\t "),a("em",[t._v("blue/green")]),t._v(" \tor\n"),a("em",[t._v("canary")]),t._v(" \trelease\ttechniques\tto\tseparate\tdeployment\tfrom\trelease,\treducing\tthe\trisk\tof\ta\nrelease\tgoing\twrong.\tUse\t "),a("em",[t._v("consumer-driven\tcontracts")]),t._v(" \tto\tcatch\tbreaking\tchanges\tbefore\nthey\thappen.")]),t._v(" "),a("p",[t._v("Remember\tthat\tit\tshould\tbe\tthe\tnorm,\tnot\tthe\texception,\tthat\tyou\tcan\tmake\ta\tchange\tto\ta\nsingle\tservice\tand\trelease\tit\tinto\tproduction,\twithout\thaving\tto\tdeploy\tany\tother\tservices\nin\tlock-step.\tYour\t "),a("em",[t._v("consumers\tshould\tdecide\twhen\tthey\tupdate\tthemselves")]),t._v(" ,\tand\tyou\tneed\tto\naccommodate\tthis.")]),t._v(" "),a("h2",{attrs:{id:"isolatefailure"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#isolatefailure"}},[t._v("#")]),t._v(" Isolate\tFailure")]),t._v(" "),a("p",[t._v("A\tmicroservice\tarchitecture\tcan\tbe\tmore\tresilient\tthan\ta\tmonolithic\tsystem,\tbut\tonly\tif\twe\nunderstand\tand\tplan\tfor\tfailures\tin\tpart\tof\tour\tsystem.\tIf\twe\tdon’t\taccount\tfor\tthe\tfact\tthat\na\tdownstream\tcall\tcan\tand\twill\tfail,\tour\tsystems\tmight\tsuffer\tcatastrophic\tcascading\nfailure,\tand\twe\tcould\tfind\tourselves\twith\ta\tsystem\tthat\tis\tmuch\tmore\tfragile\tthan\tbefore.")]),t._v(" "),a("p",[t._v("When\tusing\tnetwork\tcalls,\t "),a("em",[t._v("don’t\ttreat\tremote\tcalls\tlike\tlocal\tcalls")]),t._v(" ,\tas\tthis\twill\thide\ndifferent\tsorts\tof\tfailure\tmode.\tSo\tmake\tsure\tif\tyou’re\tusing\tclient\tlibraries\tthat\tthe\nabstraction\tof\tthe\tremote\tcall\tdoesn’t\tgo\ttoo\tfar.")]),t._v(" "),a("p",[t._v("If\twe\thold\tthe\ttenets\tof\t "),a("em",[t._v("antifragility")]),t._v(" \tin\tmind,\tand\texpect\tfailure\twill\toccur\tanywhere\tand\neverywhere,\twe\tare\ton\tthe\tright\ttrack.\tMake\tsure\tyour\t "),a("em",[t._v("timeouts")]),t._v(" \tare\tset\tappropriately.\nUnderstand\twhen\tand\thow\tto\tuse\t "),a("em",[t._v("bulkheads")]),t._v(" \tand\t "),a("em",[t._v("circuit\tbreakers")]),t._v(" \tto\tlimit\tthe\tfallout\tof\ta\nfailing\tcomponent.\tUnderstand\twhat\tthe\tcustomer-facing\timpact\twill\tbe\tif\tonly\tone\tpart\tof\nthe\tsystem\tis\tmisbehaving.\tKnow\twhat\tthe\timplications\tof\ta\tnetwork\tpartition\tmight\tbe,\nand\twhether\tsacrificing\t "),a("em",[t._v("availability")]),t._v(" \tor\t "),a("em",[t._v("consistency")]),t._v(" \tin\ta\tgiven\tsituation\tis\tthe\tright\tcall.")]),t._v(" "),a("h2",{attrs:{id:"highlyobservable"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#highlyobservable"}},[t._v("#")]),t._v(" Highly\tObservable")]),t._v(" "),a("p",[t._v("We\tcannot\trely\ton\tobserving\tthe\tbehavior\tof\ta\tsingle\tservice\tinstance\tor\tthe\tstatus\tof\ta\nsingle\tmachine\tto\tsee\tif\tthe\tsystem\tis\tfunctioning\tcorrectly.\tInstead,\twe\tneed\ta\tjoined-up\nview\tof\twhat\tis\thappening.\tUse\t "),a("em",[t._v("semantic\tmonitoring")]),t._v(" \tto\tsee\tif\tyour\tsystem\tis\tbehaving\ncorrectly,\tby\tinjecting\t "),a("em",[t._v("synthetic\ttransactions")]),t._v(" \tinto\tyour\tsystem\tto\tsimulate\treal-user\nbehavior.\t "),a("em",[t._v("Aggregate\tyour\tlogs")]),t._v(" ,\tand\t "),a("em",[t._v("aggregate\tyour\tstats")]),t._v(" ,\tso\tthat\twhen\tyou\tsee\ta\tproblem\nyou\tcan\tdrill\tdown\tto\tthe\tsource.\tAnd\twhen\tit\tcomes\tto\treproducing\tnasty\tissues\tor\tjust\nseeing\thow\tyour\tsystem\tis\tinteracting\tin\tproduction,\tuse\t "),a("em",[t._v("correlation\tIDs")]),t._v(" \tto\tallow\tyou\tto\ntrace\tcalls\tthrough\tthe\tsystem.")]),t._v(" "),a("h2",{attrs:{id:"whenshouldn-tyouusemicroservices"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#whenshouldn-tyouusemicroservices"}},[t._v("#")]),t._v(" When\tShouldn’t\tYou\tUse\tMicroservices?")]),t._v(" "),a("p",[t._v("I\tget\tasked\tthis\tquestion\ta\tlot.\tMy\tfirst\tpiece\tof\tadvice\twould\tbe\tthat\tthe\tless\twell\tyou\nunderstand\ta\tdomain,\tthe\tharder\tit\twill\tbe\tfor\tyou\tto\tfind\tproper\tbounded\tcontexts\tfor\tyour\nservices.\tAs\twe\tdiscussed\tpreviously,\tgetting\tservice\tboundaries\twrong\tcan\tresult\tin\nhaving\tto\tmake\tlots\tof\tchanges\tin\tservice-to-service\tcollaboration\t—\tan\texpensive\noperation.\tSo\tif\tyou’re\tcoming\tto\ta\tmonolithic\tsystem\tfor\twhich\tyou\tdon’t\tunderstand\tthe\ndomain,\tspend\tsome\ttime\tlearning\twhat\tthe\tsystem\tdoes\tfirst,\tand\tthen\tlook\tto\tidentify\nclean\tmodule\tboundaries\tprior\tto\tsplitting\tout\tservices.")]),t._v(" "),a("p",[t._v("Greenfield\tdevelopment\tis\talso\tquite\tchallenging.\tIt\tisn’t\tjust\tthat\tthe\tdomain\tis\talso\tlikely\nto\tbe\tnew;\tit’s\tthat\tit\tis\tmuch\teasier\tto\tchunk\tup\tsomething\tyou\thave\tthan\tsomething\tyou\ndon’t!\tSo\tagain,\tconsider\tstarting\tmonolithic\tfirst\tand\tbreak\tthings\tout\twhen\tyou’re\tstable.")]),t._v(" "),a("p",[t._v("Many\tof\tthe\tchallenges\tyou’re\tgoing\tto\tface\twith\tmicroservices\tget\tworse\twith\tscale.\tIf\nyou\tmostly\tdo\tthings\tmanually,\tyou\tmight\tbe\tOK\twith\t1\tor\t2\tservices,\tbut\t5\tor\t10?\nSticking\twith\told\tmonitoring\tpractices\twhere\tyou\tjust\tlook\tat\tstats\tlike\tCPU\tand\tmemory\nlikewise\tmight\twork\tOK\tfor\ta\tfew\tservices,\tbut\tthe\tmore\tservice-to-service\tcollaboration\nyou\tdo,\tthe\tmore\tpainful\tthis\twill\tbecome.\tYou’ll\tfind\tyourself\thitting\tthese\tpain\tpoints\tas\nyou\tadd\tmore\tservices,\tand\tI\thope\tthe\tadvice\tin\tthis\tbook\twill\thelp\tyou\tsee\tsome\tof\tthese\nproblems\tcoming,\tand\tgive\tyou\tsome\tconcrete\ttips\tfor\thow\tto\tdeal\twith\tthem.\tI\tspoke\nbefore\tabout\tREA\tand\tGilt\ttaking\ta\twhile\tto\tbuild\tthe\ttooling\tand\tpractices\tto\tmanage\nmicroservices\twell,\tprior\tto\tbeing\table\tto\tuse\tthem\tin\tany\tlarge\tquantity.\tThese\tstories\tjust\nreinforce\tto\tme\tthe\timportance\tof\tstarting\tgradually\tso\tyou\tunderstand\tyour\torganization’s\nappetite\tand\tability\tto\tchange,\twhich\twill\thelp\tyou\tproperly\tadopt\tmicroservices.")]),t._v(" "),a("h2",{attrs:{id:"partingwords"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#partingwords"}},[t._v("#")]),t._v(" Parting\tWords")]),t._v(" "),a("p",[t._v("Microservice\tarchitectures\tgive\tyou\tmore\toptions,\tand\tmore\tdecisions\tto\tmake.\tMaking\ndecisions\tin\tthis\tworld\tis\ta\tfar\tmore\tcommon\tactivity\tthan\tin\tsimpler,\tmonolithic\tsystems.\nYou\twon’t\tget\tall\tof\tthese\tdecisions\tright,\tI\tcan\tguarantee\tthat.\tSo,\tknowing\twe\tare\tgoing\nto\tget\tsome\tthings\twrong,\twhat\tare\tour\toptions?\tWell,\tI\twould\tsuggest\tfinding\tways\tto\nmake\teach\tdecision\tsmall\tin\tscope;\tthat\tway,\tif\tyou\tget\tit\twrong,\tyou\tonly\timpact\ta\tsmall\npart\tof\tyour\tsystem.\tLearn\tto\tembrace\tthe\tconcept\tof\tevolutionary\tarchitecture,\twhere\nyour\tsystem\tbends\tand\tflexes\tand\tchanges\tover\ttime\tas\tyou\tlearn\tnew\tthings.\tThink\tnot\tof\nbig-bang\trewrites,\tbut\tinstead\tof\ta\tseries\tof\tchanges\tmade\tto\tyour\tsystem\tover\ttime\tto\nkeep\tit\tsupple.")]),t._v(" "),a("p",[t._v("Hopefully\tby\tnow\tI’ve\tshared\twith\tyou\tenough\tinformation\tand\texperiences\tto\thelp\tyou\ndecide\tif\tmicroservices\tare\tfor\tyou.\tIf\tthey\tare,\tI\thope\tyou\tthink\tof\tthis\tas\ta\tjourney,\tnot\ta\ndestination.\tGo\tincrementally.\tBreak\tyour\tsystem\tapart\tpiece\tby\tpiece,\tlearning\tas\tyou\tgo.\nAnd\tget\tused\tto\tit:\tin\tmany\tways,\tthe\tdiscipline\tto\tcontinually\tchange\tand\tevolve\tour\nsystems\tis\ta\tfar\tmore\timportant\tlesson\tto\tlearn\tthan\tany\tother\tI\thave\tshared\twith\tyou\nthrough\tthis\tbook.\tChange\tis\tinevitable.\tEmbrace\tit.")])])}),[],!1,null,null,null);e.default=n.exports}}]);