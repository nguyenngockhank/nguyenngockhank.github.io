(window.webpackJsonp=window.webpackJsonp||[]).push([[54],{1105:function(e,t,a){e.exports=a.p+"assets/img/payment-process.4d105a14.png"},1106:function(e,t,a){e.exports=a.p+"assets/img/flow.3d63a0fb.png"},1107:function(e,t,a){e.exports=a.p+"assets/img/integration.15941bad.png"},1108:function(e,t,a){e.exports=a.p+"assets/img/payment-gateway-providers-compared.bb0b624d.png"},1608:function(e,t,a){"use strict";a.r(t);var s=a(7),r=Object(s.a)({},(function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[s("h1",{attrs:{id:"payment-notes"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#payment-notes"}},[e._v("#")]),e._v(" Payment notes")]),e._v(" "),s("h2",{attrs:{id:"payment-flow"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#payment-flow"}},[e._v("#")]),e._v(" Payment flow")]),e._v(" "),s("ul",[s("li",[s("strong",[e._v("Payer / Card holder")]),e._v(" that decides to pay for the service.")]),e._v(" "),s("li",[s("strong",[e._v("Merchant")]),e._v(" (business owner or service provider) to whose account the funds are transmitted.")]),e._v(" "),s("li",[s("strong",[e._v("Acquirer")]),e._v(" processes payments on behalf of the merchant and routes them through the "),s("strong",[e._v("Card Networks")]),e._v(" (such as Visa or Mastercard) to the issuing bank.")]),e._v(" "),s("li",[e._v("Seldom acquirers may attract third party providers to help process payments. Payment service providers (PSP) can offer the organisation of payment reception, Internet acquiring, agency cooperation scheme, act as international or local companies, have different conditions for opening accounts.")]),e._v(" "),s("li",[s("strong",[e._v("Issuer bank")]),e._v(" that extends cards to consumers on behalf of the card networks.")])]),e._v(" "),s("Tabs",[s("Tab",{attrs:{label:"Pic1"}},[s("p",[s("img",{attrs:{src:a(1105),alt:"flow"}})])]),e._v(" "),s("Tab",{attrs:{label:"Pic2"}},[s("p",[s("img",{attrs:{src:a(1106),alt:"flow"}})])])],1),e._v(" "),s("ol",[s("li",[e._v("The customer places an order, fills in all necessary card (account) data for payment, and press a 'Pay' button.")]),e._v(" "),s("li",[e._v("The encrypted data are sent to a payment gateway that collects payment details, initiates a transaction and sends data to an acquirer. Yet, the acquirer by itself may act as a payment gateway in several cases.")]),e._v(" "),s("li",[e._v("After confirming transaction data and, optionally, checking the payer by OTP verification, the acquirer transfer data to a payment system.")]),e._v(" "),s("li",[e._v("The payment system validates the transaction data and passes them to an issuer bank.")]),e._v(" "),s("li",[e._v("The issuer also checks the authorisation request and responds to the payment processor with the transaction status or error details. Before this, the issuer bank may request 3DS verification from the payer.")]),e._v(" "),s("li",[e._v("Through the payment gateway, the transaction status is returned to the merchant.")]),e._v(" "),s("li",[e._v("The merchant displays a status page with the transaction status (accepted or denied). And the issuer bank also sends an appropriate message to the customer.")]),e._v(" "),s("li",[e._v("Within a day or a couple of days, during clearing process, the issuing bank transfers funds to the merchant's account.")])]),e._v(" "),s("h2",{attrs:{id:"debit-credit-cards"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#debit-credit-cards"}},[e._v("#")]),e._v(" Debit / Credit Cards")]),e._v(" "),s("h3",{attrs:{id:"authorization-capture"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#authorization-capture"}},[e._v("#")]),e._v(" Authorization & Capture")]),e._v(" "),s("ul",[s("li",[s("strong",[e._v("Authorization")]),e._v("  The bank checks for sufficient funds and, if successful, holds the amount on the customer’s account to guarantee it or the merchant.")]),e._v(" "),s("li",[s("strong",[e._v("Capture")]),e._v(" The money moves from the issuing bank to the merchant’s account.")])]),e._v(" "),s("h3",{attrs:{id:"return-money-to-consumer"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#return-money-to-consumer"}},[e._v("#")]),e._v(" Return money to consumer")]),e._v(" "),s("p",[s("strong",[e._v("Mollie 2 flows")]),e._v(" "),s("img",{attrs:{src:"https://assets.docs.mollie.com/_images/order-status-flow@2x.png",alt:"mollie order status"}})]),e._v(" "),s("p",[s("a",{attrs:{href:"https://docs.mollie.com/orders/status-changes#two-flows-authorized-and-paid",target:"_blank",rel:"noopener noreferrer"}},[e._v("Mollie: Two flows: authorized and paid"),s("OutboundLink")],1)]),e._v(" "),s("p",[e._v("We take action "),s("code",[e._v("cancel")]),e._v(" the payment when "),s("code",[e._v("authorized")]),e._v(", "),s("code",[e._v("refund")]),e._v(" if payment "),s("code",[e._v("paid")]),e._v(", "),s("code",[e._v("completed")]),e._v(", "),s("code",[e._v("shipping")]),e._v(".")]),e._v(" "),s("ul",[s("li",[s("code",[e._v("refund")]),e._v(" action could be charged double (from the original payment, and the refund payment)")]),e._v(" "),s("li",[e._v("increase action "),s("code",[e._v("cancel")]),e._v(" to avoid being charged")])]),e._v(" "),s("h3",{attrs:{id:"storing-cards-info"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#storing-cards-info"}},[e._v("#")]),e._v(" Storing Cards info")]),e._v(" "),s("div",{staticClass:"custom-block warning"},[s("p",{staticClass:"custom-block-title"},[e._v("⚠️⚠️⚠️ Can a Merchant Store Credit Card Information?")]),e._v(" "),s("p",[e._v("To answer briefly, yes, merchants can store credit card information.")]),e._v(" "),s("p",[e._v("The long answer is that merchants must be "),s("strong",[e._v("PCI compliant")]),e._v(" to store their credit card data. However, there’s also some data you can keep and some you can’t make sure you securely handle your customers’ credit card information.")]),e._v(" "),s("p",[s("a",{attrs:{href:"https://www.pcidssguide.com/pci-requirements-for-storing-credit-card-information/",target:"_blank",rel:"noopener noreferrer"}},[e._v("Read more: PCI requirements for storing credit card"),s("OutboundLink")],1)])]),e._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[e._v("Use Tokenization")]),e._v(" "),s("p",[e._v("Tokenization is the process uses to collect sensitive card or bank account details, or personally identifiable information (PII), directly from your customers in a secure manner.")]),e._v(" "),s("p",[s("strong",[e._v("A token representing this information is returned to your server to use")]),e._v(". You should use our recommended payments integrations to perform this process "),s("strong",[e._v("client-side")]),e._v(". This ensures that no sensitive card data touches your server, and allows your integration to operate in a PCI-compliant way.")]),e._v(" "),s("p",[s("a",{attrs:{href:"https://stripe.com/docs/api/tokens",target:"_blank",rel:"noopener noreferrer"}},[e._v("Read more: Stripe tokens"),s("OutboundLink")],1)])]),e._v(" "),s("h2",{attrs:{id:"integration"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#integration"}},[e._v("#")]),e._v(" Integration")]),e._v(" "),s("p",[s("img",{attrs:{src:a(1107),alt:"flow"}}),e._v(" "),s("em",[e._v("Typicla Payment gateway integration")])]),e._v(" "),s("h3",{attrs:{id:"avoid-missing-payment-status-changes"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#avoid-missing-payment-status-changes"}},[e._v("#")]),e._v(" Avoid missing payment status changes")]),e._v(" "),s("ol",[s("li",[e._v("Redirect - a request from FE to BE")]),e._v(" "),s("li",[e._v("Instant Payment notification (IPN) / Webhooks  - a request from PSP to your BE")]),e._v(" "),s("li",[e._v("Polling - a request from your BE to PSP (be carefully with ratelimit)")])]),e._v(" "),s("p",[s("em",[e._v("Note")]),e._v(": Use a distributed lock to avoid race-condition if implement multi ways to fulfill the payment.")]),e._v(" "),s("p",[s("strong",[e._v("See more")])]),e._v(" "),s("ul",[s("li",[s("a",{attrs:{href:"https://docs.mollie.com/payments/status-changes",target:"_blank",rel:"noopener noreferrer"}},[e._v("Mollie: Payment status changes"),s("OutboundLink")],1)]),e._v(" "),s("li",[s("a",{attrs:{href:"https://docs.mollie.com/orders/status-changesges",target:"_blank",rel:"noopener noreferrer"}},[e._v("Mollie: Order status changes"),s("OutboundLink")],1)]),e._v(" "),s("li",[s("a",{attrs:{href:"https://stripe.com/docs/payments/intents",target:"_blank",rel:"noopener noreferrer"}},[e._v("Stripe: How payment intents work"),s("OutboundLink")],1)])]),e._v(" "),s("div",{staticClass:"custom-block warning"},[s("p",{staticClass:"custom-block-title"},[e._v("Stripe Failed Payment")]),e._v(" "),s("p",[e._v("A "),s("strong",[e._v("failed")]),e._v(" payemnt intent of Stripe can become a "),s("strong",[e._v("succeeded")]),e._v(" after retrying.")])]),e._v(" "),s("h3",{attrs:{id:"avoid-double-charge"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#avoid-double-charge"}},[e._v("#")]),e._v(" Avoid double charge")]),e._v(" "),s("p",[e._v("When we design the payment system, it is important to guarantee that the payment system executes a payment order exactly-once.")]),e._v(" "),s("p",[e._v("At the first glance, exactly-once delivery seems very hard to tackle, but if we divide the problem into two parts, it is much easier to solve. Mathematically, an operation is executed exactly-once if:")]),e._v(" "),s("ol",[s("li",[e._v("It is executed at least once.")]),e._v(" "),s("li",[e._v("At the same time, it is executed at most once.")])]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("Exactly-once = Retry + Idempotency \n")])])]),s("ul",[s("li",[e._v("Retry: Occasionally, we need to retry a payment transaction due to network errors or timeout. Retry provides the "),s("strong",[e._v("at-least-once")]),e._v(" guarantee.")]),e._v(" "),s("li",[e._v("Idempotency: From an API standpoint, idempotency means clients can make the same call repeatedly and produce the same result.")])]),e._v(" "),s("p",[e._v("For communication between clients (web and mobile applications) and servers, an idempotency key is usually a unique value that is generated by clients and expires after a certain period of time.")]),e._v(" "),s("h3",{attrs:{id:"popular-psp-s"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#popular-psp-s"}},[e._v("#")]),e._v(" Popular PSP(s)")]),e._v(" "),s("p",[s("img",{attrs:{src:a(1108),alt:"Compare"}})]),e._v(" "),s("h2",{attrs:{id:"payment-security"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#payment-security"}},[e._v("#")]),e._v(" Payment security")]),e._v(" "),s("p",[e._v("The table below summarizes techniques that are commonly used in payment security.")]),e._v(" "),s("table",[s("thead",[s("tr",[s("th",[e._v("Problem")]),e._v(" "),s("th",[e._v("Solution")])])]),e._v(" "),s("tbody",[s("tr",[s("td",[e._v("Request/response eavesdropping")]),e._v(" "),s("td",[e._v("Use HTTPS")])]),e._v(" "),s("tr",[s("td",[e._v("Data tampering")]),e._v(" "),s("td",[e._v("Enforce encryption and integrity monitoring")])]),e._v(" "),s("tr",[s("td",[e._v("Man-in-the-middle attack")]),e._v(" "),s("td",[e._v("Use SSL and authentication certificates")])]),e._v(" "),s("tr",[s("td",[e._v("Data loss")]),e._v(" "),s("td",[e._v("Database replication across multiple regions and take snapshot of data")])]),e._v(" "),s("tr",[s("td",[e._v("Distributed denial-of-service attack (DDoS)")]),e._v(" "),s("td",[e._v("Rate limiting and firewall")])]),e._v(" "),s("tr",[s("td",[e._v("Card theft")]),e._v(" "),s("td",[e._v("Tokenization. Instead of using real card numbers, tokens are stored and used for payment")])]),e._v(" "),s("tr",[s("td",[e._v("PCI compliance")]),e._v(" "),s("td",[e._v("PCI DSS is an information security standard for organizations that handle branded credit cards")])]),e._v(" "),s("tr",[s("td",[e._v("Fraud")]),e._v(" "),s("td",[e._v("Address verification, card verification value (CVV), user behavior analysis, etc.")])])])]),e._v(" "),s("h2",{attrs:{id:"database-design"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#database-design"}},[e._v("#")]),e._v(" Database Design")]),e._v(" "),s("h3",{attrs:{id:"never-use-floating-point-double-data-types-for-monetary-calculations"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#never-use-floating-point-double-data-types-for-monetary-calculations"}},[e._v("#")]),e._v(" Never Use Floating-Point / Double Data types for Monetary Calculations!")]),e._v(" "),s("p",[e._v("Floating point values, or even (Double precision floating point format), should be avoided when using a currency amount with fractions (like Dollars and cents), in its nature, it cannot be stored exactly as is in memory.")]),e._v(" "),s("p",[e._v("Say we want to store 0.1 dollars, any floating-point data type can not store it as is, it get’s stored as an approximation (0.10000000149….).")]),e._v(" "),s("p",[e._v("When doing a series of math operations, some problem can rise, that is called (loss of significance), the errors can be amplified and cause trouble 🧐.\nthe solution is simple in swift, use NSNumber")]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("let myBalance = 12.333\nlet decimal: Decimal = NSNumber(floatLiteral: 12.333).decimalValue\nlet result = decimal / 3\n")])])]),s("ul",[s("li",[s("a",{attrs:{href:"https://dba.stackexchange.com/questions/248815/monetary-value-in-integer-over-decimal-datatype",target:"_blank",rel:"noopener noreferrer"}},[e._v("Monetary value in integer over decimal datatype"),s("OutboundLink")],1)]),e._v(" "),s("li",[s("a",{attrs:{href:"https://laracasts.com/discuss/channels/laravel/best-data-type-is-for-storing-money-values",target:"_blank",rel:"noopener noreferrer"}},[e._v("best data type is for storing money values"),s("OutboundLink")],1)])]),e._v(" "),s("h2",{attrs:{id:"stripe-api-redesign"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#stripe-api-redesign"}},[e._v("#")]),e._v(" Stripe API Redesign")]),e._v(" "),s("p",[e._v("Stage 1  2011: The Stripe API, or what could be described as “7 lines of code”, revolved around the Charge concept. At this point, it exclusively handled card payments.")]),e._v(" "),s("p",[e._v("Stage 2  2011-2015: the Stripe API introduced the Token API. Its goal was to enable its customers to avoid the complex and tedious process of adhering to PCI compliance requirements.")]),e._v(" "),s("p",[e._v("Stage 3  2015: ACH and Bitcoin payments entered the scene. Because these types of transactions needed some time to “finalize”, Stripe integrated a feedback loop into the API. The change helped indicate the success of the charge.")]),e._v(" "),s("p",[e._v("Stage 4  2015-2017: This stage saw the addition of even more payment methods, including AliPay, WeChat Pay, and iDeal. As a result, the Source API was developed as an abstraction to support these varying payment methods.")]),e._v(" "),s("p",[e._v("Stage 5  2017-2018: As the number of supported payment methods grew, the team spent several months drafting a "),s("strong",[e._v("Unified Payments API")]),e._v(", with the introduction of "),s("em",[e._v("PaymentIntents")]),e._v(" and "),s("em",[e._v("PaymentMethod")]),e._v(".")]),e._v(" "),s("p",[e._v("Stage 6  2018-2020: Stripe invested two years to migrate their clients to the "),s("strong",[e._v("Unified Payments API")]),e._v(".")]),e._v(" "),s("h2",{attrs:{id:"acronyms"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#acronyms"}},[e._v("#")]),e._v(" Acronyms")]),e._v(" "),s("ul",[s("li",[e._v("PCI DSS = Payment Card Industry Data Security Standard")]),e._v(" "),s("li",[e._v("PSP = Payment Service Provider")]),e._v(" "),s("li",[e._v("CVV = Card Verification Value")])])],1)}),[],!1,null,null,null);t.default=r.exports}}]);