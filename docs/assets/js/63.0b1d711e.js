(window.webpackJsonp=window.webpackJsonp||[]).push([[63],{530:function(t,n,e){t.exports=e.p+"assets/img/sql-query-exe-order.079e4224.jpeg"},750:function(t,n,e){"use strict";e.r(n);var a=e(7),s=Object(a.a)({},(function(){var t=this,n=t.$createElement,a=t._self._c||n;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"toi-uu-relational-database-database-tuning"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#toi-uu-relational-database-database-tuning"}},[t._v("#")]),t._v(" T·ªëi ∆∞u Relational Database (Database Tuning)")]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("TIP")]),t._v(" "),a("p",[t._v("Database tuning describes a group of activities used to optimize and homogenize the performance of a database.")])]),t._v(" "),a("h2",{attrs:{id:"thu-tu-thuc-thi"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#thu-tu-thuc-thi"}},[t._v("#")]),t._v(" Th·ª© t·ª± th·ª±c thi")]),t._v(" "),a("p",[a("img",{attrs:{src:e(530),alt:"sql query execute order"}})]),t._v(" "),a("p",[t._v("Th·∫ßy t√¥i d·∫°y c√¢u th·∫ßn ch√∫ "),a("code",[t._v("Ch·ªçn, chi·∫øu, k·∫øt sau")]),t._v(" ƒë·∫°i lo·∫°i c√¢u n√†y l√† ƒë·ªÉ nh·∫Øc nh·ªü l·∫•y data v·ª´a ƒë·ªß th√¥i, buffet ƒÉn kh√¥ng h·∫øt t·ªôi l·∫Øm")]),t._v(" "),a("ul",[a("li",[a("strong",[t._v("Ch·ªçn")]),t._v(": "),a("code",[t._v("WHERE")]),t._v(", l·ªçc chi·ªÅu ngang")]),t._v(" "),a("li",[a("strong",[t._v("Chi·∫øu")]),t._v(": "),a("code",[t._v("SELECT")]),t._v(", l·ªçc chi·ªÅu d·ªçc")]),t._v(" "),a("li",[a("strong",[t._v("K·∫øt")]),t._v(": "),a("code",[t._v("JOIN")])])]),t._v(" "),a("p",[t._v("Bi·∫øt th·ª© t·ª± n√†y, c√°c b·∫°n s·∫Ω bi·∫øt th·ª© t·ª± m·∫•y c√°i l·ªánh th·ª±c thi sau ƒë√≥ ƒë∆∞a ra l·ª±a ch·ªçn s√°ng su·ªët khi vi·∫øt SQL.")]),t._v(" "),a("p",[t._v("V√≠ d·ª• n·∫øu c√¢u ƒëi·ªÅu ki·ªán c√≥ th·ªÉ ƒë·ªÉ ·ªü "),a("code",[t._v("WHERE")]),t._v(" th√¨ kh√¥ng n√™n ƒë·∫∑t ·ªü "),a("code",[t._v("HAVING")]),t._v(" v√¨ "),a("code",[t._v("WHERE")]),t._v(" ch·∫°y tr∆∞·ªõc.")]),t._v(" "),a("h2",{attrs:{id:"khoa-cua-khoa-ngo"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#khoa-cua-khoa-ngo"}},[t._v("#")]),t._v(" Kh√≥a c·ª≠a kh√≥a ng√µ")]),t._v(" "),a("p",[t._v("N·∫øu nh·∫•t qu√°n d·ªØ li·ªáu, r√†ng bu·ªôc to√†n v·∫πn kh√¥ng l√† v·∫•n ƒë·ªÅ th√¨ b·ªè m·∫•y c√°i quan h·ªá kh√≥a ch√≠nh, kh√≥a ngo·∫°i. ƒê√πa ƒë·∫•y, th·∫≠t ra l√† n·∫øu ƒë∆∞·ª£c th√¨ ƒë∆∞a logic ·∫•y l√™n code lu√¥n :>")]),t._v(" "),a("p",[t._v("M·∫•y anh l·ªõn nh∆∞ github, fb kh√¥ng x√†i "),a("em",[t._v("foreign key contraint")]),t._v(" ƒë·ªÉ tƒÉng perf, v·∫≠y app m√¨nh ƒë√£ ƒë·ªß l·ªõn ch∆∞a üòÉ))")]),t._v(" "),a("p",[a("a",{attrs:{href:"https://github.com/github/gh-ost/issues/331#issuecomment-266027731",target:"_blank",rel:"noopener noreferrer"}},[t._v("Thoughts on Foreign Keys?"),a("OutboundLink")],1)]),t._v(" "),a("h2",{attrs:{id:"thiet-ke-pha-chuan"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#thiet-ke-pha-chuan"}},[t._v("#")]),t._v(" Thi·∫øt k·∫ø ph√° chu·∫©n")]),t._v(" "),a("p",[t._v("ƒê√¥i khi thi·∫øt k·∫ø chu·∫©n, kh√¥ng d∆∞ th·ª´a d·ªØ li·ªáu l·∫°i g√¢y ra c√¢u query ph·ª©c t·∫°p nh∆∞ c, nh∆∞ b, nh∆∞ l... n√™n ph√° chu·∫©n, ch·∫•p nh·∫≠n d∆∞ th·ª´a l√† c√°ch c√≥ th·ªÉ xem x√©t =))")]),t._v(" "),a("h2",{attrs:{id:"su-dung-co-chon-loc"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#su-dung-co-chon-loc"}},[t._v("#")]),t._v(" S·ª≠ d·ª•ng c√≥ ch·ªçn l·ªçc")]),t._v(" "),a("ul",[a("li",[t._v("Ch·ªâ SELECT nh·ªØng c·ªôt c·∫ßn thi·∫øt, ƒë·ª´ng "),a("code",[t._v("SELECT *")]),t._v(" v√¥ t·ªôi v·∫°")]),t._v(" "),a("li",[t._v("Ch·ªâ JOIN v·ªõi nh·ªØng b·∫£ng c·∫ßn thi·∫øt, nghe c·ª© nh∆∞ ƒë√πa nh∆∞ng m√† th·∫ø √©o n√†o... =))")]),t._v(" "),a("li",[t._v("√ù th·ª©c sort: kh√¥ng ch·ªâ l√† "),a("code",[t._v("ORDER BY")]),t._v(" l√† di·ªÖn ra sort m√† k·ªÉ c·∫£ "),a("code",[t._v("DISTINCT")]),t._v(" hay "),a("code",[t._v("GROUP BY")]),t._v(" ho·∫∑c l√† "),a("code",[t._v("UNION")]),t._v(" "),a("ul",[a("li",[t._v("Kh√¥ng s·ª≠ d·ª•ng "),a("code",[t._v("HAVING")]),t._v(" n·∫øu c√≥ th·ªÉ d√πng "),a("code",[t._v("WHERE")]),t._v(". ƒê∆°n gi·∫£n l√† "),a("code",[t._v("WHERE")]),t._v(" s·∫Ω gi·ªõi h·∫°n record tr·∫£ v·ªÅ tr∆∞·ªõc khi "),a("code",[t._v("SORT")]),t._v(" r·ªìi "),a("code",[t._v("GROUP BY")]),t._v(".")]),t._v(" "),a("li",[t._v("Ph√¢n bi·ªát gi·ªØa 2 c√°i n√†y: "),a("code",[t._v("UNION ALL")]),t._v(" hay "),a("code",[t._v("UNION")]),t._v(". C√°i sau c√≥ s·ª≠ d·ª•ng "),a("code",[t._v("DISTINCT")]),t._v(" ƒë·ªÉ lo·∫°i b·ªè record gi·ªëng nhau.")])])])]),t._v(" "),a("h2",{attrs:{id:"index-column"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#index-column"}},[t._v("#")]),t._v(" Index column")]),t._v(" "),a("p",[t._v("C√≥ v√†i Index lo·∫°i c∆° b·∫£n")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("Index type")]),t._v(" "),a("th",[t._v("Desc")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("Primary key")]),t._v(" "),a("td",[t._v("no duplication, has not "),a("code",[t._v("null")])])]),t._v(" "),a("tr",[a("td",[t._v("Unique key")]),t._v(" "),a("td",[t._v("no duplication, has "),a("code",[t._v("null")])])]),t._v(" "),a("tr",[a("td",[t._v("Index / Secondary Index")]),t._v(" "),a("td",[t._v("has duplication, has "),a("code",[t._v("null")])])]),t._v(" "),a("tr",[a("td",[t._v("Fulltext")]),t._v(" "),a("td",[t._v("Use for searching document")])])])]),t._v(" "),a("p",[t._v("ƒê·∫±ng sau nh·ªØng chi·∫øc INDEX l√† nh·ªØng thu·∫≠t to√°n th√¢m s√¢u kh√¥n l∆∞·ªùng, ch√¥m v·ªÅ t·ª´  "),a("a",{attrs:{href:"https://www.postgresql.org/docs/current/indexes-types.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("Postgres Index Types"),a("OutboundLink")],1),t._v(", ƒë·∫°i lo·∫°i l√† t√πy m·ª•c ƒë√≠ch s·ª≠ d·ª•ng m√† l√¥i ra x√†i th√¥i.")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("Thu·∫≠t to√°n")]),t._v(" "),a("th",[t._v("H·ªó tr·ª£")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("B-Tree")]),t._v(" "),a("td",[a("code",[t._v("< <= = >= >")])])]),t._v(" "),a("tr",[a("td",[t._v("Hash")]),t._v(" "),a("td",[a("code",[t._v("=")])])]),t._v(" "),a("tr",[a("td",[t._v("GiST")]),t._v(" "),a("td",[a("code",[t._v("<< &< &> >> <<| &<| |&> |>> @> <@ ~= &&")])])]),t._v(" "),a("tr",[a("td",[t._v("SP-GiST")]),t._v(" "),a("td",[a("code",[t._v("<< >> ~= <@ <<| |>>")])])]),t._v(" "),a("tr",[a("td",[t._v("GIN")]),t._v(" "),a("td",[a("code",[t._v("<@ @> = &&")])])]),t._v(" "),a("tr",[a("td",[t._v("BRIN")]),t._v(" "),a("td",[a("code",[t._v("< <= = >= >")])])])])]),t._v(" "),a("p",[t._v("Index l√† c√°i th·ª© l√†m "),a("strong",[t._v("tƒÉng t·ªëc ƒë·ªô ƒë·ªçc")]),t._v(", v√† l√†m "),a("strong",[t._v("ch·∫≠m t·ªëc ƒë·ªô ghi")]),t._v(" v√† l√†m "),a("strong",[t._v("nhi·ªÅu kh√¥ng gian l∆∞u tr·ªØ")])]),t._v(" "),a("p",[t._v("Th·∫ø cho n√™n, c√°i n√†o kh√¥ng c·∫ßn thi·∫øt th√¨ xo√° b·ªõt ƒë√™ cho nhanh :>")]),t._v(" "),a("h3",{attrs:{id:"phan-khoa-hoc"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#phan-khoa-hoc"}},[t._v("#")]),t._v(" Ph·∫£n khoa h·ªçc")]),t._v(" "),a("p",[a("strong",[t._v("M·∫∑c d√π ƒë√£ index nh∆∞ng nh·ªØng c√¢u ƒëi·ªÅu ki·ªán d∆∞·ªõi ƒë√¢y s·∫Ω b√≥p d*i ƒë·ªìng ƒë·ªôi:")])]),t._v(" "),a("ul",[a("li",[t._v("D√≠nh t·ªõi NULL: "),a("code",[t._v("IS NULL")]),t._v(", "),a("code",[t._v("IS NOT NULL")]),t._v(". M·∫∑c ƒë·ªãnh DB s·∫Ω m·∫∑c k·ªá m·∫•y ƒë·ª©a li√™n quan t·ªõi NULL n√™n l√† Index c≈©ng ch·∫£ l∆∞u v·∫πo g√¨ c·∫£.")]),t._v(" "),a("li",[t._v("Ph·ªß ƒë·ªãnh:  "),a("code",[t._v("!=")]),t._v(", "),a("code",[t._v("<>")]),t._v(",  "),a("code",[t._v("NOT IN")]),t._v(", "),a("code",[t._v("NOT LIKE")])]),t._v(" "),a("li",[t._v("LIKE 2 l·∫ßn =)) "),a("code",[t._v("LIKE '%tha tim%'")]),t._v(", v√† ngay c·∫£ "),a("code",[t._v("LIKE '%tha-tim'")]),t._v(" th√¨ c≈©ng ch·∫£ ƒë∆∞·ª£c t√≠ index n√†o ƒë√¢u nha. C√°i n√†y th√¨ nhi·ªÅu khi b·∫•t kh·∫£ kh√°ng =)) ch·∫•p nh·∫≠n th√¥i")]),t._v(" "),a("li",[a("code",[t._v("OR")]),t._v(" trong ƒëi·ªÅu ki·ªán")])]),t._v(" "),a("p",[t._v("M·∫•y chi·∫øc query "),a("code",[t._v("OR")]),t._v(" ki·ªÉu n√†y, kh√¥ng s·ª≠ d·ª•ng ƒë∆∞·ª£c index")]),t._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("SELECT")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("fields")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("FROM")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("table")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("WHERE")]),t._v(" field1"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'something'")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("OR")]),t._v(" field2"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'something'")]),t._v(" \n")])])]),a("p",[t._v("n√™n ƒë·ªïi ra th√†nh ki·ªÉu n√†y")]),t._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("SELECT")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("fields")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("FROM")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("table")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("WHERE")]),t._v(" field1"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'something'")]),t._v(" \n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("UNION")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("SELECT")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("fields")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("FROM")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("table")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("WHERE")]),t._v(" field2"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'something'")]),t._v(" \n")])])]),a("p",[a("strong",[t._v("D∆∞·ªõi ƒë√¢y l√† m·ªôt s·ªë c√°ch kh√°ch l√†m gi·∫£m hi·ªáu nƒÉng index =))")])]),t._v(" "),a("ul",[a("li",[t._v("ƒê·∫∑t sai th·ª© t·ª± c·ªôt tr√™n index nhi·ªÅu c·ªôt.")]),t._v(" "),a("li",[t._v("So s√°nh 2 l·∫ßn =)) "),a("code",[t._v("WHERE score >= 2")]),t._v(". C√°i n√†y b·∫±ng v·ªõi vi·ªác "),a("code",[t._v("WHERE score > 2 OR score = 2")]),t._v(". N·∫æUch·ªâ thao t√°c v·ªõi s·ªë nguy√™n th√¨ c√≥ th·ªÉ s·ª≠a l·∫°i "),a("code",[t._v("WHERE score > 1")]),t._v(".")]),t._v(" "),a("li",[t._v("ƒê·ªëi v·ªõi m·∫•y chi·∫øc index c√≥ nhi·ªÅu c·ªôt, th·ª© t·ª± where c≈©ng n√™n")])]),t._v(" "),a("p",[a("strong",[t._v("V√†i l∆∞u √Ω kh√°c v·ªÅ index:")])]),t._v(" "),a("ul",[a("li",[t._v("Kh√¥ng n√™n s·ª≠ d·ª•ng tr√™n b·∫£ng nh·ªè")]),t._v(" "),a("li",[t._v("Kh√¥ng n√™n s·ª≠ d·ª•ng tr√™n b·∫£ng th∆∞·ªùng update / insert")]),t._v(" "),a("li",[t._v("kh√¥ng n√™n s·ª≠ d·ª•ng tr√™n c·ªôt th∆∞·ªùng update / insert")]),t._v(" "),a("li",[t._v("Kh√¥ng n√™n s·ª≠ d·ª•ng tr√™n c·ªôt nhi·ªÅu gi√° tr·ªã "),a("code",[t._v("NULL")]),t._v(". V√¨ nh∆∞ ƒë√£ n√≥i ·ªü tr√™n m·∫•y c√°i WHERE m√† "),a("code",[t._v("IS NULL")]),t._v(" th√¨ ko c√≥ x√†i index.")]),t._v(" "),a("li",[t._v("Kh√¥ng n√™n s·ª≠ d·ª•ng tr√™n c·ªôt c√≥ √≠t gi√° tr·ªã. Vd nh∆∞ "),a("code",[t._v("active")]),t._v(" v√† "),a("code",[t._v("inactive")]),t._v(". G·∫ßn nh∆∞ l√† full scan b·∫£ng :>")])]),t._v(" "),a("h2",{attrs:{id:"su-dung-orm-hop-ly"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#su-dung-orm-hop-ly"}},[t._v("#")]),t._v(" S·ª≠ d·ª•ng ORM h·ª£p l√Ω")]),t._v(" "),a("ul",[a("li",[t._v("C√¢n nh·∫Øc l√∫c n√†o c·∫ßn s·ª≠ d·ª•ng Lazy loading, l√∫c n√†o c·∫ßn Eager Loading. Nh·∫•t l√† khi l√†m vi·ªác v·ªõi Array.")]),t._v(" "),a("li",[t._v("ph√¢n trang b·∫±ng "),a("strong",[t._v("Cursor")]),t._v(" thay v√¨ "),a("strong",[t._v("offset")])])]),t._v(" "),a("h2",{attrs:{id:"job-schedule"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#job-schedule"}},[t._v("#")]),t._v(" Job schedule")]),t._v(" "),a("p",[t._v("Ch·∫°y script ƒë·ªÉ th·ª±c hi·ªán Job schedule (Crontab)  ho·∫∑c Backup database n√™n th·ª±c hi·ªán v√†o l√∫c √≠t ng∆∞·ªùi s·ª≠ d·ª•ng s·∫£n ph·∫©m nh·∫•t.")]),t._v(" "),a("h2",{attrs:{id:"explain"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#explain"}},[t._v("#")]),t._v(" EXPLAIN")]),t._v(" "),a("p",[t._v("S·ª≠ d·ª•ng "),a("code",[t._v("EXPLAIN "+t._s(t.query))]),t._v(" ƒë·ªÉ ph√¢n t√≠ch c√¢u l·ªánh üòÑ Xem ƒë∆∞·ª£c ƒëang join c√°i g√¨, c√≥ index kh√¥ng, bao nhi√™u rows,... "),a("a",{attrs:{href:"https://dzone.com/articles/understanding-mysql-queries-with-explain",target:"_blank",rel:"noopener noreferrer"}},[t._v("S√°ch √¥n thi h·ªçc sinh gi·ªèi"),a("OutboundLink")],1)]),t._v(" "),a("h2",{attrs:{id:"va-su-dung-cac-mo-hinh-scale"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#va-su-dung-cac-mo-hinh-scale"}},[t._v("#")]),t._v(" V√† s·ª≠ d·ª•ng c√°c m√¥ h√¨nh scale")]),t._v(" "),a("p",[a("RouterLink",{attrs:{to:"/db/db/architect.html"}},[t._v("üìï Xem b√†i n√†y")])],1),t._v(" "),a("h2",{attrs:{id:"other"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#other"}},[t._v("#")]),t._v(" Other")]),t._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"https://dzone.com/articles/when-you-should-and-should-not",target:"_blank",rel:"noopener noreferrer"}},[t._v("When you should and should NOT use ENUM data type"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("a",{attrs:{href:"https://www.postgresql.org/docs/current/indexes.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("Postgres indexes"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("a",{attrs:{href:"https://stackoverflow.com/questions/62207344/is-it-possible-to-index-on-enum",target:"_blank",rel:"noopener noreferrer"}},[t._v("Is it possible to index on enum?"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("a",{attrs:{href:"https://use-the-index-luke.com/",target:"_blank",rel:"noopener noreferrer"}},[t._v("use-the-index-luke.com"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("a",{attrs:{href:"https://ignaciochiazzo.medium.com/paginating-requests-in-apis-d4883d4c1c4c",target:"_blank",rel:"noopener noreferrer"}},[a("OutboundLink")],1)])])])}),[],!1,null,null,null);n.default=s.exports}}]);