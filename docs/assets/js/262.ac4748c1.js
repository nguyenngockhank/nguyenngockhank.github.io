(window.webpackJsonp=window.webpackJsonp||[]).push([[262],{847:function(t,e,s){"use strict";s.r(e);var a=s(7),n=Object(a.a)({},(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"_5-knowing-what-to-comment"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_5-knowing-what-to-comment"}},[t._v("#")]),t._v(" 5. Knowing What to Comment")]),t._v(" "),s("p",[t._v("The goal of this chapter is to help you realize what you should be commenting. You might think the purpose of commenting is to “explain what the code does,” but that is just a small part of it.")]),t._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[t._v("K E Y I D E A")]),t._v(" "),s("p",[t._v("The purpose of commenting is to help the reader know as much as the writer did.")])]),t._v(" "),s("p",[t._v("When you’re writing code, you have a lot of valuable information in your head. When other\npeople read your code, that information is lost—all they have is the code in front of them.")]),t._v(" "),s("p",[t._v("In this chapter, we’ll show you many examples of when to write down that information in\nyour head. We’ve left out the more mundane points about commenting; instead, we’ve focused\non the more interesting and “underserved” aspects of commenting.")]),t._v(" "),s("p",[t._v("We’ve organized the chapter into the following areas:")]),t._v(" "),s("ul",[s("li",[t._v("Knowing what "),s("em",[t._v("not")]),t._v(" to comment")]),t._v(" "),s("li",[t._v("Recording your thoughts as you code")]),t._v(" "),s("li",[t._v("Putting yourself in the readers’ shoes, to imagine what they’ll need to know")])]),t._v(" "),s("h2",{attrs:{id:"what-not-to-comment"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#what-not-to-comment"}},[t._v("#")]),t._v(" What NOT to Comment")]),t._v(" "),s("p",[t._v("Reading a comment takes time away from reading the actual code, and each comment takes up space on the screen. That is, it better be worth it. So where do you draw the line between a worthless comment and a good one?")]),t._v(" "),s("p",[t._v("All of the comments in this code are worthless:")]),t._v(" "),s("div",{staticClass:"language-cpp extra-class"},[s("pre",{pre:!0,attrs:{class:"language-cpp"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// The class definition for Account")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Account")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Constructor")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("Account")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Set the profit member to a new value")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("SetProfit")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("double")]),t._v(" profit"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Return the profit from this Account")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("double")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("GetProfit")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("p",[t._v("These comments are worthless because they don’t provide any new information or help the reader understand the code better.")]),t._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[t._v("K E Y I D E A")]),t._v(" "),s("p",[t._v("Don’t comment on facts that can be derived quickly from the code itself.")])]),t._v(" "),s("p",[t._v("The word “quickly” is an important distinction, though. Consider the comment for this Python code:")]),t._v(" "),s("div",{staticClass:"language-py extra-class"},[s("pre",{pre:!0,attrs:{class:"language-py"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# remove everything after the second '*'")]),t._v("\nname "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'*'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("join"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("line"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("split"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'*'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("p",[t._v("Technically, this comment doesn’t present any “new information” either. If you look at the code itself, you’ll eventually figure out what it’s doing. But for most programmers, reading the commented code is much faster than understanding the code without it.")]),t._v(" "),s("h3",{attrs:{id:"don-t-comment-just-for-the-sake-of-commenting"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#don-t-comment-just-for-the-sake-of-commenting"}},[t._v("#")]),t._v(" "),s("strong",[t._v("Don’t Comment Just for the Sake of Commenting")])]),t._v(" "),s("p",[t._v("Some professors require their students to have a comment for each function in their homework code. As a result, some programmers feel guilty about leaving a function naked without comments and end up rewriting the function’s name and arguments in sentence form:")]),t._v(" "),s("div",{staticClass:"language-cpp extra-class"},[s("pre",{pre:!0,attrs:{class:"language-cpp"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Find the Node in the given subtree, with the given name, using the given depth.")]),t._v("\nNode"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("FindNodeInSubtree")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Node"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" subtree"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" string name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" depth"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("p",[t._v("This one falls into the “worthless comments” category—the function’s declaration and the comment are virtually the same. This comment should be either removed or improved.")]),t._v(" "),s("p",[t._v("If you want to have a comment here, it might as well elaborate on more important details:")]),t._v(" "),s("div",{staticClass:"language-cpp extra-class"},[s("pre",{pre:!0,attrs:{class:"language-cpp"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Find a Node with the given 'name' or return NULL.")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// If depth <= 0, only 'subtree' is inspected.")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// If depth == N, only 'subtree' and N levels below are inspected.")]),t._v("\nNode"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("FindNodeInSubtree")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Node"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" subtree"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" string name"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" depth"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("h3",{attrs:{id:"don-t-comment-bad-names-fix-the-names-instead"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#don-t-comment-bad-names-fix-the-names-instead"}},[t._v("#")]),t._v(" "),s("strong",[t._v("Don’t Comment Bad Names—Fix the Names Instead")])]),t._v(" "),s("p",[t._v("A comment shouldn’t have to make up for a bad name. For example, here’s an innocent-looking comment for a function named "),s("code",[t._v("CleanReply()")]),t._v(":")]),t._v(" "),s("div",{staticClass:"language-cpp extra-class"},[s("pre",{pre:!0,attrs:{class:"language-cpp"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Enforce limits on the Reply as stated in the Request,")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// such as the number of items returned, or total byte size, etc.")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("CleanReply")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Request request"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" Reply reply"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("p",[t._v("Most of the comment is simply explaining what “clean” means. Instead, the phrase “enforce limits” should be moved into the function name:")]),t._v(" "),s("div",{staticClass:"language-cpp extra-class"},[s("pre",{pre:!0,attrs:{class:"language-cpp"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Make sure 'reply' meets the count/byte/etc. limits from the 'request'")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("EnforceLimitsFromRequest")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Request request"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" Reply reply"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("p",[t._v("This function name is more “self-documenting.” A good name is better than a good comment because it will be seen everywhere the function is used.")]),t._v(" "),s("p",[t._v("Here is another example of a comment for a poorly named function:")]),t._v(" "),s("div",{staticClass:"language-cpp extra-class"},[s("pre",{pre:!0,attrs:{class:"language-cpp"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Releases the handle for this key. This doesn't modify the actual registry.")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("DeleteRegistry")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("RegistryKey"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" key"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("p",[t._v("The name "),s("code",[t._v("DeleteRegistry()")]),t._v(" sounds like a dangerous function (it "),s("em",[t._v("deletes")]),t._v(" the registry?!). The comment “This doesn’t modify the actual registry” is trying to clear up the confusion.")]),t._v(" "),s("p",[t._v("Instead, we could use a more self-documenting name like:")]),t._v(" "),s("div",{staticClass:"language-cpp extra-class"},[s("pre",{pre:!0,attrs:{class:"language-cpp"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("ReleaseRegistryHandle")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("RegistryKey"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" key"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("p",[t._v("In general, you don’t want “crutch comments”—comments that are trying to make up for the unreadability of the code. Coders often state this rule as "),s("strong",[t._v("good code > bad code + good comments.")])]),t._v(" "),s("h2",{attrs:{id:"recording-your-thoughts"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#recording-your-thoughts"}},[t._v("#")]),t._v(" Recording Your Thoughts")]),t._v(" "),s("p",[t._v("Now that you know what "),s("em",[t._v("not")]),t._v(" to comment, let’s discuss what "),s("em",[t._v("should")]),t._v(" be commented (but often isn’t).")]),t._v(" "),s("p",[t._v("A lot of good comments can come out of simply “recording your thoughts”—that is, the important thoughts you had as you were writing the code.")]),t._v(" "),s("h3",{attrs:{id:"include-director-commentary"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#include-director-commentary"}},[t._v("#")]),t._v(" "),s("strong",[t._v("Include “Director Commentary”")])]),t._v(" "),s("p",[t._v("Movies often have a “director commentary” track where the filmmakers give their insights and tell stories to help you understand how the film was made. Similarly, you should include comments to record valuable insights about the code.")]),t._v(" "),s("p",[t._v("Here’s an example:")]),t._v(" "),s("div",{staticClass:"language-cpp extra-class"},[s("pre",{pre:!0,attrs:{class:"language-cpp"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Surprisingly, a binary tree was 40% faster than a hash table for this data.")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// The cost of computing a hash was more than the left/right comparisons.")]),t._v("\n")])])]),s("p",[t._v("This comment teaches the reader something and stops any would-be optimizer from wasting their time.")]),t._v(" "),s("p",[t._v("Here’s another example:")]),t._v(" "),s("div",{staticClass:"language-cpp extra-class"},[s("pre",{pre:!0,attrs:{class:"language-cpp"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// This heuristic might miss a few words. That's OK; solving this 100% is hard.")]),t._v("\n")])])]),s("p",[t._v("Without this comment, the reader might think there’s a bug and might waste time trying to come up with test cases that make it fail, or go off and try to fix the bug.")]),t._v(" "),s("p",[t._v("A comment can also explain why the code isn’t in great shape:")]),t._v(" "),s("div",{staticClass:"language-cpp extra-class"},[s("pre",{pre:!0,attrs:{class:"language-cpp"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// This class is getting messy. Maybe we should create a 'ResourceNode' subclass to")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// help organize things.")]),t._v("\n")])])]),s("p",[t._v("This comment acknowledges that the code is messy but also encourages the next person to fix it (with specifics on how to get started). Without the comment, many readers would be intimidated by the messy code and afraid to touch it.")]),t._v(" "),s("h3",{attrs:{id:"comment-the-flaws-in-your-code"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#comment-the-flaws-in-your-code"}},[t._v("#")]),t._v(" "),s("strong",[t._v("Comment the Flaws in Your Code")])]),t._v(" "),s("p",[t._v("Code is constantly evolving and is bound to have flaws along the way. Don’t be embarrassed to document those flaws. For example, noting when improvements should be made:")]),t._v(" "),s("div",{staticClass:"language-cpp extra-class"},[s("pre",{pre:!0,attrs:{class:"language-cpp"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// TODO: use a faster algorithm")]),t._v("\n")])])]),s("p",[t._v("or when code is incomplete:")]),t._v(" "),s("div",{staticClass:"language-cpp extra-class"},[s("pre",{pre:!0,attrs:{class:"language-cpp"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// TODO(dustin): handle other image formats besides JPEG")]),t._v("\n")])])]),s("p",[t._v("There are a number of markers that have become popular among programmers:")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("Marker Typical meaning\nTODO: Stuff I haven’t gotten around to yet\nFIXME: Known-broken code here\nHACK: Admittedly inelegant solution to a problem\nXXX: Danger! major problem here\n")])])]),s("p",[t._v("Your team might have specific conventions for when/if to use these markers. For example, "),s("code",[t._v("TODO")]),t._v(": might be reserved for show-stopping issues. If so, then for more minor flaws you could use something like todo: (lower case) or "),s("code",[t._v("maybe-later")]),t._v(": instead.")]),t._v(" "),s("p",[t._v("The important thing is that you should always feel free to comment on your thoughts about how the code should change in the future. Comments like these give readers valuable insight into the quality and state of the code and might even give them some direction on how to improve it.")]),t._v(" "),s("h3",{attrs:{id:"comment-on-your-constants"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#comment-on-your-constants"}},[t._v("#")]),t._v(" "),s("strong",[t._v("Comment on Your Constants")])]),t._v(" "),s("p",[t._v("When defining a constant, there is often a “story” for what that constant does or why it has that specific value. For example, you might see this constant in your code:")]),t._v(" "),s("div",{staticClass:"language-py extra-class"},[s("pre",{pre:!0,attrs:{class:"language-py"}},[s("code",[t._v("NUM_THREADS "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("8")]),t._v("\n")])])]),s("p",[t._v("It may not seem like this line needs a comment, but it’s likely that the programmer who chose it knows more about it:")]),t._v(" "),s("div",{staticClass:"language-py extra-class"},[s("pre",{pre:!0,attrs:{class:"language-py"}},[s("code",[t._v("NUM_THREADS "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("8")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# as long as it's >= 2 * num_processors, that's good enough.")]),t._v("\n")])])]),s("p",[t._v("Now the person reading the code has some guidance on how to adjust that value (e.g., setting it to 1 is probably too low, and setting it to 50 is overkill).")]),t._v(" "),s("p",[t._v("Or sometimes the exact value of a constant isn’t important at all. A comment to this effect is still useful:")]),t._v(" "),s("div",{staticClass:"language-cpp extra-class"},[s("pre",{pre:!0,attrs:{class:"language-cpp"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Impose a reasonable limit - no human can read that much anyway.")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("int")]),t._v(" MAX_RSS_SUBSCRIPTIONS "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1000")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("p",[t._v("Sometimes it’s a value that’s been highly tuned, and probably shouldn’t be adjusted much:")]),t._v(" "),s("div",{staticClass:"language-cpp extra-class"},[s("pre",{pre:!0,attrs:{class:"language-cpp"}},[s("code",[t._v("image_quality "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.72")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// users thought 0.72 gave the best size/quality tradeoff")]),t._v("\n")])])]),s("p",[t._v("In all these examples, you might not have thought to add comments, but they’re quite helpful.")]),t._v(" "),s("p",[t._v("There are some constants that don’t need a comment, because their name is clear enough (e.g., "),s("code",[t._v("SECONDS_PER_DAY")]),t._v("). But in our experience, most constants could be improved by adding a comment. It’s just a matter of jotting down what you were thinking about when you decided on that constant’s value.")]),t._v(" "),s("h2",{attrs:{id:"put-yourself-in-the-reader-s-shoes"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#put-yourself-in-the-reader-s-shoes"}},[t._v("#")]),t._v(" Put Yourself in the Reader’s Shoes")]),t._v(" "),s("p",[t._v("A general technique we use in this book is to "),s("strong",[t._v("imagine what your code looks like to an outsider")]),t._v(" —someone who isn’t as intimately familiar with your project as you are. This technique is especially useful to help you recognize what needs commenting.")]),t._v(" "),s("h3",{attrs:{id:"anticipating-likely-questions"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#anticipating-likely-questions"}},[t._v("#")]),t._v(" "),s("strong",[t._v("Anticipating Likely Questions")])]),t._v(" "),s("p",[t._v("When someone else reads your code, there are parts likely to make them think, "),s("em",[t._v("Huh? What’s this all about?")]),t._v(" Your job is to comment those parts.")]),t._v(" "),s("p",[t._v("For example, take a look at the definition of "),s("code",[t._v("Clear()")]),t._v(":")]),t._v(" "),s("div",{staticClass:"language-cpp extra-class"},[s("pre",{pre:!0,attrs:{class:"language-cpp"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("struct")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Recorder")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    vector"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("float")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" data"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("Clear")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        vector"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("float")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("swap")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("data"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Huh? Why not just data.clear()?")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("p",[t._v("When most C++ programmers see this code, they think, "),s("em",[t._v("Why didn’t he just do data.clear() instead of swapping with an empty vector?")]),t._v(" Well, it turns out that this is the only way to force a vector to truly relinquish its memory to the memory allocator. It’s a C++ detail that isn’t well known.")]),t._v(" "),s("p",[t._v("The bottom line is that it should be commented:")]),t._v(" "),s("div",{staticClass:"language-cpp extra-class"},[s("pre",{pre:!0,attrs:{class:"language-cpp"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v('// Force vector to relinquish its memory (look up "STL swap trick")')]),t._v("\nvector"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("float")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("swap")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("data"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("h3",{attrs:{id:"advertising-likely-pitfalls"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#advertising-likely-pitfalls"}},[t._v("#")]),t._v(" "),s("strong",[t._v("Advertising Likely Pitfalls")])]),t._v(" "),s("p",[t._v("When documenting a function or class, a good question to ask yourself is, "),s("em",[t._v("What is surprising about this code? How might it be misused?")]),t._v(" Basically, you want to “think ahead” and anticipate the problems that people might run into when using your code.")]),t._v(" "),s("p",[t._v("For example, suppose you wrote a function that sends an email to a given user:")]),t._v(" "),s("div",{staticClass:"language-cpp extra-class"},[s("pre",{pre:!0,attrs:{class:"language-cpp"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("SendEmail")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("string to"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" string subject"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" string body"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("p",[t._v("The implementation of this function involves connecting to an external email service, which might take up to a whole second, or possibly longer. Someone who is writing a web application might not realize this and mistakenly call this function while handling an HTTP request. (Doing this would cause their web application to “hang” if the email service is down.)")]),t._v(" "),s("p",[t._v("To prevent this likely mishap, you should comment on this “implementation detail”:")]),t._v(" "),s("div",{staticClass:"language-cpp extra-class"},[s("pre",{pre:!0,attrs:{class:"language-cpp"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Calls an external service to deliver email. (Times out after 1 minute.)")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("SendEmail")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("string to"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" string subject"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" string body"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("p",[t._v("Here is another example: suppose you have a "),s("code",[t._v("FixBrokenHtml()")]),t._v(" function that attempts to rewrite broken HTML by inserting missing closing tags and the like:")]),t._v(" "),s("div",{staticClass:"language-py extra-class"},[s("pre",{pre:!0,attrs:{class:"language-py"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("FixBrokenHtml")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("html"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n")])])]),s("p",[t._v("The function works great, except for the caveat that its running time blows up when there are deeply nested and unmatched tags. For nasty HTML inputs, this function could take "),s("em",[t._v("minutes")]),t._v(" to execute.")]),t._v(" "),s("p",[t._v("Rather than let the user discover this later on his own, it’s better to announce this upfront:")]),t._v(" "),s("div",{staticClass:"language-cpp extra-class"},[s("pre",{pre:!0,attrs:{class:"language-cpp"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Runtime is O(number_tags * average_tag_depth), so watch out for badly nested inputs.")]),t._v("\ndef "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("FixBrokenHtml")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("html"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n")])])]),s("h3",{attrs:{id:"big-picture-comments"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#big-picture-comments"}},[t._v("#")]),t._v(" "),s("strong",[t._v("“Big Picture” Comments")])]),t._v(" "),s("p",[t._v("One of the hardest things for a new team member to understand is the “big picture” — how classes interact, how data flows through the whole system, and where the entry points are.")]),t._v(" "),s("p",[t._v("The person who designed the system often forgets to comment about this stuff because he’s so intimately involved with it.")]),t._v(" "),s("p",[t._v("Consider this thought experiment: "),s("strong",[t._v("someone new just joined your team, she’s sitting next to you, and you need to get her familiar with the codebase.")])]),t._v(" "),s("p",[t._v("As you’re giving her a tour of the codebase, you might point out certain files or classes and say things like:")]),t._v(" "),s("ul",[s("li",[t._v("“This is the glue code between our business logic and the database. None of the application code should use this directly.”")]),t._v(" "),s("li",[t._v("“This class looks complicated, but it’s really just a smart cache. It doesn’t know anything about the rest of the system.”")])]),t._v(" "),s("p",[t._v("After a minute of casual conversation, your new team member will know much more than she would from reading the source by herself.")]),t._v(" "),s("p",[s("strong",[t._v("This is exactly the type of information that should be included as high-level comments.")])]),t._v(" "),s("p",[t._v("Here’s a simple example of a file-level comment:")]),t._v(" "),s("div",{staticClass:"language-cpp extra-class"},[s("pre",{pre:!0,attrs:{class:"language-cpp"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// This file contains helper functions that provide a more convenient interface to our")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// file system. It handles file permissions and other nitty-gritty details.")]),t._v("\n")])])]),s("p",[t._v("Don’t get overwhelmed by the thought that you have to write extensive, formal documentation. "),s("strong",[t._v("A few well-chosen sentences are better than nothing at all.")])]),t._v(" "),s("h3",{attrs:{id:"summary-comments"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#summary-comments"}},[t._v("#")]),t._v(" "),s("strong",[t._v("Summary Comments")])]),t._v(" "),s("p",[t._v("Even deep inside a function, it’s a good idea to comment on the “bigger picture.” Here’s an example of a comment that neatly summarizes the low-level code below it:")]),t._v(" "),s("div",{staticClass:"language-py extra-class"},[s("pre",{pre:!0,attrs:{class:"language-py"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Find all the items that customers purchased for themselves.")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" customer_id "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" all_customers"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" sale "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" all_sales"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("customer_id"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("sales"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" sale"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("recipient "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" customer_id"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n")])])]),s("p",[t._v("Without this comment, reading each line of code is a bit of a mystery. (“I see we’re iterating through all_customers ... but what for?”)")]),t._v(" "),s("p",[t._v("It’s especially helpful to have these summary comments in longer functions where there are a few large “chunks” inside:")]),t._v(" "),s("div",{staticClass:"language-py extra-class"},[s("pre",{pre:!0,attrs:{class:"language-py"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("def")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("GenerateUserReport")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Acquire a lock for this user")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Read user's info from the database")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Write info to a file")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Release the lock for this user")]),t._v("\n")])])]),s("p",[t._v("These comments also act as a bulleted summary of what the function does, so the reader can get the gist of what the function does before diving into details. (If these chunks are easily separable, you might just make them functions of their own. As we mentioned before, good code is better than bad code with good comments.)")]),t._v(" "),s("div",{staticClass:"custom-block tip"},[s("p",{staticClass:"custom-block-title"},[t._v("SHOULD YOU COMMENT THE WHAT, THE WHY, OR THE HOW?")]),t._v(" "),s("p",[t._v("You may have heard advice like, “"),s("em",[t._v("Comment the why, not the what (or the how).")]),t._v("” Although catchy, we feel these statements are too simplistic and mean different things to different people.")]),t._v(" "),s("p",[t._v("Our advice is to do whatever helps the reader understand the code more easily. This may involve commenting the what , the how , or the why (or all three).")])]),t._v(" "),s("h2",{attrs:{id:"final-thoughts-getting-over-writer-s-block"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#final-thoughts-getting-over-writer-s-block"}},[t._v("#")]),t._v(" Final Thoughts—Getting Over Writer’s Block")]),t._v(" "),s("p",[t._v("A lot of coders don’t like to write comments because it feels like a lot of work to write a good one. When writers have this sort of “writer’s block,” the best solution is to just start writing.")]),t._v(" "),s("p",[t._v("So the next time you’re hesitating to write a comment, just go ahead and comment what you’re thinking, however half-baked it may be.")]),t._v(" "),s("p",[t._v("For example, suppose you’re working on a function and think to yourself, "),s("em",[t._v("Oh crap, this stuff will get tricky if there are ever duplicates in this list.")]),t._v(" Just write that down:")]),t._v(" "),s("div",{staticClass:"language-cpp extra-class"},[s("pre",{pre:!0,attrs:{class:"language-cpp"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Oh crap, this stuff will get tricky if there are ever duplicates in this list.")]),t._v("\n")])])]),s("p",[t._v("See, was that so hard? It’s actually not that bad of a comment—certainly better than nothing.")]),t._v(" "),s("p",[t._v("The language is a little vague though. To fix it, we can just go through each phrase and replace it with something more specific:")]),t._v(" "),s("ul",[s("li",[t._v("By “oh crap,” you really mean “Careful: this is something to watch out for.”")]),t._v(" "),s("li",[t._v("By “this stuff,” you mean “the code that’s handling this input.”")]),t._v(" "),s("li",[t._v("By “will get tricky,” you mean “will be hard to implement.”")])]),t._v(" "),s("p",[t._v("The new comment might be:")]),t._v(" "),s("div",{staticClass:"language-cpp extra-class"},[s("pre",{pre:!0,attrs:{class:"language-cpp"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Careful: this code doesn't handle duplicates in the list (because that's hard to do)")]),t._v("\n")])])]),s("p",[t._v("Notice that we’ve broken down the task of writing a comment into these simpler steps:")]),t._v(" "),s("ol",[s("li",[t._v("Write down whatever comment is on your mind.")]),t._v(" "),s("li",[t._v("Read the comment, and see what (if anything) needs to be improved.")]),t._v(" "),s("li",[t._v("Make improvements.")])]),t._v(" "),s("p",[t._v("As you comment more often, you’ll find that the quality of comments from step 1 gets better and better and eventually might not need fixing at all. And by commenting early and often, you avoid the unpleasant situation of needing to write a bunch of comments at the end.")]),t._v(" "),s("h2",{attrs:{id:"summary"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#summary"}},[t._v("#")]),t._v(" Summary")]),t._v(" "),s("p",[t._v("The purpose of a comment is to help the reader know what the writer knew when writing the code. This whole chapter is about realizing all the not-so-obvious nuggets of information you have about the code and writing those down.")]),t._v(" "),s("p",[t._v("What "),s("em",[t._v("not")]),t._v(" to comment:")]),t._v(" "),s("ul",[s("li",[t._v("Facts that can be quickly derived from the code itself.")]),t._v(" "),s("li",[t._v("“Crutch comments” that make up for bad code (such as a bad function name) — fix the code instead.")])]),t._v(" "),s("p",[t._v("Thoughts you should be recording include:")]),t._v(" "),s("ul",[s("li",[t._v("Insights about why code is one way and not another (“director commentary”).")]),t._v(" "),s("li",[t._v("Flaws in your code, by using markers like "),s("code",[t._v("TODO:")]),t._v(" or "),s("code",[t._v("XXX:")]),t._v(".")]),t._v(" "),s("li",[t._v("The “story” for how a constant got its value.")])]),t._v(" "),s("p",[t._v("Put yourself in the reader’s shoes:")]),t._v(" "),s("ul",[s("li",[t._v("Anticipate which parts of your code will make readers say “Huh?” and comment those.")]),t._v(" "),s("li",[t._v("Document any surprising behavior an average reader wouldn’t expect.")]),t._v(" "),s("li",[t._v("Use “big picture” comments at the file/class level to explain how all the pieces fit together.")]),t._v(" "),s("li",[t._v("Summarize blocks of code with comments so that the reader doesn’t get lost in the details.")])])])}),[],!1,null,null,null);e.default=n.exports}}]);